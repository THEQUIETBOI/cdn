var JP=Object.defineProperty;var $P=(i,e)=>{for(var t in e)JP(i,t,{get:e[t],enumerable:!0})};function Vn(){}var Qx=i=>i;function e1(i,e){for(let t in e)i[t]=e[t];return i}function a2(i){return i()}function l2(){return Object.create(null)}function cr(i){i.forEach(a2)}function Jr(i){return typeof i=="function"}function ai(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}function QP(i){return Object.keys(i).length===0}function Iy(i,...e){if(i==null)return Vn;let t=i.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function en(i){let e;return Iy(i,t=>e=t)(),e}function It(i,e,t){i.$$.on_destroy.push(Iy(e,t))}function fo(i){return i??""}function on(i,e,t){return i.set(t),e}function Cl(i){return i&&Jr(i.destroy)?i.destroy:Vn}var c2=typeof window!="undefined",ek=c2?()=>window.performance.now():()=>Date.now(),t1=c2?i=>requestAnimationFrame(i):Vn,Kd=new Set;function u2(i){Kd.forEach(e=>{e.c(i)||(Kd.delete(e),e.f())}),Kd.size!==0&&t1(u2)}function tk(i){let e;return Kd.size===0&&t1(u2),{promise:new Promise(t=>{Kd.add(e={c:i,f:t})}),abort(){Kd.delete(e)}}}function Q(i,e){i.appendChild(e)}function h2(i){if(!i)return document;let e=i.getRootNode?i.getRootNode():i.ownerDocument;return e&&e.host?e:i.ownerDocument}function ik(i){let e=Ie("style");return nk(h2(i),e),e}function nk(i,e){Q(i.head||i,e)}function Gt(i,e,t){i.insertBefore(e,t||null)}function Bt(i){i.parentNode.removeChild(i)}function Is(i,e){for(let t=0;t<i.length;t+=1)i[t]&&i[t].d(e)}function Ie(i){return document.createElement(i)}function ii(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function On(i){return document.createTextNode(i)}function ot(){return On(" ")}function Gs(){return On("")}function mn(i,e,t,s){return i.addEventListener(e,t,s),()=>i.removeEventListener(e,t,s)}function Yd(i){return function(e){return e.preventDefault(),i.call(this,e)}}function Z(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}function n1(i){return i===""?null:+i}function rk(i){return Array.from(i.childNodes)}function si(i,e){e=""+e,i.wholeText!==e&&(i.data=e)}function Ll(i,e){i.value=e??""}function Tm(i,e,t,s){i.style.setProperty(e,t,s?"important":"")}function ih(i,e){for(let t=0;t<i.options.length;t+=1){let s=i.options[t];if(s.__value===e){s.selected=!0;return}}i.selectedIndex=-1}function Em(i){let e=i.querySelector(":checked")||i.options[0];return e&&e.__value}function Rn(i,e,t){i.classList[t?"add":"remove"](e)}function d2(i,e,t=!1){let s=document.createEvent("CustomEvent");return s.initCustomEvent(i,t,!1,e),s}var i1=new Set,Cy=0;function sk(i){let e=5381,t=i.length;for(;t--;)e=(e<<5)-e^i.charCodeAt(t);return e>>>0}function ok(i,e,t,s,c,h,p,r=0){let x=16.666/s,v=`{
`;for(let L=0;L<=1;L+=x){let z=e+(t-e)*h(L);v+=L*100+`%{${p(z,1-z)}}
`}let w=v+`100% {${p(t,1-t)}}
}`,S=`__svelte_${sk(w)}_${r}`,A=h2(i);i1.add(A);let I=A.__svelte_stylesheet||(A.__svelte_stylesheet=ik(i).sheet),R=A.__svelte_rules||(A.__svelte_rules={});R[S]||(R[S]=!0,I.insertRule(`@keyframes ${S} ${w}`,I.cssRules.length));let k=i.style.animation||"";return i.style.animation=`${k?`${k}, `:""}${S} ${s}ms linear ${c}ms 1 both`,Cy+=1,S}function f2(i,e){let t=(i.style.animation||"").split(", "),s=t.filter(e?h=>h.indexOf(e)<0:h=>h.indexOf("__svelte")===-1),c=t.length-s.length;c&&(i.style.animation=s.join(", "),Cy-=c,Cy||ak())}function ak(){t1(()=>{Cy||(i1.forEach(i=>{let e=i.__svelte_stylesheet,t=e.cssRules.length;for(;t--;)e.deleteRule(t);i.__svelte_rules={}}),i1.clear())})}var Sm;function Am(i){Sm=i}function r1(){if(!Sm)throw new Error("Function called outside component initialization");return Sm}function Zs(i){r1().$$.on_mount.push(i)}function s1(i){r1().$$.after_update.push(i)}function Lo(){let i=r1();return(e,t)=>{let s=i.$$.callbacks[e];if(s){let c=d2(e,t);s.slice().forEach(h=>{h.call(i,c)})}}}function Jd(i,e){let t=i.$$.callbacks[e.type];t&&t.slice().forEach(s=>s.call(this,e))}var Mm=[],wi=[],Ly=[],o1=[],p2=Promise.resolve(),a1=!1;function g2(){a1||(a1=!0,p2.then(m2))}function Im(){return g2(),p2}function _a(i){Ly.push(i)}function po(i){o1.push(i)}var l1=new Set,Dy=0;function m2(){let i=Sm;do{for(;Dy<Mm.length;){let e=Mm[Dy];Dy++,Am(e),lk(e.$$)}for(Am(null),Mm.length=0,Dy=0;wi.length;)wi.pop()();for(let e=0;e<Ly.length;e+=1){let t=Ly[e];l1.has(t)||(l1.add(t),t())}Ly.length=0}while(Mm.length);for(;o1.length;)o1.pop()();a1=!1,l1.clear(),Am(i)}function lk(i){if(i.fragment!==null){i.update(),cr(i.before_update);let e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(_a)}}var Cm;function ck(){return Cm||(Cm=Promise.resolve(),Cm.then(()=>{Cm=null})),Cm}function _2(i,e,t){i.dispatchEvent(d2(`${e?"intro":"outro"}${t}`))}var Ry=new Set,rh;function mo(){rh={r:0,c:[],p:rh}}function go(){rh.r||cr(rh.c),rh=rh.p}function ri(i,e){i&&i.i&&(Ry.delete(i),i.i(e))}function mi(i,e,t,s){if(i&&i.o){if(Ry.has(i))return;Ry.add(i),rh.c.push(()=>{Ry.delete(i),s&&(t&&i.d(1),s())}),i.o(e)}}var uk={duration:0};function c1(i,e,t){let s=e(i,t),c=!1,h,p,r=0;function x(){h&&f2(i,h)}function v(){let{delay:S=0,duration:A=300,easing:I=Qx,tick:R=Vn,css:k}=s||uk;k&&(h=ok(i,0,1,A,S,I,k,r++)),R(0,1);let L=ek()+S,z=L+A;p&&p.abort(),c=!0,_a(()=>_2(i,!0,"start")),p=tk(B=>{if(c){if(B>=z)return R(1,0),_2(i,!0,"end"),x(),c=!1;if(B>=L){let $=I((B-L)/A);R($,1-$)}}return c})}let w=!1;return{start(){w||(w=!0,f2(i),Jr(s)?(s=s(),ck().then(v)):v())},invalidate(){w=!1},end(){c&&(x(),c=!1)}}}var u1=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function h1(i,e){mi(i,1,1,()=>{e.delete(i.key)})}function d1(i,e,t,s,c,h,p,r,x,v,w,S){let A=i.length,I=h.length,R=A,k={};for(;R--;)k[i[R].key]=R;let L=[],z=new Map,B=new Map;for(R=I;R--;){let le=S(c,h,R),te=t(le),ue=p.get(te);ue?s&&ue.p(le,e):(ue=v(te,le),ue.c()),z.set(te,L[R]=ue),te in k&&B.set(te,Math.abs(R-k[te]))}let $=new Set,H=new Set;function G(le){ri(le,1),le.m(r,w),p.set(le.key,le),w=le.first,I--}for(;A&&I;){let le=L[I-1],te=i[A-1],ue=le.key,me=te.key;le===te?(w=le.first,A--,I--):z.has(me)?!p.has(ue)||$.has(ue)?G(le):H.has(me)?A--:B.get(ue)>B.get(me)?(H.add(ue),G(le)):($.add(me),A--):(x(te,p),A--)}for(;A--;){let le=i[A];z.has(le.key)||x(le,p)}for(;I;)G(L[I-1]);return L}function f1(i,e){let t={},s={},c={$$scope:1},h=i.length;for(;h--;){let p=i[h],r=e[h];if(r){for(let x in p)x in r||(s[x]=1);for(let x in r)c[x]||(t[x]=r[x],c[x]=1);i[h]=r}else for(let x in p)c[x]=1}for(let p in s)p in t||(t[p]=void 0);return t}function p1(i){return typeof i=="object"&&i!==null?i:{}}function _o(i,e,t){let s=i.$$.props[e];s!==void 0&&(i.$$.bound[s]=t,t(i.$$.ctx[s]))}function mr(i){i&&i.c()}function dr(i,e,t,s){let{fragment:c,on_mount:h,on_destroy:p,after_update:r}=i.$$;c&&c.m(e,t),s||_a(()=>{let x=h.map(a2).filter(Jr);p?p.push(...x):cr(x),i.$$.on_mount=[]}),r.forEach(_a)}function fr(i,e){let t=i.$$;t.fragment!==null&&(cr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function hk(i,e){i.$$.dirty[0]===-1&&(Mm.push(i),g2(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function Ti(i,e,t,s,c,h,p,r=[-1]){let x=Sm;Am(i);let v=i.$$={fragment:null,ctx:null,props:h,update:Vn,not_equal:c,bound:l2(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:l2(),dirty:r,skip_bound:!1,root:e.target||x.$$.root};p&&p(v.root);let w=!1;if(v.ctx=t?t(i,e.props||{},(S,A,...I)=>{let R=I.length?I[0]:A;return v.ctx&&c(v.ctx[S],v.ctx[S]=R)&&(!v.skip_bound&&v.bound[S]&&v.bound[S](R),w&&hk(i,S)),A}):[],v.update(),w=!0,cr(v.before_update),v.fragment=s?s(v.ctx):!1,e.target){if(e.hydrate){let S=rk(e.target);v.fragment&&v.fragment.l(S),S.forEach(Bt)}else v.fragment&&v.fragment.c();e.intro&&ri(i.$$.fragment),dr(i,e.target,e.anchor,e.customElement),m2()}Am(x)}var gi=class{$destroy(){fr(this,1),this.$destroy=Vn}$on(e,t){let s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{let c=s.indexOf(t);c!==-1&&s.splice(c,1)}}$set(e){this.$$set&&!QP(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var Dl={};$P(Dl,{MODE:()=>fk,NODE_ENV:()=>pk,SNOWPACK_PUBLIC_API_BASE:()=>g1,SNOWPACK_PUBLIC_CREDS:()=>dk,SNOWPACK_PUBLIC_MAPBOX_TOKEN:()=>m1,SNOWPACK_PUBLIC_WS_BASE:()=>_1,SSR:()=>mk});var dk="null",m1="pk.eyJ1IjoicXVhZHdlYXRoZXIiLCJhIjoiY2w2YXZ4YjAzMWdmODNkbWx5YmwycjcxaSJ9.DOMnL520hn-dTFcGgkH2BQ",g1="https://radar.quadweather.com/api",_1="wss://radar.quadweather.com/ws",fk="production",pk="production",mk=!1;var $d=[];function y1(i,e){return{subscribe:Ai(i,e).subscribe}}function Ai(i,e=Vn){let t,s=new Set;function c(r){if(ai(i,r)&&(i=r,t)){let x=!$d.length;for(let v of s)v[1](),$d.push(v,i);if(x){for(let v=0;v<$d.length;v+=2)$d[v][0]($d[v+1]);$d.length=0}}}function h(r){c(r(i))}function p(r,x=Vn){let v=[r,x];return s.add(v),s.size===1&&(t=e(c)||Vn),r(i),()=>{s.delete(v),s.size===0&&(t(),t=null)}}return{set:c,update:h,subscribe:p}}function v1(i,e,t){let s=!Array.isArray(i),c=s?[i]:i,h=e.length<2;return y1(t,p=>{let r=!1,x=[],v=0,w=Vn,S=()=>{if(v)return;w();let I=e(s?x[0]:x,p);h?p(I):w=Jr(I)?I:Vn},A=c.map((I,R)=>Iy(I,k=>{x[R]=k,v&=~(1<<R),r&&S()},()=>{v|=1<<R}));return r=!0,S(),function(){cr(A),w()}})}import.meta.env=Dl;function gk(){let i=new Worker(new URL("./worker.js",import.meta.url));return{worker:i,setOnMessage:function(t,s,c,h,p,r,x,v,w,S,A){function I(k,L){let z=Ii.get(k);z.rejects.pop();let B=z.resolves.pop(),$=z.timeoutIds.pop();z.jobIds.pop(),L.thread=z.threads.pop(),clearTimeout($),B(L)}function R(k,L){let z=Ii.get(k),B=z.rejects.pop();z.resolves.pop();let $=z.timeoutIds.pop();z.jobIds.pop(),L.thread=z.threads.pop(),L.action="testFail",clearTimeout($),B(L)}i.onmessage=function(k){let L=k.data.action,z=k.data.data;if(L==="error"&&x.update(B=>(B.error=!0,B.message=z.message,B.header=z.header,B)),L==="noop"&&I(z.jobId,k.data),L==="initialize"&&t.update(B=>{B.loading=z.file,B.finished=0;let $;return z.type==="start"&&($=!0),B[z.file]={fileName:z.fileName,fileNumber:z.file,elevationFiles:z.elevationFile?[z.elevationFile]:[],date:z.date.getTime(),percent:-1,loaded:$},B}),L==="update"&&t.update(B=>(B.loading=z.file,B.finished=0,B[z.file]&&Object.assign(B[z.file],{station:z.station,scans:[],idxs:{},percent:0,vcp:z.vcp,radarMetadata:{}}),B)),L==="archive2"&&t.update(B=>(B[z.file]&&(B[z.file].vcp=z.vcp),B)),L==="elevationDone"&&(t.update(B=>(B.loading=-1,B.finished=1,B[z.file]&&B[z.file].elevationFiles?.push(z.elevationFile),B)),I(z.jobId,k.data)),L==="contentFinished"&&(t.update(B=>(B.loading=-1,B.finished=1,B[z.file]&&(B[z.file].percent=-1,B[z.file].loaded=!0),B)),I(z.jobId,k.data)),L==="metadata"&&(t.update(B=>{if(B.loading=z.file,B.finished=0,!B[z.file])return B;let $=z.elevation.toFixed(1);if(!($ in B[z.file].idxs))B[z.file].idxs[$]=B[z.file].scans.length,B[z.file].scans.push([[{elevation:z.elevation,idx:z.idx,date:z.date,percent:z.percent,fields:z.fields,fileNumber:z.file,rounded:$,fileName:z.fileName}]]);else{let H=B[z.file].scans[B[z.file].idxs[$]];for(let G=0;G<H.length;G++){let le=H[G];for(let te=0;te<le.length;te++)if(z.idx-le[te].idx==1)return le.push({elevation:z.elevation,idx:z.idx,date:z.date,percent:z.percent,fields:z.fields,fileNumber:z.file,rounded:$,fileName:z.fileName}),B}B[z.file].scans[B[z.file].idxs[$]].push([{elevation:z.elevation,idx:z.idx,date:z.date,percent:z.percent,fields:z.fields,fileNumber:z.file,rounded:$,fileName:z.fileName}])}return B}),z.idx===0)){if(!en(t)[z.file])return;t.update(B=>(B[z.file]&&(B[z.file].radarMetadata={lat:z.lat,lon:z.lon,station:en(t)[z.file].station}),B)),en(c).station!=en(t)[z.file].station&&c.update(B=>({lat:z.lat,lon:z.lon,station:en(t)[z.file].station,feedhorn:z.feedhorn}))}if(L==="loadData"){if(en(t).filter(G=>G!=null).map(G=>G.fileName).indexOf(z.fileName)<0){let G=`${z.fileName}_${z.type}_${z.elevation}`;S.deleteItem(G)===0&&S.dequeue();return}A.update(G=>(G[z.file]=z.pixelGeometry,G)),s.update(G=>(G[z.file]||(G[z.file]={0:Array.apply(null,Array(30)).map(function(){}),1:Array.apply(null,Array(30)).map(function(){}),255:Array.apply(null,Array(30)).map(function(){}),9:Array.apply(null,Array(30)).map(function(){}),10:Array.apply(null,Array(30)).map(function(){}),5:Array.apply(null,Array(30)).map(function(){}),2:Array.apply(null,Array(30)).map(function(){})}),G[z.file][z.type][z.elevation]=z.float,G));let H=`${z.fileName}_${z.type}_${z.elevation}`;S.deleteItem(H)===0&&S.dequeue()}if(L==="testResponse"&&I(z.jobId,k.data),L==="didNotExist"){let B=Ii.get(z.jobId),$=B.rejects.pop();B.resolves.pop(),B.jobIds.pop();let H=B.timeoutIds.pop();z.thread=B.threads.pop(),clearTimeout(H),$({action:"didNotExist",data:{jobId:z.jobId,map:z.map,thread:z.thread}})}if(L==="loadTexture"){if(en(t).filter(G=>G!=null).map(G=>G.fileName).indexOf(z.fileName)<0){let G=`${z.fileName}_${z.type}_${z.elevation}`;S.deleteItem(G)===0&&S.dequeue();return}p.update(G=>{let le={};return le.float=z.float,le.size=z.size,le.scale=z.scale,le.offset=z.offset,le.bin1=z.bin1,le.binMax=z.binMax,le.ngates=z.ngates/(1e3/z.gate_size),G[z.fileNum]=le,G});let H=`${z.fileName}_${z.type}_${z.elevation}`;S.deleteItem(H)===0&&S.dequeue()}if(L==="deleted"&&(I(z.jobId,k.data),en(t)[en(h)[0].file]===void 0&&v.update(B=>!0)),L==="read3DBytes"&&I(z.jobId,k.data),L==="readBytes"&&I(z.jobId,k.data),L==="try_again"){let B=Ii.get(z.jobId),$=B.rejects.pop();B.resolves.pop(),B.jobIds.pop(),z.thread=B.threads.pop(),clearTimeout(B.timeoutId),$({action:"try_again",data:{jobId:B.data.jobId,thread:z.thread}})}}}}}var y2=gk;import.meta.env=Dl;function _k(){let i=new Worker(new URL("./workerVertices.js",import.meta.url));function e(t){function s(c,h,p){let r;p==="vertex"?r=Ur.get(c):p==="dealias"?r=Ks.get(c):p==="3d"&&(r=Ur.get(c)),r.rejects.pop();let x=r.resolves.pop(),v=r.timeoutIds.pop();r.timeouts.pop(),r.jobIds.pop(),h.thread=r.threads.pop(),clearTimeout(v),x(h)}i.onmessage=function(c){let h=c.data.action,p=c.data.data,r;if(p.origin==="vertex"?r=Ur.get(p.jobId):p.origin==="dealias"?r=Ks.get(p.jobId):p.origin==="3d"&&(r=Ur.get(p.jobId)),r!==void 0){if(h==="loadTexture"){let x={action:c.data.action,data:{jobId:c.data.data.jobId}};if(en(ni).filter(S=>S!=null).map(S=>S.fileName).indexOf(p.fileName)<0){s(p.jobId,x,p.origin);return}Cs.update(S=>{let A={};return A.float=p.float,A.size=p.size,A.scale=p.scale,A.offset=p.offset,A.bin1=p.bin1,A.binMax=p.binMax,A.ngates=p.ngates/(1e3/p.gate_size),A.fileName=p.fileName,A.elevations=p.elevations,S[p.fileNum]=A,S}),s(p.jobId,x,p.origin)}if(h==="processVertices"){let x={action:c.data.action,data:{jobId:c.data.data.jobId}};if(en(ni).filter(S=>S!=null).map(S=>S.fileName).indexOf(p.fileName)<0){s(p.jobId,x,p.origin);return}Rl.update(S=>(S[p.file][p.type]=p.pixelGeometry,S)),t.update(S=>(S[p.file]||(S[p.file]={0:Array.apply(null,Array(30)).map(function(){}),1:Array.apply(null,Array(30)).map(function(){}),255:Array.apply(null,Array(30)).map(function(){}),9:Array.apply(null,Array(30)).map(function(){}),10:Array.apply(null,Array(30)).map(function(){}),5:Array.apply(null,Array(30)).map(function(){}),2:Array.apply(null,Array(30)).map(function(){})}),S[p.file][p.type][p.elevation]=p.float,S)),s(p.jobId,x,p.origin)}}}}return{worker:i,setOnMessage:e}}var v2=_k;var Py=Symbol("single"),Er=Symbol("double"),Pl=Symbol("single_hidden"),yo={REFLECTIVITY:Symbol("reflectivity"),VELOCITY:Symbol("velocity"),VELOCITY_DEALIASED:Symbol("velocity_dealiased"),CC:Symbol("cc"),PHI:Symbol("phi"),SW:Symbol("sw"),ZDR:Symbol("zdr")},Ka={DEALIASED:Symbol("dealiased"),RAW:Symbol("raw")},vs={READING:Symbol("reading"),MODE3D:Symbol("mode3d"),CROSS:Symbol("cross"),LIVE:Symbol("live")},Qd={FILE:Symbol("file"),ELEVATION:Symbol("elevation")},vo={HISTORICAL:Symbol("historical"),LIVE:Symbol("live")};function bo(i=null){let e=i?i.f:function(){},{REFLECTIVITY:t,VELOCITY:s,VELOCITY_DEALIASED:c,CC:h,PHI:p,ZDR:r,SW:x}=yo,v={[t]:0,[s]:1,[c]:255,[h]:9,[p]:10,[r]:5,[x]:2},w={255:100,0:10,1:15,9:20,10:90,5:25,2:30,254:80},{READING:S,MODE3D:A,CROSS:I}=vs,{DEALIASED:R}=Ka;function k(H,G,le,te){return{elevation:H,file:G,type:le,dealiased:0,scan:te}}function L(H,G){if(en(Cs)[H]===void 0||en(ni)[H].scans.length!=en(Cs)[H].elevations.length){let le={data:{fileNum:H,idx:255,field:254,fileName:G,priority:80,map:-1,message:"read3DBytes",selections:en(_i),scans:en(ni)}};Ur.submit(le),Ya.update(te=>!0)}}function z(H,G,le,te,ue){if(en(Ys)[le]&&en(Ys)[le][H][G])return;let me,se=en(_i)[te].scan.scan,Y;H===255?Y=1:Y=H;for(let ye=0;ye<se.length;ye++)if(se[ye].fields.indexOf(Y)>-1){me=!0;break}if(me)if(H===255){let ye={data:{fileNum:le,idx:G,field:H,fileName:ue,priority:w[H],map:te,message:"readBytes"}};Ks.submit(ye)}else if(H===254){let ye=item.item.selections[0].file;if(item.item.scans[ye]===void 0){deleteItem(firstKey)===0&&dequeue();return}worker.postMessage({message:"set3d",data:item.item})}else{let ye={data:{fileNum:le,idx:G,field:H,fileName:ue,priority:w[H],map:te,message:"readBytes"}};Ur.submit(ye)}else en(Ys)[le]&&(en(Ys)[le][H][G]=new Float32Array([]));en(qr)[te].setLoading()}function B(H,G){let le;G===255&&(G=1);for(let te=0;te<H.length;te++)if(H[te].fields.indexOf(G)>-1){le=H[te].idx;break}return le}function $(H){if(H===null)return;let G;en($r)===Er?G=[0,1]:G=[0];let le=[null,null],te=[];for(let ae=0;ae<H.scan.length;ae++)te=te.concat(H.scan[ae].fields);let ue=new Set(te),me=en(qr).map((ae,de)=>{if(ae&&G.indexOf(de)>-1)return v[ae.field]}).filter(ae=>ae!=null),se=en(qr);me=me.map((ae,de)=>{let xe;if(ae===255?xe=1:xe=ae,ue.has(xe))return ae;if(de==0)return se[de].updateField(t),0;if(de==1)return en(kl)===R?(se[de].updateField(c),255):(se[de].updateField(s),1)});let Y=H.scan,ye=JSON.stringify(en(_i)),Xe=en(_i)[0].file,ge=me.map(ae=>k(B(Y,ae),H.fileNumber,ae,H)),re=JSON.stringify(ge),ve=ge[0].file;if(ye!==re){_i.update(ae=>me.map(de=>k(B(Y,de),H.fileNumber,de,H))),en(_i)[0].scan.station!=en(xo).station&&xo.update(ae=>en(ni)[en(_i)[0].file].radarMetadata);for(let ae=0;ae<me.length;ae++)z(me[ae],B(Y,me[ae]),H.fileNumber,ae,H.fileName);ve!=en(ya)&&((en(Xr)===A||en(Xr)===I)&&L(H.fileNumber,H.fileName),ya.update(ae=>ve))}}return{logStore:$}}var Ls=[];for(var x1=0;x1<256;++x1)Ls.push((x1+256).toString(16).slice(1));function yk(i,e=0){return(Ls[i[e+0]]+Ls[i[e+1]]+Ls[i[e+2]]+Ls[i[e+3]]+"-"+Ls[i[e+4]]+Ls[i[e+5]]+"-"+Ls[i[e+6]]+Ls[i[e+7]]+"-"+Ls[i[e+8]]+Ls[i[e+9]]+"-"+Ls[i[e+10]]+Ls[i[e+11]]+Ls[i[e+12]]+Ls[i[e+13]]+Ls[i[e+14]]+Ls[i[e+15]]).toLowerCase()}var ky,vk=new Uint8Array(16);function xk(){if(!ky&&(ky=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ky))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ky(vk)}var bk=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),x2={randomUUID:bk};function b2(i,e,t){if(x2.randomUUID&&!e&&!i)return x2.randomUUID();i=i||{};var s=i.random||(i.rng||xk)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(var c=0;c<16;++c)e[t+c]=s[c];return e}return yk(s)}function w2(i,e){let t=0,s=e[0],c=Math.abs(i-s);for(let h=0;h<e.length;h++){let p=Math.abs(i-e[h]);p<c&&(c=p,s=e[h],t=h)}return t}function wk(i,e,t,s){let c=Math.PI/180,h=(t-i)*c,p=(s-e)*c;i=i*c,t=t*c;let r=Math.pow(Math.sin(h/2),2)+Math.pow(Math.sin(p/2),2)*Math.cos(i)*Math.cos(t),x=6378.1,v=2*Math.asin(Math.sqrt(r));return x*v}function T2(i,e,t,s,c){let h=6378.1,p=Math.PI/180,x=wk(e,i,s,t)/h,v=p*c+90*p,w=Math.PI-v-x;return Math.sin(v)*(h/Math.sin(w))-h}function Ho(i){let e=/(\d{4})(\d{2})(\d{2})_(\d{2})(\d{2})(\d{2})/,t=i.match(e),s=/_V(\d{2})$/,c=i.match(s),h=/_(\d{2})$/,p=i.match(h),r,x,v,w={archive:55,chunk:60,start:55,unknown:65};if(t){let[S,A,I,R,k,L,z]=t;r=new Date(Date.UTC(A,I-1,R,k,L,z))}else r=new Date;return c?x="archive":p?(v=i,i=i.replace(/_(?!.*_).*/,""),x=p[1]==="01"?"start":"chunk"):x="unknown",{date:r,type:x,fileName:i,elevationFile:v,priority:w[x]}}function sh(i){let e=en(ni)[i].fileName;ni.update(s=>(s[i]=void 0,s)),i===en(_i)[0].file&&(_i.update(s=>(s=[{elevation:null,file:null,type:null,dealiased:null,scan:null},{elevation:null,file:null,type:null,dealiased:null,scan:null}],s)),ya.set(null),xo.set({})),Ys.update(s=>(s[i]=void 0,s)),Cs.update(s=>(s[i]=void 0,s)),Rl.update(s=>(s[i]={},s));let t={data:{message:"deleteFile",fileNum:i,fileName:e,priority:50}};Ii.submit(t)}var OH=bo(),{HISTORICAL:Tk,LIVE:w1}=vo;function A2(){let i,e,t,s=[],c="READY",h,p,r,x,v=0,w=!1,S,A,I=new Map;function R(re){h=re}function k(re){r=re}function L(re){x=re}function z(re){p=re}function B(re){if(en(Ds)!=w1)return;let ve,ae;if(re.message==="initialize"&&(v-=1,console.log("initialize trigger"),h&&h(v),c==="READY"&&(s.shift(),[ve]=I.keys(),ae=I.get(ve),ae&&$(ve))),re.message==="elevation_done"&&(console.log("elevation done trigger"),v-=1,h&&h(v),c==="READY"&&(s.shift(),[ve]=I.keys(),ae=I.get(ve),ae&&$(ve))),re.message==="try_again"){let de={message:"initialize",fileName:re.fileName,buffer:re.buffer};I.set(re.fileName,de),c==="READY"&&(s.shift(),[ve]=I.keys(),ae=I.get(ve),ae&&$(ve))}re.message==="deleted"&&(c="READY"),re.message==="noop"&&(v-=1,h&&h(v),I.has(re.fileName)&&I.delete(re.fileName),c==="READY"&&(s.shift(),[ve]=I.keys(),ae=I.get(ve),ae&&$(ae.fileName)))}function $(re){if(I.size!==0&&s.length===0){let ve=I.get(re);if(ve===void 0)return;I.delete(re),s.push(ve),(!ve.elevationFile||ve.elevationFile.slice(-3)==="_01")&&G(),va.postMessage(ve,[ve.buffer])}}function H(){let re=en(ni),ve=en(Vr);Object.assign(ve,{fileNames:[],elevations:[],stations:[],scans:[]}),ve.fileNames=[],ve.stations=[],ve.scans={},ve.elevations={};let ae={},de={};for(let xe=0;xe<re.length;xe++)re[xe]!=null&&(ve.fileNames.push(re[xe].fileName),ve.stations.indexOf(re[xe].station)<0&&ve.stations.push(re[xe].station),re[xe].station in ae?ae[re[xe].station]=ae[re[xe].station].concat(Object.keys(re[xe].idxs)):ae[re[xe].station]=Object.keys(re[xe].idxs),re[xe].station in de?de[re[xe].station]=de[re[xe].station].concat(re[xe].scans):de[re[xe].station]=re[xe].scans);for(let xe=0;xe<ve.stations.length;xe++){let De=ve.stations[xe];ve.elevations[De]=[],ve.scans[De]={},ve.elevations[De]=Array.from(new Set(ae[De])).sort(function(pe,xt){return+pe-+xt});let Ce=de[De];for(let pe=0;pe<ve.elevations[De].length;pe++)ve.scans[De][ve.elevations[De][pe]]=[];for(let pe=0;pe<Ce.length;pe++)ve.scans[De][Ce[pe][0][0].rounded].push(...Ce[pe]);for(let pe in ve.scans[De])ve.scans[De][pe]=ve.scans[De][pe].sort(function(xt,Ct){return xt[0].date-Ct[0].date})}}function G(re){let ae=en(ni).filter(Ce=>Ce!=null),de=Date.now(),xe,De;if(ae.length===5){for(let Ce=0;Ce<ae.length;Ce++)if(!ae[Ce].scans||!ae[Ce].scans[0]){xe=Ce,De=ae[Ce].fileName;break}else{let pe=ae[Ce].scans[0][0][0].date;pe<de&&(xe=Ce,De=ae[Ce].fileName,de=pe)}return sh(xe),Ii.complete(re.jobIds[re.jobIds.length-1],re.threads[re.threads.length-1]),Ii.submit({data:re.data}),!0}return!1}function le(){let re=en(ni);for(let ve=0;ve<re.length;ve++){if(re[ve]===void 0||re[ve].station===e)continue;let ae=re[ve].fileName,de=re[ve].fileNumber;re[ve].fileNumber===en(_i)[0].file&&(_i.set([{elevation:null,file:null,type:null,dealiased:null,scan:null},{elevation:null,file:null,type:null,dealiased:null,scan:null}]),ya.set(null),xo.set({})),ni.update(De=>(De[ve]=void 0,De)),Ys.update(De=>(De[ve]=void 0,De)),Cs.update(De=>(De[ve]=void 0,De));let xe={data:{message:"deleteFile",fileNum:de,fileName:ae,priority:50}};Ii.submit(xe)}}function te(){clearTimeout(A)}async function ue(re,ve,ae){return new Promise((xe,De)=>{let Ce={priority:70,origin:ae};re.data.field===254&&(Ce.origin="3d");let pe=re.data.jobId,xt=re.data.map,Ct=re.threads[re.threads.length-1];Object.assign(re.data,Ce);let ct={action:"timeout",data:{jobId:pe,map:xt,thread:Ct}},Qe=()=>{De(ct)},zt={jobIds:[pe],resolves:[xe],rejects:[De],threads:re.threads,timeouts:[Qe],timeoutIds:[],data:re.data};ve.set(pe,zt),Ii.submit(zt)})}Ur.on("submitted",re=>{Ur.process()}),Ks.on("submitted",re=>{Ks.process()}),Ii.on("submitted",re=>{Ii.process()}),Ii.on("complete",()=>{}),Ks.on("process",re=>{ue(re,Ks,"dealias").then(ae=>{Ks.complete(ae.data.jobId,ae.thread),Ks.process()}).catch(ae=>{let de=Ks.get(ae.data.jobId);de.data.jobId=ae.data.jobId,me(de,ae),(ae.action==="timeout"||ae.action==="didNotExist")&&(Ks.complete(ae.data.jobId,ae.data.thread),Ks.process())})}),Ur.on("process",re=>{ue(re,Ur,"vertex").then(ae=>{Ur.complete(ae.data.jobId,ae.thread),Ur.process()}).catch(ae=>{let de=Ur.get(ae.data.jobId);de.data.jobId=ae.data.jobId,me(de,ae),(ae.action==="timeout"||ae.action==="didNotExist")&&(Ur.complete(ae.data.jobId,ae.data.thread),Ur.process())})}),Ii.on("nextStep",re=>{re.data.jobId=re.jobIds[re.jobIds.length-1];let ve=re.threads[re.threads.length-1],ae=re.timeouts[re.timeouts.length-1],de;re.data.origin==="dealias"?de=3e4:de=15e3;let xe=setTimeout(ae,de);re.timeoutIds.push(xe),re.data.origin==="vertex"?(re.data.message="processVertices",b1.workers[ve].postMessage({data:re.data,transferrable:re.transferrable,struct:re.struct},[re.transferrable.array.buffer])):re.data.origin==="dealias"?(re.data.message="dealiasVertices",E2.workers[ve].postMessage({data:re.data,transferrable:re.transferrable,struct:re.struct},[re.transferrable.array.buffer])):re.data.origin==="3d"&&(re.data.message="process3D",b1.workers[ve].postMessage({data:re.data,transferrable:re.transferrable,struct:re.struct},[re.transferrable.buffer,re.transferrable.metadata,re.transferrable.offsets]))}),Ii.on("process",re=>{if((re.data.type==="archive"||re.data.type==="start")&&(Ii.set(re.data.jobId,re),G(re)))return;new Promise((ae,de)=>{let xe=re.data.jobId,Ce=setTimeout(()=>{let xt=Ii.get(re.data.jobId),Ct=xt.rejects.pop(),ct=xt.resolves.pop(),Qe=xt.jobIds.pop(),zt=xt.threads[xt.threads.length-1];Ct({action:"timeout",data:{jobId:xe,map:re.data.map,thread:zt}})},15e3);re.resolves.push(ae),re.rejects.push(de),re.timeoutIds.push(Ce),Ii.set(re.data.jobId,re);let pe=re.data.buffer?[re.data.buffer]:[];va.postMessage(re.data,pe)}).then(ae=>{let de=Ii.get(ae.data.jobId);ae.action==="deleted"&&(c="READY",x()),Ii.complete(ae.data.jobId,ae.thread),Ii.process();let xe=["contentFinished","elevationDone"];if(!Ii.checkProcessing()&&en(Ds)===w1&&xe.includes(ae.action)&&h&&h(0),!Ii.checkProcessing()&&en(Ds)===Tk&&ae.action!=="deleted"&&r&&r(),ae.action==="contentFinished"&&(de.data.source==="drop"?Rs.update(De=>{let Ce=De.readFiles.filter(pe=>pe!==de.data.fileName);return De.toRead-=1,De.read+=1,De.readFiles=Ce,De}):de.data.source==="download"&&Rs.update(De=>{let Ce=De.downloadFiles.filter(pe=>pe!==de.data.fileName);return De.toDownload-=1,De.downloaded+=1,De.downloadFiles=Ce,De}),x()),ae.action==="elevationDone"){let De=en(Cs)[ae.data.file];if(De){let Ce={data:{fileNum:ae.data.file,idx:De.elevations[De.elevations.length-1],field:254,fileName:ae.data.fileName,priority:80,message:"read3DBytes",map:-1,selections:en(_i),scans:en(ni)}};Ur.submit(Ce)}}ae.action==="read3DBytes"&&Ii.nextStep({jobIds:de.jobIds,resolves:de.resolves,rejects:de.rejects,timeouts:de.timeouts,timeoutIds:de.timeoutIds,threads:de.threads,data:ae.data,transferrable:ae.transferrable,struct:ae.struct}),ae.action==="readBytes"&&Ii.nextStep({jobIds:de.jobIds,resolves:de.resolves,rejects:de.rejects,timeouts:de.timeouts,timeoutIds:de.timeoutIds,threads:de.threads,data:ae.data,transferrable:ae.transferrable,struct:ae.struct})}).catch(ae=>{let de=Ii.get(ae.data.jobId);if(de.data.jobId=ae.data.jobId,ae.action==="didNotExist"||ae.action==="timeout"||ae.action==="testFail"){if(de.data.message!="readBytes"&&de.data.message!="read3DBytes"){de.data.source==="drop"?Rs.update(xe=>{let De=xe.readFiles.filter(Ce=>Ce!==de.data.fileName);return xe.toRead-=1,xe.read+=1,xe.readFiles=De,xe}):de.data.source==="download"&&Rs.update(xe=>{let De=xe.downloadFiles.filter(Ce=>Ce!==de.data.fileName);return xe.toDownload-=1,xe.downloaded+=1,xe.downloadFiles=De,xe}),Ii.complete(ae.data.jobId,ae.data.thread),Ii.process();return}me(de,ae),Ii.complete(ae.data.jobId,ae.data.thread),Ii.process()}ae.action==="try_again"&&(me(de,ae),Ii.complete(ae.data.jobId,ae.data.thread),Ii.submit(de))})});function me(re,ve){let ae=`${re.data.fileName}_${re.data.field}_${re.data.idx}`,de=en(_i),xe=de.length;for(let De=0;De<xe;De++)if(de[De].scan){let Ce=`${de[De].scan.fileName}_${de[De].type}_${de[De].elevation}`;if(ae===Ce){for(let pe=re.jobIds.length-1;pe>=0;pe--){let xt={action:ve.action,data:{jobId:re.jobIds[pe],thread:re.threads[pe]}};re.data.jobId!=re.jobIds[pe]&&re.rejects[pe](xt)}en(qr)[De].stopLoading()}}}function se(){let re={id:t,action:"ping"};i.send(JSON.stringify(re)),A=setTimeout(()=>{i.close()},3e3)}async function Y(re=null){if(!i)return new Promise(async function(ve,ae){if(!re)try{let de=await gr.getRefresh();gr.setToken(de);let xe=await gr.checkScopes([])}catch(de){return ae({error:"logout"})}i=new WebSocket(`${S2}/?token=${encodeURIComponent(gr.token)}`),i.onerror=function(de){i.close()},i.onopen=async function(){S&&(clearInterval(S),S=null),i.isAlive=!0,te(),S=setInterval(se,5e3),gr.get(`${$s}/alerts`).then(de=>de.json()).then(de=>{Lm.update(xe=>(xe=de,xe))}).catch(de=>console.log("fetch error",de)),ve(i)},i.onclose=function(de){te(),clearInterval(S),S=null,i=null,de.reason!=="Unauthorized"&&en(Ds)===w1&&setTimeout(function(){Y()},Math.max(Math.random()*2e3,3e3))},i.onmessage=async function(de){let xe=de.data;if(xe instanceof Blob)de.data.arrayBuffer().then(De=>console.log(De));else{let De=JSON.parse(xe);if(De.data&&(t=De.data,e)){Sr.set(!0);let Ce;en(Js)&&(w=!0),Ce={id:t,site:e,action:"new_site"},i.send(JSON.stringify(Ce))}if(De.action==="pong"&&te(),De.action==="no_file"&&(Sr.set(!1),Zi.update(Ce=>(Ce.error=!0,Ce.message=`Site ${e} does not have any recent radar data available.`,Ce.header="No data available",Ce.color="normal",Ce))),De.action==="new_elevation_file"){if(!De.fileNames.length)return;let xt=en(ni).filter(zt=>zt!=null).filter(zt=>zt.fileName===De.fileName),Ct=[];if(xt.length>0){let zt=new Set(xt[0].elevationFiles);Ct=De.fileNames.filter(Zt=>!zt.has(Zt))}else Ct=De.fileNames;Ct.length==0&&De.newSite&&De.site===e&&(Sr.set(!1),h&&h(0));let ct=Ct.map(async zt=>{let Zt=await gr.get(`${$s}/data?site=${De.site}&file_name=${zt}`);if(!Zt.ok)throw new Error("failed");return Zt.arrayBuffer()});(await Promise.all(ct)).forEach((zt,Zt)=>{let Lt=Ho(Ct[Zt]),Re={message:"initialize",status:null,jobId:null,buffer:zt};Lt.type==="chunk"&&(Re.message="readChunk"),Object.assign(Re,Lt),Ii.submit({data:Re})})}if(De.action==="new_file"){let Ce=[],pe=en(ni),xt=pe.filter(Ct=>Ct!=null);for(let Ct=0;Ct<xt.length;Ct++)Ce.push(xt[Ct].fileName);if(Ce.indexOf(De.fileName)>-1)return;gr.get(`${$s}/data?site=${De.site}&file_name=${De.fileName}`).then(Ct=>Ct.arrayBuffer()).then(Ct=>{w&&(w=!1,ye()),Ce=[],pe=en(ni),xt=pe.filter(ct=>ct!=null);for(let ct=0;ct<xt.length;ct++)Ce.push(xt[ct].fileName);if(Ce.indexOf(De.fileName)<0&&De.site===e){let ct=Ho(De.fileName),Qe={message:"initialize",status:null,jobId:null,buffer:Ct};ct.type==="chunk"&&(Qe.message="readChunk"),Object.assign(Qe,ct),Ii.submit({data:Qe})}else Sr.set(!1)}).catch(Ct=>console.log(Ct))}if(De.action==="new_site"){let Ce=[],xt=en(ni).filter(Ct=>Ct!=null);for(let Ct=0;Ct<xt.length;Ct++)Ce.push(xt[Ct].fileName);if(!De.fileName){Sr.set(!1);return}Ce.indexOf(De.fileName)>=0&&De.site===e?(Sr.set(!1),h&&h(0)):gr.get(`${$s}/data?site=${De.site}&file_name=${De.fileName}`).then(Ct=>Ct.arrayBuffer()).then(Ct=>{if(Ce.indexOf(De.fileName)<0&&De.site===e){let ct=Ho(De.fileName),Qe={message:"initialize",status:null,jobId:null,buffer:Ct};ct.type==="chunk"&&(Qe.message="readChunk"),Object.assign(Qe,ct),Ii.submit({data:Qe})}}).catch(Ct=>console.log(Ct))}if(De.action==="loop_response")if(De.files.length===0){Sr.set(!1);return}else{let Ce=[],xt=en(ni).filter(Qe=>Qe!=null);for(let Qe=0;Qe<xt.length;Qe++){let zt=Ho(xt[Qe].fileName);Ce.push([xt[Qe].fileName,zt.date,"loaded"])}for(let Qe=0;Qe<De.files.length;Qe++){let zt=Ho(De.files[Qe]);Ce.push([De.files[Qe],zt.date,"not_loaded"])}if(Ce=Ce.sort((Qe,zt)=>Qe[1]-zt[1]).slice(-5).filter(Qe=>Qe[2]==="not_loaded").reverse(),Ce.length===0){Sr.set(!1);return}let Ct=Ce.map(async Qe=>{let zt=await gr.get(`${$s}/data?site=${De.site}&file_name=${Qe[0]}`);if(!zt.ok)throw new Error("failed");return zt.arrayBuffer()});(await Promise.all(Ct)).forEach((Qe,zt)=>{let Zt=[],Re=en(ni).filter(qt=>qt!=null);for(let qt=0;qt<Re.length;qt++){let nt=Ho(Re[qt].fileName);Zt.push([Re[qt].fileName,nt.date])}if(Zt.indexOf(Ce[zt][0])<0&&De.site===e){let qt=Ho(Ce[zt][0]),nt={message:"initialize",status:null,jobId:null,buffer:Qe};qt.type==="chunk"&&(nt.message="readChunk"),Object.assign(nt,qt),Ii.submit({data:nt}),Sr.set(!0)}})}De.action==="new_alerts"&&gr.get(`${$s}/alerts`).then(Ce=>Ce.json()).then(Ce=>{Lm.update(pe=>(pe=Ce,pe))}).catch(Ce=>console.log("fetch error",Ce))}}})}function ye(){if(e){le();let re,ve=[],de=en(ni).filter(De=>De!=null);for(let De=0;De<de.length;De++)ve.push(de[De].fileName);let xe={id:t,site:e,action:"load_loop",fileNames:ve};i.send(JSON.stringify(xe)),Sr.set(!0)}}function Xe(re){if(re!=e)e=re,p(),w=!1,Sr.set(!0);else return;let ve={id:t,site:e,action:"new_site"};i.send(JSON.stringify(ve))}function ge(){i&&(i.close(),i=null)}return{get site(){return e},set site(re){e=re},get ws(){return i},connect:Y,close:ge,setSite:Xe,loadLoop:ye,handleQueue:B,setTrigger:R,setNewSite:k,setCancel:z,setUpdateArchive:L}}function M2(){let i=1,e=1,t;async function s(){return new Promise((v,w)=>{let S=indexedDB.open("db",i);S.onerror=function(A){w("error "+A.target.errorCode)},S.onsuccess=function(A){t=A.target.result,t.close();let I=indexedDB.deleteDatabase("db");I.onsuccess=async function(R){v("deleted and recreated")},I.onerror=function(R){w("error deleting db")}}})}function c(){return new Promise((v,w)=>{let S=indexedDB.open("db",e);S.onerror=function(A){w("error "+A.target.errorCode)},S.onsuccess=function(A){t=A.target.result,v("Database created successfully")},S.onupgradeneeded=function(A){t=A.target.result;let I="colorTables";if(!t.objectStoreNames.contains(I)){let R=t.createObjectStore(I,{keyPath:"id",autoIncrement:!0});R.createIndex("nameIndex","name",{unique:!1});let k={name:"default",colorStops:[[0,[36,36,36]],[10,[20,70,108]],[20,[15,203,255]],[25,[29,158,0]],[30,[149,244,76]],[35,[255,247,0]],[40,[255,159,15]],[45,[235,121,0]],[50,[255,31,31]],[60,[173,17,0]],[65,[255,184,245]],[70,[202,87,255]],[80,[74,0,158]]],selected:!0,product:"br",scale:null,units:"dbz"};R.add(k),v("added initial object")}}})}function h(v,w,S,A,I,R){return new Promise((k,L)=>{let z=indexedDB.open("db",e);z.onerror=function(B){L("error"+B.target.errorCode)},z.onsuccess=function(B){t=B.target.result;let G=t.transaction(v,"readwrite").objectStore(v).add({name:S,colorStops:w,selected:!1,product:A,scale:I,units:R});G.onsuccess=function(le){k(le.target.result)},G.onerror=function(le){L("error "+le.target.errorCode)}}})}function p(v){return new Promise((w,S)=>{let A=indexedDB.open("db",e);A.onerror=function(I){S("error"+I.target.errorCode)},A.onsuccess=function(I){t=I.target.result;let L=t.transaction(v,"readwrite").objectStore(v).getAll();L.onsuccess=function(z){let B=L.result;w(B)},L.onerror=function(z){S("error"+z.target.errorCode)}}})}function r(v,w){return new Promise((S,A)=>{let I=indexedDB.open("db",e);I.onerror=function(R){A("error"+R.target.errorCode)},I.onsuccess=function(R){t=R.target.result;let L=t.transaction(v,"readwrite").objectStore(v),z=L.getAll();z.onsuccess=function(B){let $=z.result;for(let H=0;H<$.length;H++)$[H].selected=!1,$[H].id===w.id&&($[H].selected=!0),L.put($[H]);S("set selected color")},z.onerror=function(B){A("error"+B.target.errorCode)}}})}function x(v,w){return new Promise((S,A)=>{let I=indexedDB.open("db",e);I.onerror=function(R){A("error"+R.target.errorCode)},I.onsuccess=function(R){t=R.target.result;let z=t.transaction(v,"readwrite").objectStore(v).delete(w.id);z.onsuccess=function(B){S("deleted")},z.onerror=function(B){A("error "+B.target.errorCode)}}})}return{createDb:c,setColorValue:h,getAllColors:p,deleteDb:s,selectColor:r,deleteColor:x}}function I2(){let i=new Map,e=!1;function t(p){return i.has(p)}function s(p){return i.delete(p)?(e=!1,0):1}function c(){let r=en(ni).filter(S=>S!=null).map(S=>S.fileName);if(i.size===0){e=!1;return}let x,v;for(let[S,A]of i)if(A.item.field!=255){x=S,v=A;break}if(x||([x]=i.keys(),v=i.get(x)),r.indexOf(v.item.fileName)<0){s(x)===0&&c();return}let w=v.item.field;if(e=!0,w===255)en(va).postMessage({message:"dealiasVelocity",data:v.item});else if(w===1)en(va).postMessage({message:"loadVelocity",data:v.item});else if(w===254){let S=v.item.selections[0].file;if(v.item.scans[S]===void 0){s(x)===0&&c();return}console.log("sending to worker 3d Queue",v.item),en(va).postMessage({message:"set3d",data:v.item})}else en(va).postMessage({message:"loadData",data:v.item})}function h(p){let r=`${p.fileName}_${p.field}_${p.idx}`;return t(r)?1:(i.set(r,{status:"QUEUED",item:p}),i.size===1&&c(),0)}return{enqueue:h,dequeue:c,deleteItem:s}}function C2(){let{LIVE:i}=vo,e=bo(),t=0,s,c,h,p,r,x,v,w,S=en(qr);function A(){return{max:w,fileIdx:x,station_state:h,elevation_state:p,idx:v,currentIdx:I(r)}}function I(se){if(se===void 0||!en(_i)[0].scan)return;let Y=en(_i)[0].scan.scan[0].date.getTime();for(let ye=0;ye<se.length;ye++)if(se[ye][0].date.getTime()===Y)return ye}function R(){let se=en(_i),Y=en(Vr),ye=en(xo);se[0].scan?!se[0].scan&&ye.station?Y.elevations[ye.station]&&le({elevation:Y.elevations[ye.station][0],station:ye.station}):se[0].scan&&se[0].scan.station!=ye.station&&Y.elevations[ye.station]&&le({elevation:Y.elevations[ye.station][0],station:ye.station}):le({elevation:Y.elevations[Y.stations[0]][0],station:Y.stations[0]})}function k(se){let Y=en(_i),ye=en(Vr);if(t=se,t===0){if(Sr.set(!1),!Y[0].scan&&!zi.site)le({elevation:ye.elevations[ye.stations[0]][0],station:ye.stations[0],state:"recent"});else if(!Y[0].scan&&zi.site)ye.elevations[zi.site]&&le({elevation:ye.elevations[zi.site][0],station:zi.site,state:"recent"});else if(Y[0].scan&&Y[0].scan.station!=zi.site)ye.elevations[zi.site]&&le({elevation:ye.elevations[zi.site][0],station:zi.site,state:"recent"});else if(en(Dc)&&r){let Xe={fileNumber:r[r.length-1][0].fileNumber,scan:r[r.length-1],fileName:r[r.length-1][0].fileName,station:zi.site||h};e.logStore(Xe),v=r.length-1}}}function L(){Js.set(!1),window.cancelAnimationFrame(s),S[0].triggerRepaint(),en($r)===Er&&S[1]&&S[1].triggerRepaint()}function z(se){c===void 0&&(c=se),se-c>=124?(te(),c=se,v===w-1?(window.cancelAnimationFrame(s),setTimeout(function(){if(en(Js)){v=0,c=void 0;let ye={fileNumber:r[v][0].fileNumber,scan:r[v],fileName:r[v][0].fileName,station:h};e.logStore(ye),s=window.requestAnimationFrame(z)}},1e3)):s=window.requestAnimationFrame(z)):s=window.requestAnimationFrame(z)}function B(){let se=Date.now();te();let Y=se-c;v===w-1?(clearTimeout(s),setTimeout(function(){if(en(Js)){v=0,c=void 0;let ye={fileNumber:r[v][0].fileNumber,scan:r[v],fileName:r[v][0].fileName,station:h};e.logStore(ye),c=Date.now(),s=setTimeout(B,0)}},1e3)):(c=Date.now(),s=setTimeout(B,Math.max(0,125-Y%125)))}function $(){if(en(Js))Js.set(!1),window.cancelAnimationFrame(s),S[0].triggerRepaint(),en($r)===Er&&S[1]&&S[1].triggerRepaint();else{Js.set(!0),v=0,c=void 0;let se={fileNumber:r[v][0].fileNumber,scan:r[v],fileName:r[v][0].fileName,station:h};e.logStore(se),s=window.requestAnimationFrame(z)}}zi.setTrigger(k),zi.setNewSite(R),zi.setCancel(L);function H(se="none"){let Y=en(_i),ye=en(Vr);h=Y[0].scan?Y[0].scan.station:void 0,p=Y[0].scan?Y[0].scan.scan[0].rounded:void 0,r=ye.scans&&Y[0].scan?ye.scans[h][p]:void 0,x=Y[0].scan?Y[0].scan.fileNumber:void 0,r&&(w=r.length)}function G(){!en(Vr).scans||!h||!p||(r=en(Vr).scans[h][p],w=r.length,v=I(r))}function le(se){if(en(Sr))return;v=I(r);let Y=0,ye;r&&(Y=r[v][0].date.getTime(),ye=r[v][0].fileNumber),r=en(Vr).scans[se.station][se.elevation];let Xe=r.map(re=>re[0].date.getTime());w=r.length,se.index!=null?v=se.index:se.state==="recent"?v=w-1:v=w2(Y,Xe),v===w-1?Dc.set(!0):Dc.set(!1);let ge={fileNumber:r[v][0].fileNumber,scan:r[v],fileName:r[v][0].fileName,station:se.station};en(Ds)===i&&(zi.setSite(se.station),S[0].setLayoutProperty("sites","icon-image",["case",["==",["slice",["get","STATION_ID"],7],zi.site],"selected","unselected"]),(en($r)===Er||en($r)===Pl)&&S[1]&&S[1].setLayoutProperty("sites","icon-image",["case",["==",["slice",["get","STATION_ID"],7],zi.site],"selected","unselected"])),e.logStore(ge)}function te(){if(v===void 0)return;let se=v;if(v=v+1<w?v+1:v,v>w-1&&(v=w-1),v===se||(v===w-1?Dc.set(!0):Dc.set(!1),!r||r[v]===void 0))return;let Y={fileNumber:r[v][0].fileNumber,scan:r[v],fileName:r[v][0].fileName,station:h};e.logStore(Y)}function ue(){if(v===void 0)return;let se=v;if(v=v-1>=0?v-1:v,v===se||(v===w-1?Dc.set(!0):Dc.set(!1),!r||r[v]===void 0))return;let Y={fileNumber:r[v][0].fileNumber,scan:r[v],fileName:r[v][0].fileName,station:h};e.logStore(Y)}function me(){en(Sr)||(Sr.set(!0),zi.loadLoop())}return{handleClick:le,setSites:G,setStates:H,handleLoadClick:me,setValues:A,previous:ue,advance:te,handleAnimateClick:$}}var L2=class{constructor(e=[],t=Ek){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:s}=this,c=t[e];for(;e>0;){let h=e-1>>1,p=t[h];if(s(c,p)>=0)break;t[e]=p,e=h}t[e]=c}_down(e){let{data:t,compare:s}=this,c=this.length>>1,h=t[e];for(;e<c;){let p=(e<<1)+1,r=t[p],x=p+1;if(x<this.length&&s(t[x],r)<0&&(p=x,r=t[x]),s(r,h)>=0)break;t[e]=r,e=p}t[e]=h}};function Ek(i,e){return i<e?-1:i>e?1:0}var oh=L2;function T1(i,e){let t={},s=!1,c=new oh;for(let H=0;H<e;H++)c.push(H);function h(H){if(H.data.message==="initialize"||H.data.message==="readChunk"||H.data.message==="deleteFile"){let G=H.data.message+"_"+H.data.fileName;return H.data.elevationFile&&(G=G+"_"+H.data.elevationFile),G}else return`${H.data.message}_${H.data.fileName}_${H.data.field}_${H.data.idx}`}function p(H,G){t[H]||(t[H]=[]),t[H].push(G)}function r(H,G){t[H]&&t[H].forEach(le=>le(G))}function x(H,G){for(let le in G)G.hasOwnProperty(le)&&!H.hasOwnProperty(le)&&(H[le]=G[le])}let v=new oh([],i),w=new Map,S=new Set;function A(H){let G=h(H);if(S.has(G))return;x(H,{jobIds:[],resolves:[],rejects:[],timeouts:[],timeoutIds:[],threads:[]}),H.data.status="submitted";let te=b2();H.data.jobId=te,H.jobIds.push(te),v.push(H),S.add(G),r("submitted",H)}function I(){if(v.length===0||c.length===0)return;s=!0;let H=v.pop();H.threads.push(c.pop()),H.data.status="processing",r("process",H)}function R(){return!!(s||v.length>0||w.size>0)}function k(H,G){w.set(H,G)}function L(H){return w.get(H)}function z(H){r("nextStep",H)}function B(H,G){if(w.has(H)){let le=w.get(H),te=h(le);S.delete(te),c.push(G)}else console.log("didn't have job id",H);s=!1,w.delete(H),r("complete",null)}function $(H){let G=w.get(G);w.delete(H),A(G)}return{submit:A,process:I,complete:B,fail:$,on:p,emit:r,set:k,get:L,nextStep:z,checkProcessing:R,processing:w}}function E1(i){return T1((t,s)=>t.data.priority-s.data.priority,i)}function D2(){async function i(){await fetch(`${$s}/trending`).then(c=>c.json()).then(c=>{Dm.update(h=>(h=c,h))})}let e;function t(){e&&clearInterval(e),e=null,Dm.update(c=>(c={type:"FeatureCollection",features:[]},c))}async function s(){await i(),e=setInterval(i,3e4)}return{start:s,clear:t}}var S1=class{constructor(e={},t){this.apiBase=t,this.token=null,this.user=null,this.defaultOptions={...e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`,...e.headers}}}setToken(e){return this.token=e,this.user=this.parseToken(this.token),this.defaultOptions.headers.Authorization=`Bearer ${this.token}`,this.token}removeToken(){sessionStorage.removeItem("accessToken")}parseToken(e){return JSON.parse(atob(e.split(".")[1]))}returnParsedToken(){if(this.token)return this.parseToken(this.token)}async getTokenSilently(){if(this.token){let e=this.parseToken(this.token),t=Math.floor(Date.now()/1e3);if(e.exp-t<5)try{return this.setToken(await this.getRefresh())}catch(c){return!1}return this.token}else try{return this.setToken(await this.getRefresh())}catch(e){return!1}}async request(e,t={}){let s={...this.defaultOptions,...t,headers:{...this.defaultOptions.headers,...t.headers}};try{let c=await fetch(e,s);if(c.status===401){let h=await fetch(`${this.apiBase}/refresh-token`,{method:"POST",credentials:"include"});if(h.ok){this.setToken((await h.json()).token);let p={...this.defaultOptions,...t,headers:{...this.defaultOptions.headers,...t.headers}};return await fetch(e,p)}else{let p=new Error(`HTTP error: ${c.status}`);throw p.response=c,c.status===401&&ah.set(!1),p}}if(!c.ok){let h=new Error(`HTTP error: ${c.status}`);throw h.response=c,h}return c}catch(c){throw c}}async checkScopes(e=[]){return await(await this.post(`${this.apiBase}/check-access`,{scopes:e})).json()}async post(e,t={},s={}){return this.request(e,{...s,method:"POST",body:JSON.stringify(t)})}async get(e,t={}){return this.request(e,{...t,method:"GET"})}async getRefresh(){return(await(await this.post(`${this.apiBase}/refresh-token`)).json()).token}},R2=S1;var Sk=4,P2=0,k2=1,Ak=2;function ef(i){let e=i.length;for(;--e>=0;)i[e]=0}var Mk=0,z2=1,Ik=2,Ck=3,Lk=258,A1=29,Rm=256,Pm=Rm+1+A1,tf=30,M1=19,O2=2*Pm+1,lh=15,I1=16,Dk=7,C1=256,N2=16,F2=17,B2=18,L1=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),zy=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Rk=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),U2=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Pk=512,zl=new Array((Pm+2)*2);ef(zl);var km=new Array(tf*2);ef(km);var zm=new Array(Pk);ef(zm);var Om=new Array(Lk-Ck+1);ef(Om);var D1=new Array(A1);ef(D1);var Oy=new Array(tf);ef(Oy);function R1(i,e,t,s,c){this.static_tree=i,this.extra_bits=e,this.extra_base=t,this.elems=s,this.max_length=c,this.has_stree=i&&i.length}var V2,G2,H2;function P1(i,e){this.dyn_tree=i,this.max_code=0,this.stat_desc=e}var j2=i=>i<256?zm[i]:zm[256+(i>>>7)],Nm=(i,e)=>{i.pending_buf[i.pending++]=e&255,i.pending_buf[i.pending++]=e>>>8&255},wo=(i,e,t)=>{i.bi_valid>I1-t?(i.bi_buf|=e<<i.bi_valid&65535,Nm(i,i.bi_buf),i.bi_buf=e>>I1-i.bi_valid,i.bi_valid+=t-I1):(i.bi_buf|=e<<i.bi_valid&65535,i.bi_valid+=t)},Ja=(i,e,t)=>{wo(i,t[e*2],t[e*2+1])},W2=(i,e)=>{let t=0;do t|=i&1,i>>>=1,t<<=1;while(--e>0);return t>>>1},kk=i=>{i.bi_valid===16?(Nm(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},zk=(i,e)=>{let t=e.dyn_tree,s=e.max_code,c=e.stat_desc.static_tree,h=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,r=e.stat_desc.extra_base,x=e.stat_desc.max_length,v,w,S,A,I,R,k=0;for(A=0;A<=lh;A++)i.bl_count[A]=0;for(t[i.heap[i.heap_max]*2+1]=0,v=i.heap_max+1;v<O2;v++)w=i.heap[v],A=t[t[w*2+1]*2+1]+1,A>x&&(A=x,k++),t[w*2+1]=A,!(w>s)&&(i.bl_count[A]++,I=0,w>=r&&(I=p[w-r]),R=t[w*2],i.opt_len+=R*(A+I),h&&(i.static_len+=R*(c[w*2+1]+I)));if(k!==0){do{for(A=x-1;i.bl_count[A]===0;)A--;i.bl_count[A]--,i.bl_count[A+1]+=2,i.bl_count[x]--,k-=2}while(k>0);for(A=x;A!==0;A--)for(w=i.bl_count[A];w!==0;)S=i.heap[--v],!(S>s)&&(t[S*2+1]!==A&&(i.opt_len+=(A-t[S*2+1])*t[S*2],t[S*2+1]=A),w--)}},q2=(i,e,t)=>{let s=new Array(lh+1),c=0,h,p;for(h=1;h<=lh;h++)s[h]=c=c+t[h-1]<<1;for(p=0;p<=e;p++){let r=i[p*2+1];r!==0&&(i[p*2]=W2(s[r]++,r))}},Ok=()=>{let i,e,t,s,c,h=new Array(lh+1);for(t=0,s=0;s<A1-1;s++)for(D1[s]=t,i=0;i<1<<L1[s];i++)Om[t++]=s;for(Om[t-1]=s,c=0,s=0;s<16;s++)for(Oy[s]=c,i=0;i<1<<zy[s];i++)zm[c++]=s;for(c>>=7;s<tf;s++)for(Oy[s]=c<<7,i=0;i<1<<zy[s]-7;i++)zm[256+c++]=s;for(e=0;e<=lh;e++)h[e]=0;for(i=0;i<=143;)zl[i*2+1]=8,i++,h[8]++;for(;i<=255;)zl[i*2+1]=9,i++,h[9]++;for(;i<=279;)zl[i*2+1]=7,i++,h[7]++;for(;i<=287;)zl[i*2+1]=8,i++,h[8]++;for(q2(zl,Pm+1,h),i=0;i<tf;i++)km[i*2+1]=5,km[i*2]=W2(i,5);V2=new R1(zl,L1,Rm+1,Pm,lh),G2=new R1(km,zy,0,tf,lh),H2=new R1(new Array(0),Rk,0,M1,Dk)},X2=i=>{let e;for(e=0;e<Pm;e++)i.dyn_ltree[e*2]=0;for(e=0;e<tf;e++)i.dyn_dtree[e*2]=0;for(e=0;e<M1;e++)i.bl_tree[e*2]=0;i.dyn_ltree[C1*2]=1,i.opt_len=i.static_len=0,i.last_lit=i.matches=0},Z2=i=>{i.bi_valid>8?Nm(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},Nk=(i,e,t,s)=>{Z2(i),s&&(Nm(i,t),Nm(i,~t)),i.pending_buf.set(i.window.subarray(e,e+t),i.pending),i.pending+=t},K2=(i,e,t,s)=>{let c=e*2,h=t*2;return i[c]<i[h]||i[c]===i[h]&&s[e]<=s[t]},k1=(i,e,t)=>{let s=i.heap[t],c=t<<1;for(;c<=i.heap_len&&(c<i.heap_len&&K2(e,i.heap[c+1],i.heap[c],i.depth)&&c++,!K2(e,s,i.heap[c],i.depth));)i.heap[t]=i.heap[c],t=c,c<<=1;i.heap[t]=s},Y2=(i,e,t)=>{let s,c,h=0,p,r;if(i.last_lit!==0)do s=i.pending_buf[i.d_buf+h*2]<<8|i.pending_buf[i.d_buf+h*2+1],c=i.pending_buf[i.l_buf+h],h++,s===0?Ja(i,c,e):(p=Om[c],Ja(i,p+Rm+1,e),r=L1[p],r!==0&&(c-=D1[p],wo(i,c,r)),s--,p=j2(s),Ja(i,p,t),r=zy[p],r!==0&&(s-=Oy[p],wo(i,s,r)));while(h<i.last_lit);Ja(i,C1,e)},z1=(i,e)=>{let t=e.dyn_tree,s=e.stat_desc.static_tree,c=e.stat_desc.has_stree,h=e.stat_desc.elems,p,r,x=-1,v;for(i.heap_len=0,i.heap_max=O2,p=0;p<h;p++)t[p*2]!==0?(i.heap[++i.heap_len]=x=p,i.depth[p]=0):t[p*2+1]=0;for(;i.heap_len<2;)v=i.heap[++i.heap_len]=x<2?++x:0,t[v*2]=1,i.depth[v]=0,i.opt_len--,c&&(i.static_len-=s[v*2+1]);for(e.max_code=x,p=i.heap_len>>1;p>=1;p--)k1(i,t,p);v=h;do p=i.heap[1],i.heap[1]=i.heap[i.heap_len--],k1(i,t,1),r=i.heap[1],i.heap[--i.heap_max]=p,i.heap[--i.heap_max]=r,t[v*2]=t[p*2]+t[r*2],i.depth[v]=(i.depth[p]>=i.depth[r]?i.depth[p]:i.depth[r])+1,t[p*2+1]=t[r*2+1]=v,i.heap[1]=v++,k1(i,t,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],zk(i,e),q2(t,x,i.bl_count)},J2=(i,e,t)=>{let s,c=-1,h,p=e[0*2+1],r=0,x=7,v=4;for(p===0&&(x=138,v=3),e[(t+1)*2+1]=65535,s=0;s<=t;s++)h=p,p=e[(s+1)*2+1],!(++r<x&&h===p)&&(r<v?i.bl_tree[h*2]+=r:h!==0?(h!==c&&i.bl_tree[h*2]++,i.bl_tree[N2*2]++):r<=10?i.bl_tree[F2*2]++:i.bl_tree[B2*2]++,r=0,c=h,p===0?(x=138,v=3):h===p?(x=6,v=3):(x=7,v=4))},$2=(i,e,t)=>{let s,c=-1,h,p=e[0*2+1],r=0,x=7,v=4;for(p===0&&(x=138,v=3),s=0;s<=t;s++)if(h=p,p=e[(s+1)*2+1],!(++r<x&&h===p)){if(r<v)do Ja(i,h,i.bl_tree);while(--r!=0);else h!==0?(h!==c&&(Ja(i,h,i.bl_tree),r--),Ja(i,N2,i.bl_tree),wo(i,r-3,2)):r<=10?(Ja(i,F2,i.bl_tree),wo(i,r-3,3)):(Ja(i,B2,i.bl_tree),wo(i,r-11,7));r=0,c=h,p===0?(x=138,v=3):h===p?(x=6,v=3):(x=7,v=4)}},Fk=i=>{let e;for(J2(i,i.dyn_ltree,i.l_desc.max_code),J2(i,i.dyn_dtree,i.d_desc.max_code),z1(i,i.bl_desc),e=M1-1;e>=3&&i.bl_tree[U2[e]*2+1]===0;e--);return i.opt_len+=3*(e+1)+5+5+4,e},Bk=(i,e,t,s)=>{let c;for(wo(i,e-257,5),wo(i,t-1,5),wo(i,s-4,4),c=0;c<s;c++)wo(i,i.bl_tree[U2[c]*2+1],3);$2(i,i.dyn_ltree,e-1),$2(i,i.dyn_dtree,t-1)},Uk=i=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&i.dyn_ltree[t*2]!==0)return P2;if(i.dyn_ltree[9*2]!==0||i.dyn_ltree[10*2]!==0||i.dyn_ltree[13*2]!==0)return k2;for(t=32;t<Rm;t++)if(i.dyn_ltree[t*2]!==0)return k2;return P2},Q2=!1,Vk=i=>{Q2||(Ok(),Q2=!0),i.l_desc=new P1(i.dyn_ltree,V2),i.d_desc=new P1(i.dyn_dtree,G2),i.bl_desc=new P1(i.bl_tree,H2),i.bi_buf=0,i.bi_valid=0,X2(i)},eA=(i,e,t,s)=>{wo(i,(Mk<<1)+(s?1:0),3),Nk(i,e,t,!0)},Gk=i=>{wo(i,z2<<1,3),Ja(i,C1,zl),kk(i)},Hk=(i,e,t,s)=>{let c,h,p=0;i.level>0?(i.strm.data_type===Ak&&(i.strm.data_type=Uk(i)),z1(i,i.l_desc),z1(i,i.d_desc),p=Fk(i),c=i.opt_len+3+7>>>3,h=i.static_len+3+7>>>3,h<=c&&(c=h)):c=h=t+5,t+4<=c&&e!==-1?eA(i,e,t,s):i.strategy===Sk||h===c?(wo(i,(z2<<1)+(s?1:0),3),Y2(i,zl,km)):(wo(i,(Ik<<1)+(s?1:0),3),Bk(i,i.l_desc.max_code+1,i.d_desc.max_code+1,p+1),Y2(i,i.dyn_ltree,i.dyn_dtree)),X2(i),s&&Z2(i)},jk=(i,e,t)=>(i.pending_buf[i.d_buf+i.last_lit*2]=e>>>8&255,i.pending_buf[i.d_buf+i.last_lit*2+1]=e&255,i.pending_buf[i.l_buf+i.last_lit]=t&255,i.last_lit++,e===0?i.dyn_ltree[t*2]++:(i.matches++,e--,i.dyn_ltree[(Om[t]+Rm+1)*2]++,i.dyn_dtree[j2(e)*2]++),i.last_lit===i.lit_bufsize-1),Wk=Vk,qk=eA,Xk=Hk,Zk=jk,Kk=Gk,Yk={_tr_init:Wk,_tr_stored_block:qk,_tr_flush_block:Xk,_tr_tally:Zk,_tr_align:Kk},Jk=(i,e,t,s)=>{let c=i&65535|0,h=i>>>16&65535|0,p=0;for(;t!==0;){p=t>2e3?2e3:t,t-=p;do c=c+e[s++]|0,h=h+c|0;while(--p);c%=65521,h%=65521}return c|h<<16|0},Fm=Jk,$k=()=>{let i,e=[];for(var t=0;t<256;t++){i=t;for(var s=0;s<8;s++)i=i&1?3988292384^i>>>1:i>>>1;e[t]=i}return e},Qk=new Uint32Array($k()),ez=(i,e,t,s)=>{let c=Qk,h=s+t;i^=-1;for(let p=s;p<h;p++)i=i>>>8^c[(i^e[p])&255];return i^-1},xs=ez,nf={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Bm={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:tz,_tr_stored_block:nz,_tr_flush_block:iz,_tr_tally:Rc,_tr_align:rz}=Yk,{Z_NO_FLUSH:ch,Z_PARTIAL_FLUSH:sz,Z_FULL_FLUSH:oz,Z_FINISH:Pc,Z_BLOCK:tA,Z_OK:$a,Z_STREAM_END:nA,Z_STREAM_ERROR:jo,Z_DATA_ERROR:az,Z_BUF_ERROR:O1,Z_DEFAULT_COMPRESSION:lz,Z_FILTERED:cz,Z_HUFFMAN_ONLY:Ny,Z_RLE:uz,Z_FIXED:hz,Z_DEFAULT_STRATEGY:dz,Z_UNKNOWN:fz,Z_DEFLATED:Fy}=Bm,pz=9,mz=15,gz=8,_z=29,yz=256,N1=yz+1+_z,vz=30,xz=19,bz=2*N1+1,wz=15,Bi=3,kc=258,xa=kc+Bi+1,Tz=32,By=42,F1=69,Uy=73,Vy=91,Gy=103,uh=113,Um=666,os=1,Vm=2,hh=3,rf=4,Ez=3,zc=(i,e)=>(i.msg=nf[e],e),iA=i=>(i<<1)-(i>4?9:0),Oc=i=>{let e=i.length;for(;--e>=0;)i[e]=0},Sz=(i,e,t)=>(e<<i.hash_shift^t)&i.hash_mask,Nc=Sz,Fc=i=>{let e=i.state,t=e.pending;t>i.avail_out&&(t=i.avail_out),t!==0&&(i.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),i.next_out),i.next_out+=t,e.pending_out+=t,i.total_out+=t,i.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Ps=(i,e)=>{iz(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,e),i.block_start=i.strstart,Fc(i.strm)},$i=(i,e)=>{i.pending_buf[i.pending++]=e},Gm=(i,e)=>{i.pending_buf[i.pending++]=e>>>8&255,i.pending_buf[i.pending++]=e&255},Az=(i,e,t,s)=>{let c=i.avail_in;return c>s&&(c=s),c===0?0:(i.avail_in-=c,e.set(i.input.subarray(i.next_in,i.next_in+c),t),i.state.wrap===1?i.adler=Fm(i.adler,e,c,t):i.state.wrap===2&&(i.adler=xs(i.adler,e,c,t)),i.next_in+=c,i.total_in+=c,c)},rA=(i,e)=>{let t=i.max_chain_length,s=i.strstart,c,h,p=i.prev_length,r=i.nice_match,x=i.strstart>i.w_size-xa?i.strstart-(i.w_size-xa):0,v=i.window,w=i.w_mask,S=i.prev,A=i.strstart+kc,I=v[s+p-1],R=v[s+p];i.prev_length>=i.good_match&&(t>>=2),r>i.lookahead&&(r=i.lookahead);do if(c=e,!(v[c+p]!==R||v[c+p-1]!==I||v[c]!==v[s]||v[++c]!==v[s+1])){s+=2,c++;do;while(v[++s]===v[++c]&&v[++s]===v[++c]&&v[++s]===v[++c]&&v[++s]===v[++c]&&v[++s]===v[++c]&&v[++s]===v[++c]&&v[++s]===v[++c]&&v[++s]===v[++c]&&s<A);if(h=kc-(A-s),s=A-kc,h>p){if(i.match_start=e,p=h,h>=r)break;I=v[s+p-1],R=v[s+p]}}while((e=S[e&w])>x&&--t!=0);return p<=i.lookahead?p:i.lookahead},dh=i=>{let e=i.w_size,t,s,c,h,p;do{if(h=i.window_size-i.lookahead-i.strstart,i.strstart>=e+(e-xa)){i.window.set(i.window.subarray(e,e+e),0),i.match_start-=e,i.strstart-=e,i.block_start-=e,s=i.hash_size,t=s;do c=i.head[--t],i.head[t]=c>=e?c-e:0;while(--s);s=e,t=s;do c=i.prev[--t],i.prev[t]=c>=e?c-e:0;while(--s);h+=e}if(i.strm.avail_in===0)break;if(s=Az(i.strm,i.window,i.strstart+i.lookahead,h),i.lookahead+=s,i.lookahead+i.insert>=Bi)for(p=i.strstart-i.insert,i.ins_h=i.window[p],i.ins_h=Nc(i,i.ins_h,i.window[p+1]);i.insert&&(i.ins_h=Nc(i,i.ins_h,i.window[p+Bi-1]),i.prev[p&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=p,p++,i.insert--,!(i.lookahead+i.insert<Bi)););}while(i.lookahead<xa&&i.strm.avail_in!==0)},Mz=(i,e)=>{let t=65535;for(t>i.pending_buf_size-5&&(t=i.pending_buf_size-5);;){if(i.lookahead<=1){if(dh(i),i.lookahead===0&&e===ch)return os;if(i.lookahead===0)break}i.strstart+=i.lookahead,i.lookahead=0;let s=i.block_start+t;if((i.strstart===0||i.strstart>=s)&&(i.lookahead=i.strstart-s,i.strstart=s,Ps(i,!1),i.strm.avail_out===0)||i.strstart-i.block_start>=i.w_size-xa&&(Ps(i,!1),i.strm.avail_out===0))return os}return i.insert=0,e===Pc?(Ps(i,!0),i.strm.avail_out===0?hh:rf):(i.strstart>i.block_start&&(Ps(i,!1),i.strm.avail_out===0),os)},B1=(i,e)=>{let t,s;for(;;){if(i.lookahead<xa){if(dh(i),i.lookahead<xa&&e===ch)return os;if(i.lookahead===0)break}if(t=0,i.lookahead>=Bi&&(i.ins_h=Nc(i,i.ins_h,i.window[i.strstart+Bi-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),t!==0&&i.strstart-t<=i.w_size-xa&&(i.match_length=rA(i,t)),i.match_length>=Bi)if(s=Rc(i,i.strstart-i.match_start,i.match_length-Bi),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=Bi){i.match_length--;do i.strstart++,i.ins_h=Nc(i,i.ins_h,i.window[i.strstart+Bi-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!=0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=Nc(i,i.ins_h,i.window[i.strstart+1]);else s=Rc(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(s&&(Ps(i,!1),i.strm.avail_out===0))return os}return i.insert=i.strstart<Bi-1?i.strstart:Bi-1,e===Pc?(Ps(i,!0),i.strm.avail_out===0?hh:rf):i.last_lit&&(Ps(i,!1),i.strm.avail_out===0)?os:Vm},sf=(i,e)=>{let t,s,c;for(;;){if(i.lookahead<xa){if(dh(i),i.lookahead<xa&&e===ch)return os;if(i.lookahead===0)break}if(t=0,i.lookahead>=Bi&&(i.ins_h=Nc(i,i.ins_h,i.window[i.strstart+Bi-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=Bi-1,t!==0&&i.prev_length<i.max_lazy_match&&i.strstart-t<=i.w_size-xa&&(i.match_length=rA(i,t),i.match_length<=5&&(i.strategy===cz||i.match_length===Bi&&i.strstart-i.match_start>4096)&&(i.match_length=Bi-1)),i.prev_length>=Bi&&i.match_length<=i.prev_length){c=i.strstart+i.lookahead-Bi,s=Rc(i,i.strstart-1-i.prev_match,i.prev_length-Bi),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=c&&(i.ins_h=Nc(i,i.ins_h,i.window[i.strstart+Bi-1]),t=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!=0);if(i.match_available=0,i.match_length=Bi-1,i.strstart++,s&&(Ps(i,!1),i.strm.avail_out===0))return os}else if(i.match_available){if(s=Rc(i,0,i.window[i.strstart-1]),s&&Ps(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return os}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(s=Rc(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<Bi-1?i.strstart:Bi-1,e===Pc?(Ps(i,!0),i.strm.avail_out===0?hh:rf):i.last_lit&&(Ps(i,!1),i.strm.avail_out===0)?os:Vm},Iz=(i,e)=>{let t,s,c,h,p=i.window;for(;;){if(i.lookahead<=kc){if(dh(i),i.lookahead<=kc&&e===ch)return os;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=Bi&&i.strstart>0&&(c=i.strstart-1,s=p[c],s===p[++c]&&s===p[++c]&&s===p[++c])){h=i.strstart+kc;do;while(s===p[++c]&&s===p[++c]&&s===p[++c]&&s===p[++c]&&s===p[++c]&&s===p[++c]&&s===p[++c]&&s===p[++c]&&c<h);i.match_length=kc-(h-c),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=Bi?(t=Rc(i,1,i.match_length-Bi),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(t=Rc(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),t&&(Ps(i,!1),i.strm.avail_out===0))return os}return i.insert=0,e===Pc?(Ps(i,!0),i.strm.avail_out===0?hh:rf):i.last_lit&&(Ps(i,!1),i.strm.avail_out===0)?os:Vm},Cz=(i,e)=>{let t;for(;;){if(i.lookahead===0&&(dh(i),i.lookahead===0)){if(e===ch)return os;break}if(i.match_length=0,t=Rc(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,t&&(Ps(i,!1),i.strm.avail_out===0))return os}return i.insert=0,e===Pc?(Ps(i,!0),i.strm.avail_out===0?hh:rf):i.last_lit&&(Ps(i,!1),i.strm.avail_out===0)?os:Vm};function Qa(i,e,t,s,c){this.good_length=i,this.max_lazy=e,this.nice_length=t,this.max_chain=s,this.func=c}var Hm=[new Qa(0,0,0,0,Mz),new Qa(4,4,8,4,B1),new Qa(4,5,16,8,B1),new Qa(4,6,32,32,B1),new Qa(4,4,16,16,sf),new Qa(8,16,32,32,sf),new Qa(8,16,128,128,sf),new Qa(8,32,128,256,sf),new Qa(32,128,258,1024,sf),new Qa(32,258,258,4096,sf)],Lz=i=>{i.window_size=2*i.w_size,Oc(i.head),i.max_lazy_match=Hm[i.level].max_lazy,i.good_match=Hm[i.level].good_length,i.nice_match=Hm[i.level].nice_length,i.max_chain_length=Hm[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=Bi-1,i.match_available=0,i.ins_h=0};function Dz(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Fy,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(bz*2),this.dyn_dtree=new Uint16Array((2*vz+1)*2),this.bl_tree=new Uint16Array((2*xz+1)*2),Oc(this.dyn_ltree),Oc(this.dyn_dtree),Oc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(wz+1),this.heap=new Uint16Array(2*N1+1),Oc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*N1+1),Oc(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var sA=i=>{if(!i||!i.state)return zc(i,jo);i.total_in=i.total_out=0,i.data_type=fz;let e=i.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?By:uh,i.adler=e.wrap===2?0:1,e.last_flush=ch,tz(e),$a},oA=i=>{let e=sA(i);return e===$a&&Lz(i.state),e},Rz=(i,e)=>!i||!i.state||i.state.wrap!==2?jo:(i.state.gzhead=e,$a),aA=(i,e,t,s,c,h)=>{if(!i)return jo;let p=1;if(e===lz&&(e=6),s<0?(p=0,s=-s):s>15&&(p=2,s-=16),c<1||c>pz||t!==Fy||s<8||s>15||e<0||e>9||h<0||h>hz)return zc(i,jo);s===8&&(s=9);let r=new Dz;return i.state=r,r.strm=i,r.wrap=p,r.gzhead=null,r.w_bits=s,r.w_size=1<<r.w_bits,r.w_mask=r.w_size-1,r.hash_bits=c+7,r.hash_size=1<<r.hash_bits,r.hash_mask=r.hash_size-1,r.hash_shift=~~((r.hash_bits+Bi-1)/Bi),r.window=new Uint8Array(r.w_size*2),r.head=new Uint16Array(r.hash_size),r.prev=new Uint16Array(r.w_size),r.lit_bufsize=1<<c+6,r.pending_buf_size=r.lit_bufsize*4,r.pending_buf=new Uint8Array(r.pending_buf_size),r.d_buf=1*r.lit_bufsize,r.l_buf=(1+2)*r.lit_bufsize,r.level=e,r.strategy=h,r.method=t,oA(i)},Pz=(i,e)=>aA(i,e,Fy,mz,gz,dz),kz=(i,e)=>{let t,s;if(!i||!i.state||e>tA||e<0)return i?zc(i,jo):jo;let c=i.state;if(!i.output||!i.input&&i.avail_in!==0||c.status===Um&&e!==Pc)return zc(i,i.avail_out===0?O1:jo);c.strm=i;let h=c.last_flush;if(c.last_flush=e,c.status===By)if(c.wrap===2)i.adler=0,$i(c,31),$i(c,139),$i(c,8),c.gzhead?($i(c,(c.gzhead.text?1:0)+(c.gzhead.hcrc?2:0)+(c.gzhead.extra?4:0)+(c.gzhead.name?8:0)+(c.gzhead.comment?16:0)),$i(c,c.gzhead.time&255),$i(c,c.gzhead.time>>8&255),$i(c,c.gzhead.time>>16&255),$i(c,c.gzhead.time>>24&255),$i(c,c.level===9?2:c.strategy>=Ny||c.level<2?4:0),$i(c,c.gzhead.os&255),c.gzhead.extra&&c.gzhead.extra.length&&($i(c,c.gzhead.extra.length&255),$i(c,c.gzhead.extra.length>>8&255)),c.gzhead.hcrc&&(i.adler=xs(i.adler,c.pending_buf,c.pending,0)),c.gzindex=0,c.status=F1):($i(c,0),$i(c,0),$i(c,0),$i(c,0),$i(c,0),$i(c,c.level===9?2:c.strategy>=Ny||c.level<2?4:0),$i(c,Ez),c.status=uh);else{let p=Fy+(c.w_bits-8<<4)<<8,r=-1;c.strategy>=Ny||c.level<2?r=0:c.level<6?r=1:c.level===6?r=2:r=3,p|=r<<6,c.strstart!==0&&(p|=Tz),p+=31-p%31,c.status=uh,Gm(c,p),c.strstart!==0&&(Gm(c,i.adler>>>16),Gm(c,i.adler&65535)),i.adler=1}if(c.status===F1)if(c.gzhead.extra){for(t=c.pending;c.gzindex<(c.gzhead.extra.length&65535)&&!(c.pending===c.pending_buf_size&&(c.gzhead.hcrc&&c.pending>t&&(i.adler=xs(i.adler,c.pending_buf,c.pending-t,t)),Fc(i),t=c.pending,c.pending===c.pending_buf_size));)$i(c,c.gzhead.extra[c.gzindex]&255),c.gzindex++;c.gzhead.hcrc&&c.pending>t&&(i.adler=xs(i.adler,c.pending_buf,c.pending-t,t)),c.gzindex===c.gzhead.extra.length&&(c.gzindex=0,c.status=Uy)}else c.status=Uy;if(c.status===Uy)if(c.gzhead.name){t=c.pending;do{if(c.pending===c.pending_buf_size&&(c.gzhead.hcrc&&c.pending>t&&(i.adler=xs(i.adler,c.pending_buf,c.pending-t,t)),Fc(i),t=c.pending,c.pending===c.pending_buf_size)){s=1;break}c.gzindex<c.gzhead.name.length?s=c.gzhead.name.charCodeAt(c.gzindex++)&255:s=0,$i(c,s)}while(s!==0);c.gzhead.hcrc&&c.pending>t&&(i.adler=xs(i.adler,c.pending_buf,c.pending-t,t)),s===0&&(c.gzindex=0,c.status=Vy)}else c.status=Vy;if(c.status===Vy)if(c.gzhead.comment){t=c.pending;do{if(c.pending===c.pending_buf_size&&(c.gzhead.hcrc&&c.pending>t&&(i.adler=xs(i.adler,c.pending_buf,c.pending-t,t)),Fc(i),t=c.pending,c.pending===c.pending_buf_size)){s=1;break}c.gzindex<c.gzhead.comment.length?s=c.gzhead.comment.charCodeAt(c.gzindex++)&255:s=0,$i(c,s)}while(s!==0);c.gzhead.hcrc&&c.pending>t&&(i.adler=xs(i.adler,c.pending_buf,c.pending-t,t)),s===0&&(c.status=Gy)}else c.status=Gy;if(c.status===Gy&&(c.gzhead.hcrc?(c.pending+2>c.pending_buf_size&&Fc(i),c.pending+2<=c.pending_buf_size&&($i(c,i.adler&255),$i(c,i.adler>>8&255),i.adler=0,c.status=uh)):c.status=uh),c.pending!==0){if(Fc(i),i.avail_out===0)return c.last_flush=-1,$a}else if(i.avail_in===0&&iA(e)<=iA(h)&&e!==Pc)return zc(i,O1);if(c.status===Um&&i.avail_in!==0)return zc(i,O1);if(i.avail_in!==0||c.lookahead!==0||e!==ch&&c.status!==Um){let p=c.strategy===Ny?Cz(c,e):c.strategy===uz?Iz(c,e):Hm[c.level].func(c,e);if((p===hh||p===rf)&&(c.status=Um),p===os||p===hh)return i.avail_out===0&&(c.last_flush=-1),$a;if(p===Vm&&(e===sz?rz(c):e!==tA&&(nz(c,0,0,!1),e===oz&&(Oc(c.head),c.lookahead===0&&(c.strstart=0,c.block_start=0,c.insert=0))),Fc(i),i.avail_out===0))return c.last_flush=-1,$a}return e!==Pc?$a:c.wrap<=0?nA:(c.wrap===2?($i(c,i.adler&255),$i(c,i.adler>>8&255),$i(c,i.adler>>16&255),$i(c,i.adler>>24&255),$i(c,i.total_in&255),$i(c,i.total_in>>8&255),$i(c,i.total_in>>16&255),$i(c,i.total_in>>24&255)):(Gm(c,i.adler>>>16),Gm(c,i.adler&65535)),Fc(i),c.wrap>0&&(c.wrap=-c.wrap),c.pending!==0?$a:nA)},zz=i=>{if(!i||!i.state)return jo;let e=i.state.status;return e!==By&&e!==F1&&e!==Uy&&e!==Vy&&e!==Gy&&e!==uh&&e!==Um?zc(i,jo):(i.state=null,e===uh?zc(i,az):$a)},Oz=(i,e)=>{let t=e.length;if(!i||!i.state)return jo;let s=i.state,c=s.wrap;if(c===2||c===1&&s.status!==By||s.lookahead)return jo;if(c===1&&(i.adler=Fm(i.adler,e,t,0)),s.wrap=0,t>=s.w_size){c===0&&(Oc(s.head),s.strstart=0,s.block_start=0,s.insert=0);let x=new Uint8Array(s.w_size);x.set(e.subarray(t-s.w_size,t),0),e=x,t=s.w_size}let h=i.avail_in,p=i.next_in,r=i.input;for(i.avail_in=t,i.next_in=0,i.input=e,dh(s);s.lookahead>=Bi;){let x=s.strstart,v=s.lookahead-(Bi-1);do s.ins_h=Nc(s,s.ins_h,s.window[x+Bi-1]),s.prev[x&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=x,x++;while(--v);s.strstart=x,s.lookahead=Bi-1,dh(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=Bi-1,s.match_available=0,i.next_in=p,i.input=r,i.avail_in=h,s.wrap=c,$a},Nz=Pz,Fz=aA,Bz=oA,Uz=sA,Vz=Rz,Gz=kz,Hz=zz,jz=Oz,Wz="pako deflate (from Nodeca project)",jm={deflateInit:Nz,deflateInit2:Fz,deflateReset:Bz,deflateResetKeep:Uz,deflateSetHeader:Vz,deflate:Gz,deflateEnd:Hz,deflateSetDictionary:jz,deflateInfo:Wz},qz=(i,e)=>Object.prototype.hasOwnProperty.call(i,e),Xz=function(i){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(!!t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let s in t)qz(t,s)&&(i[s]=t[s])}}return i},Zz=i=>{let e=0;for(let s=0,c=i.length;s<c;s++)e+=i[s].length;let t=new Uint8Array(e);for(let s=0,c=0,h=i.length;s<h;s++){let p=i[s];t.set(p,c),c+=p.length}return t},Hy={assign:Xz,flattenChunks:Zz},lA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(i){lA=!1}var Wm=new Uint8Array(256);for(let i=0;i<256;i++)Wm[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;Wm[254]=Wm[254]=1;var Kz=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let e,t,s,c,h,p=i.length,r=0;for(c=0;c<p;c++)t=i.charCodeAt(c),(t&64512)==55296&&c+1<p&&(s=i.charCodeAt(c+1),(s&64512)==56320&&(t=65536+(t-55296<<10)+(s-56320),c++)),r+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(r),h=0,c=0;h<r;c++)t=i.charCodeAt(c),(t&64512)==55296&&c+1<p&&(s=i.charCodeAt(c+1),(s&64512)==56320&&(t=65536+(t-55296<<10)+(s-56320),c++)),t<128?e[h++]=t:t<2048?(e[h++]=192|t>>>6,e[h++]=128|t&63):t<65536?(e[h++]=224|t>>>12,e[h++]=128|t>>>6&63,e[h++]=128|t&63):(e[h++]=240|t>>>18,e[h++]=128|t>>>12&63,e[h++]=128|t>>>6&63,e[h++]=128|t&63);return e},Yz=(i,e)=>{if(e<65534&&i.subarray&&lA)return String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));let t="";for(let s=0;s<e;s++)t+=String.fromCharCode(i[s]);return t},Jz=(i,e)=>{let t=e||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,e));let s,c,h=new Array(t*2);for(c=0,s=0;s<t;){let p=i[s++];if(p<128){h[c++]=p;continue}let r=Wm[p];if(r>4){h[c++]=65533,s+=r-1;continue}for(p&=r===2?31:r===3?15:7;r>1&&s<t;)p=p<<6|i[s++]&63,r--;if(r>1){h[c++]=65533;continue}p<65536?h[c++]=p:(p-=65536,h[c++]=55296|p>>10&1023,h[c++]=56320|p&1023)}return Yz(h,c)},$z=(i,e)=>{e=e||i.length,e>i.length&&(e=i.length);let t=e-1;for(;t>=0&&(i[t]&192)==128;)t--;return t<0||t===0?e:t+Wm[i[t]]>e?t:e},qm={string2buf:Kz,buf2string:Jz,utf8border:$z};function Qz(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var cA=Qz,uA=Object.prototype.toString,{Z_NO_FLUSH:eO,Z_SYNC_FLUSH:tO,Z_FULL_FLUSH:nO,Z_FINISH:iO,Z_OK:jy,Z_STREAM_END:rO,Z_DEFAULT_COMPRESSION:sO,Z_DEFAULT_STRATEGY:oO,Z_DEFLATED:aO}=Bm;function U1(i){this.options=Hy.assign({level:sO,method:aO,chunkSize:16384,windowBits:15,memLevel:8,strategy:oO},i||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new cA,this.strm.avail_out=0;let t=jm.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==jy)throw new Error(nf[t]);if(e.header&&jm.deflateSetHeader(this.strm,e.header),e.dictionary){let s;if(typeof e.dictionary=="string"?s=qm.string2buf(e.dictionary):uA.call(e.dictionary)==="[object ArrayBuffer]"?s=new Uint8Array(e.dictionary):s=e.dictionary,t=jm.deflateSetDictionary(this.strm,s),t!==jy)throw new Error(nf[t]);this._dict_set=!0}}U1.prototype.push=function(i,e){let t=this.strm,s=this.options.chunkSize,c,h;if(this.ended)return!1;for(e===~~e?h=e:h=e===!0?iO:eO,typeof i=="string"?t.input=qm.string2buf(i):uA.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(s),t.next_out=0,t.avail_out=s),(h===tO||h===nO)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(c=jm.deflate(t,h),c===rO)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),c=jm.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===jy;if(t.avail_out===0){this.onData(t.output);continue}if(h>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};U1.prototype.onData=function(i){this.chunks.push(i)};U1.prototype.onEnd=function(i){i===jy&&(this.result=Hy.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};var Wy=30,lO=12,cO=function(e,t){let s,c,h,p,r,x,v,w,S,A,I,R,k,L,z,B,$,H,G,le,te,ue,me,se,Y=e.state;s=e.next_in,me=e.input,c=s+(e.avail_in-5),h=e.next_out,se=e.output,p=h-(t-e.avail_out),r=h+(e.avail_out-257),x=Y.dmax,v=Y.wsize,w=Y.whave,S=Y.wnext,A=Y.window,I=Y.hold,R=Y.bits,k=Y.lencode,L=Y.distcode,z=(1<<Y.lenbits)-1,B=(1<<Y.distbits)-1;e:do{R<15&&(I+=me[s++]<<R,R+=8,I+=me[s++]<<R,R+=8),$=k[I&z];t:for(;;){if(H=$>>>24,I>>>=H,R-=H,H=$>>>16&255,H===0)se[h++]=$&65535;else if(H&16){G=$&65535,H&=15,H&&(R<H&&(I+=me[s++]<<R,R+=8),G+=I&(1<<H)-1,I>>>=H,R-=H),R<15&&(I+=me[s++]<<R,R+=8,I+=me[s++]<<R,R+=8),$=L[I&B];n:for(;;){if(H=$>>>24,I>>>=H,R-=H,H=$>>>16&255,H&16){if(le=$&65535,H&=15,R<H&&(I+=me[s++]<<R,R+=8,R<H&&(I+=me[s++]<<R,R+=8)),le+=I&(1<<H)-1,le>x){e.msg="invalid distance too far back",Y.mode=Wy;break e}if(I>>>=H,R-=H,H=h-p,le>H){if(H=le-H,H>w&&Y.sane){e.msg="invalid distance too far back",Y.mode=Wy;break e}if(te=0,ue=A,S===0){if(te+=v-H,H<G){G-=H;do se[h++]=A[te++];while(--H);te=h-le,ue=se}}else if(S<H){if(te+=v+S-H,H-=S,H<G){G-=H;do se[h++]=A[te++];while(--H);if(te=0,S<G){H=S,G-=H;do se[h++]=A[te++];while(--H);te=h-le,ue=se}}}else if(te+=S-H,H<G){G-=H;do se[h++]=A[te++];while(--H);te=h-le,ue=se}for(;G>2;)se[h++]=ue[te++],se[h++]=ue[te++],se[h++]=ue[te++],G-=3;G&&(se[h++]=ue[te++],G>1&&(se[h++]=ue[te++]))}else{te=h-le;do se[h++]=se[te++],se[h++]=se[te++],se[h++]=se[te++],G-=3;while(G>2);G&&(se[h++]=se[te++],G>1&&(se[h++]=se[te++]))}}else if((H&64)==0){$=L[($&65535)+(I&(1<<H)-1)];continue n}else{e.msg="invalid distance code",Y.mode=Wy;break e}break}}else if((H&64)==0){$=k[($&65535)+(I&(1<<H)-1)];continue t}else if(H&32){Y.mode=lO;break e}else{e.msg="invalid literal/length code",Y.mode=Wy;break e}break}}while(s<c&&h<r);G=R>>3,s-=G,R-=G<<3,I&=(1<<R)-1,e.next_in=s,e.next_out=h,e.avail_in=s<c?5+(c-s):5-(s-c),e.avail_out=h<r?257+(r-h):257-(h-r),Y.hold=I,Y.bits=R},of=15,hA=852,dA=592,fA=0,V1=1,pA=2,uO=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),hO=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dO=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),fO=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),pO=(i,e,t,s,c,h,p,r)=>{let x=r.bits,v=0,w=0,S=0,A=0,I=0,R=0,k=0,L=0,z=0,B=0,$,H,G,le,te,ue=null,me=0,se,Y=new Uint16Array(of+1),ye=new Uint16Array(of+1),Xe=null,ge=0,re,ve,ae;for(v=0;v<=of;v++)Y[v]=0;for(w=0;w<s;w++)Y[e[t+w]]++;for(I=x,A=of;A>=1&&Y[A]===0;A--);if(I>A&&(I=A),A===0)return c[h++]=1<<24|64<<16|0,c[h++]=1<<24|64<<16|0,r.bits=1,0;for(S=1;S<A&&Y[S]===0;S++);for(I<S&&(I=S),L=1,v=1;v<=of;v++)if(L<<=1,L-=Y[v],L<0)return-1;if(L>0&&(i===fA||A!==1))return-1;for(ye[1]=0,v=1;v<of;v++)ye[v+1]=ye[v]+Y[v];for(w=0;w<s;w++)e[t+w]!==0&&(p[ye[e[t+w]]++]=w);if(i===fA?(ue=Xe=p,se=19):i===V1?(ue=uO,me-=257,Xe=hO,ge-=257,se=256):(ue=dO,Xe=fO,se=-1),B=0,w=0,v=S,te=h,R=I,k=0,G=-1,z=1<<I,le=z-1,i===V1&&z>hA||i===pA&&z>dA)return 1;for(;;){re=v-k,p[w]<se?(ve=0,ae=p[w]):p[w]>se?(ve=Xe[ge+p[w]],ae=ue[me+p[w]]):(ve=32+64,ae=0),$=1<<v-k,H=1<<R,S=H;do H-=$,c[te+(B>>k)+H]=re<<24|ve<<16|ae|0;while(H!==0);for($=1<<v-1;B&$;)$>>=1;if($!==0?(B&=$-1,B+=$):B=0,w++,--Y[v]==0){if(v===A)break;v=e[t+p[w]]}if(v>I&&(B&le)!==G){for(k===0&&(k=I),te+=S,R=v-k,L=1<<R;R+k<A&&(L-=Y[R+k],!(L<=0));)R++,L<<=1;if(z+=1<<R,i===V1&&z>hA||i===pA&&z>dA)return 1;G=B&le,c[G]=I<<24|R<<16|te-h|0}}return B!==0&&(c[te+B]=v-k<<24|64<<16|0),r.bits=I,0},Xm=pO,mO=0,mA=1,gA=2,{Z_FINISH:_A,Z_BLOCK:gO,Z_TREES:qy,Z_OK:fh,Z_STREAM_END:_O,Z_NEED_DICT:yO,Z_STREAM_ERROR:Wo,Z_DATA_ERROR:yA,Z_MEM_ERROR:vA,Z_BUF_ERROR:vO,Z_DEFLATED:xA}=Bm,bA=1,wA=2,TA=3,EA=4,SA=5,AA=6,MA=7,IA=8,CA=9,LA=10,Xy=11,Ol=12,G1=13,DA=14,H1=15,RA=16,PA=17,kA=18,zA=19,Zy=20,Ky=21,OA=22,NA=23,FA=24,BA=25,UA=26,j1=27,VA=28,GA=29,Dr=30,HA=31,xO=32,bO=852,wO=592,TO=15,EO=TO,jA=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function SO(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var WA=i=>{if(!i||!i.state)return Wo;let e=i.state;return i.total_in=i.total_out=e.total=0,i.msg="",e.wrap&&(i.adler=e.wrap&1),e.mode=bA,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(bO),e.distcode=e.distdyn=new Int32Array(wO),e.sane=1,e.back=-1,fh},qA=i=>{if(!i||!i.state)return Wo;let e=i.state;return e.wsize=0,e.whave=0,e.wnext=0,WA(i)},XA=(i,e)=>{let t;if(!i||!i.state)return Wo;let s=i.state;return e<0?(t=0,e=-e):(t=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?Wo:(s.window!==null&&s.wbits!==e&&(s.window=null),s.wrap=t,s.wbits=e,qA(i))},ZA=(i,e)=>{if(!i)return Wo;let t=new SO;i.state=t,t.window=null;let s=XA(i,e);return s!==fh&&(i.state=null),s},AO=i=>ZA(i,EO),KA=!0,W1,q1,MO=i=>{if(KA){W1=new Int32Array(512),q1=new Int32Array(32);let e=0;for(;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(Xm(mA,i.lens,0,288,W1,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;Xm(gA,i.lens,0,32,q1,0,i.work,{bits:5}),KA=!1}i.lencode=W1,i.lenbits=9,i.distcode=q1,i.distbits=5},YA=(i,e,t,s)=>{let c,h=i.state;return h.window===null&&(h.wsize=1<<h.wbits,h.wnext=0,h.whave=0,h.window=new Uint8Array(h.wsize)),s>=h.wsize?(h.window.set(e.subarray(t-h.wsize,t),0),h.wnext=0,h.whave=h.wsize):(c=h.wsize-h.wnext,c>s&&(c=s),h.window.set(e.subarray(t-s,t-s+c),h.wnext),s-=c,s?(h.window.set(e.subarray(t-s,t),0),h.wnext=s,h.whave=h.wsize):(h.wnext+=c,h.wnext===h.wsize&&(h.wnext=0),h.whave<h.wsize&&(h.whave+=c))),0},IO=(i,e)=>{let t,s,c,h,p,r,x,v,w,S,A,I,R,k,L=0,z,B,$,H,G,le,te,ue,me=new Uint8Array(4),se,Y,ye=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!i||!i.state||!i.output||!i.input&&i.avail_in!==0)return Wo;t=i.state,t.mode===Ol&&(t.mode=G1),p=i.next_out,c=i.output,x=i.avail_out,h=i.next_in,s=i.input,r=i.avail_in,v=t.hold,w=t.bits,S=r,A=x,ue=fh;e:for(;;)switch(t.mode){case bA:if(t.wrap===0){t.mode=G1;break}for(;w<16;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}if(t.wrap&2&&v===35615){t.check=0,me[0]=v&255,me[1]=v>>>8&255,t.check=xs(t.check,me,2,0),v=0,w=0,t.mode=wA;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((v&255)<<8)+(v>>8))%31){i.msg="incorrect header check",t.mode=Dr;break}if((v&15)!==xA){i.msg="unknown compression method",t.mode=Dr;break}if(v>>>=4,w-=4,te=(v&15)+8,t.wbits===0)t.wbits=te;else if(te>t.wbits){i.msg="invalid window size",t.mode=Dr;break}t.dmax=1<<t.wbits,i.adler=t.check=1,t.mode=v&512?LA:Ol,v=0,w=0;break;case wA:for(;w<16;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}if(t.flags=v,(t.flags&255)!==xA){i.msg="unknown compression method",t.mode=Dr;break}if(t.flags&57344){i.msg="unknown header flags set",t.mode=Dr;break}t.head&&(t.head.text=v>>8&1),t.flags&512&&(me[0]=v&255,me[1]=v>>>8&255,t.check=xs(t.check,me,2,0)),v=0,w=0,t.mode=TA;case TA:for(;w<32;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}t.head&&(t.head.time=v),t.flags&512&&(me[0]=v&255,me[1]=v>>>8&255,me[2]=v>>>16&255,me[3]=v>>>24&255,t.check=xs(t.check,me,4,0)),v=0,w=0,t.mode=EA;case EA:for(;w<16;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}t.head&&(t.head.xflags=v&255,t.head.os=v>>8),t.flags&512&&(me[0]=v&255,me[1]=v>>>8&255,t.check=xs(t.check,me,2,0)),v=0,w=0,t.mode=SA;case SA:if(t.flags&1024){for(;w<16;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}t.length=v,t.head&&(t.head.extra_len=v),t.flags&512&&(me[0]=v&255,me[1]=v>>>8&255,t.check=xs(t.check,me,2,0)),v=0,w=0}else t.head&&(t.head.extra=null);t.mode=AA;case AA:if(t.flags&1024&&(I=t.length,I>r&&(I=r),I&&(t.head&&(te=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(s.subarray(h,h+I),te)),t.flags&512&&(t.check=xs(t.check,s,I,h)),r-=I,h+=I,t.length-=I),t.length))break e;t.length=0,t.mode=MA;case MA:if(t.flags&2048){if(r===0)break e;I=0;do te=s[h+I++],t.head&&te&&t.length<65536&&(t.head.name+=String.fromCharCode(te));while(te&&I<r);if(t.flags&512&&(t.check=xs(t.check,s,I,h)),r-=I,h+=I,te)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=IA;case IA:if(t.flags&4096){if(r===0)break e;I=0;do te=s[h+I++],t.head&&te&&t.length<65536&&(t.head.comment+=String.fromCharCode(te));while(te&&I<r);if(t.flags&512&&(t.check=xs(t.check,s,I,h)),r-=I,h+=I,te)break e}else t.head&&(t.head.comment=null);t.mode=CA;case CA:if(t.flags&512){for(;w<16;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}if(v!==(t.check&65535)){i.msg="header crc mismatch",t.mode=Dr;break}v=0,w=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=Ol;break;case LA:for(;w<32;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}i.adler=t.check=jA(v),v=0,w=0,t.mode=Xy;case Xy:if(t.havedict===0)return i.next_out=p,i.avail_out=x,i.next_in=h,i.avail_in=r,t.hold=v,t.bits=w,yO;i.adler=t.check=1,t.mode=Ol;case Ol:if(e===gO||e===qy)break e;case G1:if(t.last){v>>>=w&7,w-=w&7,t.mode=j1;break}for(;w<3;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}switch(t.last=v&1,v>>>=1,w-=1,v&3){case 0:t.mode=DA;break;case 1:if(MO(t),t.mode=Zy,e===qy){v>>>=2,w-=2;break e}break;case 2:t.mode=PA;break;case 3:i.msg="invalid block type",t.mode=Dr}v>>>=2,w-=2;break;case DA:for(v>>>=w&7,w-=w&7;w<32;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}if((v&65535)!=(v>>>16^65535)){i.msg="invalid stored block lengths",t.mode=Dr;break}if(t.length=v&65535,v=0,w=0,t.mode=H1,e===qy)break e;case H1:t.mode=RA;case RA:if(I=t.length,I){if(I>r&&(I=r),I>x&&(I=x),I===0)break e;c.set(s.subarray(h,h+I),p),r-=I,h+=I,x-=I,p+=I,t.length-=I;break}t.mode=Ol;break;case PA:for(;w<14;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}if(t.nlen=(v&31)+257,v>>>=5,w-=5,t.ndist=(v&31)+1,v>>>=5,w-=5,t.ncode=(v&15)+4,v>>>=4,w-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=Dr;break}t.have=0,t.mode=kA;case kA:for(;t.have<t.ncode;){for(;w<3;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}t.lens[ye[t.have++]]=v&7,v>>>=3,w-=3}for(;t.have<19;)t.lens[ye[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,se={bits:t.lenbits},ue=Xm(mO,t.lens,0,19,t.lencode,0,t.work,se),t.lenbits=se.bits,ue){i.msg="invalid code lengths set",t.mode=Dr;break}t.have=0,t.mode=zA;case zA:for(;t.have<t.nlen+t.ndist;){for(;L=t.lencode[v&(1<<t.lenbits)-1],z=L>>>24,B=L>>>16&255,$=L&65535,!(z<=w);){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}if($<16)v>>>=z,w-=z,t.lens[t.have++]=$;else{if($===16){for(Y=z+2;w<Y;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}if(v>>>=z,w-=z,t.have===0){i.msg="invalid bit length repeat",t.mode=Dr;break}te=t.lens[t.have-1],I=3+(v&3),v>>>=2,w-=2}else if($===17){for(Y=z+3;w<Y;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}v>>>=z,w-=z,te=0,I=3+(v&7),v>>>=3,w-=3}else{for(Y=z+7;w<Y;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}v>>>=z,w-=z,te=0,I=11+(v&127),v>>>=7,w-=7}if(t.have+I>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=Dr;break}for(;I--;)t.lens[t.have++]=te}}if(t.mode===Dr)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=Dr;break}if(t.lenbits=9,se={bits:t.lenbits},ue=Xm(mA,t.lens,0,t.nlen,t.lencode,0,t.work,se),t.lenbits=se.bits,ue){i.msg="invalid literal/lengths set",t.mode=Dr;break}if(t.distbits=6,t.distcode=t.distdyn,se={bits:t.distbits},ue=Xm(gA,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,se),t.distbits=se.bits,ue){i.msg="invalid distances set",t.mode=Dr;break}if(t.mode=Zy,e===qy)break e;case Zy:t.mode=Ky;case Ky:if(r>=6&&x>=258){i.next_out=p,i.avail_out=x,i.next_in=h,i.avail_in=r,t.hold=v,t.bits=w,cO(i,A),p=i.next_out,c=i.output,x=i.avail_out,h=i.next_in,s=i.input,r=i.avail_in,v=t.hold,w=t.bits,t.mode===Ol&&(t.back=-1);break}for(t.back=0;L=t.lencode[v&(1<<t.lenbits)-1],z=L>>>24,B=L>>>16&255,$=L&65535,!(z<=w);){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}if(B&&(B&240)==0){for(H=z,G=B,le=$;L=t.lencode[le+((v&(1<<H+G)-1)>>H)],z=L>>>24,B=L>>>16&255,$=L&65535,!(H+z<=w);){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}v>>>=H,w-=H,t.back+=H}if(v>>>=z,w-=z,t.back+=z,t.length=$,B===0){t.mode=UA;break}if(B&32){t.back=-1,t.mode=Ol;break}if(B&64){i.msg="invalid literal/length code",t.mode=Dr;break}t.extra=B&15,t.mode=OA;case OA:if(t.extra){for(Y=t.extra;w<Y;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}t.length+=v&(1<<t.extra)-1,v>>>=t.extra,w-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=NA;case NA:for(;L=t.distcode[v&(1<<t.distbits)-1],z=L>>>24,B=L>>>16&255,$=L&65535,!(z<=w);){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}if((B&240)==0){for(H=z,G=B,le=$;L=t.distcode[le+((v&(1<<H+G)-1)>>H)],z=L>>>24,B=L>>>16&255,$=L&65535,!(H+z<=w);){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}v>>>=H,w-=H,t.back+=H}if(v>>>=z,w-=z,t.back+=z,B&64){i.msg="invalid distance code",t.mode=Dr;break}t.offset=$,t.extra=B&15,t.mode=FA;case FA:if(t.extra){for(Y=t.extra;w<Y;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}t.offset+=v&(1<<t.extra)-1,v>>>=t.extra,w-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=Dr;break}t.mode=BA;case BA:if(x===0)break e;if(I=A-x,t.offset>I){if(I=t.offset-I,I>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=Dr;break}I>t.wnext?(I-=t.wnext,R=t.wsize-I):R=t.wnext-I,I>t.length&&(I=t.length),k=t.window}else k=c,R=p-t.offset,I=t.length;I>x&&(I=x),x-=I,t.length-=I;do c[p++]=k[R++];while(--I);t.length===0&&(t.mode=Ky);break;case UA:if(x===0)break e;c[p++]=t.length,x--,t.mode=Ky;break;case j1:if(t.wrap){for(;w<32;){if(r===0)break e;r--,v|=s[h++]<<w,w+=8}if(A-=x,i.total_out+=A,t.total+=A,A&&(i.adler=t.check=t.flags?xs(t.check,c,A,p-A):Fm(t.check,c,A,p-A)),A=x,(t.flags?v:jA(v))!==t.check){i.msg="incorrect data check",t.mode=Dr;break}v=0,w=0}t.mode=VA;case VA:if(t.wrap&&t.flags){for(;w<32;){if(r===0)break e;r--,v+=s[h++]<<w,w+=8}if(v!==(t.total&4294967295)){i.msg="incorrect length check",t.mode=Dr;break}v=0,w=0}t.mode=GA;case GA:ue=_O;break e;case Dr:ue=yA;break e;case HA:return vA;case xO:default:return Wo}return i.next_out=p,i.avail_out=x,i.next_in=h,i.avail_in=r,t.hold=v,t.bits=w,(t.wsize||A!==i.avail_out&&t.mode<Dr&&(t.mode<j1||e!==_A))&&YA(i,i.output,i.next_out,A-i.avail_out),S-=i.avail_in,A-=i.avail_out,i.total_in+=S,i.total_out+=A,t.total+=A,t.wrap&&A&&(i.adler=t.check=t.flags?xs(t.check,c,A,i.next_out-A):Fm(t.check,c,A,i.next_out-A)),i.data_type=t.bits+(t.last?64:0)+(t.mode===Ol?128:0)+(t.mode===Zy||t.mode===H1?256:0),(S===0&&A===0||e===_A)&&ue===fh&&(ue=vO),ue},CO=i=>{if(!i||!i.state)return Wo;let e=i.state;return e.window&&(e.window=null),i.state=null,fh},LO=(i,e)=>{if(!i||!i.state)return Wo;let t=i.state;return(t.wrap&2)==0?Wo:(t.head=e,e.done=!1,fh)},DO=(i,e)=>{let t=e.length,s,c,h;return!i||!i.state||(s=i.state,s.wrap!==0&&s.mode!==Xy)?Wo:s.mode===Xy&&(c=1,c=Fm(c,e,t,0),c!==s.check)?yA:(h=YA(i,e,t,t),h?(s.mode=HA,vA):(s.havedict=1,fh))},RO=qA,PO=XA,kO=WA,zO=AO,OO=ZA,NO=IO,FO=CO,BO=LO,UO=DO,VO="pako inflate (from Nodeca project)",Nl={inflateReset:RO,inflateReset2:PO,inflateResetKeep:kO,inflateInit:zO,inflateInit2:OO,inflate:NO,inflateEnd:FO,inflateGetHeader:BO,inflateSetDictionary:UO,inflateInfo:VO};function GO(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var HO=GO,JA=Object.prototype.toString,{Z_NO_FLUSH:jO,Z_FINISH:WO,Z_OK:Zm,Z_STREAM_END:X1,Z_NEED_DICT:Z1,Z_STREAM_ERROR:qO,Z_DATA_ERROR:$A,Z_MEM_ERROR:XO}=Bm;function Km(i){this.options=Hy.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(i&&i.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new cA,this.strm.avail_out=0;let t=Nl.inflateInit2(this.strm,e.windowBits);if(t!==Zm)throw new Error(nf[t]);if(this.header=new HO,Nl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=qm.string2buf(e.dictionary):JA.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=Nl.inflateSetDictionary(this.strm,e.dictionary),t!==Zm)))throw new Error(nf[t])}Km.prototype.push=function(i,e){let t=this.strm,s=this.options.chunkSize,c=this.options.dictionary,h,p,r;if(this.ended)return!1;for(e===~~e?p=e:p=e===!0?WO:jO,JA.call(i)==="[object ArrayBuffer]"?t.input=new Uint8Array(i):t.input=i,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(s),t.next_out=0,t.avail_out=s),h=Nl.inflate(t,p),h===Z1&&c&&(h=Nl.inflateSetDictionary(t,c),h===Zm?h=Nl.inflate(t,p):h===$A&&(h=Z1));t.avail_in>0&&h===X1&&t.state.wrap>0&&i[t.next_in]!==0;)Nl.inflateReset(t),h=Nl.inflate(t,p);switch(h){case qO:case $A:case Z1:case XO:return this.onEnd(h),this.ended=!0,!1}if(r=t.avail_out,t.next_out&&(t.avail_out===0||h===X1))if(this.options.to==="string"){let x=qm.utf8border(t.output,t.next_out),v=t.next_out-x,w=qm.buf2string(t.output,x);t.next_out=v,t.avail_out=s-v,v&&t.output.set(t.output.subarray(x,x+v),0),this.onData(w)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(h===Zm&&r===0)){if(h===X1)return h=Nl.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Km.prototype.onData=function(i){this.chunks.push(i)};Km.prototype.onEnd=function(i){i===Zm&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Hy.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function K1(i,e){let t=new Km(e);if(t.push(i),t.err)throw t.msg||nf[t.err];return t.result}function ZO(i,e){return e=e||{},e.raw=!0,K1(i,e)}var KO=Km,YO=K1,JO=ZO,$O=K1,QO=Bm,eN={Inflate:KO,inflate:YO,inflateRaw:JO,ungzip:$O,constants:QO};var{Inflate:nj,inflate:tN,inflateRaw:ij,ungzip:rj}=eN;var ph=tN;function QA(){let i=new oh([],function(I,R){return R.time-I.time}),e=0,t=0,s,c;function h(){for(;i.length;){let I=new FileReader,R=i.pop();I.onload=function(k){let L=k.target.result,z=new Uint8Array(L);try{z=ph(z)}catch($){}let B="";for(let $=0;$<6;$++)B=B+String.fromCharCode(z[$]);if(B!="AR2V00"&&B!="ARCHIV"){e-=1,B==="ARCHIV"?Zi.update($=>($.error=!0,$.message="The application cannot yet read files in an old format like "+R.name+".",$.header="Old format",$)):Zi.update($=>($.error=!0,$.message="The file "+R.name+" could not be read due to an unexpected format.",$.header="Unexpected format",$));return}en(va).postMessage({message:"initialize",fileName:R.name,buffer:z.buffer},[z.buffer])},I.readAsArrayBuffer(R)}}function p(I){I.preventDefault(),c=!0,s.style.pointerEvents="none"}function r(I){I.preventDefault()}function x(I){I.preventDefault(),c=!1,s.style.pointerEvents=""}function v(I){if(s.style.pointerEvents="",I.preventDefault(),c=!1,I.dataTransfer.items){let R=[];for(let k=0;k<I.dataTransfer.items.length;k++)if(I.dataTransfer.items[k].kind==="file"){let L=I.dataTransfer.items[k].getAsFile();L.time=Date.now(),R.push(L)}w(R)}}function w(I){let R=0;for(let z=0;z<en(ni).length;z++)en(ni)[z]&&R++;let k=en(ni).filter(z=>z!=null).map(z=>z.fileName),L=[];for(let z=0;z<I.length;z++){let B=I[z];if(k.indexOf(B.name)>=0){Zi.update($=>($.error=!0,$.message="A file already exists with the name "+B.name,$.header="Duplicate file",$));return}L.push(B)}if(e+I.length>5||I.length+R>5){Zi.update(z=>(z.error=!0,z.message="The application cannot load more than 5 files. Remove a file using the File view before loading another.",z.header="Too many files",z));return}for(let z=0;z<L.length;z++)i.push(L[z]);e=e+L.length,h()}function S(){if(!!e){if(en(ni).finished===1&&(percent=1,t+=1),t===e)percent=-1,t=0,e=0;else if(en(ni)[en(ni).loading]){let I=en(ni).loading,R=en(ni)[I].percent;R!=null&&(percent=R)}}}function A(){let I=this.files,R=[];for(let k=0,L=I.length;k<L;k++){let z=I[k];z.time=Date.now(),R.push(z)}w(R)}return{set b(I){s=I},get b(){return s},set hovering(I){c=I},get hovering(){return c},set count(I){e=I},get count(){return e},set numLoaded(I){t=I},get numLoaded(){return t},handleDragDrop:v,handleDragEnter:p,handleDragLeave:x,handleDragOver:r,updatePercent:S,handleFiles:A}}var af=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Y1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function J1(i,e){return i(e={exports:{}},e.exports),e.exports}var mh=J1(function(i,e){Object.defineProperty(e,"__esModule",{value:!0});var t=function(){function s(){var c=this;this.locked=new Map,this.addToLocked=function(h,p){var r=c.locked.get(h);r===void 0?p===void 0?c.locked.set(h,[]):c.locked.set(h,[p]):p!==void 0&&(r.unshift(p),c.locked.set(h,r))},this.isLocked=function(h){return c.locked.has(h)},this.lock=function(h){return new Promise(function(p,r){c.isLocked(h)?c.addToLocked(h,p):(c.addToLocked(h),p())})},this.unlock=function(h){var p=c.locked.get(h);if(p!==void 0&&p.length!==0){var r=p.pop();c.locked.set(h,p),r!==void 0&&setTimeout(r,0)}else c.locked.delete(h)}}return s.getInstance=function(){return s.instance===void 0&&(s.instance=new s),s.instance},s}();e.default=function(){return t.getInstance()}});Y1(mh);var nN=Y1(J1(function(i,e){var t=af&&af.__awaiter||function(x,v,w,S){return new(w||(w=Promise))(function(A,I){function R(z){try{L(S.next(z))}catch(B){I(B)}}function k(z){try{L(S.throw(z))}catch(B){I(B)}}function L(z){z.done?A(z.value):new w(function(B){B(z.value)}).then(R,k)}L((S=S.apply(x,v||[])).next())})},s=af&&af.__generator||function(x,v){var w,S,A,I,R={label:0,sent:function(){if(1&A[0])throw A[1];return A[1]},trys:[],ops:[]};return I={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function k(L){return function(z){return function(B){if(w)throw new TypeError("Generator is already executing.");for(;R;)try{if(w=1,S&&(A=2&B[0]?S.return:B[0]?S.throw||((A=S.return)&&A.call(S),0):S.next)&&!(A=A.call(S,B[1])).done)return A;switch(S=0,A&&(B=[2&B[0],A.value]),B[0]){case 0:case 1:A=B;break;case 4:return R.label++,{value:B[1],done:!1};case 5:R.label++,S=B[1],B=[0];continue;case 7:B=R.ops.pop(),R.trys.pop();continue;default:if(A=R.trys,!((A=A.length>0&&A[A.length-1])||B[0]!==6&&B[0]!==2)){R=0;continue}if(B[0]===3&&(!A||B[1]>A[0]&&B[1]<A[3])){R.label=B[1];break}if(B[0]===6&&R.label<A[1]){R.label=A[1],A=B;break}if(A&&R.label<A[2]){R.label=A[2],R.ops.push(B);break}A[2]&&R.ops.pop(),R.trys.pop();continue}B=v.call(x,R)}catch($){B=[6,$],S=0}finally{w=A=0}if(5&B[0])throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}([L,z])}}};Object.defineProperty(e,"__esModule",{value:!0});var c="browser-tabs-lock-key";function h(x){return new Promise(function(v){return setTimeout(v,x)})}function p(x){for(var v="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",w="",S=0;S<x;S++)w+=v[Math.floor(Math.random()*v.length)];return w}var r=function(){function x(){this.acquiredIatSet=new Set,this.id=Date.now().toString()+p(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),x.waiters===void 0&&(x.waiters=[])}return x.prototype.acquireLock=function(v,w){return w===void 0&&(w=5e3),t(this,void 0,void 0,function(){var S,A,I,R,k,L;return s(this,function(z){switch(z.label){case 0:S=Date.now()+p(4),A=Date.now()+w,I=c+"-"+v,R=window.localStorage,z.label=1;case 1:return Date.now()<A?[4,h(30)]:[3,8];case 2:return z.sent(),R.getItem(I)!==null?[3,5]:(k=this.id+"-"+v+"-"+S,[4,h(Math.floor(25*Math.random()))]);case 3:return z.sent(),R.setItem(I,JSON.stringify({id:this.id,iat:S,timeoutKey:k,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,h(30)];case 4:return z.sent(),(L=R.getItem(I))!==null&&(L=JSON.parse(L)).id===this.id&&L.iat===S?(this.acquiredIatSet.add(S),this.refreshLockWhileAcquired(I,S),[2,!0]):[3,7];case 5:return x.lockCorrector(),[4,this.waitForSomethingToChange(A)];case 6:z.sent(),z.label=7;case 7:return S=Date.now()+p(4),[3,1];case 8:return[2,!1]}})})},x.prototype.refreshLockWhileAcquired=function(v,w){return t(this,void 0,void 0,function(){var S=this;return s(this,function(A){return setTimeout(function(){return t(S,void 0,void 0,function(){var I,R;return s(this,function(k){switch(k.label){case 0:return[4,mh.default().lock(w)];case 1:return k.sent(),this.acquiredIatSet.has(w)?(I=window.localStorage,(R=I.getItem(v))===null?(mh.default().unlock(w),[2]):((R=JSON.parse(R)).timeRefreshed=Date.now(),I.setItem(v,JSON.stringify(R)),mh.default().unlock(w),this.refreshLockWhileAcquired(v,w),[2])):(mh.default().unlock(w),[2])}})})},1e3),[2]})})},x.prototype.waitForSomethingToChange=function(v){return t(this,void 0,void 0,function(){return s(this,function(w){switch(w.label){case 0:return[4,new Promise(function(S){var A=!1,I=Date.now(),R=!1;function k(){if(R||(window.removeEventListener("storage",k),x.removeFromWaiting(k),clearTimeout(L),R=!0),!A){A=!0;var z=50-(Date.now()-I);z>0?setTimeout(S,z):S()}}window.addEventListener("storage",k),x.addToWaiting(k);var L=setTimeout(k,Math.max(0,v-Date.now()))})];case 1:return w.sent(),[2]}})})},x.addToWaiting=function(v){this.removeFromWaiting(v),x.waiters!==void 0&&x.waiters.push(v)},x.removeFromWaiting=function(v){x.waiters!==void 0&&(x.waiters=x.waiters.filter(function(w){return w!==v}))},x.notifyWaiters=function(){x.waiters!==void 0&&x.waiters.slice().forEach(function(v){return v()})},x.prototype.releaseLock=function(v){return t(this,void 0,void 0,function(){return s(this,function(w){switch(w.label){case 0:return[4,this.releaseLock__private__(v)];case 1:return[2,w.sent()]}})})},x.prototype.releaseLock__private__=function(v){return t(this,void 0,void 0,function(){var w,S,A;return s(this,function(I){switch(I.label){case 0:return w=window.localStorage,S=c+"-"+v,(A=w.getItem(S))===null?[2]:(A=JSON.parse(A)).id!==this.id?[3,2]:[4,mh.default().lock(A.iat)];case 1:I.sent(),this.acquiredIatSet.delete(A.iat),w.removeItem(S),mh.default().unlock(A.iat),x.notifyWaiters(),I.label=2;case 2:return[2]}})})},x.lockCorrector=function(){for(var v=Date.now()-5e3,w=window.localStorage,S=Object.keys(w),A=!1,I=0;I<S.length;I++){var R=S[I];if(R.includes(c)){var k=w.getItem(R);k!==null&&((k=JSON.parse(k)).timeRefreshed===void 0&&k.timeAcquired<v||k.timeRefreshed!==void 0&&k.timeRefreshed<v)&&(w.removeItem(R),A=!0)}}A&&x.notifyWaiters()},x.waiters=void 0,x}();e.default=r}));var gh=J1(function(i,e){var t=af&&af.__assign||function(){return t=Object.assign||function(x){for(var v,w=1,S=arguments.length;w<S;w++)for(var A in v=arguments[w])Object.prototype.hasOwnProperty.call(v,A)&&(x[A]=v[A]);return x},t.apply(this,arguments)};function s(x,v){if(!v)return"";var w="; "+x;return v===!0?w:w+"="+v}function c(x,v,w){return encodeURIComponent(x).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(v).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(S){if(typeof S.expires=="number"){var A=new Date;A.setMilliseconds(A.getMilliseconds()+864e5*S.expires),S.expires=A}return s("Expires",S.expires?S.expires.toUTCString():"")+s("Domain",S.domain)+s("Path",S.path)+s("Secure",S.secure)+s("SameSite",S.sameSite)}(w)}function h(x){for(var v={},w=x?x.split("; "):[],S=/(%[\dA-F]{2})+/gi,A=0;A<w.length;A++){var I=w[A].split("="),R=I.slice(1).join("=");R.charAt(0)==='"'&&(R=R.slice(1,-1));try{v[I[0].replace(S,decodeURIComponent)]=R.replace(S,decodeURIComponent)}catch(k){}}return v}function p(){return h(document.cookie)}function r(x,v,w){document.cookie=c(x,v,t({path:"/"},w))}e.__esModule=!0,e.encode=c,e.parse=h,e.getAll=p,e.get=function(x){return p()[x]},e.set=r,e.remove=function(x,v){r(x,"",t(t({},v),{expires:-1}))}});Y1(gh),gh.encode,gh.parse,gh.getAll;var hj=gh.get,dj=gh.set,fj=gh.remove;function iN(i,e,t){var s=e===void 0?null:e,c=function(x,v){var w=atob(x);if(v){for(var S=new Uint8Array(w.length),A=0,I=w.length;A<I;++A)S[A]=w.charCodeAt(A);return String.fromCharCode.apply(null,new Uint16Array(S.buffer))}return w}(i,t!==void 0&&t),h=c.indexOf(`
`,10)+1,p=c.substring(h)+(s?"//# sourceMappingURL="+s:""),r=new Blob([p],{type:"application/javascript"});return URL.createObjectURL(r)}var eM,tM,nM,$1,pj=(eM="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHtlcnJvcjp0LGVycm9yX2Rlc2NyaXB0aW9uOnJ9KXtyZXR1cm4gbmV3IGUodCxyKX19Y2xhc3MgdCBleHRlbmRzIGV7Y29uc3RydWN0b3IoZSxzKXtzdXBlcigibWlzc2luZ19yZWZyZXNoX3Rva2VuIixgTWlzc2luZyBSZWZyZXNoIFRva2VuIChhdWRpZW5jZTogJyR7cihlLFsiZGVmYXVsdCJdKX0nLCBzY29wZTogJyR7cihzKX0nKWApLHRoaXMuYXVkaWVuY2U9ZSx0aGlzLnNjb3BlPXMsT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsdC5wcm90b3R5cGUpfX1mdW5jdGlvbiByKGUsdD1bXSl7cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9Y29uc3Qgcz1lPT57dmFye2NsaWVudElkOnR9PWUscj1mdW5jdGlvbihlLHQpe3ZhciByPXt9O2Zvcih2YXIgcyBpbiBlKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLHMpJiZ0LmluZGV4T2Yocyk8MCYmKHJbc109ZVtzXSk7aWYobnVsbCE9ZSYmImZ1bmN0aW9uIj09dHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpe3ZhciBvPTA7Zm9yKHM9T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTtvPHMubGVuZ3RoO28rKyl0LmluZGV4T2Yoc1tvXSk8MCYmT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKGUsc1tvXSkmJihyW3Nbb11dPWVbc1tvXV0pfXJldHVybiByfShlLFsiY2xpZW50SWQiXSk7cmV0dXJuIG5ldyBVUkxTZWFyY2hQYXJhbXMoKGU9Pk9iamVjdC5rZXlzKGUpLmZpbHRlcigodD0+dm9pZCAwIT09ZVt0XSkpLnJlZHVjZSgoKHQscik9Pk9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSx0KSx7W3JdOmVbcl19KSkse30pKShPYmplY3QuYXNzaWduKHtjbGllbnRfaWQ6dH0scikpKS50b1N0cmluZygpfTtsZXQgbz17fTtjb25zdCBuPShlLHQpPT5gJHtlfXwke3R9YDthZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwoYXN5bmMoe2RhdGE6e3RpbWVvdXQ6ZSxhdXRoOnIsZmV0Y2hVcmw6aSxmZXRjaE9wdGlvbnM6Yyx1c2VGb3JtRGF0YTphfSxwb3J0czpbZl19KT0+e2xldCBwO2NvbnN0e2F1ZGllbmNlOmwsc2NvcGU6dX09cnx8e307dHJ5e2NvbnN0IHI9YT8oZT0+e2NvbnN0IHQ9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSxyPXt9O3JldHVybiB0LmZvckVhY2goKChlLHQpPT57clt0XT1lfSkpLHJ9KShjLmJvZHkpOkpTT04ucGFyc2UoYy5ib2R5KTtpZighci5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT1yLmdyYW50X3R5cGUpe2NvbnN0IGU9KChlLHQpPT5vW24oZSx0KV0pKGwsdSk7aWYoIWUpdGhyb3cgbmV3IHQobCx1KTtjLmJvZHk9YT9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxyKSx7cmVmcmVzaF90b2tlbjplfSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxyKSx7cmVmcmVzaF90b2tlbjplfSkpfWxldCBkLGc7ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKGQ9bmV3IEFib3J0Q29udHJvbGxlcixjLnNpZ25hbD1kLnNpZ25hbCk7dHJ5e2c9YXdhaXQgUHJvbWlzZS5yYWNlKFsoaD1lLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsaCkpKSksZmV0Y2goaSxPYmplY3QuYXNzaWduKHt9LGMpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIGYucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFnKXJldHVybiBkJiZkLmFib3J0KCksdm9pZCBmLnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO3A9YXdhaXQgZy5qc29uKCkscC5yZWZyZXNoX3Rva2VuPygoKGUsdCxyKT0+e29bbih0LHIpXT1lfSkocC5yZWZyZXNoX3Rva2VuLGwsdSksZGVsZXRlIHAucmVmcmVzaF90b2tlbik6KChlLHQpPT57ZGVsZXRlIG9bbihlLHQpXX0pKGwsdSksZi5wb3N0TWVzc2FnZSh7b2s6Zy5vayxqc29uOnB9KX1jYXRjaChlKXtmLnBvc3RNZXNzYWdlKHtvazohMSxqc29uOntlcnJvcl9kZXNjcmlwdGlvbjplLm1lc3NhZ2V9fSl9dmFyIGh9KSl9KCk7Cgo=",tM=null,nM=!1,function(i){return $1=$1||iN(eM,tM,nM),new Worker($1,i)});var mj=new nN;import.meta.env=Dl;function iM(){async function i(){try{let p=await gr.getRefresh();gr.setToken(p),ah.set(!0)}catch(p){ah.set(!1)}}i();async function e(){return await gr.getTokenSilently()}async function t(){return await gr.getTokenSilently()}async function s(){let p=gr.token;return p?gr.parseToken(p):!1}return{isAuthenticated:e,login:async()=>{await auth0Client.loginWithRedirect({authorizationParams:{redirect_uri:window.location.origin}})},logout:async()=>{try{let p=await gr.post(`${$s}/logout`)}catch(p){throw p}finally{gr.removeToken(),location.reload()}},getToken:t,getUser:s,initialize:i}}var rM={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[-124.1069,47.1158]},properties:{STATION_ID:"NEXRAD:KLGX",STATION_NAME:"LANGLEY HILL NW WASHIN",STATE:"WA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-86.76972,33.17194]},properties:{STATION_ID:"NEXRAD:KBMX",STATION_NAME:"BIRMINGHAM",STATE:"AL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-78.73694,42.94861]},properties:{STATION_ID:"NEXRAD:KBUF",STATION_NAME:"BUFFALO",STATE:"NY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-116.23444,43.49083]},properties:{STATION_ID:"NEXRAD:KCBX",STATION_NAME:"BOISE",STATE:"ID"}},{type:"Feature",geometry:{type:"Point",coordinates:[-74.41111,39.94694]},properties:{STATION_ID:"NEXRAD:KDIX",STATION_NAME:"PHILADELPHIA",STATE:"NJ"}},{type:"Feature",geometry:{type:"Point",coordinates:[-110.63028,31.89361]},properties:{STATION_ID:"NEXRAD:KEMX",STATION_NAME:"TUCSON",STATE:"AZ"}},{type:"Feature",geometry:{type:"Point",coordinates:[-114.89139,35.70111]},properties:{STATION_ID:"NEXRAD:KESX",STATION_NAME:"LAS VEGAS",STATE:"NV"}},{type:"Feature",geometry:{type:"Point",coordinates:[-98.97611,34.36222]},properties:{STATION_ID:"NEXRAD:KFDR",STATION_NAME:"ALTUS AFB",STATE:"OK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-101.81361,33.65417]},properties:{STATION_ID:"NEXRAD:KLBB",STATION_NAME:"LUBBOCK",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-89.87333,35.34472]},properties:{STATION_ID:"NEXRAD:KNQA",STATION_NAME:"MEMPHIS",STATE:"TN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-88.77194,37.06833]},properties:{STATION_ID:"NEXRAD:KPAH",STATION_NAME:"PADUCAH",STATE:"KY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-104.18139,38.45944]},properties:{STATION_ID:"NEXRAD:KPUX",STATION_NAME:"PUEBLO",STATE:"CO"}},{type:"Feature",geometry:{type:"Point",coordinates:[-122.96417,45.715]},properties:{STATION_ID:"NEXRAD:KRTX",STATION_NAME:"PORTLAND",STATE:"OR"}},{type:"Feature",geometry:{type:"Point",coordinates:[-111.38444,47.45972]},properties:{STATION_ID:"NEXRAD:KTFX",STATION_NAME:"GREAT FALLS",STATE:"MT"}},{type:"Feature",geometry:{type:"Point",coordinates:[-98.1275,36.74083]},properties:{STATION_ID:"NEXRAD:KVNX",STATION_NAME:"VANCE AFB",STATE:"OK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-159.55222,21.89417]},properties:{STATION_ID:"NEXRAD:PHKI",STATION_NAME:"SOUTH KAUAI",STATE:"HI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-155.77778,20.12556]},properties:{STATION_ID:"NEXRAD:PHKM",STATION_NAME:"KAMUELA",STATE:"HI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-98.41306,45.45583]},properties:{STATION_ID:"NEXRAD:KABR",STATION_NAME:"ABERDEEN",STATE:"SD"}},{type:"Feature",geometry:{type:"Point",coordinates:[-122.49444,48.19472]},properties:{STATION_ID:"NEXRAD:KATX",STATION_NAME:"SEATTLE",STATE:"WA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-92.20972,46.83694]},properties:{STATION_ID:"NEXRAD:KDLH",STATION_NAME:"DULUTH",STATE:"MN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-75.44,38.82556]},properties:{STATION_ID:"NEXRAD:KDOX",STATION_NAME:"DOVER AFB",STATE:"DE"}},{type:"Feature",geometry:{type:"Point",coordinates:[-101.7,39.36694]},properties:{STATION_ID:"NEXRAD:KGLD",STATION_NAME:"GOODLAND",STATE:"KS"}},{type:"Feature",geometry:{type:"Point",coordinates:[-119.63111,36.31417]},properties:{STATION_ID:"NEXRAD:KHNX",STATION_NAME:"SAN JOAQUIN VALLEY",STATE:"CA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-97.4425,37.65444]},properties:{STATION_ID:"NEXRAD:KICT",STATION_NAME:"WICHITA",STATE:"KS"}},{type:"Feature",geometry:{type:"Point",coordinates:[-100.57583,41.95778]},properties:{STATION_ID:"NEXRAD:KLNX",STATION_NAME:"NORTH PLATTE",STATE:"NE"}},{type:"Feature",geometry:{type:"Point",coordinates:[-90.68278,38.69889]},properties:{STATION_ID:"NEXRAD:KLSX",STATION_NAME:"ST LOUIS",STATE:"MO"}},{type:"Feature",geometry:{type:"Point",coordinates:[-112.68528,43.10583]},properties:{STATION_ID:"NEXRAD:KSFX",STATION_NAME:"POCATELLO",STATE:"ID"}},{type:"Feature",geometry:{type:"Point",coordinates:[-96.2325,38.99694]},properties:{STATION_ID:"NEXRAD:KTWX",STATION_NAME:"TOPEKA",STATE:"KS"}},{type:"Feature",geometry:{type:"Point",coordinates:[-87.7247,38.26]},properties:{STATION_ID:"NEXRAD:KVWX",STATION_NAME:"EVANSVILLE",STATE:"IN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-91.19111,43.82278]},properties:{STATION_ID:"NEXRAD:KARX",STATION_NAME:"LA CROSSE",STATE:"WI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-108.60611,45.85389]},properties:{STATION_ID:"NEXRAD:KBLX",STATION_NAME:"BILLINGS",STATE:"MT"}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.70333,24.59694]},properties:{STATION_ID:"NEXRAD:KBYX",STATION_NAME:"KEY WEST",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-104.80611,41.15194]},properties:{STATION_ID:"NEXRAD:KCYS",STATION_NAME:"CHEYENNE",STATE:"WY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-83.47167,42.69972]},properties:{STATION_ID:"NEXRAD:KDTX",STATION_NAME:"DETROIT",STATE:"MI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-111.19833,34.57444]},properties:{STATION_ID:"NEXRAD:KFSX",STATION_NAME:"FLAGSTAFF",STATE:"AZ"}},{type:"Feature",geometry:{type:"Point",coordinates:[-88.11111,44.49833]},properties:{STATION_ID:"NEXRAD:KGRB",STATION_NAME:"GREEN BAY",STATE:"WI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-88.55056,42.96778]},properties:{STATION_ID:"NEXRAD:KMKX",STATION_NAME:"MILWAUKEE",STATE:"WI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-80.65444,28.11306]},properties:{STATION_ID:"NEXRAD:KMLB",STATION_NAME:"MELBOURNE",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-78.49,35.66528]},properties:{STATION_ID:"NEXRAD:KRAX",STATION_NAME:"RALEIGH DURHAM",STATE:"NC"}},{type:"Feature",geometry:{type:"Point",coordinates:[-100.49222,31.37111]},properties:{STATION_ID:"NEXRAD:KSJT",STATION_NAME:"SAN ANGELO",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-83.00194,30.89]},properties:{STATION_ID:"NEXRAD:KVAX",STATION_NAME:"MOODY AFB",STATE:"GA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-147.49917,65.03556]},properties:{STATION_ID:"NEXRAD:PAPD",STATION_NAME:"FAIRBANKS",STATE:"AK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-157.18,21.13278]},properties:{STATION_ID:"NEXRAD:PHMO",STATION_NAME:"MOLOKAI",STATE:"HI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-155.56889,19.095]},properties:{STATION_ID:"NEXRAD:PHWA",STATION_NAME:"SOUTH SHORE",STATE:"HI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-106.82333,35.14972]},properties:{STATION_ID:"NEXRAD:KABX",STATION_NAME:"ALBUQUERQUE",STATE:"NM"}},{type:"Feature",geometry:{type:"Point",coordinates:[-73.16639,44.51111]},properties:{STATION_ID:"NEXRAD:KCXX",STATION_NAME:"BURLINGTON",STATE:"VT"}},{type:"Feature",geometry:{type:"Point",coordinates:[-111.19833,34.57444]},properties:{STATION_ID:"NEXRAD:KFSX",STATION_NAME:"FLAGSTAFF",STATE:"AZ"}},{type:"Feature",geometry:{type:"Point",coordinates:[-104.54528,39.78667]},properties:{STATION_ID:"NEXRAD:KFTG",STATION_NAME:"DENVER FRONT RANGE AP",STATE:"CO"}},{type:"Feature",geometry:{type:"Point",coordinates:[-106.62417,48.20639]},properties:{STATION_ID:"NEXRAD:KGGW",STATION_NAME:"GLASGOW",STATE:"MT"}},{type:"Feature",geometry:{type:"Point",coordinates:[-82.22028,34.88306]},properties:{STATION_ID:"NEXRAD:KGSP",STATION_NAME:"GREER",STATE:"SC"}},{type:"Feature",geometry:{type:"Point",coordinates:[-87.285,36.73667]},properties:{STATION_ID:"NEXRAD:KHPX",STATION_NAME:"FT CAMPBELL",STATE:"KY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-86.28028,39.7075]},properties:{STATION_ID:"NEXRAD:KIND",STATION_NAME:"INDIANAPOLIS",STATE:"IN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.70194,30.48444]},properties:{STATION_ID:"NEXRAD:KJAX",STATION_NAME:"JACKSONVILLE",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-83.35111,32.675]},properties:{STATION_ID:"NEXRAD:KJGX",STATION_NAME:"ROBINS AFB",STATE:"GA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-83.31306,37.59083]},properties:{STATION_ID:"NEXRAD:KJKL",STATION_NAME:"JACKSON",STATE:"KY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-88.08472,41.60444]},properties:{STATION_ID:"NEXRAD:KLOT",STATION_NAME:"CHICAGO",STATE:"IL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-97.325,47.52806]},properties:{STATION_ID:"NEXRAD:KMVX",STATION_NAME:"GRAND FORKS",STATE:"ND"}},{type:"Feature",geometry:{type:"Point",coordinates:[-72.86444,40.86556]},properties:{STATION_ID:"NEXRAD:KOKX",STATION_NAME:"NEW YORK CITY",STATE:"NY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-93.84111,32.45056]},properties:{STATION_ID:"NEXRAD:KSHV",STATION_NAME:"SHREVEPORT",STATE:"LA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-102.82944,44.125]},properties:{STATION_ID:"NEXRAD:KUDX",STATION_NAME:"RAPID CITY",STATE:"SD"}},{type:"Feature",geometry:{type:"Point",coordinates:[-114.65583,32.49528]},properties:{STATION_ID:"NEXRAD:KYUX",STATION_NAME:"YUMA",STATE:"AZ"}},{type:"Feature",geometry:{type:"Point",coordinates:[-67.80694,46.03917]},properties:{STATION_ID:"NEXRAD:KCBW",STATION_NAME:"HOULTON",STATE:"ME"}},{type:"Feature",geometry:{type:"Point",coordinates:[-71.1375,41.95583]},properties:{STATION_ID:"NEXRAD:KBOX",STATION_NAME:"BOSTON",STATE:"MA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.86,41.41306]},properties:{STATION_ID:"NEXRAD:KCLE",STATION_NAME:"CLEVELAND",STATE:"OH"}},{type:"Feature",geometry:{type:"Point",coordinates:[-85.45944,31.46028]},properties:{STATION_ID:"NEXRAD:KEOX",STATION_NAME:"FT RUCKER",STATE:"AL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-85.54472,42.89389]},properties:{STATION_ID:"NEXRAD:KGRR",STATION_NAME:"GRAND RAPIDS",STATE:"MI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-83.82167,39.42028]},properties:{STATION_ID:"NEXRAD:KILN",STATION_NAME:"CINCINNATI",STATE:"OH"}},{type:"Feature",geometry:{type:"Point",coordinates:[-85.7,41.40861]},properties:{STATION_ID:"NEXRAD:KIWX",STATION_NAME:"FT WAYNE",STATE:"IN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-102.18889,31.94333]},properties:{STATION_ID:"NEXRAD:KMAF",STATION_NAME:"MIDLAND ODESSA",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-113.98611,47.04111]},properties:{STATION_ID:"NEXRAD:KMSX",STATION_NAME:"MISSOULA",STATE:"MT"}},{type:"Feature",geometry:{type:"Point",coordinates:[-112.44694,41.26278]},properties:{STATION_ID:"NEXRAD:KMTX",STATION_NAME:"SALT LAKE CITY",STATE:"UT"}},{type:"Feature",geometry:{type:"Point",coordinates:[-84.32889,30.3975]},properties:{STATION_ID:"NEXRAD:KTLH",STATION_NAME:"TALLAHASSEE",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-120.39583,34.83806]},properties:{STATION_ID:"NEXRAD:KVBX",STATION_NAME:"VANDENBERG AFB",STATE:"CA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-161.87417,60.79278]},properties:{STATION_ID:"NEXRAD:PABC",STATION_NAME:"BETHEL FAA",STATE:"AK"}},{type:"Feature",geometry:{type:"Point",coordinates:[144.80833,13.45444]},properties:{STATION_ID:"NEXRAD:PGUA",STATION_NAME:"ANDERSEN AFB AGANA",STATE:"GU"}},{type:"Feature",geometry:{type:"Point",coordinates:[-80.27417,37.02417]},properties:{STATION_ID:"NEXRAD:KFCX",STATION_NAME:"ROANOKE",STATE:"VA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-95.07889,29.47194]},properties:{STATION_ID:"NEXRAD:KHGX",STATION_NAME:"HOUSTON",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-89.33667,40.15056]},properties:{STATION_ID:"NEXRAD:KILX",STATION_NAME:"LINCOLN",STATE:"IL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-90.4074,30.5195999]},properties:{STATION_ID:"NEXRAD:KHDC",STATION_NAME:"NEW ORLEANS",STATE:"LA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-78.42917,33.98917]},properties:{STATION_ID:"NEXRAD:KLTX",STATION_NAME:"WILMINGTON",STATE:"NC"}},{type:"Feature",geometry:{type:"Point",coordinates:[-87.54833,46.53111]},properties:{STATION_ID:"NEXRAD:KMQT",STATION_NAME:"MARQUETTE",STATE:"MI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-121.8975,37.15528]},properties:{STATION_ID:"NEXRAD:KMUX",STATION_NAME:"SAN FRANCISCO",STATE:"CA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-85.78972,32.53667]},properties:{STATION_ID:"NEXRAD:KMXX",STATION_NAME:"MAXWELL AFB",STATE:"AL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-118.85278,45.69056]},properties:{STATION_ID:"NEXRAD:KPDT",STATION_NAME:"PENDLETON",STATE:"OR"}},{type:"Feature",geometry:{type:"Point",coordinates:[-92.97583,31.15528]},properties:{STATION_ID:"NEXRAD:KPOE",STATION_NAME:"FT POLK",STATE:"LA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-117.635,33.81778]},properties:{STATION_ID:"NEXRAD:KSOX",STATION_NAME:"SANTA ANA MOUNTAINS",STATE:"CA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-119.17861,34.41167]},properties:{STATION_ID:"NEXRAD:KVTX",STATION_NAME:"LOS ANGELES",STATE:"CA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-146.30111,59.46194]},properties:{STATION_ID:"NEXRAD:PAIH",STATION_NAME:"MIDDLETON ISLAND",STATE:"AK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-78.00389,40.92306]},properties:{STATION_ID:"NEXRAD:KCCX",STATION_NAME:"STATE COLLEGE",STATE:"PA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-121.63167,39.49611]},properties:{STATION_ID:"NEXRAD:KBBX",STATION_NAME:"BEALE AFB",STATE:"CA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-75.985,42.19972]},properties:{STATION_ID:"NEXRAD:KBGM",STATION_NAME:"BINGHAMTON",STATE:"NY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-124.29194,40.49833]},properties:{STATION_ID:"NEXRAD:KBHX",STATION_NAME:"EUREKA",STATE:"CA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-97.51083,27.78389]},properties:{STATION_ID:"NEXRAD:KCRP",STATION_NAME:"CORPUS CHRISTI",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-121.67667,38.50111]},properties:{STATION_ID:"NEXRAD:KDAX",STATION_NAME:"SACRAMENTO",STATE:"CA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-93.72278,41.73111]},properties:{STATION_ID:"NEXRAD:KDMX",STATION_NAME:"DES MOINES",STATE:"IA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-94.26417,38.81028]},properties:{STATION_ID:"NEXRAD:KEAX",STATION_NAME:"KANSAS CITY",STATE:"MO"}},{type:"Feature",geometry:{type:"Point",coordinates:[-85.92139,30.56417]},properties:{STATION_ID:"NEXRAD:KEVX",STATION_NAME:"EGLIN AFB",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-98.02806,29.70361]},properties:{STATION_ID:"NEXRAD:KEWX",STATION_NAME:"AUSTIN SAN ANTONIO",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-84.71972,44.90722]},properties:{STATION_ID:"NEXRAD:KAPX",STATION_NAME:"GAYLORD",STATE:"MI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-97.41861,25.91556]},properties:{STATION_ID:"NEXRAD:KBRO",STATION_NAME:"BROWNSVILLE",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.04222,32.65556]},properties:{STATION_ID:"NEXRAD:KCLX",STATION_NAME:"CHARLESTON",STATE:"SC"}},{type:"Feature",geometry:{type:"Point",coordinates:[-99.96833,37.76083]},properties:{STATION_ID:"NEXRAD:KDDC",STATION_NAME:"DODGE CITY",STATE:"KS"}},{type:"Feature",geometry:{type:"Point",coordinates:[-90.58083,41.61167]},properties:{STATION_ID:"NEXRAD:KDVN",STATION_NAME:"DAVENPORT",STATE:"IA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-97.30278,32.57278]},properties:{STATION_ID:"NEXRAD:KFWS",STATION_NAME:"DALLAS",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-97.38278,30.72167]},properties:{STATION_ID:"NEXRAD:KGRK",STATION_NAME:"FT HOOD",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-70.25694,43.89139]},properties:{STATION_ID:"NEXRAD:KGYX",STATION_NAME:"PORTLAND",STATE:"ME"}},{type:"Feature",geometry:{type:"Point",coordinates:[-111.66917,33.28917]},properties:{STATION_ID:"NEXRAD:KIWA",STATION_NAME:"PHOENIX",STATE:"AZ"}},{type:"Feature",geometry:{type:"Point",coordinates:[-85.94389,37.97528]},properties:{STATION_ID:"NEXRAD:KLVX",STATION_NAME:"LOUISVILLE",STATE:"KY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-122.71611,42.08111]},properties:{STATION_ID:"NEXRAD:KMAX",STATION_NAME:"MEDFORD",STATE:"OR"}},{type:"Feature",geometry:{type:"Point",coordinates:[-76.87639,34.77583]},properties:{STATION_ID:"NEXRAD:KMHX",STATION_NAME:"MOREHEAD CITY",STATE:"NC"}},{type:"Feature",geometry:{type:"Point",coordinates:[-88.23972,30.67944]},properties:{STATION_ID:"NEXRAD:KMOB",STATION_NAME:"MOBILE",STATE:"AL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-93.56528,44.84889]},properties:{STATION_ID:"NEXRAD:KMPX",STATION_NAME:"MINNEAPOLIS",STATE:"MN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-86.5625,36.24722]},properties:{STATION_ID:"NEXRAD:KOHX",STATION_NAME:"NASHVILLE",STATE:"TN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-80.21833,40.53167]},properties:{STATION_ID:"NEXRAD:KPBZ",STATION_NAME:"PITTSBURGH",STATE:"PA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-93.40028,37.23528]},properties:{STATION_ID:"NEXRAD:KSGF",STATION_NAME:"SPRINGFIELD",STATE:"MO"}},{type:"Feature",geometry:{type:"Point",coordinates:[-97.2775,35.33306]},properties:{STATION_ID:"NEXRAD:KTLX",STATION_NAME:"OKLAHOMA CITY",STATE:"OK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-151.351467,60.725914]},properties:{STATION_ID:"NEXRAD:PAHG",STATION_NAME:"ANCHORAGE",STATE:"AK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-77.0075,36.98389]},properties:{STATION_ID:"NEXRAD:KAKQ",STATION_NAME:"NORFOLK RICH",STATE:"VA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-101.70889,35.23333]},properties:{STATION_ID:"NEXRAD:KAMA",STATION_NAME:"AMARILLO",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-80.41306,25.61056]},properties:{STATION_ID:"NEXRAD:KAMX",STATION_NAME:"MIAMI",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-100.76028,46.77083]},properties:{STATION_ID:"NEXRAD:KBIS",STATION_NAME:"BISMARCK",STATE:"ND"}},{type:"Feature",geometry:{type:"Point",coordinates:[-89.98444,32.28]},properties:{STATION_ID:"NEXRAD:KDGX",STATION_NAME:"JACKSON BRANDON",STATE:"MS"}},{type:"Feature",geometry:{type:"Point",coordinates:[-74.06444,42.58639]},properties:{STATION_ID:"NEXRAD:KENX",STATION_NAME:"ALBANY",STATE:"NY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-103.62944,34.63528]},properties:{STATION_ID:"NEXRAD:KFDX",STATION_NAME:"CANNON AFB",STATE:"NM"}},{type:"Feature",geometry:{type:"Point",coordinates:[-84.56583,33.36333]},properties:{STATION_ID:"NEXRAD:KFFC",STATION_NAME:"ATLANTA",STATE:"GA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-95.56444,36.175]},properties:{STATION_ID:"NEXRAD:KINX",STATION_NAME:"TULSA",STATE:"OK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-92.26194,34.83639]},properties:{STATION_ID:"NEXRAD:KLZK",STATION_NAME:"LITTLE ROCK",STATE:"AR"}},{type:"Feature",geometry:{type:"Point",coordinates:[-100.86444,48.3925]},properties:{STATION_ID:"NEXRAD:KMBX",STATION_NAME:"MINOT AFB",STATE:"ND"}},{type:"Feature",geometry:{type:"Point",coordinates:[-83.40194,36.16833]},properties:{STATION_ID:"NEXRAD:KMRX",STATION_NAME:"KNOXVILLE",STATE:"TN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-117.62583,47.68056]},properties:{STATION_ID:"NEXRAD:KOTX",STATION_NAME:"SPOKANE",STATE:"WA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-119.46111,39.75417]},properties:{STATION_ID:"NEXRAD:KRGX",STATION_NAME:"RENO",STATE:"NV"}},{type:"Feature",geometry:{type:"Point",coordinates:[-108.47667,43.06611]},properties:{STATION_ID:"NEXRAD:KRIW",STATION_NAME:"RIVERTON",STATE:"WY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-98.44167,40.32083]},properties:{STATION_ID:"NEXRAD:KUEX",STATION_NAME:"HASTINGS",STATE:"NE"}},{type:"Feature",geometry:{type:"Point",coordinates:[-135.52917,56.85278]},properties:{STATION_ID:"NEXRAD:PACG",STATION_NAME:"SITKA",STATE:"AK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-96.72889,43.58778]},properties:{STATION_ID:"NEXRAD:KFSD",STATION_NAME:"SIOUX FALLS",STATE:"SD"}},{type:"Feature",geometry:{type:"Point",coordinates:[-94.36167,35.29056]},properties:{STATION_ID:"NEXRAD:KSRX",STATION_NAME:"FT SMITH",STATE:"AR"}},{type:"Feature",geometry:{type:"Point",coordinates:[-108.21306,39.06222]},properties:{STATION_ID:"NEXRAD:KGJX",STATION_NAME:"GRAND JUNCTION",STATE:"CO"}},{type:"Feature",geometry:{type:"Point",coordinates:[-93.21583,30.125]},properties:{STATION_ID:"NEXRAD:KLCH",STATION_NAME:"LAKE CHARLES",STATE:"LA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-156.62944,58.67944]},properties:{STATION_ID:"NEXRAD:PAKC",STATION_NAME:"KING SALMON",STATE:"AK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.11861,33.94861]},properties:{STATION_ID:"NEXRAD:KCAE",STATION_NAME:"COLUMBIA",STATE:"SC"}},{type:"Feature",geometry:{type:"Point",coordinates:[-100.28028,29.2725]},properties:{STATION_ID:"NEXRAD:KDFX",STATION_NAME:"LAUGHLIN AFB",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-88.32889,33.89667]},properties:{STATION_ID:"NEXRAD:KGWX",STATION_NAME:"COLUMBUS AFB",STATE:"MS"}},{type:"Feature",geometry:{type:"Point",coordinates:[-117.56,35.09778]},properties:{STATION_ID:"NEXRAD:KEYX",STATION_NAME:"EDWARDS",STATE:"CA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-106.6975,31.87306]},properties:{STATION_ID:"NEXRAD:KEPZ",STATION_NAME:"EL PASO",STATE:"NM"}},{type:"Feature",geometry:{type:"Point",coordinates:[-116.80278,40.73972]},properties:{STATION_ID:"NEXRAD:KLRX",STATION_NAME:"ELKO",STATE:"NV"}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.72389,38.31194]},properties:{STATION_ID:"NEXRAD:KRLX",STATION_NAME:"CHARLESTON",STATE:"WV"}},{type:"Feature",geometry:{type:"Point",coordinates:[-106.12222,33.07639]},properties:{STATION_ID:"NEXRAD:KHDX",STATION_NAME:"HOLLOMAN AFB",STATE:"NM"}},{type:"Feature",geometry:{type:"Point",coordinates:[-112.86222,37.59083]},properties:{STATION_ID:"NEXRAD:KICX",STATION_NAME:"CEDAR CITY",STATE:"UT"}},{type:"Feature",geometry:{type:"Point",coordinates:[-80.65444,28.11306]},properties:{STATION_ID:"NEXRAD:KMLB",STATION_NAME:"MELBOURNE",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-117.04194,32.91889]},properties:{STATION_ID:"NEXRAD:KNKX",STATION_NAME:"SAN DIEGO",STATE:"CA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-165.295,64.51139]},properties:{STATION_ID:"NEXRAD:PAEC",STATION_NAME:"NOME",STATE:"AK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-99.25417,32.53833]},properties:{STATION_ID:"NEXRAD:KDYX",STATION_NAME:"DYESS AFB",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-86.08361,34.93056]},properties:{STATION_ID:"NEXRAD:KHTX",STATION_NAME:"HUNTSVILLE",STATE:"AL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-96.36639,41.32028]},properties:{STATION_ID:"NEXRAD:KOAX",STATION_NAME:"OMAHA",STATE:"NE"}},{type:"Feature",geometry:{type:"Point",coordinates:[-82.40194,27.70528]},properties:{STATION_ID:"NEXRAD:KTBW",STATION_NAME:"TAMPA",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-75.68,43.75583]},properties:{STATION_ID:"NEXRAD:KTYX",STATION_NAME:"FT DRUM",STATE:"NY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-76.845,38.695]},properties:{STATION_ID:"NEXRAD:TADW",STATION_NAME:"ANDREWS AFB",STATE:"MD"}},{type:"Feature",geometry:{type:"Point",coordinates:[-84.261944,33.646944]},properties:{STATION_ID:"NEXRAD:TATL",STATION_NAME:"ATLANTA",STATE:"GA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-86.661944,35.98]},properties:{STATION_ID:"NEXRAD:TBNA",STATION_NAME:"NASHVILLE",STATE:"TN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-70.933056,42.158056]},properties:{STATION_ID:"NEXRAD:TBOS",STATION_NAME:"BOSTON",STATE:"MA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-76.63,39.09]},properties:{STATION_ID:"NEXRAD:TBWI",STATION_NAME:"BALTIMORE WASHINGTON",STATE:"MD"}},{type:"Feature",geometry:{type:"Point",coordinates:[-80.885,35.336944]},properties:{STATION_ID:"NEXRAD:TCLT",STATION_NAME:"CHARLOTTE",STATE:"NC"}},{type:"Feature",geometry:{type:"Point",coordinates:[-82.715,40.006111]},properties:{STATION_ID:"NEXRAD:TCMH",STATION_NAME:"COLUMBUS",STATE:"OH"}},{type:"Feature",geometry:{type:"Point",coordinates:[-84.58,38.898056]},properties:{STATION_ID:"NEXRAD:TCVG",STATION_NAME:"COVINGTON",STATE:"KY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-96.968056,32.926111]},properties:{STATION_ID:"NEXRAD:TDAL",STATION_NAME:"DALLAS LOVE FLD",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-84.123056,40.021944]},properties:{STATION_ID:"NEXRAD:TDAY",STATION_NAME:"DAYTON",STATE:"OH"}},{type:"Feature",geometry:{type:"Point",coordinates:[-76.961944,38.758889]},properties:{STATION_ID:"NEXRAD:TDCA",STATION_NAME:"WASHINGTON NATL",STATE:"MD"}},{type:"Feature",geometry:{type:"Point",coordinates:[-104.526111,39.728056]},properties:{STATION_ID:"NEXRAD:TDEN",STATION_NAME:"DENVER",STATE:"CO"}},{type:"Feature",geometry:{type:"Point",coordinates:[-96.918056,33.065]},properties:{STATION_ID:"NEXRAD:TDFW",STATION_NAME:"DALLAS FT WORTH",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-83.515,42.111111]},properties:{STATION_ID:"NEXRAD:TDTW",STATION_NAME:"DETROIT",STATE:"MI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-74.27,40.593056]},properties:{STATION_ID:"NEXRAD:TEWR",STATION_NAME:"NEWARK",STATE:"NJ"}},{type:"Feature",geometry:{type:"Point",coordinates:[-80.343889,26.143056]},properties:{STATION_ID:"NEXRAD:TFLL",STATION_NAME:"FT LAUDERDALE",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-95.241944,29.516111]},properties:{STATION_ID:"NEXRAD:THOU",STATION_NAME:"HOUSTON HOBBY",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-77.48751,38.97628]},properties:{STATION_ID:"NEXRAD:KLWX",STATION_NAME:"STERLING",STATE:"VA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-77.528889,39.083889]},properties:{STATION_ID:"NEXRAD:TIAD",STATION_NAME:"WASHINGTON DULLES",STATE:"VA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-95.566944,30.065]},properties:{STATION_ID:"NEXRAD:TIAH",STATION_NAME:"HOUSTON INTL",STATE:"TX"}},{type:"Feature",geometry:{type:"Point",coordinates:[-97.436944,37.506944]},properties:{STATION_ID:"NEXRAD:TICH",STATION_NAME:"WICHITA",STATE:"KS"}},{type:"Feature",geometry:{type:"Point",coordinates:[-86.436111,39.636944]},properties:{STATION_ID:"NEXRAD:TIDS",STATION_NAME:"INDIANAPOLIS",STATE:"IN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-73.881111,40.588889]},properties:{STATION_ID:"NEXRAD:TJFK",STATION_NAME:"NYC JFK",STATE:"NY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-66.07861,18.1175]},properties:{STATION_ID:"NEXRAD:TJUA",STATION_NAME:"SAN JUAN",STATE:"PR"}},{type:"Feature",geometry:{type:"Point",coordinates:[-115.006944,36.143889]},properties:{STATION_ID:"NEXRAD:TLAS",STATION_NAME:"LAS VEGAS",STATE:"NV"}},{type:"Feature",geometry:{type:"Point",coordinates:[-82.008056,41.29]},properties:{STATION_ID:"NEXRAD:TLVE",STATION_NAME:"CLEVELAND",STATE:"OH"}},{type:"Feature",geometry:{type:"Point",coordinates:[-94.741944,39.498056]},properties:{STATION_ID:"NEXRAD:TMCI",STATION_NAME:"KANSAS CITY",STATE:"MO"}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.326111,28.343889]},properties:{STATION_ID:"NEXRAD:TMCO",STATION_NAME:"ORLANDO INTL",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-87.713333,41.651111]},properties:{STATION_ID:"NEXRAD:TMDW",STATION_NAME:"CHICAGO MIDWAY",STATE:"IL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-89.993056,34.896111]},properties:{STATION_ID:"NEXRAD:TMEM",STATION_NAME:"MEMPHIS",STATE:"MS"}},{type:"Feature",geometry:{type:"Point",coordinates:[-80.491111,25.758056]},properties:{STATION_ID:"NEXRAD:TMIA",STATION_NAME:"MIAMI",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-88.046111,42.818889]},properties:{STATION_ID:"NEXRAD:TMKE",STATION_NAME:"MILWAUKEE",STATE:"WI"}},{type:"Feature",geometry:{type:"Point",coordinates:[-92.933056,44.871111]},properties:{STATION_ID:"NEXRAD:TMSP",STATION_NAME:"MINNEAPOLIS",STATE:"MN"}},{type:"Feature",geometry:{type:"Point",coordinates:[-90.403056,30.021944]},properties:{STATION_ID:"NEXRAD:TMSY",STATION_NAME:"NEW ORLEANS",STATE:"LA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-97.51,35.276111]},properties:{STATION_ID:"NEXRAD:TOKC",STATION_NAME:"NORMAN WFO",STATE:"OK"}},{type:"Feature",geometry:{type:"Point",coordinates:[-87.858056,41.796944]},properties:{STATION_ID:"NEXRAD:TORD",STATION_NAME:"CHICAGO OHARE",STATE:"IL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-80.273056,26.688056]},properties:{STATION_ID:"NEXRAD:TPBI",STATION_NAME:"W PALM BEACH",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-75.068889,39.948889]},properties:{STATION_ID:"NEXRAD:TPHL",STATION_NAME:"PHILA",STATE:"NJ"}},{type:"Feature",geometry:{type:"Point",coordinates:[-112.163056,33.421111]},properties:{STATION_ID:"NEXRAD:TPHX",STATION_NAME:"PHOENIX",STATE:"AZ"}},{type:"Feature",geometry:{type:"Point",coordinates:[-80.486111,40.501111]},properties:{STATION_ID:"NEXRAD:TPIT",STATION_NAME:"PITTSBURGH",STATE:"PA"}},{type:"Feature",geometry:{type:"Point",coordinates:[-78.696944,36.001944]},properties:{STATION_ID:"NEXRAD:TRDU",STATION_NAME:"RALEIGH",STATE:"NC"}},{type:"Feature",geometry:{type:"Point",coordinates:[-85.61,38.046111]},properties:{STATION_ID:"NEXRAD:TSDF",STATION_NAME:"LOUISVILLE",STATE:"KY"}},{type:"Feature",geometry:{type:"Point",coordinates:[-66.178889,18.473889]},properties:{STATION_ID:"NEXRAD:TSJU",STATION_NAME:"SAN JUAN",STATE:"PR"}},{type:"Feature",geometry:{type:"Point",coordinates:[-111.93,40.966944]},properties:{STATION_ID:"NEXRAD:TSLC",STATION_NAME:"SALT LAKE CITY",STATE:"UT"}},{type:"Feature",geometry:{type:"Point",coordinates:[-90.488889,38.805]},properties:{STATION_ID:"NEXRAD:TSTL",STATION_NAME:"ST LOUIS",STATE:"MO"}},{type:"Feature",geometry:{type:"Point",coordinates:[-82.518056,27.86]},properties:{STATION_ID:"NEXRAD:TTPA",STATION_NAME:"TAMPA",STATE:"FL"}},{type:"Feature",geometry:{type:"Point",coordinates:[-95.826944,36.071111]},properties:{STATION_ID:"NEXRAD:TTUL",STATION_NAME:"TULSA",STATE:"OK"}}]};var{REFLECTIVITY:lf,VELOCITY:cf,VELOCITY_DEALIASED:uf,CC:hf,PHI:df,ZDR:ff,SW:pf}=yo,ba=-160,wa=160,sM={[lf]:[-30,80],[cf]:[ba,wa],[uf]:[ba,wa],[hf]:[.2,1.05],[df]:[-2,10],[ff]:[-8,8],[pf]:[0,60]},mf={[lf]:[0,80],[cf]:[ba,wa],[uf]:[ba,wa],[hf]:[.2,1.05],[df]:[-2,10],[ff]:[-8,8],[pf]:[0,60]},Q1={[lf]:["#242424","#14466c","#0FCBFF","#1D9E00","#95F44C","#FFF700","#FF9F0F","#EB7900","#FF1F1F","#AD1100","#FFB8F5","#CA57FF","#4A009E"],[cf]:["#ffffff","#FC52FF","#871FFF","#0011CC","#0088CC","#B3F0FF","#42FF42","#009402","#A3A3A3","#8A0000","#FF5269","#FFB3E0","#FFF1C2","#FF9214","#B85C00","#572100","#000000"],[uf]:["#ffffff","#FC52FF","#871FFF","#0011CC","#0088CC","#B3F0FF","#42FF42","#009402","#A3A3A3","#8A0000","#FF5269","#FFB3E0","#FFF1C2","#FF9214","#B85C00","#572100","#000000"],[hf]:["#000000","#949494","#7593FF","#0045BD","#ADF4FF","#00FA32","#FFD53D","#F01000","#C20047","#FFB8D8","#FFEBF2"],[df]:["#8b898c","#403e41","#520008","#e575bd","#a27abf","#6df2f4","#29c042","#0afb0e","#fefb06","#ff820c"],[ff]:["#242424","#afafaf","#B980FF","#0000a3","#6bf0ff","#3dff64","#f5ff2e","#ffa30f","#e61300","#ff6bb5","#ffe0e6"],[pf]:["#242424","#afafaf","#ff700a","#b30000","#f000ac","#8800c2","#e0fcff","#b4eb00","#7dd100"]},rN={[lf]:[0,10,20,30,40,50,60,70,80],[cf]:[-160,-120,-80,-40,0,40,80,120,160],[uf]:[-160,-120,-80,-40,0,40,80,120,160],[hf]:[.2,1.05],[df]:[-2,0,1,2,3,4,5,6,7,8,9,10],[ff]:[-8,0,1,2,3,4,5,6,7,8],[pf]:[0,10,15,20,25,30,35,40,60]},oM={[lf]:"dBZ",[cf]:"kt",[uf]:"kt",[hf]:"",[df]:"deg km-1",[ff]:"dB",[pf]:"kt"},eb={[lf]:[0,10,20,25,30,35,40,45,50,60,65,70,80],[cf]:[ba,-140,-120,-100,-80,-60,-40,-20,0,20,40,60,80,100,120,140,wa],[uf]:[ba,-140,-120,-100,-80,-60,-40,-20,0,20,40,60,80,100,120,140,wa],[hf]:[.2,.4,.55,.65,.8,.85,.95,.975,1,1.04,1.05],[df]:[-2,-.5,0,1.5,2,3,4,5,7,10],[ff]:[-8,0,.25,.5,1.5,2,2.5,3.5,5,6,8],[pf]:[0,10,15,20,25,30,35,40,60]};function qo(i){if(i.length===4)return`rgba(${i.join(",")})`;if(i.length===3)return`rgb(${i.join(",")})`}function Yy(i,e,t,s,c,h){let p=document.createElement("canvas"),r=200,x=20;p.width=r,p.height=x;let v=p.getContext("2d"),w=window.devicePixelRatio||1;p.width=p.width*w,p.height=p.height*w,p.style.width=`${r}px`,p.style.height=`${x}px`,v.scale(w,w),v.clearRect(0,0,p.width,p.height);let S=v.createLinearGradient(0,0,r,0),A=document.createElement("canvas");A.width=1200,A.height=1;let I=A.getContext("2d");I.clearRect(0,0,A.width,A.height);let R=I.createLinearGradient(0,0,1200,0),k=999,L=-999;for(let B=0;B<i.length;B++)i[B][0]>L&&(L=i[B][0]),i[B][0]<k&&(k=i[B][0]);for(let B=0;B<i.length;B++)i[B].length===3?(S.addColorStop((i[B][0]-k)/(L-k),qo(i[B][1])),R.addColorStop((i[B][0]-k)/(L-k),qo(i[B][1])),i[B+1]?(S.addColorStop((i[B+1][0]-k)/(L-k),qo(i[B][2])),R.addColorStop((i[B+1][0]-k)/(L-k),qo(i[B][2]))):(S.addColorStop(1,qo(i[B][2])),R.addColorStop(1,qo(i[B][2])))):i[B].length===2&&(S.addColorStop((i[B][0]-k)/(L-k),qo(i[B][1])),R.addColorStop((i[B][0]-k)/(L-k),qo(i[B][1])));v.fillStyle=S,v.fillRect(0,0,r,x),I.fillStyle=R,I.fillRect(0,0,1200,1);let z=I.getImageData(0,0,1200,1);return{image:p.toDataURL(),imageData:z,name:e,minMax:[k,L],values:i,id:t,product:s,scale:c,units:h}}function aM(i,e,t){let s=i,c=e;function h(p){let r=Q1[p],x=eb[p];c.clearRect(0,0,s.width,s.height);let v=c.createLinearGradient(0,0,s.width,0),w=mf[p][1],S=mf[p][0],A=r.length;for(let I=0;I<A;++I)v.addColorStop((x[I]-S)/(w-S),r[I]);c.fillStyle=v,c.fillRect(0,0,s.width,10)}return{render:h}}function lM(i){let e=i.getContext("2d"),t=window.devicePixelRatio||1;i.width=i.clientWidth*t,i.height=i.clientHeight*t,e.scale(t,t);function s(c){if(!e||c===void 0)return;e.clearRect(0,0,i.width,i.height);let h=c.values,p=c.minMax[0],r=c.minMax[1],x=e.createLinearGradient(25,0,275,0);for(let S=0;S<h.length;S++)h[S].length===3?(x.addColorStop((h[S][0]-p)/(r-p),qo(h[S][1])),h[S+1]?x.addColorStop((h[S+1][0]-p)/(r-p),qo(h[S][2])):x.addColorStop(1,qo(h[S][2]))):h[S].length===2&&x.addColorStop((h[S][0]-p)/(r-p),qo(h[S][1]));e.fillStyle=x,e.fillRect(25,15,250,10),e.fillStyle="black",e.strokeStyle="white",e.textAlign="center";let v=25,w=Math.ceil(p/10)*10;for(;w<=r;){let S=(w-p)/(r-p);e.lineWidth=3,e.strokeText(w,S*250+v,36),e.lineWidth=1.5,e.fillText(w,S*250+v,36),w+=10}e.textAlign="left",e.lineWidth=3,e.strokeText("dBZ",25,10),e.lineWidth=1.5,e.fillText("dBZ",25,10)}return{render:s}}function cM(i){let e=i.getContext("2d"),t=window.devicePixelRatio||1;i.width=i.clientWidth*t,i.height=i.clientHeight*t,e.scale(t,t);function s(c){if(!e||c===void 0)return;e.clearRect(0,0,i.width,i.height);let h=Q1[c],p=eb[c],r=rN[c],x=e.createLinearGradient(25,0,275,0),v=mf[c][1],w=mf[c][0],S=h.length;for(let I=0;I<S;++I)x.addColorStop((p[I]-w)/(v-w),h[I]);e.fillStyle=x,e.fillRect(25,15,250,10),e.fillStyle="black",e.strokeStyle="white",e.textAlign="center";let A=25;for(let I=0;I<r.length;I+=1){let R=(r[I]-w)/(v-w);e.lineWidth=3,e.strokeText(r[I],R*250+A,36),e.lineWidth=1.5,e.fillText(r[I],R*250+A,36)}e.textAlign="left",e.lineWidth=3,e.strokeText(oM[c],25,10),e.lineWidth=1.5,e.fillText(oM[c],25,10)}return{render:s}}function Jy(i,e){let t=i.createTexture();return{imageData:e.imageData,texture:t}}function tb(i,e){let t=Q1[e],s=eb[e],c=document.createElement("CANVAS");c.width=1200,c.height=1;let h=c.getContext("2d");h.clearRect(0,0,c.width,c.height);let p=h.createLinearGradient(0,0,1200,0),r=mf[e][1],x=mf[e][0],v=t.length;for(let A=0;A<v;++A)p.addColorStop((s[A]-x)/(r-x),t[A]);h.fillStyle=p,h.fillRect(0,0,1200,1);let w=h.getImageData(0,0,1200,1),S=i.createTexture();return i.activeTexture(i.TEXTURE7),i.bindTexture(i.TEXTURE_2D,S),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,w),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),{imageData:w,texture:S}}var{DEALIASED:sN}=Ka,{READING:oN}=vs,{ELEVATION:aN}=Qd,{HISTORICAL:lN}=vo,$s=g1,S2=_1,Zi=Ai({}),Ta=Ai({}),Ya=Ai(!1),$y=Ai(!1),Sr=Ai(!1),Dc=Ai(!0),Js=Ai(!1),_h=Ai(!1),Bc=Ai(!1),Fl=Ai(!1),Uc=Ai(!1),Vc=Ai(!1),ah=Ai(!1),yh=Ai(!1),Gc=Ai(!1),Rs=Ai({toRead:0,read:0,readFiles:[],toDownload:0,downloaded:0,downloadFiles:[]}),vh=Ai({value:"monochrome",styleid:"mapbox://styles/quadweather/cksxhy0l281db18nvnnfvdigv",layer:"land-structure-line"}),Ym=Ai({opacity:1}),$r=Ai(Py),Ea=Ai("horizontal"),gf=Ai("closed"),kl=Ai(sN),Xr=Ai(oN),Jm=Ai(aN),Ds=Ai(lN),ya=Ai(null),ni=Ai(Array.apply(null,Array(5)).map(function(){})),uM=v1(ni,i=>i.filter(e=>e!=null).length),Vr=v1(ni,i=>{let e={fileNames:[],elevations:[],stations:[],scans:[]},t=i;e.fileNames=[],e.stations=[],e.scans={},e.elevations={};let s={},c={};for(let h=0;h<t.length;h++)t[h]!=null&&t[h].idxs&&(e.fileNames.push(t[h].fileName),e.stations.indexOf(t[h].station)<0&&e.stations.push(t[h].station),t[h].station in s?s[t[h].station]=s[t[h].station].concat(Object.keys(t[h].idxs)):s[t[h].station]=Object.keys(t[h].idxs),t[h].station in c?c[t[h].station]=c[t[h].station].concat(t[h].scans):c[t[h].station]=t[h].scans);for(let h=0;h<e.stations.length;h++){let p=e.stations[h];e.elevations[p]=[],e.scans[p]={},e.elevations[p]=Array.from(new Set(s[p])).sort(function(x,v){return+x-+v});let r=c[p];for(let x=0;x<e.elevations[p].length;x++)e.scans[p][e.elevations[p][x]]=[];for(let x=0;x<r.length;x++)e.scans[p][r[x][0][0].rounded].push(...r[x]);for(let x in e.scans[p])e.scans[p][x]=e.scans[p][x].sort(function(v,w){return v[0].date-w[0].date})}return e}),Cs=Ai(Array.apply(null,Array(5)).map(function(){})),Ys=Ai(Array.apply(null,Array(5)).map(function(){})),Rl=Ai(Array.apply(null,Array(5)).map(()=>({}))),xo=Ai({}),Gj=Ai(null),xh=Ai(null),bh=Ai(null),_i=Ai([{elevation:null,file:null,type:null,dealiased:null,scan:null},{elevation:null,file:null,type:null,dealiased:null,scan:null}]),qr=Ai(Array.apply(null,Array(2))),Xo=Ai({br:{current:{},all:[]},bv:{current:{},all:[]}});function hM(i,e){let t=i-1,s=[];for(let h=0;h<i;h++){let p=v2();p.setOnMessage(Ys),s.push(p.worker),s[s.length-1].postMessage(e)}function c(){return t=(t+1)%i,t}return{determineIndex:c,workers:s}}function cN(){let i=typeof SharedArrayBuffer,e=navigator.hardwareConcurrency>1,t=!1;if(navigator.userAgentData)t=navigator.userAgentData.mobile;else{let s=navigator.userAgent||navigator.vendor;t=/Safari|android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(s)}return i!=="undefined"&&e&&!t?"pthreads":"single"}var nb=cN(),Qy=nb==="single"?1:2,uN=hM(Qy,{data:{message:"config",type:"base",mode:nb}}),hN=hM(Qy,{data:{message:"config",type:"velocity",mode:nb}}),b1=uN,E2=hN,Ii=T1((i,e)=>i.data.date&&e.data.date&&i.data.date.getTime()!==e.data.date.getTime()?e.data.date.getTime()-i.data.date.getTime():i.data.priority!==e.data.priority?i.data.priority-e.data.priority:!i.data.elevationFile||!e.data.elevationFile?i.data.fileName.localeCompare(e.data.fileName,void 0,{numeric:!0,sensitivity:"base"}):i.data.elevationFile.localeCompare(e.data.elevationFile,void 0,{numeric:!0,sensitivity:"base"}),1),Ur=E1(Qy),Ks=E1(Qy),zi=A2(),ib=D2(),dN=I2(),rr=C2(),gr=new R2({credentials:"include"},$s),wh=iM(),Th=M2(),rb=new Promise((i,e)=>{"indexedDB"in window?Th.createDb().then(t=>{Th.getAllColors("colorTables").then(s=>{let c={br:{current:null,all:[]},bv:{current:null,all:[]}},h={br:0,bv:0};for(let p=0;p<s.length;p++){s[p].selected&&(c[s[p].product].current=h[s[p].product]),h[s[p].product]+=1;let r=Yy(s[p].colorStops,s[p].name,s[p].id,s[p].product,s[p].scale,s[p].units);c[s[p].product].all.push(r)}Xo.update(p=>(p=c,p)),i("done loading indexeddb")})}):(Xo.update(t=>"unsupported"),i("done loading indexeddb (not supported)"))}),dM=y2();dM.setOnMessage(ni,Ys,xo,_i,Cs,Vr,Zi,$y,zi,dN,Rl);var va=dM.worker,Hj=Ai(null,i=>{i(QA())}),Lm=Ai({type:"FeatureCollection",features:[]}),Dm=Ai({type:"FeatureCollection",features:[]}),fM=Ai({type:"FeatureCollection",features:[]}),pM=y1(rM);function mM(i){let e,t,s,c=i[0].read+1+"",h,p,r=i[0].toRead+i[0].read+"",x,v,w;return{c(){e=Ie("div"),t=Ie("div"),s=On("Reading "),h=On(c),p=On(" of "),x=On(r),v=ot(),w=Ie("div"),Z(t,"class","of svelte-103qaoo"),Z(w,"class","lds-dual-ring svelte-103qaoo"),Z(e,"class","loadingWrapper svelte-103qaoo")},m(S,A){Gt(S,e,A),Q(e,t),Q(t,s),Q(t,h),Q(t,p),Q(t,x),Q(e,v),Q(e,w)},p(S,A){A&1&&c!==(c=S[0].read+1+"")&&si(h,c),A&1&&r!==(r=S[0].toRead+S[0].read+"")&&si(x,r)},d(S){S&&Bt(e)}}}function pN(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L,z=i[0].toRead&&mM(i);return{c(){e=Ie("div"),t=Ie("input"),s=ot(),c=Ie("label"),h=Ie("input"),p=ot(),r=ii("svg"),x=ii("circle"),v=ii("path"),w=ii("path"),S=ot(),A=Ie("span"),A.textContent="Add Level II Files",I=ot(),z&&z.c(),R=Gs(),Z(t,"type","file"),Z(t,"id","input"),t.multiple=!0,Z(t,"class","svelte-103qaoo"),Z(h,"type","file"),h.multiple=!0,Z(h,"class","svelte-103qaoo"),Z(x,"cx","12"),Z(x,"cy","12"),Z(x,"r","10"),Z(v,"d","M8 12h8"),Z(w,"d","M12 8v8"),Z(r,"xmlns","http://www.w3.org/2000/svg"),Z(r,"width","16"),Z(r,"height","16"),Z(r,"viewBox","0 0 24 24"),Z(r,"fill","none"),Z(r,"stroke","currentColor"),Z(r,"stroke-width","2"),Z(r,"stroke-linecap","round"),Z(r,"stroke-linejoin","round"),Z(r,"class","lucide lucide-circle-plus button-svg svelte-103qaoo"),Z(A,"class","button-span svelte-103qaoo"),Z(c,"class","custom-file-upload svelte-103qaoo"),Z(e,"class","dragover svelte-103qaoo"),Rn(e,"active",i[1])},m(B,$){Gt(B,e,$),Q(e,t),Q(e,s),Q(e,c),Q(c,h),i[8](h),Q(c,p),Q(c,r),Q(r,x),Q(r,v),Q(r,w),Q(c,S),Q(c,A),i[9](c),Gt(B,I,$),z&&z.m(B,$),Gt(B,R,$),k||(L=[mn(h,"change",i[7]),mn(e,"dragenter",i[4]),mn(e,"dragover",fN),mn(e,"dragleave",i[5]),mn(e,"drop",i[6])],k=!0)},p(B,[$]){$&2&&Rn(e,"active",B[1]),B[0].toRead?z?z.p(B,$):(z=mM(B),z.c(),z.m(R.parentNode,R)):z&&(z.d(1),z=null)},i:Vn,o:Vn,d(B){B&&Bt(e),i[8](null),i[9](null),B&&Bt(I),z&&z.d(B),B&&Bt(R),k=!1,cr(L)}}}function fN(i){i.preventDefault()}function mN(i,e,t){let s,c,h,p,r;It(i,Rs,te=>t(0,s=te)),It(i,Vr,te=>t(10,c=te)),It(i,_i,te=>t(11,h=te)),It(i,Zi,te=>t(12,p=te)),It(i,ni,te=>t(13,r=te));let x=bo(),v=new oh([],function(te,ue){return ue.time-te.time}),w=!1,S,A,I;function R(){for(;v.length;){let te=new FileReader,ue=v.pop();te.onload=function(me){let se=Ho(ue.name),Y=me.target.result,ye=new Uint8Array(Y);try{ye=ph(ye)}catch(re){}let Xe="";for(let re=0;re<6;re++)Xe=Xe+String.fromCharCode(ye[re]);if(Xe!="AR2V00"&&Xe!="ARCHIV"&&!se.elevationFile){on(Rs,s.toRead-=1,s),Xe==="ARCHIV"?on(Zi,p={error:!0,message:"The application cannot yet read files in an old format like "+ue.name+".",header:"Old format"},p):on(Zi,p={error:!0,message:"The file "+ue.name+" could not be read due to an unexpected format.",header:"Unexpected format"},p);return}let ge={message:"initialize",status:null,jobId:null,buffer:ye.buffer,source:"drop"};se.type==="chunk"&&(ge.message="readChunk"),Object.assign(ge,se),Ii.submit({data:ge})},te.readAsArrayBuffer(ue)}}function k(te){te.preventDefault(),t(1,w=!0),t(2,A.style.pointerEvents="none",A)}function L(te){te.preventDefault(),t(1,w=!1),t(2,A.style.pointerEvents="",A)}function z(te){let ue=0,me=[];for(let Y=0;Y<r.length;Y++)r[Y]&&r[Y].loaded&&(ue++,me.push(r[Y].fileName));me=me.concat(s.readFiles).concat(s.downloadFiles);let se=[];for(let Y=0;Y<te.length;Y++){let ye=te[Y];if(me.indexOf(ye.name)>=0){on(Zi,p={error:!0,message:"A file already exists with the name "+ye.name,header:"Duplicate file"},p),t(3,I.value=null,I);return}se.push(ye)}if(s.toRead+ue>=5||s.toRead+ue+se.length>5||ue>=5){on(Zi,p={error:!0,message:"The application cannot load more than 5 files. Remove a file by clicking the trashcan icon in the File View before loading another.",header:"Too many files"},p),t(3,I.value=null,I);return}for(let Y=0;Y<se.length;Y++)v.push(se[Y]);on(Rs,s.toRead+=se.length,s),R(),t(3,I.value=null,I)}function B(te){if(t(2,A.style.pointerEvents="",A),te.preventDefault(),t(1,w=!1),te.dataTransfer.items){let ue=[];for(let me=0;me<te.dataTransfer.items.length;me++)if(te.dataTransfer.items[me].kind==="file"){let se=te.dataTransfer.items[me].getAsFile();se.time=Date.now(),ue.push(se)}z(ue)}}function $(){if(s.read>0&&s.toRead===0&&(on(Rs,s.read=0,s),!h[0].scan)){let te={elevation:c.elevations[c.stations[0]][0],station:c.stations[0]},ue=c.scans[te.station][te.elevation],me={fileNumber:ue[0][0].fileNumber,scan:ue[0],fileName:ue[0][0].fileName,station:te.station};x.logStore(me),rr.setStates(),rr.setSites()}}function H(){let te=this.files,ue=[];for(let me=0,se=te.length;me<se;me++){let Y=te[me];Y.time=Date.now(),ue.push(Y)}z(ue)}function G(te){wi[te?"unshift":"push"](()=>{I=te,t(3,I)})}function le(te){wi[te?"unshift":"push"](()=>{A=te,t(2,A)})}return i.$$.update=()=>{if(i.$$.dirty&1){e:$()}},[s,w,A,I,k,L,B,H,G,le]}var gM=class extends gi{constructor(e){super();Ti(this,e,mN,pN,ai,{})}},_M=gM;function vM(i){let e,t,s,c,h,p,r,x,v=(i[1]===void 0||i[4][i[1]]===void 0?"":i[4][i[1]].fileName)+"",w,S,A,I,R,k,L,z,B,$,H,G,le=i[2]>0&&yM(i);function te(se,Y){return se[5]?_N:gN}let ue=te(i,-1),me=ue(i);return{c(){e=Ie("div"),t=Ie("div"),s=Ie("table"),c=Ie("tbody"),h=Ie("tr"),h.innerHTML=`<td class="file svelte-yiclpa">File</td> 
                <td class="vcp svelte-yiclpa">Frame</td>`,p=ot(),r=Ie("tr"),x=Ie("td"),w=On(v),S=ot(),A=Ie("td"),le&&le.c(),I=ot(),R=Ie("div"),k=Ie("button"),k.innerHTML='<span class="arrow svelte-yiclpa"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left button-svg svelte-yiclpa"><path d="m15 18-6-6 6-6"></path></svg></span>',L=ot(),z=Ie("button"),me.c(),B=ot(),$=Ie("button"),$.innerHTML='<span class="arrow svelte-yiclpa"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right button-svg svelte-yiclpa"><path d="m9 18 6-6-6-6"></path></svg></span>',Z(h,"class","title-tr svelte-yiclpa"),Z(x,"class","content file svelte-yiclpa"),Z(A,"class","content vcp svelte-yiclpa"),Z(s,"class","svelte-yiclpa"),Z(t,"class","table-wrapper svelte-yiclpa"),Z(k,"class","arrowbutton svelte-yiclpa"),Z(z,"class","loopButton svelte-yiclpa"),Z($,"class","arrowbutton svelte-yiclpa"),Z(R,"class","pncontainer svelte-yiclpa"),Z(e,"class","tc svelte-yiclpa")},m(se,Y){Gt(se,e,Y),Q(e,t),Q(t,s),Q(s,c),Q(c,h),Q(c,p),Q(c,r),Q(r,x),Q(x,w),Q(r,S),Q(r,A),le&&le.m(A,null),Q(e,I),Q(e,R),Q(R,k),Q(R,L),Q(R,z),me.m(z,null),Q(R,B),Q(R,$),H||(G=[mn(k,"click",rr.previous),mn(z,"click",rr.handleAnimateClick),mn($,"click",rr.advance)],H=!0)},p(se,Y){Y&18&&v!==(v=(se[1]===void 0||se[4][se[1]]===void 0?"":se[4][se[1]].fileName)+"")&&si(w,v),se[2]>0?le?le.p(se,Y):(le=yM(se),le.c(),le.m(A,null)):le&&(le.d(1),le=null),ue!==(ue=te(se,Y))&&(me.d(1),me=ue(se),me&&(me.c(),me.m(z,null)))},d(se){se&&Bt(e),le&&le.d(),me.d(),H=!1,cr(G)}}}function yM(i){let e,t=i[3]+1+"",s,c,h;return{c(){e=Ie("div"),s=On(t),c=On("/"),h=On(i[2]),Z(e,"class","idx")},m(p,r){Gt(p,e,r),Q(e,s),Q(e,c),Q(e,h)},p(p,r){r&8&&t!==(t=p[3]+1+"")&&si(s,t),r&4&&si(h,p[2])},d(p){p&&Bt(e)}}}function gN(i){let e,t,s;return{c(){e=ii("svg"),t=ii("circle"),s=ii("polygon"),Z(t,"cx","12"),Z(t,"cy","12"),Z(t,"r","10"),Z(s,"points","10 8 16 12 10 16 10 8"),Z(e,"xmlns","http://www.w3.org/2000/svg"),Z(e,"width","24"),Z(e,"height","24"),Z(e,"viewBox","0 0 24 24"),Z(e,"fill","none"),Z(e,"stroke","currentColor"),Z(e,"stroke-width","1.5"),Z(e,"stroke-linecap","round"),Z(e,"stroke-linejoin","round"),Z(e,"class","lucide lucide-circle-play button-svg svelte-yiclpa")},m(c,h){Gt(c,e,h),Q(e,t),Q(e,s)},d(c){c&&Bt(e)}}}function _N(i){let e,t,s,c;return{c(){e=ii("svg"),t=ii("circle"),s=ii("line"),c=ii("line"),Z(t,"cx","12"),Z(t,"cy","12"),Z(t,"r","10"),Z(s,"x1","10"),Z(s,"x2","10"),Z(s,"y1","15"),Z(s,"y2","9"),Z(c,"x1","14"),Z(c,"x2","14"),Z(c,"y1","15"),Z(c,"y2","9"),Z(e,"xmlns","http://www.w3.org/2000/svg"),Z(e,"width","24"),Z(e,"height","24"),Z(e,"viewBox","0 0 24 24"),Z(e,"fill","none"),Z(e,"stroke","currentColor"),Z(e,"stroke-width","1.5"),Z(e,"stroke-linecap","round"),Z(e,"stroke-linejoin","round"),Z(e,"class","lucide lucide-circle-pause button-svg svelte-yiclpa")},m(h,p){Gt(h,e,p),Q(e,t),Q(e,s),Q(e,c)},d(h){h&&Bt(e)}}}function yN(i){let e,t=i[0][0].scan&&vM(i);return{c(){t&&t.c(),e=Gs()},m(s,c){t&&t.m(s,c),Gt(s,e,c)},p(s,[c]){s[0][0].scan?t?t.p(s,c):(t=vM(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Vn,o:Vn,d(s){t&&t.d(s),s&&Bt(e)}}}function vN(i,e,t){let s,c,h,p;It(i,Vr,R=>t(6,s=R)),It(i,_i,R=>t(0,c=R)),It(i,ni,R=>t(4,h=R)),It(i,Js,R=>t(5,p=R));let r,x,v,w,S,A;function I(){let R=rr.setValues();t(1,r=R.fileIdx),t(2,w=R.max),S=R.idx,x=R.elevation_state,v=R.station_state,t(3,A=R.currentIdx)}return i.$$.update=()=>{if(i.$$.dirty&1){e:rr.setStates(),I()}if(i.$$.dirty&64){e:rr.setSites(),I()}},[c,r,w,A,h,p,s]}var xM=class extends gi{constructor(e){super();Ti(this,e,vN,yN,ai,{})}},bM=xM;var e0="139",Hc={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},jc={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},wM=0,sb=1,TM=2;var ob=1,EM=2,_f=3,yf=0,To=1,el=2,ab=1;var Bl=0,Eh=1,lb=2,cb=3,ub=4,SM=5,Sh=100,AM=101,MM=102,hb=103,db=104,IM=200,CM=201,LM=202,DM=203,fb=204,pb=205,RM=206,PM=207,kM=208,zM=209,OM=210,NM=0,FM=1,BM=2,t0=3,UM=4,VM=5,GM=6,HM=7,$m=0,jM=1,WM=2,tl=0,qM=1,XM=2,ZM=3,KM=4,YM=5,mb=300,Ah=301,Mh=302,n0=303,i0=304,Qm=306,Ih=1e3,Zo=1001,r0=1002,Qi=1003,gb=1004;var _b=1005;var bs=1006,JM=1007;var eg=1008;var Wc=1009,$M=1010,QM=1011,vf=1012,eI=1013,tg=1014,qc=1015,Ch=1016,tI=1017,nI=1018,Lh=1020,iI=1021,rI=1022,ws=1023,sI=1024,oI=1025,Xc=1026,Dh=1027,ng=1028,aI=1029,lI=1030,cI=1031,uI=1033,s0=33776,o0=33777,a0=33778,l0=33779,yb=35840,vb=35841,xb=35842,bb=35843,hI=36196,wb=37492,Tb=37496,Eb=37808,Sb=37809,Ab=37810,Mb=37811,Ib=37812,Cb=37813,Lb=37814,Db=37815,Rb=37816,Pb=37817,kb=37818,zb=37819,Ob=37820,Nb=37821,Fb=36492,dI=2200,fI=2201,pI=2202,ig=2300,rg=2301,c0=2302,Rh=2400,Ph=2401,sg=2402,u0=2500,Bb=2501,mI=0;var nl=3e3,Ar=3001,gI=3200,_I=3201,kh=0,yI=1;var il="srgb",Zc="srgb-linear";var h0=7680;var vI=519,xf=35044,og=35048;var bf="300 es",d0=1035,Sa=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let c=this._listeners[e];if(c!==void 0){let h=c.indexOf(t);h!==-1&&c.splice(h,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let s=this._listeners[e.type];if(s!==void 0){e.target=this;let c=s.slice(0);for(let h=0,p=c.length;h<p;h++)c[h].call(this,e);e.target=null}}},ks=[];for(let i=0;i<256;i++)ks[i]=(i<16?"0":"")+i.toString(16);var xI=1234567,ag=Math.PI/180,lg=180/Math.PI;function Ko(){let i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(ks[i&255]+ks[i>>8&255]+ks[i>>16&255]+ks[i>>24&255]+"-"+ks[e&255]+ks[e>>8&255]+"-"+ks[e>>16&15|64]+ks[e>>24&255]+"-"+ks[t&63|128]+ks[t>>8&255]+"-"+ks[t>>16&255]+ks[t>>24&255]+ks[s&255]+ks[s>>8&255]+ks[s>>16&255]+ks[s>>24&255]).toLowerCase()}function as(i,e,t){return Math.max(e,Math.min(t,i))}function Ub(i,e){return(i%e+e)%e}function xN(i,e,t,s,c){return s+(i-e)*(c-s)/(t-e)}function bN(i,e,t){return i!==e?(t-i)/(e-i):0}function cg(i,e,t){return(1-t)*i+t*e}function wN(i,e,t,s){return cg(i,e,1-Math.exp(-t*s))}function TN(i,e=1){return e-Math.abs(Ub(i,e*2)-e)}function EN(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function SN(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function AN(i,e){return i+Math.floor(Math.random()*(e-i+1))}function MN(i,e){return i+Math.random()*(e-i)}function IN(i){return i*(.5-Math.random())}function CN(i){i!==void 0&&(xI=i);let e=xI+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function LN(i){return i*ag}function DN(i){return i*lg}function Vb(i){return(i&i-1)==0&&i!==0}function RN(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function f0(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function PN(i,e,t,s,c){let h=Math.cos,p=Math.sin,r=h(t/2),x=p(t/2),v=h((e+s)/2),w=p((e+s)/2),S=h((e-s)/2),A=p((e-s)/2),I=h((s-e)/2),R=p((s-e)/2);switch(c){case"XYX":i.set(r*w,x*S,x*A,r*v);break;case"YZY":i.set(x*A,r*w,x*S,r*v);break;case"ZXZ":i.set(x*S,x*A,r*w,r*v);break;case"XZX":i.set(r*w,x*R,x*I,r*v);break;case"YXY":i.set(x*I,r*w,x*R,r*v);break;case"ZYZ":i.set(x*R,x*I,r*w,r*v);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+c)}}function kN(i,e){switch(e.constructor){case Float32Array:return i;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function zN(i,e){switch(e.constructor){case Float32Array:return i;case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}var p0=Object.freeze({__proto__:null,DEG2RAD:ag,RAD2DEG:lg,generateUUID:Ko,clamp:as,euclideanModulo:Ub,mapLinear:xN,inverseLerp:bN,lerp:cg,damp:wN,pingpong:TN,smoothstep:EN,smootherstep:SN,randInt:AN,randFloat:MN,randFloatSpread:IN,seededRandom:CN,degToRad:LN,radToDeg:DN,isPowerOfTwo:Vb,ceilPowerOfTwo:RN,floorPowerOfTwo:f0,setQuaternionFromProperEuler:PN,normalize:zN,denormalize:kN}),Wt=class{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,s=this.y,c=e.elements;return this.x=c[0]*t+c[3]*s+c[6],this.y=c[1]*t+c[4]*s+c[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,s=this.y-e.y;return t*t+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,s){return s!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let s=Math.cos(t),c=Math.sin(t),h=this.x-e.x,p=this.y-e.y;return this.x=h*s-p*c+e.x,this.y=h*c+p*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};Wt.prototype.isVector2=!0;var ls=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,s,c,h,p,r,x,v){let w=this.elements;return w[0]=e,w[1]=c,w[2]=r,w[3]=t,w[4]=h,w[5]=x,w[6]=s,w[7]=p,w[8]=v,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],this}extractBasis(e,t,s){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let s=e.elements,c=t.elements,h=this.elements,p=s[0],r=s[3],x=s[6],v=s[1],w=s[4],S=s[7],A=s[2],I=s[5],R=s[8],k=c[0],L=c[3],z=c[6],B=c[1],$=c[4],H=c[7],G=c[2],le=c[5],te=c[8];return h[0]=p*k+r*B+x*G,h[3]=p*L+r*$+x*le,h[6]=p*z+r*H+x*te,h[1]=v*k+w*B+S*G,h[4]=v*L+w*$+S*le,h[7]=v*z+w*H+S*te,h[2]=A*k+I*B+R*G,h[5]=A*L+I*$+R*le,h[8]=A*z+I*H+R*te,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],s=e[1],c=e[2],h=e[3],p=e[4],r=e[5],x=e[6],v=e[7],w=e[8];return t*p*w-t*r*v-s*h*w+s*r*x+c*h*v-c*p*x}invert(){let e=this.elements,t=e[0],s=e[1],c=e[2],h=e[3],p=e[4],r=e[5],x=e[6],v=e[7],w=e[8],S=w*p-r*v,A=r*x-w*h,I=v*h-p*x,R=t*S+s*A+c*I;if(R===0)return this.set(0,0,0,0,0,0,0,0,0);let k=1/R;return e[0]=S*k,e[1]=(c*v-w*s)*k,e[2]=(r*s-c*p)*k,e[3]=A*k,e[4]=(w*t-c*x)*k,e[5]=(c*h-r*t)*k,e[6]=I*k,e[7]=(s*x-v*t)*k,e[8]=(p*t-s*h)*k,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,s,c,h,p,r){let x=Math.cos(h),v=Math.sin(h);return this.set(s*x,s*v,-s*(x*p+v*r)+p+e,-c*v,c*x,-c*(-v*p+x*r)+r+t,0,0,1),this}scale(e,t){let s=this.elements;return s[0]*=e,s[3]*=e,s[6]*=e,s[1]*=t,s[4]*=t,s[7]*=t,this}rotate(e){let t=Math.cos(e),s=Math.sin(e),c=this.elements,h=c[0],p=c[3],r=c[6],x=c[1],v=c[4],w=c[7];return c[0]=t*h+s*x,c[3]=t*p+s*v,c[6]=t*r+s*w,c[1]=-s*h+t*x,c[4]=-s*p+t*v,c[7]=-s*r+t*w,this}translate(e,t){let s=this.elements;return s[0]+=e*s[2],s[3]+=e*s[5],s[6]+=e*s[8],s[1]+=t*s[2],s[4]+=t*s[5],s[7]+=t*s[8],this}equals(e){let t=this.elements,s=e.elements;for(let c=0;c<9;c++)if(t[c]!==s[c])return!1;return!0}fromArray(e,t=0){for(let s=0;s<9;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){let s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}};ls.prototype.isMatrix3=!0;function bI(i){for(let e=i.length-1;e>=0;--e)if(i[e]>65535)return!0;return!1}function ug(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function zh(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function m0(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}var Gb={[il]:{[Zc]:zh},[Zc]:{[il]:m0}},Yo={legacyMode:!0,get workingColorSpace(){return Zc},set workingColorSpace(i){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(i,e,t){if(this.legacyMode||e===t||!e||!t)return i;if(Gb[e]&&Gb[e][t]!==void 0){let s=Gb[e][t];return i.r=s(i.r),i.g=s(i.g),i.b=s(i.b),i}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(i,e){return this.convert(i,this.workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this.workingColorSpace)}},wI={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},cs={r:0,g:0,b:0},Aa={h:0,s:0,l:0},g0={h:0,s:0,l:0};function Hb(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}function _0(i,e){return e.r=i.r,e.g=i.g,e.b=i.b,e}var jn=class{constructor(e,t,s){return t===void 0&&s===void 0?this.set(e):this.setRGB(e,t,s)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=il){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Yo.toWorkingColorSpace(this,t),this}setRGB(e,t,s,c=Zc){return this.r=e,this.g=t,this.b=s,Yo.toWorkingColorSpace(this,c),this}setHSL(e,t,s,c=Zc){if(e=Ub(e,1),t=as(t,0,1),s=as(s,0,1),t===0)this.r=this.g=this.b=s;else{let h=s<=.5?s*(1+t):s+t-s*t,p=2*s-h;this.r=Hb(p,h,e+1/3),this.g=Hb(p,h,e),this.b=Hb(p,h,e-1/3)}return Yo.toWorkingColorSpace(this,c),this}setStyle(e,t=il){function s(h){h!==void 0&&parseFloat(h)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let c;if(c=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let h,p=c[1],r=c[2];switch(p){case"rgb":case"rgba":if(h=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(h[1],10))/255,this.g=Math.min(255,parseInt(h[2],10))/255,this.b=Math.min(255,parseInt(h[3],10))/255,Yo.toWorkingColorSpace(this,t),s(h[4]),this;if(h=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(h[1],10))/100,this.g=Math.min(100,parseInt(h[2],10))/100,this.b=Math.min(100,parseInt(h[3],10))/100,Yo.toWorkingColorSpace(this,t),s(h[4]),this;break;case"hsl":case"hsla":if(h=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){let x=parseFloat(h[1])/360,v=parseInt(h[2],10)/100,w=parseInt(h[3],10)/100;return s(h[4]),this.setHSL(x,v,w,t)}break}}else if(c=/^\#([A-Fa-f\d]+)$/.exec(e)){let h=c[1],p=h.length;if(p===3)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,Yo.toWorkingColorSpace(this,t),this;if(p===6)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,Yo.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=il){let s=wI[e.toLowerCase()];return s!==void 0?this.setHex(s,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=zh(e.r),this.g=zh(e.g),this.b=zh(e.b),this}copyLinearToSRGB(e){return this.r=m0(e.r),this.g=m0(e.g),this.b=m0(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=il){return Yo.fromWorkingColorSpace(_0(this,cs),e),as(cs.r*255,0,255)<<16^as(cs.g*255,0,255)<<8^as(cs.b*255,0,255)<<0}getHexString(e=il){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Zc){Yo.fromWorkingColorSpace(_0(this,cs),t);let s=cs.r,c=cs.g,h=cs.b,p=Math.max(s,c,h),r=Math.min(s,c,h),x,v,w=(r+p)/2;if(r===p)x=0,v=0;else{let S=p-r;switch(v=w<=.5?S/(p+r):S/(2-p-r),p){case s:x=(c-h)/S+(c<h?6:0);break;case c:x=(h-s)/S+2;break;case h:x=(s-c)/S+4;break}x/=6}return e.h=x,e.s=v,e.l=w,e}getRGB(e,t=Zc){return Yo.fromWorkingColorSpace(_0(this,cs),t),e.r=cs.r,e.g=cs.g,e.b=cs.b,e}getStyle(e=il){return Yo.fromWorkingColorSpace(_0(this,cs),e),e!==il?`color(${e} ${cs.r} ${cs.g} ${cs.b})`:`rgb(${cs.r*255|0},${cs.g*255|0},${cs.b*255|0})`}offsetHSL(e,t,s){return this.getHSL(Aa),Aa.h+=e,Aa.s+=t,Aa.l+=s,this.setHSL(Aa.h,Aa.s,Aa.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,s){return this.r=e.r+(t.r-e.r)*s,this.g=e.g+(t.g-e.g)*s,this.b=e.b+(t.b-e.b)*s,this}lerpHSL(e,t){this.getHSL(Aa),e.getHSL(g0);let s=cg(Aa.h,g0.h,t),c=cg(Aa.s,g0.s,t),h=cg(Aa.l,g0.l,t);return this.setHSL(s,c,h),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};jn.NAMES=wI;jn.prototype.isColor=!0;jn.prototype.r=1;jn.prototype.g=1;jn.prototype.b=1;var wf,Ul=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{wf===void 0&&(wf=ug("canvas")),wf.width=e.width,wf.height=e.height;let s=wf.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),t=wf}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){let t=ug("canvas");t.width=e.width,t.height=e.height;let s=t.getContext("2d");s.drawImage(e,0,0,e.width,e.height);let c=s.getImageData(0,0,e.width,e.height),h=c.data;for(let p=0;p<h.length;p++)h[p]=zh(h[p]/255)*255;return s.putImageData(c,0,0),t}else if(e.data){let t=e.data.slice(0);for(let s=0;s<t.length;s++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[s]=Math.floor(zh(t[s]/255)*255):t[s]=zh(t[s]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},y0=class{constructor(e=null){this.uuid=Ko(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let s={uuid:this.uuid,url:""},c=this.data;if(c!==null){let h;if(Array.isArray(c)){h=[];for(let p=0,r=c.length;p<r;p++)c[p].isDataTexture?h.push(jb(c[p].image)):h.push(jb(c[p]))}else h=jb(c);s.url=h}return t||(e.images[this.uuid]=s),s}};function jb(i){return typeof HTMLImageElement!="undefined"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&i instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap?Ul.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}y0.prototype.isSource=!0;var ON=0,Qr=class extends Sa{constructor(e=Qr.DEFAULT_IMAGE,t=Qr.DEFAULT_MAPPING,s=Zo,c=Zo,h=bs,p=eg,r=ws,x=Wc,v=1,w=nl){super();Object.defineProperty(this,"id",{value:ON++}),this.uuid=Ko(),this.name="",this.source=new y0(e),this.mipmaps=[],this.mapping=t,this.wrapS=s,this.wrapT=c,this.magFilter=h,this.minFilter=p,this.anisotropy=v,this.format=r,this.internalFormat=null,this.type=x,this.offset=new Wt(0,0),this.repeat=new Wt(1,1),this.center=new Wt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ls,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=w,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),t||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==mb)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ih:e.x=e.x-Math.floor(e.x);break;case Zo:e.x=e.x<0?0:1;break;case r0:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ih:e.y=e.y-Math.floor(e.y);break;case Zo:e.y=e.y<0?0:1;break;case r0:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Qr.DEFAULT_IMAGE=null;Qr.DEFAULT_MAPPING=mb;Qr.prototype.isTexture=!0;var Ui=class{constructor(e=0,t=0,s=0,c=1){this.x=e,this.y=t,this.z=s,this.w=c}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,s,c){return this.x=e,this.y=t,this.z=s,this.w=c,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,s=this.y,c=this.z,h=this.w,p=e.elements;return this.x=p[0]*t+p[4]*s+p[8]*c+p[12]*h,this.y=p[1]*t+p[5]*s+p[9]*c+p[13]*h,this.z=p[2]*t+p[6]*s+p[10]*c+p[14]*h,this.w=p[3]*t+p[7]*s+p[11]*c+p[15]*h,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,s,c,h,p=.01,r=.1,x=e.elements,v=x[0],w=x[4],S=x[8],A=x[1],I=x[5],R=x[9],k=x[2],L=x[6],z=x[10];if(Math.abs(w-A)<p&&Math.abs(S-k)<p&&Math.abs(R-L)<p){if(Math.abs(w+A)<r&&Math.abs(S+k)<r&&Math.abs(R+L)<r&&Math.abs(v+I+z-3)<r)return this.set(1,0,0,0),this;t=Math.PI;let $=(v+1)/2,H=(I+1)/2,G=(z+1)/2,le=(w+A)/4,te=(S+k)/4,ue=(R+L)/4;return $>H&&$>G?$<p?(s=0,c=.707106781,h=.707106781):(s=Math.sqrt($),c=le/s,h=te/s):H>G?H<p?(s=.707106781,c=0,h=.707106781):(c=Math.sqrt(H),s=le/c,h=ue/c):G<p?(s=.707106781,c=.707106781,h=0):(h=Math.sqrt(G),s=te/h,c=ue/h),this.set(s,c,h,t),this}let B=Math.sqrt((L-R)*(L-R)+(S-k)*(S-k)+(A-w)*(A-w));return Math.abs(B)<.001&&(B=1),this.x=(L-R)/B,this.y=(S-k)/B,this.z=(A-w)/B,this.w=Math.acos((v+I+z-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this.w=e.w+(t.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,s){return s!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};Ui.prototype.isVector4=!0;var Qs=class extends Sa{constructor(e,t,s={}){super();this.width=e,this.height=t,this.depth=1,this.scissor=new Ui(0,0,e,t),this.scissorTest=!1,this.viewport=new Ui(0,0,e,t);let c={width:e,height:t,depth:1};this.texture=new Qr(c,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=s.generateMipmaps!==void 0?s.generateMipmaps:!1,this.texture.internalFormat=s.internalFormat!==void 0?s.internalFormat:null,this.texture.minFilter=s.minFilter!==void 0?s.minFilter:bs,this.depthBuffer=s.depthBuffer!==void 0?s.depthBuffer:!0,this.stencilBuffer=s.stencilBuffer!==void 0?s.stencilBuffer:!1,this.depthTexture=s.depthTexture!==void 0?s.depthTexture:null,this.samples=s.samples!==void 0?s.samples:0}setSize(e,t,s=1){(this.width!==e||this.height!==t||this.depth!==s)&&(this.width=e,this.height=t,this.depth=s,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=s,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}};Qs.prototype.isWebGLRenderTarget=!0;var Tf=class extends Qr{constructor(e=null,t=1,s=1,c=1){super(null);this.image={data:e,width:t,height:s,depth:c},this.magFilter=Qi,this.minFilter=Qi,this.wrapR=Zo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};Tf.prototype.isDataArrayTexture=!0;var Wb=class extends Qs{constructor(e,t,s){super(e,t);this.depth=s,this.texture=new Tf(null,e,t,s),this.texture.isRenderTargetTexture=!0}};Wb.prototype.isWebGLArrayRenderTarget=!0;var Kc=class extends Qr{constructor(e=null,t=1,s=1,c=1){super(null);this.image={data:e,width:t,height:s,depth:c},this.magFilter=Qi,this.minFilter=Qi,this.wrapR=Zo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};Kc.prototype.isData3DTexture=!0;var qb=class extends Qs{constructor(e,t,s){super(e,t);this.depth=s,this.texture=new Kc(null,e,t,s),this.texture.isRenderTargetTexture=!0}};qb.prototype.isWebGL3DRenderTarget=!0;var Xb=class extends Qs{constructor(e,t,s,c={}){super(e,t,c);let h=this.texture;this.texture=[];for(let p=0;p<s;p++)this.texture[p]=h.clone(),this.texture[p].isRenderTargetTexture=!0}setSize(e,t,s=1){if(this.width!==e||this.height!==t||this.depth!==s){this.width=e,this.height=t,this.depth=s;for(let c=0,h=this.texture.length;c<h;c++)this.texture[c].image.width=e,this.texture[c].image.height=t,this.texture[c].image.depth=s;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,s=e.texture.length;t<s;t++)this.texture[t]=e.texture[t].clone();return this}};Xb.prototype.isWebGLMultipleRenderTargets=!0;var us=class{constructor(e=0,t=0,s=0,c=1){this._x=e,this._y=t,this._z=s,this._w=c}static slerp(e,t,s,c){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),s.slerpQuaternions(e,t,c)}static slerpFlat(e,t,s,c,h,p,r){let x=s[c+0],v=s[c+1],w=s[c+2],S=s[c+3],A=h[p+0],I=h[p+1],R=h[p+2],k=h[p+3];if(r===0){e[t+0]=x,e[t+1]=v,e[t+2]=w,e[t+3]=S;return}if(r===1){e[t+0]=A,e[t+1]=I,e[t+2]=R,e[t+3]=k;return}if(S!==k||x!==A||v!==I||w!==R){let L=1-r,z=x*A+v*I+w*R+S*k,B=z>=0?1:-1,$=1-z*z;if($>Number.EPSILON){let G=Math.sqrt($),le=Math.atan2(G,z*B);L=Math.sin(L*le)/G,r=Math.sin(r*le)/G}let H=r*B;if(x=x*L+A*H,v=v*L+I*H,w=w*L+R*H,S=S*L+k*H,L===1-r){let G=1/Math.sqrt(x*x+v*v+w*w+S*S);x*=G,v*=G,w*=G,S*=G}}e[t]=x,e[t+1]=v,e[t+2]=w,e[t+3]=S}static multiplyQuaternionsFlat(e,t,s,c,h,p){let r=s[c],x=s[c+1],v=s[c+2],w=s[c+3],S=h[p],A=h[p+1],I=h[p+2],R=h[p+3];return e[t]=r*R+w*S+x*I-v*A,e[t+1]=x*R+w*A+v*S-r*I,e[t+2]=v*R+w*I+r*A-x*S,e[t+3]=w*R-r*S-x*A-v*I,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,c){return this._x=e,this._y=t,this._z=s,this._w=c,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let s=e._x,c=e._y,h=e._z,p=e._order,r=Math.cos,x=Math.sin,v=r(s/2),w=r(c/2),S=r(h/2),A=x(s/2),I=x(c/2),R=x(h/2);switch(p){case"XYZ":this._x=A*w*S+v*I*R,this._y=v*I*S-A*w*R,this._z=v*w*R+A*I*S,this._w=v*w*S-A*I*R;break;case"YXZ":this._x=A*w*S+v*I*R,this._y=v*I*S-A*w*R,this._z=v*w*R-A*I*S,this._w=v*w*S+A*I*R;break;case"ZXY":this._x=A*w*S-v*I*R,this._y=v*I*S+A*w*R,this._z=v*w*R+A*I*S,this._w=v*w*S-A*I*R;break;case"ZYX":this._x=A*w*S-v*I*R,this._y=v*I*S+A*w*R,this._z=v*w*R-A*I*S,this._w=v*w*S+A*I*R;break;case"YZX":this._x=A*w*S+v*I*R,this._y=v*I*S+A*w*R,this._z=v*w*R-A*I*S,this._w=v*w*S-A*I*R;break;case"XZY":this._x=A*w*S-v*I*R,this._y=v*I*S-A*w*R,this._z=v*w*R+A*I*S,this._w=v*w*S+A*I*R;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+p)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let s=t/2,c=Math.sin(s);return this._x=e.x*c,this._y=e.y*c,this._z=e.z*c,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,s=t[0],c=t[4],h=t[8],p=t[1],r=t[5],x=t[9],v=t[2],w=t[6],S=t[10],A=s+r+S;if(A>0){let I=.5/Math.sqrt(A+1);this._w=.25/I,this._x=(w-x)*I,this._y=(h-v)*I,this._z=(p-c)*I}else if(s>r&&s>S){let I=2*Math.sqrt(1+s-r-S);this._w=(w-x)/I,this._x=.25*I,this._y=(c+p)/I,this._z=(h+v)/I}else if(r>S){let I=2*Math.sqrt(1+r-s-S);this._w=(h-v)/I,this._x=(c+p)/I,this._y=.25*I,this._z=(x+w)/I}else{let I=2*Math.sqrt(1+S-s-r);this._w=(p-c)/I,this._x=(h+v)/I,this._y=(x+w)/I,this._z=.25*I}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(as(this.dot(e),-1,1)))}rotateTowards(e,t){let s=this.angleTo(e);if(s===0)return this;let c=Math.min(1,t/s);return this.slerp(e,c),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let s=e._x,c=e._y,h=e._z,p=e._w,r=t._x,x=t._y,v=t._z,w=t._w;return this._x=s*w+p*r+c*v-h*x,this._y=c*w+p*x+h*r-s*v,this._z=h*w+p*v+s*x-c*r,this._w=p*w-s*r-c*x-h*v,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let s=this._x,c=this._y,h=this._z,p=this._w,r=p*e._w+s*e._x+c*e._y+h*e._z;if(r<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,r=-r):this.copy(e),r>=1)return this._w=p,this._x=s,this._y=c,this._z=h,this;let x=1-r*r;if(x<=Number.EPSILON){let I=1-t;return this._w=I*p+t*this._w,this._x=I*s+t*this._x,this._y=I*c+t*this._y,this._z=I*h+t*this._z,this.normalize(),this._onChangeCallback(),this}let v=Math.sqrt(x),w=Math.atan2(v,r),S=Math.sin((1-t)*w)/v,A=Math.sin(t*w)/v;return this._w=p*S+this._w*A,this._x=s*S+this._x*A,this._y=c*S+this._y*A,this._z=h*S+this._z*A,this._onChangeCallback(),this}slerpQuaternions(e,t,s){return this.copy(e).slerp(t,s)}random(){let e=Math.random(),t=Math.sqrt(1-e),s=Math.sqrt(e),c=2*Math.PI*Math.random(),h=2*Math.PI*Math.random();return this.set(t*Math.cos(c),s*Math.sin(h),s*Math.cos(h),t*Math.sin(c))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};us.prototype.isQuaternion=!0;var Be=class{constructor(e=0,t=0,s=0){this.x=e,this.y=t,this.z=s}set(e,t,s){return s===void 0&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(TI.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(TI.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,s=this.y,c=this.z,h=e.elements;return this.x=h[0]*t+h[3]*s+h[6]*c,this.y=h[1]*t+h[4]*s+h[7]*c,this.z=h[2]*t+h[5]*s+h[8]*c,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,s=this.y,c=this.z,h=e.elements,p=1/(h[3]*t+h[7]*s+h[11]*c+h[15]);return this.x=(h[0]*t+h[4]*s+h[8]*c+h[12])*p,this.y=(h[1]*t+h[5]*s+h[9]*c+h[13])*p,this.z=(h[2]*t+h[6]*s+h[10]*c+h[14])*p,this}applyQuaternion(e){let t=this.x,s=this.y,c=this.z,h=e.x,p=e.y,r=e.z,x=e.w,v=x*t+p*c-r*s,w=x*s+r*t-h*c,S=x*c+h*s-p*t,A=-h*t-p*s-r*c;return this.x=v*x+A*-h+w*-r-S*-p,this.y=w*x+A*-p+S*-h-v*-r,this.z=S*x+A*-r+v*-p-w*-h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,s=this.y,c=this.z,h=e.elements;return this.x=h[0]*t+h[4]*s+h[8]*c,this.y=h[1]*t+h[5]*s+h[9]*c,this.z=h[2]*t+h[6]*s+h[10]*c,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){let s=e.x,c=e.y,h=e.z,p=t.x,r=t.y,x=t.z;return this.x=c*x-h*r,this.y=h*p-s*x,this.z=s*r-c*p,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return Zb.copy(this).projectOnVector(e),this.sub(Zb)}reflect(e){return this.sub(Zb.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let s=this.dot(e)/t;return Math.acos(as(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,s=this.y-e.y,c=this.z-e.z;return t*t+s*s+c*c}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){let c=Math.sin(t)*e;return this.x=c*Math.sin(s),this.y=Math.cos(t)*e,this.z=c*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),c=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=c,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,s){return s!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,s=Math.sqrt(1-e**2);return this.x=s*Math.cos(t),this.y=s*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};Be.prototype.isVector3=!0;var Zb=new Be,TI=new us,Ts=class{constructor(e=new Be(Infinity,Infinity,Infinity),t=new Be(-Infinity,-Infinity,-Infinity)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=Infinity,s=Infinity,c=Infinity,h=-Infinity,p=-Infinity,r=-Infinity;for(let x=0,v=e.length;x<v;x+=3){let w=e[x],S=e[x+1],A=e[x+2];w<t&&(t=w),S<s&&(s=S),A<c&&(c=A),w>h&&(h=w),S>p&&(p=S),A>r&&(r=A)}return this.min.set(t,s,c),this.max.set(h,p,r),this}setFromBufferAttribute(e){let t=Infinity,s=Infinity,c=Infinity,h=-Infinity,p=-Infinity,r=-Infinity;for(let x=0,v=e.count;x<v;x++){let w=e.getX(x),S=e.getY(x),A=e.getZ(x);w<t&&(t=w),S<s&&(s=S),A<c&&(c=A),w>h&&(h=w),S>p&&(p=S),A>r&&(r=A)}return this.min.set(t,s,c),this.max.set(h,p,r),this}setFromPoints(e){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let s=Oh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let s=e.geometry;if(s!==void 0)if(t&&s.attributes!=null&&s.attributes.position!==void 0){let h=s.attributes.position;for(let p=0,r=h.count;p<r;p++)Oh.fromBufferAttribute(h,p).applyMatrix4(e.matrixWorld),this.expandByPoint(Oh)}else s.boundingBox===null&&s.computeBoundingBox(),Kb.copy(s.boundingBox),Kb.applyMatrix4(e.matrixWorld),this.union(Kb);let c=e.children;for(let h=0,p=c.length;h<p;h++)this.expandByObject(c[h],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Oh),Oh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,s;return e.normal.x>0?(t=e.normal.x*this.min.x,s=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,s=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,s+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,s+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,s+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,s+=e.normal.z*this.min.z),t<=-e.constant&&s>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(hg),v0.subVectors(this.max,hg),Ef.subVectors(e.a,hg),Sf.subVectors(e.b,hg),Af.subVectors(e.c,hg),Yc.subVectors(Sf,Ef),Jc.subVectors(Af,Sf),Nh.subVectors(Ef,Af);let t=[0,-Yc.z,Yc.y,0,-Jc.z,Jc.y,0,-Nh.z,Nh.y,Yc.z,0,-Yc.x,Jc.z,0,-Jc.x,Nh.z,0,-Nh.x,-Yc.y,Yc.x,0,-Jc.y,Jc.x,0,-Nh.y,Nh.x,0];return!Yb(t,Ef,Sf,Af,v0)||(t=[1,0,0,0,1,0,0,0,1],!Yb(t,Ef,Sf,Af,v0))?!1:(x0.crossVectors(Yc,Jc),t=[x0.x,x0.y,x0.z],Yb(t,Ef,Sf,Af,v0))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Oh.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Oh).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Vl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Vl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Vl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Vl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Vl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Vl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Vl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Vl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Vl),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};Ts.prototype.isBox3=!0;var Vl=[new Be,new Be,new Be,new Be,new Be,new Be,new Be,new Be],Oh=new Be,Kb=new Ts,Ef=new Be,Sf=new Be,Af=new Be,Yc=new Be,Jc=new Be,Nh=new Be,hg=new Be,v0=new Be,x0=new Be,Fh=new Be;function Yb(i,e,t,s,c){for(let h=0,p=i.length-3;h<=p;h+=3){Fh.fromArray(i,h);let r=c.x*Math.abs(Fh.x)+c.y*Math.abs(Fh.y)+c.z*Math.abs(Fh.z),x=e.dot(Fh),v=t.dot(Fh),w=s.dot(Fh);if(Math.max(-Math.max(x,v,w),Math.min(x,v,w))>r)return!1}return!0}var NN=new Ts,EI=new Be,b0=new Be,Jb=new Be,Jo=class{constructor(e=new Be,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let s=this.center;t!==void 0?s.copy(t):NN.setFromPoints(e).getCenter(s);let c=0;for(let h=0,p=e.length;h<p;h++)c=Math.max(c,s.distanceToSquared(e[h]));return this.radius=Math.sqrt(c),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let s=this.center.distanceToSquared(e);return t.copy(e),s>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Jb.subVectors(e,this.center);let t=Jb.lengthSq();if(t>this.radius*this.radius){let s=Math.sqrt(t),c=(s-this.radius)*.5;this.center.add(Jb.multiplyScalar(c/s)),this.radius+=c}return this}union(e){return this.center.equals(e.center)===!0?b0.set(0,0,1).multiplyScalar(e.radius):b0.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(EI.copy(e.center).add(b0)),this.expandByPoint(EI.copy(e.center).sub(b0)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Gl=new Be,$b=new Be,w0=new Be,$c=new Be,Qb=new Be,T0=new Be,ew=new Be,Qc=class{constructor(e=new Be,t=new Be(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Gl)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let s=t.dot(this.direction);return s<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(s).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Gl.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Gl.copy(this.direction).multiplyScalar(t).add(this.origin),Gl.distanceToSquared(e))}distanceSqToSegment(e,t,s,c){$b.copy(e).add(t).multiplyScalar(.5),w0.copy(t).sub(e).normalize(),$c.copy(this.origin).sub($b);let h=e.distanceTo(t)*.5,p=-this.direction.dot(w0),r=$c.dot(this.direction),x=-$c.dot(w0),v=$c.lengthSq(),w=Math.abs(1-p*p),S,A,I,R;if(w>0)if(S=p*x-r,A=p*r-x,R=h*w,S>=0)if(A>=-R)if(A<=R){let k=1/w;S*=k,A*=k,I=S*(S+p*A+2*r)+A*(p*S+A+2*x)+v}else A=h,S=Math.max(0,-(p*A+r)),I=-S*S+A*(A+2*x)+v;else A=-h,S=Math.max(0,-(p*A+r)),I=-S*S+A*(A+2*x)+v;else A<=-R?(S=Math.max(0,-(-p*h+r)),A=S>0?-h:Math.min(Math.max(-h,-x),h),I=-S*S+A*(A+2*x)+v):A<=R?(S=0,A=Math.min(Math.max(-h,-x),h),I=A*(A+2*x)+v):(S=Math.max(0,-(p*h+r)),A=S>0?h:Math.min(Math.max(-h,-x),h),I=-S*S+A*(A+2*x)+v);else A=p>0?-h:h,S=Math.max(0,-(p*A+r)),I=-S*S+A*(A+2*x)+v;return s&&s.copy(this.direction).multiplyScalar(S).add(this.origin),c&&c.copy(w0).multiplyScalar(A).add($b),I}intersectSphere(e,t){Gl.subVectors(e.center,this.origin);let s=Gl.dot(this.direction),c=Gl.dot(Gl)-s*s,h=e.radius*e.radius;if(c>h)return null;let p=Math.sqrt(h-c),r=s-p,x=s+p;return r<0&&x<0?null:r<0?this.at(x,t):this.at(r,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let s=-(this.origin.dot(e.normal)+e.constant)/t;return s>=0?s:null}intersectPlane(e,t){let s=this.distanceToPlane(e);return s===null?null:this.at(s,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let s,c,h,p,r,x,v=1/this.direction.x,w=1/this.direction.y,S=1/this.direction.z,A=this.origin;return v>=0?(s=(e.min.x-A.x)*v,c=(e.max.x-A.x)*v):(s=(e.max.x-A.x)*v,c=(e.min.x-A.x)*v),w>=0?(h=(e.min.y-A.y)*w,p=(e.max.y-A.y)*w):(h=(e.max.y-A.y)*w,p=(e.min.y-A.y)*w),s>p||h>c||((h>s||s!==s)&&(s=h),(p<c||c!==c)&&(c=p),S>=0?(r=(e.min.z-A.z)*S,x=(e.max.z-A.z)*S):(r=(e.max.z-A.z)*S,x=(e.min.z-A.z)*S),s>x||r>c)||((r>s||s!==s)&&(s=r),(x<c||c!==c)&&(c=x),c<0)?null:this.at(s>=0?s:c,t)}intersectsBox(e){return this.intersectBox(e,Gl)!==null}intersectTriangle(e,t,s,c,h){Qb.subVectors(t,e),T0.subVectors(s,e),ew.crossVectors(Qb,T0);let p=this.direction.dot(ew),r;if(p>0){if(c)return null;r=1}else if(p<0)r=-1,p=-p;else return null;$c.subVectors(this.origin,e);let x=r*this.direction.dot(T0.crossVectors($c,T0));if(x<0)return null;let v=r*this.direction.dot(Qb.cross($c));if(v<0||x+v>p)return null;let w=-r*$c.dot(ew);return w<0?null:this.at(w/p,h)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Jn=class{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L){let z=this.elements;return z[0]=e,z[4]=t,z[8]=s,z[12]=c,z[1]=h,z[5]=p,z[9]=r,z[13]=x,z[2]=v,z[6]=w,z[10]=S,z[14]=A,z[3]=I,z[7]=R,z[11]=k,z[15]=L,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Jn().fromArray(this.elements)}copy(e){let t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){let t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,s=e.elements,c=1/Mf.setFromMatrixColumn(e,0).length(),h=1/Mf.setFromMatrixColumn(e,1).length(),p=1/Mf.setFromMatrixColumn(e,2).length();return t[0]=s[0]*c,t[1]=s[1]*c,t[2]=s[2]*c,t[3]=0,t[4]=s[4]*h,t[5]=s[5]*h,t[6]=s[6]*h,t[7]=0,t[8]=s[8]*p,t[9]=s[9]*p,t[10]=s[10]*p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let t=this.elements,s=e.x,c=e.y,h=e.z,p=Math.cos(s),r=Math.sin(s),x=Math.cos(c),v=Math.sin(c),w=Math.cos(h),S=Math.sin(h);if(e.order==="XYZ"){let A=p*w,I=p*S,R=r*w,k=r*S;t[0]=x*w,t[4]=-x*S,t[8]=v,t[1]=I+R*v,t[5]=A-k*v,t[9]=-r*x,t[2]=k-A*v,t[6]=R+I*v,t[10]=p*x}else if(e.order==="YXZ"){let A=x*w,I=x*S,R=v*w,k=v*S;t[0]=A+k*r,t[4]=R*r-I,t[8]=p*v,t[1]=p*S,t[5]=p*w,t[9]=-r,t[2]=I*r-R,t[6]=k+A*r,t[10]=p*x}else if(e.order==="ZXY"){let A=x*w,I=x*S,R=v*w,k=v*S;t[0]=A-k*r,t[4]=-p*S,t[8]=R+I*r,t[1]=I+R*r,t[5]=p*w,t[9]=k-A*r,t[2]=-p*v,t[6]=r,t[10]=p*x}else if(e.order==="ZYX"){let A=p*w,I=p*S,R=r*w,k=r*S;t[0]=x*w,t[4]=R*v-I,t[8]=A*v+k,t[1]=x*S,t[5]=k*v+A,t[9]=I*v-R,t[2]=-v,t[6]=r*x,t[10]=p*x}else if(e.order==="YZX"){let A=p*x,I=p*v,R=r*x,k=r*v;t[0]=x*w,t[4]=k-A*S,t[8]=R*S+I,t[1]=S,t[5]=p*w,t[9]=-r*w,t[2]=-v*w,t[6]=I*S+R,t[10]=A-k*S}else if(e.order==="XZY"){let A=p*x,I=p*v,R=r*x,k=r*v;t[0]=x*w,t[4]=-S,t[8]=v*w,t[1]=A*S+k,t[5]=p*w,t[9]=I*S-R,t[2]=R*S-I,t[6]=r*w,t[10]=k*S+A}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(FN,e,BN)}lookAt(e,t,s){let c=this.elements;return Do.subVectors(e,t),Do.lengthSq()===0&&(Do.z=1),Do.normalize(),eu.crossVectors(s,Do),eu.lengthSq()===0&&(Math.abs(s.z)===1?Do.x+=1e-4:Do.z+=1e-4,Do.normalize(),eu.crossVectors(s,Do)),eu.normalize(),E0.crossVectors(Do,eu),c[0]=eu.x,c[4]=E0.x,c[8]=Do.x,c[1]=eu.y,c[5]=E0.y,c[9]=Do.y,c[2]=eu.z,c[6]=E0.z,c[10]=Do.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let s=e.elements,c=t.elements,h=this.elements,p=s[0],r=s[4],x=s[8],v=s[12],w=s[1],S=s[5],A=s[9],I=s[13],R=s[2],k=s[6],L=s[10],z=s[14],B=s[3],$=s[7],H=s[11],G=s[15],le=c[0],te=c[4],ue=c[8],me=c[12],se=c[1],Y=c[5],ye=c[9],Xe=c[13],ge=c[2],re=c[6],ve=c[10],ae=c[14],de=c[3],xe=c[7],De=c[11],Ce=c[15];return h[0]=p*le+r*se+x*ge+v*de,h[4]=p*te+r*Y+x*re+v*xe,h[8]=p*ue+r*ye+x*ve+v*De,h[12]=p*me+r*Xe+x*ae+v*Ce,h[1]=w*le+S*se+A*ge+I*de,h[5]=w*te+S*Y+A*re+I*xe,h[9]=w*ue+S*ye+A*ve+I*De,h[13]=w*me+S*Xe+A*ae+I*Ce,h[2]=R*le+k*se+L*ge+z*de,h[6]=R*te+k*Y+L*re+z*xe,h[10]=R*ue+k*ye+L*ve+z*De,h[14]=R*me+k*Xe+L*ae+z*Ce,h[3]=B*le+$*se+H*ge+G*de,h[7]=B*te+$*Y+H*re+G*xe,h[11]=B*ue+$*ye+H*ve+G*De,h[15]=B*me+$*Xe+H*ae+G*Ce,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],s=e[4],c=e[8],h=e[12],p=e[1],r=e[5],x=e[9],v=e[13],w=e[2],S=e[6],A=e[10],I=e[14],R=e[3],k=e[7],L=e[11],z=e[15];return R*(+h*x*S-c*v*S-h*r*A+s*v*A+c*r*I-s*x*I)+k*(+t*x*I-t*v*A+h*p*A-c*p*I+c*v*w-h*x*w)+L*(+t*v*S-t*r*I-h*p*S+s*p*I+h*r*w-s*v*w)+z*(-c*r*w-t*x*S+t*r*A+c*p*S-s*p*A+s*x*w)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){let c=this.elements;return e.isVector3?(c[12]=e.x,c[13]=e.y,c[14]=e.z):(c[12]=e,c[13]=t,c[14]=s),this}invert(){let e=this.elements,t=e[0],s=e[1],c=e[2],h=e[3],p=e[4],r=e[5],x=e[6],v=e[7],w=e[8],S=e[9],A=e[10],I=e[11],R=e[12],k=e[13],L=e[14],z=e[15],B=S*L*v-k*A*v+k*x*I-r*L*I-S*x*z+r*A*z,$=R*A*v-w*L*v-R*x*I+p*L*I+w*x*z-p*A*z,H=w*k*v-R*S*v+R*r*I-p*k*I-w*r*z+p*S*z,G=R*S*x-w*k*x-R*r*A+p*k*A+w*r*L-p*S*L,le=t*B+s*$+c*H+h*G;if(le===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let te=1/le;return e[0]=B*te,e[1]=(k*A*h-S*L*h-k*c*I+s*L*I+S*c*z-s*A*z)*te,e[2]=(r*L*h-k*x*h+k*c*v-s*L*v-r*c*z+s*x*z)*te,e[3]=(S*x*h-r*A*h-S*c*v+s*A*v+r*c*I-s*x*I)*te,e[4]=$*te,e[5]=(w*L*h-R*A*h+R*c*I-t*L*I-w*c*z+t*A*z)*te,e[6]=(R*x*h-p*L*h-R*c*v+t*L*v+p*c*z-t*x*z)*te,e[7]=(p*A*h-w*x*h+w*c*v-t*A*v-p*c*I+t*x*I)*te,e[8]=H*te,e[9]=(R*S*h-w*k*h-R*s*I+t*k*I+w*s*z-t*S*z)*te,e[10]=(p*k*h-R*r*h+R*s*v-t*k*v-p*s*z+t*r*z)*te,e[11]=(w*r*h-p*S*h-w*s*v+t*S*v+p*s*I-t*r*I)*te,e[12]=G*te,e[13]=(w*k*c-R*S*c+R*s*A-t*k*A-w*s*L+t*S*L)*te,e[14]=(R*r*c-p*k*c-R*s*x+t*k*x+p*s*L-t*r*L)*te,e[15]=(p*S*c-w*r*c+w*s*x-t*S*x-p*s*A+t*r*A)*te,this}scale(e){let t=this.elements,s=e.x,c=e.y,h=e.z;return t[0]*=s,t[4]*=c,t[8]*=h,t[1]*=s,t[5]*=c,t[9]*=h,t[2]*=s,t[6]*=c,t[10]*=h,t[3]*=s,t[7]*=c,t[11]*=h,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],c=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,c))}makeTranslation(e,t,s){return this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let s=Math.cos(t),c=Math.sin(t),h=1-s,p=e.x,r=e.y,x=e.z,v=h*p,w=h*r;return this.set(v*p+s,v*r-c*x,v*x+c*r,0,v*r+c*x,w*r+s,w*x-c*p,0,v*x-c*r,w*x+c*p,h*x*x+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s,c,h,p){return this.set(1,s,h,0,e,1,p,0,t,c,1,0,0,0,0,1),this}compose(e,t,s){let c=this.elements,h=t._x,p=t._y,r=t._z,x=t._w,v=h+h,w=p+p,S=r+r,A=h*v,I=h*w,R=h*S,k=p*w,L=p*S,z=r*S,B=x*v,$=x*w,H=x*S,G=s.x,le=s.y,te=s.z;return c[0]=(1-(k+z))*G,c[1]=(I+H)*G,c[2]=(R-$)*G,c[3]=0,c[4]=(I-H)*le,c[5]=(1-(A+z))*le,c[6]=(L+B)*le,c[7]=0,c[8]=(R+$)*te,c[9]=(L-B)*te,c[10]=(1-(A+k))*te,c[11]=0,c[12]=e.x,c[13]=e.y,c[14]=e.z,c[15]=1,this}decompose(e,t,s){let c=this.elements,h=Mf.set(c[0],c[1],c[2]).length(),p=Mf.set(c[4],c[5],c[6]).length(),r=Mf.set(c[8],c[9],c[10]).length();this.determinant()<0&&(h=-h),e.x=c[12],e.y=c[13],e.z=c[14],Ma.copy(this);let v=1/h,w=1/p,S=1/r;return Ma.elements[0]*=v,Ma.elements[1]*=v,Ma.elements[2]*=v,Ma.elements[4]*=w,Ma.elements[5]*=w,Ma.elements[6]*=w,Ma.elements[8]*=S,Ma.elements[9]*=S,Ma.elements[10]*=S,t.setFromRotationMatrix(Ma),s.x=h,s.y=p,s.z=r,this}makePerspective(e,t,s,c,h,p){p===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let r=this.elements,x=2*h/(t-e),v=2*h/(s-c),w=(t+e)/(t-e),S=(s+c)/(s-c),A=-(p+h)/(p-h),I=-2*p*h/(p-h);return r[0]=x,r[4]=0,r[8]=w,r[12]=0,r[1]=0,r[5]=v,r[9]=S,r[13]=0,r[2]=0,r[6]=0,r[10]=A,r[14]=I,r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}makeOrthographic(e,t,s,c,h,p){let r=this.elements,x=1/(t-e),v=1/(s-c),w=1/(p-h),S=(t+e)*x,A=(s+c)*v,I=(p+h)*w;return r[0]=2*x,r[4]=0,r[8]=0,r[12]=-S,r[1]=0,r[5]=2*v,r[9]=0,r[13]=-A,r[2]=0,r[6]=0,r[10]=-2*w,r[14]=-I,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}equals(e){let t=this.elements,s=e.elements;for(let c=0;c<16;c++)if(t[c]!==s[c])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){let s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}};Jn.prototype.isMatrix4=!0;var Mf=new Be,Ma=new Jn,FN=new Be(0,0,0),BN=new Be(1,1,1),eu=new Be,E0=new Be,Do=new Be,SI=new Jn,AI=new us,Hl=class{constructor(e=0,t=0,s=0,c=Hl.DefaultOrder){this._x=e,this._y=t,this._z=s,this._order=c}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,s,c=this._order){return this._x=e,this._y=t,this._z=s,this._order=c,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,s=!0){let c=e.elements,h=c[0],p=c[4],r=c[8],x=c[1],v=c[5],w=c[9],S=c[2],A=c[6],I=c[10];switch(t){case"XYZ":this._y=Math.asin(as(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-w,I),this._z=Math.atan2(-p,h)):(this._x=Math.atan2(A,v),this._z=0);break;case"YXZ":this._x=Math.asin(-as(w,-1,1)),Math.abs(w)<.9999999?(this._y=Math.atan2(r,I),this._z=Math.atan2(x,v)):(this._y=Math.atan2(-S,h),this._z=0);break;case"ZXY":this._x=Math.asin(as(A,-1,1)),Math.abs(A)<.9999999?(this._y=Math.atan2(-S,I),this._z=Math.atan2(-p,v)):(this._y=0,this._z=Math.atan2(x,h));break;case"ZYX":this._y=Math.asin(-as(S,-1,1)),Math.abs(S)<.9999999?(this._x=Math.atan2(A,I),this._z=Math.atan2(x,h)):(this._x=0,this._z=Math.atan2(-p,v));break;case"YZX":this._z=Math.asin(as(x,-1,1)),Math.abs(x)<.9999999?(this._x=Math.atan2(-w,v),this._y=Math.atan2(-S,h)):(this._x=0,this._y=Math.atan2(r,I));break;case"XZY":this._z=Math.asin(-as(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(A,v),this._y=Math.atan2(r,h)):(this._x=Math.atan2(-w,I),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,s){return SI.makeRotationFromQuaternion(e),this.setFromRotationMatrix(SI,t,s)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return AI.setFromEuler(this),this.setFromQuaternion(AI,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};Hl.prototype.isEuler=!0;Hl.DefaultOrder="XYZ";Hl.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var S0=class{constructor(){this.mask=1|0}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=4294967295|0}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}},UN=0,MI=new Be,If=new us,jl=new Jn,A0=new Be,dg=new Be,VN=new Be,GN=new us,II=new Be(1,0,0),CI=new Be(0,1,0),LI=new Be(0,0,1),HN={type:"added"},DI={type:"removed"},Ki=class extends Sa{constructor(){super();Object.defineProperty(this,"id",{value:UN++}),this.uuid=Ko(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ki.DefaultUp.clone();let e=new Be,t=new Hl,s=new us,c=new Be(1,1,1);function h(){s.setFromEuler(t,!1)}function p(){t.setFromQuaternion(s,void 0,!1)}t._onChange(h),s._onChange(p),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:c},modelViewMatrix:{value:new Jn},normalMatrix:{value:new ls}}),this.matrix=new Jn,this.matrixWorld=new Jn,this.matrixAutoUpdate=Ki.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new S0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return If.setFromAxisAngle(e,t),this.quaternion.multiply(If),this}rotateOnWorldAxis(e,t){return If.setFromAxisAngle(e,t),this.quaternion.premultiply(If),this}rotateX(e){return this.rotateOnAxis(II,e)}rotateY(e){return this.rotateOnAxis(CI,e)}rotateZ(e){return this.rotateOnAxis(LI,e)}translateOnAxis(e,t){return MI.copy(e).applyQuaternion(this.quaternion),this.position.add(MI.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(II,e)}translateY(e){return this.translateOnAxis(CI,e)}translateZ(e){return this.translateOnAxis(LI,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(jl.copy(this.matrixWorld).invert())}lookAt(e,t,s){e.isVector3?A0.copy(e):A0.set(e,t,s);let c=this.parent;this.updateWorldMatrix(!0,!1),dg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?jl.lookAt(dg,A0,this.up):jl.lookAt(A0,dg,this.up),this.quaternion.setFromRotationMatrix(jl),c&&(jl.extractRotation(c.matrixWorld),If.setFromRotationMatrix(jl),this.quaternion.premultiply(If.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(HN)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(DI)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(DI)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),jl.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),jl.multiply(e.parent.matrixWorld)),e.applyMatrix4(jl),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let s=0,c=this.children.length;s<c;s++){let p=this.children[s].getObjectByProperty(e,t);if(p!==void 0)return p}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(dg,e,VN),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(dg,GN,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let s=0,c=t.length;s<c;s++)t[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let s=0,c=t.length;s<c;s++)t[s].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let s=0,c=t.length;s<c;s++)t[s].updateMatrixWorld(e)}updateWorldMatrix(e,t){let s=this.parent;if(e===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let c=this.children;for(let h=0,p=c.length;h<p;h++)c[h].updateWorldMatrix(!1,!0)}}toJSON(e){let t=e===void 0||typeof e=="string",s={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let c={};c.uuid=this.uuid,c.type=this.type,this.name!==""&&(c.name=this.name),this.castShadow===!0&&(c.castShadow=!0),this.receiveShadow===!0&&(c.receiveShadow=!0),this.visible===!1&&(c.visible=!1),this.frustumCulled===!1&&(c.frustumCulled=!1),this.renderOrder!==0&&(c.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(c.userData=this.userData),c.layers=this.layers.mask,c.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(c.matrixAutoUpdate=!1),this.isInstancedMesh&&(c.type="InstancedMesh",c.count=this.count,c.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(c.instanceColor=this.instanceColor.toJSON()));function h(r,x){return r[x.uuid]===void 0&&(r[x.uuid]=x.toJSON(e)),x.uuid}if(this.isScene)this.background&&(this.background.isColor?c.background=this.background.toJSON():this.background.isTexture&&(c.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(c.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){c.geometry=h(e.geometries,this.geometry);let r=this.geometry.parameters;if(r!==void 0&&r.shapes!==void 0){let x=r.shapes;if(Array.isArray(x))for(let v=0,w=x.length;v<w;v++){let S=x[v];h(e.shapes,S)}else h(e.shapes,x)}}if(this.isSkinnedMesh&&(c.bindMode=this.bindMode,c.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(h(e.skeletons,this.skeleton),c.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let r=[];for(let x=0,v=this.material.length;x<v;x++)r.push(h(e.materials,this.material[x]));c.material=r}else c.material=h(e.materials,this.material);if(this.children.length>0){c.children=[];for(let r=0;r<this.children.length;r++)c.children.push(this.children[r].toJSON(e).object)}if(this.animations.length>0){c.animations=[];for(let r=0;r<this.animations.length;r++){let x=this.animations[r];c.animations.push(h(e.animations,x))}}if(t){let r=p(e.geometries),x=p(e.materials),v=p(e.textures),w=p(e.images),S=p(e.shapes),A=p(e.skeletons),I=p(e.animations),R=p(e.nodes);r.length>0&&(s.geometries=r),x.length>0&&(s.materials=x),v.length>0&&(s.textures=v),w.length>0&&(s.images=w),S.length>0&&(s.shapes=S),A.length>0&&(s.skeletons=A),I.length>0&&(s.animations=I),R.length>0&&(s.nodes=R)}return s.object=c,s;function p(r){let x=[];for(let v in r){let w=r[v];delete w.metadata,x.push(w)}return x}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let s=0;s<e.children.length;s++){let c=e.children[s];this.add(c.clone())}return this}};Ki.DefaultUp=new Be(0,1,0);Ki.DefaultMatrixAutoUpdate=!0;Ki.prototype.isObject3D=!0;var Ia=new Be,Wl=new Be,tw=new Be,ql=new Be,Cf=new Be,Lf=new Be,RI=new Be,nw=new Be,iw=new Be,rw=new Be,Gr=class{constructor(e=new Be,t=new Be,s=new Be){this.a=e,this.b=t,this.c=s}static getNormal(e,t,s,c){c.subVectors(s,t),Ia.subVectors(e,t),c.cross(Ia);let h=c.lengthSq();return h>0?c.multiplyScalar(1/Math.sqrt(h)):c.set(0,0,0)}static getBarycoord(e,t,s,c,h){Ia.subVectors(c,t),Wl.subVectors(s,t),tw.subVectors(e,t);let p=Ia.dot(Ia),r=Ia.dot(Wl),x=Ia.dot(tw),v=Wl.dot(Wl),w=Wl.dot(tw),S=p*v-r*r;if(S===0)return h.set(-2,-1,-1);let A=1/S,I=(v*x-r*w)*A,R=(p*w-r*x)*A;return h.set(1-I-R,R,I)}static containsPoint(e,t,s,c){return this.getBarycoord(e,t,s,c,ql),ql.x>=0&&ql.y>=0&&ql.x+ql.y<=1}static getUV(e,t,s,c,h,p,r,x){return this.getBarycoord(e,t,s,c,ql),x.set(0,0),x.addScaledVector(h,ql.x),x.addScaledVector(p,ql.y),x.addScaledVector(r,ql.z),x}static isFrontFacing(e,t,s,c){return Ia.subVectors(s,t),Wl.subVectors(e,t),Ia.cross(Wl).dot(c)<0}set(e,t,s){return this.a.copy(e),this.b.copy(t),this.c.copy(s),this}setFromPointsAndIndices(e,t,s,c){return this.a.copy(e[t]),this.b.copy(e[s]),this.c.copy(e[c]),this}setFromAttributeAndIndices(e,t,s,c){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,s),this.c.fromBufferAttribute(e,c),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ia.subVectors(this.c,this.b),Wl.subVectors(this.a,this.b),Ia.cross(Wl).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Gr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Gr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,s,c,h){return Gr.getUV(e,this.a,this.b,this.c,t,s,c,h)}containsPoint(e){return Gr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Gr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let s=this.a,c=this.b,h=this.c,p,r;Cf.subVectors(c,s),Lf.subVectors(h,s),nw.subVectors(e,s);let x=Cf.dot(nw),v=Lf.dot(nw);if(x<=0&&v<=0)return t.copy(s);iw.subVectors(e,c);let w=Cf.dot(iw),S=Lf.dot(iw);if(w>=0&&S<=w)return t.copy(c);let A=x*S-w*v;if(A<=0&&x>=0&&w<=0)return p=x/(x-w),t.copy(s).addScaledVector(Cf,p);rw.subVectors(e,h);let I=Cf.dot(rw),R=Lf.dot(rw);if(R>=0&&I<=R)return t.copy(h);let k=I*v-x*R;if(k<=0&&v>=0&&R<=0)return r=v/(v-R),t.copy(s).addScaledVector(Lf,r);let L=w*R-I*S;if(L<=0&&S-w>=0&&I-R>=0)return RI.subVectors(h,c),r=(S-w)/(S-w+(I-R)),t.copy(c).addScaledVector(RI,r);let z=1/(L+k+A);return p=k*z,r=A*z,t.copy(s).addScaledVector(Cf,p).addScaledVector(Lf,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},jN=0,Zr=class extends Sa{constructor(){super();Object.defineProperty(this,"id",{value:jN++}),this.uuid=Ko(),this.name="",this.type="Material",this.fog=!0,this.blending=Eh,this.side=yf,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=fb,this.blendDst=pb,this.blendEquation=Sh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=t0,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=vI,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=h0,this.stencilZFail=h0,this.stencilZPass=h0,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let s=e[t];if(s===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=s===ab;continue}let c=this[t];if(c===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}c&&c.isColor?c.set(s):c&&c.isVector3&&s&&s.isVector3?c.copy(s):this[t]=s}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let s={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(e).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(e).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(e).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(e).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(e).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==Eh&&(s.blending=this.blending),this.side!==yf&&(s.side=this.side),this.vertexColors&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=this.transparent),s.depthFunc=this.depthFunc,s.depthTest=this.depthTest,s.depthWrite=this.depthWrite,s.colorWrite=this.colorWrite,s.stencilWrite=this.stencilWrite,s.stencilWriteMask=this.stencilWriteMask,s.stencilFunc=this.stencilFunc,s.stencilRef=this.stencilRef,s.stencilFuncMask=this.stencilFuncMask,s.stencilFail=this.stencilFail,s.stencilZFail=this.stencilZFail,s.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(s.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(s.wireframe=this.wireframe),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=this.flatShading),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData);function c(h){let p=[];for(let r in h){let x=h[r];delete x.metadata,p.push(x)}return p}if(t){let h=c(e.textures),p=c(e.images);h.length>0&&(s.textures=h),p.length>0&&(s.images=p)}return s}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,s=null;if(t!==null){let c=t.length;s=new Array(c);for(let h=0;h!==c;++h)s[h]=t[h].clone()}return this.clippingPlanes=s,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};Zr.prototype.isMaterial=!0;Zr.fromType=function(){return null};var Xl=class extends Zr{constructor(e){super();this.type="MeshBasicMaterial",this.color=new jn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$m,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};Xl.prototype.isMeshBasicMaterial=!0;var es=new Be,M0=new Wt,xr=class{constructor(e,t,s){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=s===!0,this.usage=xf,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,s){e*=this.itemSize,s*=t.itemSize;for(let c=0,h=this.itemSize;c<h;c++)this.array[e+c]=t.array[s+c];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let t=this.array,s=0;for(let c=0,h=e.length;c<h;c++){let p=e[c];p===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",c),p=new jn),t[s++]=p.r,t[s++]=p.g,t[s++]=p.b}return this}copyVector2sArray(e){let t=this.array,s=0;for(let c=0,h=e.length;c<h;c++){let p=e[c];p===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",c),p=new Wt),t[s++]=p.x,t[s++]=p.y}return this}copyVector3sArray(e){let t=this.array,s=0;for(let c=0,h=e.length;c<h;c++){let p=e[c];p===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",c),p=new Be),t[s++]=p.x,t[s++]=p.y,t[s++]=p.z}return this}copyVector4sArray(e){let t=this.array,s=0;for(let c=0,h=e.length;c<h;c++){let p=e[c];p===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",c),p=new Ui),t[s++]=p.x,t[s++]=p.y,t[s++]=p.z,t[s++]=p.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,s=this.count;t<s;t++)M0.fromBufferAttribute(this,t),M0.applyMatrix3(e),this.setXY(t,M0.x,M0.y);else if(this.itemSize===3)for(let t=0,s=this.count;t<s;t++)es.fromBufferAttribute(this,t),es.applyMatrix3(e),this.setXYZ(t,es.x,es.y,es.z);return this}applyMatrix4(e){for(let t=0,s=this.count;t<s;t++)es.fromBufferAttribute(this,t),es.applyMatrix4(e),this.setXYZ(t,es.x,es.y,es.z);return this}applyNormalMatrix(e){for(let t=0,s=this.count;t<s;t++)es.fromBufferAttribute(this,t),es.applyNormalMatrix(e),this.setXYZ(t,es.x,es.y,es.z);return this}transformDirection(e){for(let t=0,s=this.count;t<s;t++)es.fromBufferAttribute(this,t),es.transformDirection(e),this.setXYZ(t,es.x,es.y,es.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=s,this}setXYZ(e,t,s,c){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=s,this.array[e+2]=c,this}setXYZW(e,t,s,c,h){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=s,this.array[e+2]=c,this.array[e+3]=h,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==xf&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}};xr.prototype.isBufferAttribute=!0;var I0=class extends xr{constructor(e,t,s){super(new Uint16Array(e),t,s)}};var C0=class extends xr{constructor(e,t,s){super(new Uint32Array(e),t,s)}},sw=class extends xr{constructor(e,t,s){super(new Uint16Array(e),t,s)}};sw.prototype.isFloat16BufferAttribute=!0;var br=class extends xr{constructor(e,t,s){super(new Float32Array(e),t,s)}};var WN=0,$o=new Jn,ow=new Ki,Df=new Be,Ro=new Ts,fg=new Ts,Es=new Be,er=class extends Sa{constructor(){super();Object.defineProperty(this,"id",{value:WN++}),this.uuid=Ko(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:Infinity},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(bI(e)?C0:I0)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,s=0){this.groups.push({start:e,count:t,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let s=this.attributes.normal;if(s!==void 0){let h=new ls().getNormalMatrix(e);s.applyNormalMatrix(h),s.needsUpdate=!0}let c=this.attributes.tangent;return c!==void 0&&(c.transformDirection(e),c.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return $o.makeRotationFromQuaternion(e),this.applyMatrix4($o),this}rotateX(e){return $o.makeRotationX(e),this.applyMatrix4($o),this}rotateY(e){return $o.makeRotationY(e),this.applyMatrix4($o),this}rotateZ(e){return $o.makeRotationZ(e),this.applyMatrix4($o),this}translate(e,t,s){return $o.makeTranslation(e,t,s),this.applyMatrix4($o),this}scale(e,t,s){return $o.makeScale(e,t,s),this.applyMatrix4($o),this}lookAt(e){return ow.lookAt(e),ow.updateMatrix(),this.applyMatrix4(ow.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Df).negate(),this.translate(Df.x,Df.y,Df.z),this}setFromPoints(e){let t=[];for(let s=0,c=e.length;s<c;s++){let h=e[s];t.push(h.x,h.y,h.z||0)}return this.setAttribute("position",new br(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ts);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Be(-Infinity,-Infinity,-Infinity),new Be(Infinity,Infinity,Infinity));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let s=0,c=t.length;s<c;s++){let h=t[s];Ro.setFromBufferAttribute(h),this.morphTargetsRelative?(Es.addVectors(this.boundingBox.min,Ro.min),this.boundingBox.expandByPoint(Es),Es.addVectors(this.boundingBox.max,Ro.max),this.boundingBox.expandByPoint(Es)):(this.boundingBox.expandByPoint(Ro.min),this.boundingBox.expandByPoint(Ro.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Jo);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Be,Infinity);return}if(e){let s=this.boundingSphere.center;if(Ro.setFromBufferAttribute(e),t)for(let h=0,p=t.length;h<p;h++){let r=t[h];fg.setFromBufferAttribute(r),this.morphTargetsRelative?(Es.addVectors(Ro.min,fg.min),Ro.expandByPoint(Es),Es.addVectors(Ro.max,fg.max),Ro.expandByPoint(Es)):(Ro.expandByPoint(fg.min),Ro.expandByPoint(fg.max))}Ro.getCenter(s);let c=0;for(let h=0,p=e.count;h<p;h++)Es.fromBufferAttribute(e,h),c=Math.max(c,s.distanceToSquared(Es));if(t)for(let h=0,p=t.length;h<p;h++){let r=t[h],x=this.morphTargetsRelative;for(let v=0,w=r.count;v<w;v++)Es.fromBufferAttribute(r,v),x&&(Df.fromBufferAttribute(e,v),Es.add(Df)),c=Math.max(c,s.distanceToSquared(Es))}this.boundingSphere.radius=Math.sqrt(c),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let s=e.array,c=t.position.array,h=t.normal.array,p=t.uv.array,r=c.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new xr(new Float32Array(4*r),4));let x=this.getAttribute("tangent").array,v=[],w=[];for(let se=0;se<r;se++)v[se]=new Be,w[se]=new Be;let S=new Be,A=new Be,I=new Be,R=new Wt,k=new Wt,L=new Wt,z=new Be,B=new Be;function $(se,Y,ye){S.fromArray(c,se*3),A.fromArray(c,Y*3),I.fromArray(c,ye*3),R.fromArray(p,se*2),k.fromArray(p,Y*2),L.fromArray(p,ye*2),A.sub(S),I.sub(S),k.sub(R),L.sub(R);let Xe=1/(k.x*L.y-L.x*k.y);!isFinite(Xe)||(z.copy(A).multiplyScalar(L.y).addScaledVector(I,-k.y).multiplyScalar(Xe),B.copy(I).multiplyScalar(k.x).addScaledVector(A,-L.x).multiplyScalar(Xe),v[se].add(z),v[Y].add(z),v[ye].add(z),w[se].add(B),w[Y].add(B),w[ye].add(B))}let H=this.groups;H.length===0&&(H=[{start:0,count:s.length}]);for(let se=0,Y=H.length;se<Y;++se){let ye=H[se],Xe=ye.start,ge=ye.count;for(let re=Xe,ve=Xe+ge;re<ve;re+=3)$(s[re+0],s[re+1],s[re+2])}let G=new Be,le=new Be,te=new Be,ue=new Be;function me(se){te.fromArray(h,se*3),ue.copy(te);let Y=v[se];G.copy(Y),G.sub(te.multiplyScalar(te.dot(Y))).normalize(),le.crossVectors(ue,Y);let Xe=le.dot(w[se])<0?-1:1;x[se*4]=G.x,x[se*4+1]=G.y,x[se*4+2]=G.z,x[se*4+3]=Xe}for(let se=0,Y=H.length;se<Y;++se){let ye=H[se],Xe=ye.start,ge=ye.count;for(let re=Xe,ve=Xe+ge;re<ve;re+=3)me(s[re+0]),me(s[re+1]),me(s[re+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new xr(new Float32Array(t.count*3),3),this.setAttribute("normal",s);else for(let A=0,I=s.count;A<I;A++)s.setXYZ(A,0,0,0);let c=new Be,h=new Be,p=new Be,r=new Be,x=new Be,v=new Be,w=new Be,S=new Be;if(e)for(let A=0,I=e.count;A<I;A+=3){let R=e.getX(A+0),k=e.getX(A+1),L=e.getX(A+2);c.fromBufferAttribute(t,R),h.fromBufferAttribute(t,k),p.fromBufferAttribute(t,L),w.subVectors(p,h),S.subVectors(c,h),w.cross(S),r.fromBufferAttribute(s,R),x.fromBufferAttribute(s,k),v.fromBufferAttribute(s,L),r.add(w),x.add(w),v.add(w),s.setXYZ(R,r.x,r.y,r.z),s.setXYZ(k,x.x,x.y,x.z),s.setXYZ(L,v.x,v.y,v.z)}else for(let A=0,I=t.count;A<I;A+=3)c.fromBufferAttribute(t,A+0),h.fromBufferAttribute(t,A+1),p.fromBufferAttribute(t,A+2),w.subVectors(p,h),S.subVectors(c,h),w.cross(S),s.setXYZ(A+0,w.x,w.y,w.z),s.setXYZ(A+1,w.x,w.y,w.z),s.setXYZ(A+2,w.x,w.y,w.z);this.normalizeNormals(),s.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let s=this.attributes;for(let c in s){if(e.attributes[c]===void 0)continue;let p=s[c].array,r=e.attributes[c],x=r.array,v=r.itemSize*t,w=Math.min(x.length,p.length-v);for(let S=0,A=v;S<w;S++,A++)p[A]=x[S]}return this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,s=e.count;t<s;t++)Es.fromBufferAttribute(e,t),Es.normalize(),e.setXYZ(t,Es.x,Es.y,Es.z)}toNonIndexed(){function e(r,x){let v=r.array,w=r.itemSize,S=r.normalized,A=new v.constructor(x.length*w),I=0,R=0;for(let k=0,L=x.length;k<L;k++){r.isInterleavedBufferAttribute?I=x[k]*r.data.stride+r.offset:I=x[k]*w;for(let z=0;z<w;z++)A[R++]=v[I++]}return new xr(A,w,S)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new er,s=this.index.array,c=this.attributes;for(let r in c){let x=c[r],v=e(x,s);t.setAttribute(r,v)}let h=this.morphAttributes;for(let r in h){let x=[],v=h[r];for(let w=0,S=v.length;w<S;w++){let A=v[w],I=e(A,s);x.push(I)}t.morphAttributes[r]=x}t.morphTargetsRelative=this.morphTargetsRelative;let p=this.groups;for(let r=0,x=p.length;r<x;r++){let v=p[r];t.addGroup(v.start,v.count,v.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let x=this.parameters;for(let v in x)x[v]!==void 0&&(e[v]=x[v]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let s=this.attributes;for(let x in s){let v=s[x];e.data.attributes[x]=v.toJSON(e.data)}let c={},h=!1;for(let x in this.morphAttributes){let v=this.morphAttributes[x],w=[];for(let S=0,A=v.length;S<A;S++){let I=v[S];w.push(I.toJSON(e.data))}w.length>0&&(c[x]=w,h=!0)}h&&(e.data.morphAttributes=c,e.data.morphTargetsRelative=this.morphTargetsRelative);let p=this.groups;p.length>0&&(e.data.groups=JSON.parse(JSON.stringify(p)));let r=this.boundingSphere;return r!==null&&(e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let s=e.index;s!==null&&this.setIndex(s.clone(t));let c=e.attributes;for(let v in c){let w=c[v];this.setAttribute(v,w.clone(t))}let h=e.morphAttributes;for(let v in h){let w=[],S=h[v];for(let A=0,I=S.length;A<I;A++)w.push(S[A].clone(t));this.morphAttributes[v]=w}this.morphTargetsRelative=e.morphTargetsRelative;let p=e.groups;for(let v=0,w=p.length;v<w;v++){let S=p[v];this.addGroup(S.start,S.count,S.materialIndex)}let r=e.boundingBox;r!==null&&(this.boundingBox=r.clone());let x=e.boundingSphere;return x!==null&&(this.boundingSphere=x.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}};er.prototype.isBufferGeometry=!0;var PI=new Jn,Rf=new Qc,aw=new Jo,tu=new Be,nu=new Be,iu=new Be,lw=new Be,cw=new Be,uw=new Be,L0=new Be,D0=new Be,R0=new Be,P0=new Wt,k0=new Wt,z0=new Wt,hw=new Be,O0=new Be,Hr=class extends Ki{constructor(e=new er,t=new Xl){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,s=Object.keys(t);if(s.length>0){let c=t[s[0]];if(c!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let h=0,p=c.length;h<p;h++){let r=c[h].name||String(h);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=h}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){let s=this.geometry,c=this.material,h=this.matrixWorld;if(c===void 0||(s.boundingSphere===null&&s.computeBoundingSphere(),aw.copy(s.boundingSphere),aw.applyMatrix4(h),e.ray.intersectsSphere(aw)===!1)||(PI.copy(h).invert(),Rf.copy(e.ray).applyMatrix4(PI),s.boundingBox!==null&&Rf.intersectsBox(s.boundingBox)===!1))return;let p;if(s.isBufferGeometry){let r=s.index,x=s.attributes.position,v=s.morphAttributes.position,w=s.morphTargetsRelative,S=s.attributes.uv,A=s.attributes.uv2,I=s.groups,R=s.drawRange;if(r!==null)if(Array.isArray(c))for(let k=0,L=I.length;k<L;k++){let z=I[k],B=c[z.materialIndex],$=Math.max(z.start,R.start),H=Math.min(r.count,Math.min(z.start+z.count,R.start+R.count));for(let G=$,le=H;G<le;G+=3){let te=r.getX(G),ue=r.getX(G+1),me=r.getX(G+2);p=N0(this,B,e,Rf,x,v,w,S,A,te,ue,me),p&&(p.faceIndex=Math.floor(G/3),p.face.materialIndex=z.materialIndex,t.push(p))}}else{let k=Math.max(0,R.start),L=Math.min(r.count,R.start+R.count);for(let z=k,B=L;z<B;z+=3){let $=r.getX(z),H=r.getX(z+1),G=r.getX(z+2);p=N0(this,c,e,Rf,x,v,w,S,A,$,H,G),p&&(p.faceIndex=Math.floor(z/3),t.push(p))}}else if(x!==void 0)if(Array.isArray(c))for(let k=0,L=I.length;k<L;k++){let z=I[k],B=c[z.materialIndex],$=Math.max(z.start,R.start),H=Math.min(x.count,Math.min(z.start+z.count,R.start+R.count));for(let G=$,le=H;G<le;G+=3){let te=G,ue=G+1,me=G+2;p=N0(this,B,e,Rf,x,v,w,S,A,te,ue,me),p&&(p.faceIndex=Math.floor(G/3),p.face.materialIndex=z.materialIndex,t.push(p))}}else{let k=Math.max(0,R.start),L=Math.min(x.count,R.start+R.count);for(let z=k,B=L;z<B;z+=3){let $=z,H=z+1,G=z+2;p=N0(this,c,e,Rf,x,v,w,S,A,$,H,G),p&&(p.faceIndex=Math.floor(z/3),t.push(p))}}}else s.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};Hr.prototype.isMesh=!0;function qN(i,e,t,s,c,h,p,r){let x;if(e.side===To?x=s.intersectTriangle(p,h,c,!0,r):x=s.intersectTriangle(c,h,p,e.side!==el,r),x===null)return null;O0.copy(r),O0.applyMatrix4(i.matrixWorld);let v=t.ray.origin.distanceTo(O0);return v<t.near||v>t.far?null:{distance:v,point:O0.clone(),object:i}}function N0(i,e,t,s,c,h,p,r,x,v,w,S){tu.fromBufferAttribute(c,v),nu.fromBufferAttribute(c,w),iu.fromBufferAttribute(c,S);let A=i.morphTargetInfluences;if(h&&A){L0.set(0,0,0),D0.set(0,0,0),R0.set(0,0,0);for(let R=0,k=h.length;R<k;R++){let L=A[R],z=h[R];L!==0&&(lw.fromBufferAttribute(z,v),cw.fromBufferAttribute(z,w),uw.fromBufferAttribute(z,S),p?(L0.addScaledVector(lw,L),D0.addScaledVector(cw,L),R0.addScaledVector(uw,L)):(L0.addScaledVector(lw.sub(tu),L),D0.addScaledVector(cw.sub(nu),L),R0.addScaledVector(uw.sub(iu),L)))}tu.add(L0),nu.add(D0),iu.add(R0)}i.isSkinnedMesh&&(i.boneTransform(v,tu),i.boneTransform(w,nu),i.boneTransform(S,iu));let I=qN(i,e,t,s,tu,nu,iu,hw);if(I){r&&(P0.fromBufferAttribute(r,v),k0.fromBufferAttribute(r,w),z0.fromBufferAttribute(r,S),I.uv=Gr.getUV(hw,tu,nu,iu,P0,k0,z0,new Wt)),x&&(P0.fromBufferAttribute(x,v),k0.fromBufferAttribute(x,w),z0.fromBufferAttribute(x,S),I.uv2=Gr.getUV(hw,tu,nu,iu,P0,k0,z0,new Wt));let R={a:v,b:w,c:S,normal:new Be,materialIndex:0};Gr.getNormal(tu,nu,iu,R.normal),I.face=R}return I}var rl=class extends er{constructor(e=1,t=1,s=1,c=1,h=1,p=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:s,widthSegments:c,heightSegments:h,depthSegments:p};let r=this;c=Math.floor(c),h=Math.floor(h),p=Math.floor(p);let x=[],v=[],w=[],S=[],A=0,I=0;R("z","y","x",-1,-1,s,t,e,p,h,0),R("z","y","x",1,-1,s,t,-e,p,h,1),R("x","z","y",1,1,e,s,t,c,p,2),R("x","z","y",1,-1,e,s,-t,c,p,3),R("x","y","z",1,-1,e,t,s,c,h,4),R("x","y","z",-1,-1,e,t,-s,c,h,5),this.setIndex(x),this.setAttribute("position",new br(v,3)),this.setAttribute("normal",new br(w,3)),this.setAttribute("uv",new br(S,2));function R(k,L,z,B,$,H,G,le,te,ue,me){let se=H/te,Y=G/ue,ye=H/2,Xe=G/2,ge=le/2,re=te+1,ve=ue+1,ae=0,de=0,xe=new Be;for(let De=0;De<ve;De++){let Ce=De*Y-Xe;for(let pe=0;pe<re;pe++){let xt=pe*se-ye;xe[k]=xt*B,xe[L]=Ce*$,xe[z]=ge,v.push(xe.x,xe.y,xe.z),xe[k]=0,xe[L]=0,xe[z]=le>0?1:-1,w.push(xe.x,xe.y,xe.z),S.push(pe/te),S.push(1-De/ue),ae+=1}}for(let De=0;De<ue;De++)for(let Ce=0;Ce<te;Ce++){let pe=A+Ce+re*De,xt=A+Ce+re*(De+1),Ct=A+(Ce+1)+re*(De+1),ct=A+(Ce+1)+re*De;x.push(pe,xt,ct),x.push(xt,Ct,ct),de+=6}r.addGroup(I,de,me),I+=de,A+=ae}}static fromJSON(e){return new rl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Pf(i){let e={};for(let t in i){e[t]={};for(let s in i[t]){let c=i[t][s];c&&(c.isColor||c.isMatrix3||c.isMatrix4||c.isVector2||c.isVector3||c.isVector4||c.isTexture||c.isQuaternion)?e[t][s]=c.clone():Array.isArray(c)?e[t][s]=c.slice():e[t][s]=c}}return e}function Hs(i){let e={};for(let t=0;t<i.length;t++){let s=Pf(i[t]);for(let c in s)e[c]=s[c]}return e}var pg={clone:Pf,merge:Hs},XN=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ZN=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,eo=class extends Zr{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=XN,this.fragmentShader=ZN,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Pf(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let c in this.uniforms){let p=this.uniforms[c].value;p&&p.isTexture?t.uniforms[c]={type:"t",value:p.toJSON(e).uuid}:p&&p.isColor?t.uniforms[c]={type:"c",value:p.getHex()}:p&&p.isVector2?t.uniforms[c]={type:"v2",value:p.toArray()}:p&&p.isVector3?t.uniforms[c]={type:"v3",value:p.toArray()}:p&&p.isVector4?t.uniforms[c]={type:"v4",value:p.toArray()}:p&&p.isMatrix3?t.uniforms[c]={type:"m3",value:p.toArray()}:p&&p.isMatrix4?t.uniforms[c]={type:"m4",value:p.toArray()}:t.uniforms[c]={value:p}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let s={};for(let c in this.extensions)this.extensions[c]===!0&&(s[c]=!0);return Object.keys(s).length>0&&(t.extensions=s),t}};eo.prototype.isShaderMaterial=!0;var mg=class extends Ki{constructor(){super();this.type="Camera",this.matrixWorldInverse=new Jn,this.projectionMatrix=new Jn,this.projectionMatrixInverse=new Jn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};mg.prototype.isCamera=!0;var Ss=class extends mg{constructor(e=50,t=1,s=.1,c=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=s,this.far=c,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=lg*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(ag*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return lg*2*Math.atan(Math.tan(ag*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,s,c,h,p){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=c,this.view.width=h,this.view.height=p,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(ag*.5*this.fov)/this.zoom,s=2*t,c=this.aspect*s,h=-.5*c,p=this.view;if(this.view!==null&&this.view.enabled){let x=p.fullWidth,v=p.fullHeight;h+=p.offsetX*c/x,t-=p.offsetY*s/v,c*=p.width/x,s*=p.height/v}let r=this.filmOffset;r!==0&&(h+=e*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(h,h+c,t,t-s,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};Ss.prototype.isPerspectiveCamera=!0;var kf=90,zf=1,gg=class extends Ki{constructor(e,t,s){super();if(this.type="CubeCamera",s.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=s;let c=new Ss(kf,zf,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Be(1,0,0)),this.add(c);let h=new Ss(kf,zf,e,t);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new Be(-1,0,0)),this.add(h);let p=new Ss(kf,zf,e,t);p.layers=this.layers,p.up.set(0,0,1),p.lookAt(new Be(0,1,0)),this.add(p);let r=new Ss(kf,zf,e,t);r.layers=this.layers,r.up.set(0,0,-1),r.lookAt(new Be(0,-1,0)),this.add(r);let x=new Ss(kf,zf,e,t);x.layers=this.layers,x.up.set(0,-1,0),x.lookAt(new Be(0,0,1)),this.add(x);let v=new Ss(kf,zf,e,t);v.layers=this.layers,v.up.set(0,-1,0),v.lookAt(new Be(0,0,-1)),this.add(v)}update(e,t){this.parent===null&&this.updateMatrixWorld();let s=this.renderTarget,[c,h,p,r,x,v]=this.children,w=e.getRenderTarget(),S=e.outputEncoding,A=e.toneMapping,I=e.xr.enabled;e.outputEncoding=nl,e.toneMapping=tl,e.xr.enabled=!1;let R=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,e.setRenderTarget(s,0),e.render(t,c),e.setRenderTarget(s,1),e.render(t,h),e.setRenderTarget(s,2),e.render(t,p),e.setRenderTarget(s,3),e.render(t,r),e.setRenderTarget(s,4),e.render(t,x),s.texture.generateMipmaps=R,e.setRenderTarget(s,5),e.render(t,v),e.setRenderTarget(w),e.outputEncoding=S,e.toneMapping=A,e.xr.enabled=I,s.texture.needsPMREMUpdate=!0}},Of=class extends Qr{constructor(e,t,s,c,h,p,r,x,v,w){e=e!==void 0?e:[],t=t!==void 0?t:Ah,super(e,t,s,c,h,p,r,x,v,w),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};Of.prototype.isCubeTexture=!0;var F0=class extends Qs{constructor(e,t={}){super(e,e,t);let s={width:e,height:e,depth:1},c=[s,s,s,s,s,s];this.texture=new Of(c,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:bs}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},c=new rl(5,5,5),h=new eo({name:"CubemapFromEquirect",uniforms:Pf(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:To,blending:Bl});h.uniforms.tEquirect.value=t;let p=new Hr(c,h),r=t.minFilter;return t.minFilter===eg&&(t.minFilter=bs),new gg(1,10,this).update(e,p),t.minFilter=r,p.geometry.dispose(),p.material.dispose(),this}clear(e,t,s,c){let h=e.getRenderTarget();for(let p=0;p<6;p++)e.setRenderTarget(this,p),e.clear(t,s,c);e.setRenderTarget(h)}};F0.prototype.isWebGLCubeRenderTarget=!0;var dw=new Be,KN=new Be,YN=new ls,Ca=class{constructor(e=new Be(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,s,c){return this.normal.set(e,t,s),this.constant=c,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,s){let c=dw.subVectors(s,t).cross(KN.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(c,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let s=e.delta(dw),c=this.normal.dot(s);if(c===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let h=-(e.start.dot(this.normal)+this.constant)/c;return h<0||h>1?null:t.copy(s).multiplyScalar(h).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),s=this.distanceToPoint(e.end);return t<0&&s>0||s<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let s=t||YN.getNormalMatrix(e),c=this.coplanarPoint(dw).applyMatrix4(e),h=this.normal.applyMatrix3(s).normalize();return this.constant=-c.dot(h),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};Ca.prototype.isPlane=!0;var Nf=new Jo,B0=new Be,Ff=class{constructor(e=new Ca,t=new Ca,s=new Ca,c=new Ca,h=new Ca,p=new Ca){this.planes=[e,t,s,c,h,p]}set(e,t,s,c,h,p){let r=this.planes;return r[0].copy(e),r[1].copy(t),r[2].copy(s),r[3].copy(c),r[4].copy(h),r[5].copy(p),this}copy(e){let t=this.planes;for(let s=0;s<6;s++)t[s].copy(e.planes[s]);return this}setFromProjectionMatrix(e){let t=this.planes,s=e.elements,c=s[0],h=s[1],p=s[2],r=s[3],x=s[4],v=s[5],w=s[6],S=s[7],A=s[8],I=s[9],R=s[10],k=s[11],L=s[12],z=s[13],B=s[14],$=s[15];return t[0].setComponents(r-c,S-x,k-A,$-L).normalize(),t[1].setComponents(r+c,S+x,k+A,$+L).normalize(),t[2].setComponents(r+h,S+v,k+I,$+z).normalize(),t[3].setComponents(r-h,S-v,k-I,$-z).normalize(),t[4].setComponents(r-p,S-w,k-R,$-B).normalize(),t[5].setComponents(r+p,S+w,k+R,$+B).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Nf.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Nf)}intersectsSprite(e){return Nf.center.set(0,0,0),Nf.radius=.7071067811865476,Nf.applyMatrix4(e.matrixWorld),this.intersectsSphere(Nf)}intersectsSphere(e){let t=this.planes,s=e.center,c=-e.radius;for(let h=0;h<6;h++)if(t[h].distanceToPoint(s)<c)return!1;return!0}intersectsBox(e){let t=this.planes;for(let s=0;s<6;s++){let c=t[s];if(B0.x=c.normal.x>0?e.max.x:e.min.x,B0.y=c.normal.y>0?e.max.y:e.min.y,B0.z=c.normal.z>0?e.max.z:e.min.z,c.distanceToPoint(B0)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let s=0;s<6;s++)if(t[s].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function kI(){let i=null,e=!1,t=null,s=null;function c(h,p){t(h,p),s=i.requestAnimationFrame(c)}return{start:function(){e!==!0&&t!==null&&(s=i.requestAnimationFrame(c),e=!0)},stop:function(){i.cancelAnimationFrame(s),e=!1},setAnimationLoop:function(h){t=h},setContext:function(h){i=h}}}function JN(i,e){let t=e.isWebGL2,s=new WeakMap;function c(v,w){let S=v.array,A=v.usage,I=i.createBuffer();i.bindBuffer(w,I),i.bufferData(w,S,A),v.onUploadCallback();let R;if(S instanceof Float32Array)R=5126;else if(S instanceof Uint16Array)if(v.isFloat16BufferAttribute)if(t)R=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else R=5123;else if(S instanceof Int16Array)R=5122;else if(S instanceof Uint32Array)R=5125;else if(S instanceof Int32Array)R=5124;else if(S instanceof Int8Array)R=5120;else if(S instanceof Uint8Array)R=5121;else if(S instanceof Uint8ClampedArray)R=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+S);return{buffer:I,type:R,bytesPerElement:S.BYTES_PER_ELEMENT,version:v.version}}function h(v,w,S){let A=w.array,I=w.updateRange;i.bindBuffer(S,v),I.count===-1?i.bufferSubData(S,0,A):(t?i.bufferSubData(S,I.offset*A.BYTES_PER_ELEMENT,A,I.offset,I.count):i.bufferSubData(S,I.offset*A.BYTES_PER_ELEMENT,A.subarray(I.offset,I.offset+I.count)),I.count=-1)}function p(v){return v.isInterleavedBufferAttribute&&(v=v.data),s.get(v)}function r(v){v.isInterleavedBufferAttribute&&(v=v.data);let w=s.get(v);w&&(i.deleteBuffer(w.buffer),s.delete(v))}function x(v,w){if(v.isGLBufferAttribute){let A=s.get(v);(!A||A.version<v.version)&&s.set(v,{buffer:v.buffer,type:v.type,bytesPerElement:v.elementSize,version:v.version});return}v.isInterleavedBufferAttribute&&(v=v.data);let S=s.get(v);S===void 0?s.set(v,c(v,w)):S.version<v.version&&(h(S.buffer,v,w),S.version=v.version)}return{get:p,remove:r,update:x}}var Bf=class extends er{constructor(e=1,t=1,s=1,c=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:s,heightSegments:c};let h=e/2,p=t/2,r=Math.floor(s),x=Math.floor(c),v=r+1,w=x+1,S=e/r,A=t/x,I=[],R=[],k=[],L=[];for(let z=0;z<w;z++){let B=z*A-p;for(let $=0;$<v;$++){let H=$*S-h;R.push(H,-B,0),k.push(0,0,1),L.push($/r),L.push(1-z/x)}}for(let z=0;z<x;z++)for(let B=0;B<r;B++){let $=B+v*z,H=B+v*(z+1),G=B+1+v*(z+1),le=B+1+v*z;I.push($,H,le),I.push(H,G,le)}this.setIndex(I),this.setAttribute("position",new br(R,3)),this.setAttribute("normal",new br(k,3)),this.setAttribute("uv",new br(L,2))}static fromJSON(e){return new Bf(e.width,e.height,e.widthSegments,e.heightSegments)}},$N=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,QN=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,eF=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,tF=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,nF=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,iF=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,rF="vec3 transformed = vec3( position );",sF=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,oF=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,aF=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,lF=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,cF=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,uF=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,hF=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,dF=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,fF=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,pF=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,mF=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,gF=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,_F=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,yF=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,vF=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,xF=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,bF=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,wF=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,TF="gl_FragColor = linearToOutputTexel( gl_FragColor );",EF=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,SF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,AF=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,MF=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,IF=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,CF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,LF=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,DF=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,RF=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,PF=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,kF=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,zF=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,OF=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,NF=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,FF=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,BF=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,UF=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,VF=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,GF=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,HF=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,jF=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,WF=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,qF=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,XF=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,ZF=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,KF=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,YF=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,JF=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,$F=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,QF=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,e5=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,t5=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,n5=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,i5=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,r5=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,s5=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,o5=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,a5=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,l5=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,c5=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,u5=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,h5=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,d5=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,f5=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,p5=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,m5=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,g5=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,_5=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,y5=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,v5=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,x5=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,b5=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,w5=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,T5=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,E5=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,S5=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,A5=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,M5=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,I5=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,C5=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,L5=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,D5=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,R5=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,P5=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,k5=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,z5=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,O5=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,N5=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,F5=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,B5=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,U5=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,V5=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,G5=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,H5=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,j5=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,W5=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,q5=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,X5=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Z5=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,K5=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Y5=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,J5=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,$5=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Q5=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,eB=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,tB=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,nB=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,iB=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,rB=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,sB=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,oB=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,aB=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lB=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cB=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,uB=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hB=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,dB=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,fB=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pB=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mB=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,gB=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_B=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yB=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vB=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,xB=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,bB=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wB=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,TB=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,EB=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ki={alphamap_fragment:$N,alphamap_pars_fragment:QN,alphatest_fragment:eF,alphatest_pars_fragment:tF,aomap_fragment:nF,aomap_pars_fragment:iF,begin_vertex:rF,beginnormal_vertex:sF,bsdfs:oF,bumpmap_pars_fragment:aF,clipping_planes_fragment:lF,clipping_planes_pars_fragment:cF,clipping_planes_pars_vertex:uF,clipping_planes_vertex:hF,color_fragment:dF,color_pars_fragment:fF,color_pars_vertex:pF,color_vertex:mF,common:gF,cube_uv_reflection_fragment:_F,defaultnormal_vertex:yF,displacementmap_pars_vertex:vF,displacementmap_vertex:xF,emissivemap_fragment:bF,emissivemap_pars_fragment:wF,encodings_fragment:TF,encodings_pars_fragment:EF,envmap_fragment:SF,envmap_common_pars_fragment:AF,envmap_pars_fragment:MF,envmap_pars_vertex:IF,envmap_physical_pars_fragment:BF,envmap_vertex:CF,fog_vertex:LF,fog_pars_vertex:DF,fog_fragment:RF,fog_pars_fragment:PF,gradientmap_pars_fragment:kF,lightmap_fragment:zF,lightmap_pars_fragment:OF,lights_lambert_vertex:NF,lights_pars_begin:FF,lights_toon_fragment:UF,lights_toon_pars_fragment:VF,lights_phong_fragment:GF,lights_phong_pars_fragment:HF,lights_physical_fragment:jF,lights_physical_pars_fragment:WF,lights_fragment_begin:qF,lights_fragment_maps:XF,lights_fragment_end:ZF,logdepthbuf_fragment:KF,logdepthbuf_pars_fragment:YF,logdepthbuf_pars_vertex:JF,logdepthbuf_vertex:$F,map_fragment:QF,map_pars_fragment:e5,map_particle_fragment:t5,map_particle_pars_fragment:n5,metalnessmap_fragment:i5,metalnessmap_pars_fragment:r5,morphcolor_vertex:s5,morphnormal_vertex:o5,morphtarget_pars_vertex:a5,morphtarget_vertex:l5,normal_fragment_begin:c5,normal_fragment_maps:u5,normal_pars_fragment:h5,normal_pars_vertex:d5,normal_vertex:f5,normalmap_pars_fragment:p5,clearcoat_normal_fragment_begin:m5,clearcoat_normal_fragment_maps:g5,clearcoat_pars_fragment:_5,output_fragment:y5,packing:v5,premultiplied_alpha_fragment:x5,project_vertex:b5,dithering_fragment:w5,dithering_pars_fragment:T5,roughnessmap_fragment:E5,roughnessmap_pars_fragment:S5,shadowmap_pars_fragment:A5,shadowmap_pars_vertex:M5,shadowmap_vertex:I5,shadowmask_pars_fragment:C5,skinbase_vertex:L5,skinning_pars_vertex:D5,skinning_vertex:R5,skinnormal_vertex:P5,specularmap_fragment:k5,specularmap_pars_fragment:z5,tonemapping_fragment:O5,tonemapping_pars_fragment:N5,transmission_fragment:F5,transmission_pars_fragment:B5,uv_pars_fragment:U5,uv_pars_vertex:V5,uv_vertex:G5,uv2_pars_fragment:H5,uv2_pars_vertex:j5,uv2_vertex:W5,worldpos_vertex:q5,background_vert:X5,background_frag:Z5,cube_vert:K5,cube_frag:Y5,depth_vert:J5,depth_frag:$5,distanceRGBA_vert:Q5,distanceRGBA_frag:eB,equirect_vert:tB,equirect_frag:nB,linedashed_vert:iB,linedashed_frag:rB,meshbasic_vert:sB,meshbasic_frag:oB,meshlambert_vert:aB,meshlambert_frag:lB,meshmatcap_vert:cB,meshmatcap_frag:uB,meshnormal_vert:hB,meshnormal_frag:dB,meshphong_vert:fB,meshphong_frag:pB,meshphysical_vert:mB,meshphysical_frag:gB,meshtoon_vert:_B,meshtoon_frag:yB,points_vert:vB,points_frag:xB,shadow_vert:bB,shadow_frag:wB,sprite_vert:TB,sprite_frag:EB},En={common:{diffuse:{value:new jn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ls},uv2Transform:{value:new ls},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Wt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ls}},sprite:{diffuse:{value:new jn(16777215)},opacity:{value:1},center:{value:new Wt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ls}}},js={basic:{uniforms:Hs([En.common,En.specularmap,En.envmap,En.aomap,En.lightmap,En.fog]),vertexShader:ki.meshbasic_vert,fragmentShader:ki.meshbasic_frag},lambert:{uniforms:Hs([En.common,En.specularmap,En.envmap,En.aomap,En.lightmap,En.emissivemap,En.fog,En.lights,{emissive:{value:new jn(0)}}]),vertexShader:ki.meshlambert_vert,fragmentShader:ki.meshlambert_frag},phong:{uniforms:Hs([En.common,En.specularmap,En.envmap,En.aomap,En.lightmap,En.emissivemap,En.bumpmap,En.normalmap,En.displacementmap,En.fog,En.lights,{emissive:{value:new jn(0)},specular:{value:new jn(1118481)},shininess:{value:30}}]),vertexShader:ki.meshphong_vert,fragmentShader:ki.meshphong_frag},standard:{uniforms:Hs([En.common,En.envmap,En.aomap,En.lightmap,En.emissivemap,En.bumpmap,En.normalmap,En.displacementmap,En.roughnessmap,En.metalnessmap,En.fog,En.lights,{emissive:{value:new jn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ki.meshphysical_vert,fragmentShader:ki.meshphysical_frag},toon:{uniforms:Hs([En.common,En.aomap,En.lightmap,En.emissivemap,En.bumpmap,En.normalmap,En.displacementmap,En.gradientmap,En.fog,En.lights,{emissive:{value:new jn(0)}}]),vertexShader:ki.meshtoon_vert,fragmentShader:ki.meshtoon_frag},matcap:{uniforms:Hs([En.common,En.bumpmap,En.normalmap,En.displacementmap,En.fog,{matcap:{value:null}}]),vertexShader:ki.meshmatcap_vert,fragmentShader:ki.meshmatcap_frag},points:{uniforms:Hs([En.points,En.fog]),vertexShader:ki.points_vert,fragmentShader:ki.points_frag},dashed:{uniforms:Hs([En.common,En.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ki.linedashed_vert,fragmentShader:ki.linedashed_frag},depth:{uniforms:Hs([En.common,En.displacementmap]),vertexShader:ki.depth_vert,fragmentShader:ki.depth_frag},normal:{uniforms:Hs([En.common,En.bumpmap,En.normalmap,En.displacementmap,{opacity:{value:1}}]),vertexShader:ki.meshnormal_vert,fragmentShader:ki.meshnormal_frag},sprite:{uniforms:Hs([En.sprite,En.fog]),vertexShader:ki.sprite_vert,fragmentShader:ki.sprite_frag},background:{uniforms:{uvTransform:{value:new ls},t2D:{value:null}},vertexShader:ki.background_vert,fragmentShader:ki.background_frag},cube:{uniforms:Hs([En.envmap,{opacity:{value:1}}]),vertexShader:ki.cube_vert,fragmentShader:ki.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ki.equirect_vert,fragmentShader:ki.equirect_frag},distanceRGBA:{uniforms:Hs([En.common,En.displacementmap,{referencePosition:{value:new Be},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ki.distanceRGBA_vert,fragmentShader:ki.distanceRGBA_frag},shadow:{uniforms:Hs([En.lights,En.fog,{color:{value:new jn(0)},opacity:{value:1}}]),vertexShader:ki.shadow_vert,fragmentShader:ki.shadow_frag}};js.physical={uniforms:Hs([js.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Wt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new jn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Wt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new jn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new jn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ki.meshphysical_vert,fragmentShader:ki.meshphysical_frag};function SB(i,e,t,s,c,h){let p=new jn(0),r=c===!0?0:1,x,v,w=null,S=0,A=null;function I(k,L){let z=!1,B=L.isScene===!0?L.background:null;B&&B.isTexture&&(B=e.get(B));let $=i.xr,H=$.getSession&&$.getSession();H&&H.environmentBlendMode==="additive"&&(B=null),B===null?R(p,r):B&&B.isColor&&(R(B,1),z=!0),(i.autoClear||z)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),B&&(B.isCubeTexture||B.mapping===Qm)?(v===void 0&&(v=new Hr(new rl(1,1,1),new eo({name:"BackgroundCubeMaterial",uniforms:Pf(js.cube.uniforms),vertexShader:js.cube.vertexShader,fragmentShader:js.cube.fragmentShader,side:To,depthTest:!1,depthWrite:!1,fog:!1})),v.geometry.deleteAttribute("normal"),v.geometry.deleteAttribute("uv"),v.onBeforeRender=function(G,le,te){this.matrixWorld.copyPosition(te.matrixWorld)},Object.defineProperty(v.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(v)),v.material.uniforms.envMap.value=B,v.material.uniforms.flipEnvMap.value=B.isCubeTexture&&B.isRenderTargetTexture===!1?-1:1,(w!==B||S!==B.version||A!==i.toneMapping)&&(v.material.needsUpdate=!0,w=B,S=B.version,A=i.toneMapping),k.unshift(v,v.geometry,v.material,0,0,null)):B&&B.isTexture&&(x===void 0&&(x=new Hr(new Bf(2,2),new eo({name:"BackgroundMaterial",uniforms:Pf(js.background.uniforms),vertexShader:js.background.vertexShader,fragmentShader:js.background.fragmentShader,side:yf,depthTest:!1,depthWrite:!1,fog:!1})),x.geometry.deleteAttribute("normal"),Object.defineProperty(x.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(x)),x.material.uniforms.t2D.value=B,B.matrixAutoUpdate===!0&&B.updateMatrix(),x.material.uniforms.uvTransform.value.copy(B.matrix),(w!==B||S!==B.version||A!==i.toneMapping)&&(x.material.needsUpdate=!0,w=B,S=B.version,A=i.toneMapping),k.unshift(x,x.geometry,x.material,0,0,null))}function R(k,L){t.buffers.color.setClear(k.r,k.g,k.b,L,h)}return{getClearColor:function(){return p},setClearColor:function(k,L=1){p.set(k),r=L,R(p,r)},getClearAlpha:function(){return r},setClearAlpha:function(k){r=k,R(p,r)},render:I}}function AB(i,e,t,s){let c=i.getParameter(34921),h=s.isWebGL2?null:e.get("OES_vertex_array_object"),p=s.isWebGL2||h!==null,r={},x=L(null),v=x,w=!1;function S(ge,re,ve,ae,de){let xe=!1;if(p){let De=k(ae,ve,re);v!==De&&(v=De,I(v.object)),xe=z(ae,de),xe&&B(ae,de)}else{let De=re.wireframe===!0;(v.geometry!==ae.id||v.program!==ve.id||v.wireframe!==De)&&(v.geometry=ae.id,v.program=ve.id,v.wireframe=De,xe=!0)}ge.isInstancedMesh===!0&&(xe=!0),de!==null&&t.update(de,34963),(xe||w)&&(w=!1,ue(ge,re,ve,ae),de!==null&&i.bindBuffer(34963,t.get(de).buffer))}function A(){return s.isWebGL2?i.createVertexArray():h.createVertexArrayOES()}function I(ge){return s.isWebGL2?i.bindVertexArray(ge):h.bindVertexArrayOES(ge)}function R(ge){return s.isWebGL2?i.deleteVertexArray(ge):h.deleteVertexArrayOES(ge)}function k(ge,re,ve){let ae=ve.wireframe===!0,de=r[ge.id];de===void 0&&(de={},r[ge.id]=de);let xe=de[re.id];xe===void 0&&(xe={},de[re.id]=xe);let De=xe[ae];return De===void 0&&(De=L(A()),xe[ae]=De),De}function L(ge){let re=[],ve=[],ae=[];for(let de=0;de<c;de++)re[de]=0,ve[de]=0,ae[de]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:re,enabledAttributes:ve,attributeDivisors:ae,object:ge,attributes:{},index:null}}function z(ge,re){let ve=v.attributes,ae=ge.attributes,de=0;for(let xe in ae){let De=ve[xe],Ce=ae[xe];if(De===void 0||De.attribute!==Ce||De.data!==Ce.data)return!0;de++}return v.attributesNum!==de||v.index!==re}function B(ge,re){let ve={},ae=ge.attributes,de=0;for(let xe in ae){let De=ae[xe],Ce={};Ce.attribute=De,De.data&&(Ce.data=De.data),ve[xe]=Ce,de++}v.attributes=ve,v.attributesNum=de,v.index=re}function $(){let ge=v.newAttributes;for(let re=0,ve=ge.length;re<ve;re++)ge[re]=0}function H(ge){G(ge,0)}function G(ge,re){let ve=v.newAttributes,ae=v.enabledAttributes,de=v.attributeDivisors;ve[ge]=1,ae[ge]===0&&(i.enableVertexAttribArray(ge),ae[ge]=1),de[ge]!==re&&((s.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[s.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ge,re),de[ge]=re)}function le(){let ge=v.newAttributes,re=v.enabledAttributes;for(let ve=0,ae=re.length;ve<ae;ve++)re[ve]!==ge[ve]&&(i.disableVertexAttribArray(ve),re[ve]=0)}function te(ge,re,ve,ae,de,xe){s.isWebGL2===!0&&(ve===5124||ve===5125)?i.vertexAttribIPointer(ge,re,ve,de,xe):i.vertexAttribPointer(ge,re,ve,ae,de,xe)}function ue(ge,re,ve,ae){if(s.isWebGL2===!1&&(ge.isInstancedMesh||ae.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;$();let de=ae.attributes,xe=ve.getAttributes(),De=re.defaultAttributeValues;for(let Ce in xe){let pe=xe[Ce];if(pe.location>=0){let xt=de[Ce];if(xt===void 0&&(Ce==="instanceMatrix"&&ge.instanceMatrix&&(xt=ge.instanceMatrix),Ce==="instanceColor"&&ge.instanceColor&&(xt=ge.instanceColor)),xt!==void 0){let Ct=xt.normalized,ct=xt.itemSize,Qe=t.get(xt);if(Qe===void 0)continue;let zt=Qe.buffer,Zt=Qe.type,Lt=Qe.bytesPerElement;if(xt.isInterleavedBufferAttribute){let Re=xt.data,qt=Re.stride,nt=xt.offset;if(Re.isInstancedInterleavedBuffer){for(let at=0;at<pe.locationSize;at++)G(pe.location+at,Re.meshPerAttribute);ge.isInstancedMesh!==!0&&ae._maxInstanceCount===void 0&&(ae._maxInstanceCount=Re.meshPerAttribute*Re.count)}else for(let at=0;at<pe.locationSize;at++)H(pe.location+at);i.bindBuffer(34962,zt);for(let at=0;at<pe.locationSize;at++)te(pe.location+at,ct/pe.locationSize,Zt,Ct,qt*Lt,(nt+ct/pe.locationSize*at)*Lt)}else{if(xt.isInstancedBufferAttribute){for(let Re=0;Re<pe.locationSize;Re++)G(pe.location+Re,xt.meshPerAttribute);ge.isInstancedMesh!==!0&&ae._maxInstanceCount===void 0&&(ae._maxInstanceCount=xt.meshPerAttribute*xt.count)}else for(let Re=0;Re<pe.locationSize;Re++)H(pe.location+Re);i.bindBuffer(34962,zt);for(let Re=0;Re<pe.locationSize;Re++)te(pe.location+Re,ct/pe.locationSize,Zt,Ct,ct*Lt,ct/pe.locationSize*Re*Lt)}}else if(De!==void 0){let Ct=De[Ce];if(Ct!==void 0)switch(Ct.length){case 2:i.vertexAttrib2fv(pe.location,Ct);break;case 3:i.vertexAttrib3fv(pe.location,Ct);break;case 4:i.vertexAttrib4fv(pe.location,Ct);break;default:i.vertexAttrib1fv(pe.location,Ct)}}}}le()}function me(){ye();for(let ge in r){let re=r[ge];for(let ve in re){let ae=re[ve];for(let de in ae)R(ae[de].object),delete ae[de];delete re[ve]}delete r[ge]}}function se(ge){if(r[ge.id]===void 0)return;let re=r[ge.id];for(let ve in re){let ae=re[ve];for(let de in ae)R(ae[de].object),delete ae[de];delete re[ve]}delete r[ge.id]}function Y(ge){for(let re in r){let ve=r[re];if(ve[ge.id]===void 0)continue;let ae=ve[ge.id];for(let de in ae)R(ae[de].object),delete ae[de];delete ve[ge.id]}}function ye(){Xe(),w=!0,v!==x&&(v=x,I(v.object))}function Xe(){x.geometry=null,x.program=null,x.wireframe=!1}return{setup:S,reset:ye,resetDefaultState:Xe,dispose:me,releaseStatesOfGeometry:se,releaseStatesOfProgram:Y,initAttributes:$,enableAttribute:H,disableUnusedAttributes:le}}function MB(i,e,t,s){let c=s.isWebGL2,h;function p(v){h=v}function r(v,w){i.drawArrays(h,v,w),t.update(w,h,1)}function x(v,w,S){if(S===0)return;let A,I;if(c)A=i,I="drawArraysInstanced";else if(A=e.get("ANGLE_instanced_arrays"),I="drawArraysInstancedANGLE",A===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}A[I](h,v,w,S),t.update(w,h,S)}this.setMode=p,this.render=r,this.renderInstances=x}function IB(i,e,t){let s;function c(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){let te=e.get("EXT_texture_filter_anisotropic");s=i.getParameter(te.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function h(te){if(te==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";te="mediump"}return te==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let p=typeof WebGL2RenderingContext!="undefined"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&i instanceof WebGL2ComputeRenderingContext,r=t.precision!==void 0?t.precision:"highp",x=h(r);x!==r&&(console.warn("THREE.WebGLRenderer:",r,"not supported, using",x,"instead."),r=x);let v=p||e.has("WEBGL_draw_buffers"),w=t.logarithmicDepthBuffer===!0,S=i.getParameter(34930),A=i.getParameter(35660),I=i.getParameter(3379),R=i.getParameter(34076),k=i.getParameter(34921),L=i.getParameter(36347),z=i.getParameter(36348),B=i.getParameter(36349),$=A>0,H=p||e.has("OES_texture_float"),G=$&&H,le=p?i.getParameter(36183):0;return{isWebGL2:p,drawBuffers:v,getMaxAnisotropy:c,getMaxPrecision:h,precision:r,logarithmicDepthBuffer:w,maxTextures:S,maxVertexTextures:A,maxTextureSize:I,maxCubemapSize:R,maxAttributes:k,maxVertexUniforms:L,maxVaryings:z,maxFragmentUniforms:B,vertexTextures:$,floatFragmentTextures:H,floatVertexTextures:G,maxSamples:le}}function CB(i){let e=this,t=null,s=0,c=!1,h=!1,p=new Ca,r=new ls,x={value:null,needsUpdate:!1};this.uniform=x,this.numPlanes=0,this.numIntersection=0,this.init=function(S,A,I){let R=S.length!==0||A||s!==0||c;return c=A,t=w(S,I,0),s=S.length,R},this.beginShadows=function(){h=!0,w(null)},this.endShadows=function(){h=!1,v()},this.setState=function(S,A,I){let R=S.clippingPlanes,k=S.clipIntersection,L=S.clipShadows,z=i.get(S);if(!c||R===null||R.length===0||h&&!L)h?w(null):v();else{let B=h?0:s,$=B*4,H=z.clippingState||null;x.value=H,H=w(R,A,$,I);for(let G=0;G!==$;++G)H[G]=t[G];z.clippingState=H,this.numIntersection=k?this.numPlanes:0,this.numPlanes+=B}};function v(){x.value!==t&&(x.value=t,x.needsUpdate=s>0),e.numPlanes=s,e.numIntersection=0}function w(S,A,I,R){let k=S!==null?S.length:0,L=null;if(k!==0){if(L=x.value,R!==!0||L===null){let z=I+k*4,B=A.matrixWorldInverse;r.getNormalMatrix(B),(L===null||L.length<z)&&(L=new Float32Array(z));for(let $=0,H=I;$!==k;++$,H+=4)p.copy(S[$]).applyMatrix4(B,r),p.normal.toArray(L,H),L[H+3]=p.constant}x.value=L,x.needsUpdate=!0}return e.numPlanes=k,e.numIntersection=0,L}}function LB(i){let e=new WeakMap;function t(p,r){return r===n0?p.mapping=Ah:r===i0&&(p.mapping=Mh),p}function s(p){if(p&&p.isTexture&&p.isRenderTargetTexture===!1){let r=p.mapping;if(r===n0||r===i0)if(e.has(p)){let x=e.get(p).texture;return t(x,p.mapping)}else{let x=p.image;if(x&&x.height>0){let v=new F0(x.height/2);return v.fromEquirectangularTexture(i,p),e.set(p,v),p.addEventListener("dispose",c),t(v.texture,p.mapping)}else return null}}return p}function c(p){let r=p.target;r.removeEventListener("dispose",c);let x=e.get(r);x!==void 0&&(e.delete(r),x.dispose())}function h(){e=new WeakMap}return{get:s,dispose:h}}var _g=class extends mg{constructor(e=-1,t=1,s=1,c=-1,h=.1,p=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=s,this.bottom=c,this.near=h,this.far=p,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,s,c,h,p){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=c,this.view.width=h,this.view.height=p,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,c=(this.top+this.bottom)/2,h=s-e,p=s+e,r=c+t,x=c-t;if(this.view!==null&&this.view.enabled){let v=(this.right-this.left)/this.view.fullWidth/this.zoom,w=(this.top-this.bottom)/this.view.fullHeight/this.zoom;h+=v*this.view.offsetX,p=h+v*this.view.width,r-=w*this.view.offsetY,x=r-w*this.view.height}this.projectionMatrix.makeOrthographic(h,p,r,x,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};_g.prototype.isOrthographicCamera=!0;var Uf=4,zI=[.125,.215,.35,.446,.526,.582],Bh=20,fw=new _g,OI=new jn,pw=null,Uh=(1+Math.sqrt(5))/2,Vf=1/Uh,NI=[new Be(1,1,1),new Be(-1,1,1),new Be(1,1,-1),new Be(-1,1,-1),new Be(0,Uh,Vf),new Be(0,Uh,-Vf),new Be(Vf,0,Uh),new Be(-Vf,0,Uh),new Be(Uh,Vf,0),new Be(-Uh,Vf,0)],U0=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,s=.1,c=100){pw=this._renderer.getRenderTarget(),this._setSize(256);let h=this._allocateTargets();return h.depthBuffer=!0,this._sceneToCubeUV(e,s,c,h),t>0&&this._blur(h,0,0,t),this._applyPMREM(h),this._cleanup(h),h}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=UI(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=BI(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(pw),e.scissorTest=!1,V0(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ah||e.mapping===Mh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),pw=this._renderer.getRenderTarget();let s=t||this._allocateTargets();return this._textureToCubeUV(e,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){let e=3*Math.max(this._cubeSize,16*7),t=4*this._cubeSize-32,s={magFilter:bs,minFilter:bs,generateMipmaps:!1,type:Ch,format:ws,encoding:nl,depthBuffer:!1},c=FI(e,t,s);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=FI(e,t,s);let{_lodMax:h}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=DB(h)),this._blurMaterial=RB(h,e,t)}return c}_compileMaterial(e){let t=new Hr(this._lodPlanes[0],e);this._renderer.compile(t,fw)}_sceneToCubeUV(e,t,s,c){let h=90,p=1,r=new Ss(h,p,t,s),x=[1,-1,1,1,1,1],v=[1,1,1,-1,-1,-1],w=this._renderer,S=w.autoClear,A=w.toneMapping;w.getClearColor(OI),w.toneMapping=tl,w.autoClear=!1;let I=new Xl({name:"PMREM.Background",side:To,depthWrite:!1,depthTest:!1}),R=new Hr(new rl,I),k=!1,L=e.background;L?L.isColor&&(I.color.copy(L),e.background=null,k=!0):(I.color.copy(OI),k=!0);for(let z=0;z<6;z++){let B=z%3;B===0?(r.up.set(0,x[z],0),r.lookAt(v[z],0,0)):B===1?(r.up.set(0,0,x[z]),r.lookAt(0,v[z],0)):(r.up.set(0,x[z],0),r.lookAt(0,0,v[z]));let $=this._cubeSize;V0(c,B*$,z>2?$:0,$,$),w.setRenderTarget(c),k&&w.render(R,r),w.render(e,r)}R.geometry.dispose(),R.material.dispose(),w.toneMapping=A,w.autoClear=S,e.background=L}_textureToCubeUV(e,t){let s=this._renderer,c=e.mapping===Ah||e.mapping===Mh;c?(this._cubemapMaterial===null&&(this._cubemapMaterial=UI()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=BI());let h=c?this._cubemapMaterial:this._equirectMaterial,p=new Hr(this._lodPlanes[0],h),r=h.uniforms;r.envMap.value=e;let x=this._cubeSize;V0(t,0,0,3*x,2*x),s.setRenderTarget(t),s.render(p,fw)}_applyPMREM(e){let t=this._renderer,s=t.autoClear;t.autoClear=!1;for(let c=1;c<this._lodPlanes.length;c++){let h=Math.sqrt(this._sigmas[c]*this._sigmas[c]-this._sigmas[c-1]*this._sigmas[c-1]),p=NI[(c-1)%NI.length];this._blur(e,c-1,c,h,p)}t.autoClear=s}_blur(e,t,s,c,h){let p=this._pingPongRenderTarget;this._halfBlur(e,p,t,s,c,"latitudinal",h),this._halfBlur(p,e,s,s,c,"longitudinal",h)}_halfBlur(e,t,s,c,h,p,r){let x=this._renderer,v=this._blurMaterial;p!=="latitudinal"&&p!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let w=3,S=new Hr(this._lodPlanes[c],v),A=v.uniforms,I=this._sizeLods[s]-1,R=isFinite(h)?Math.PI/(2*I):2*Math.PI/(2*Bh-1),k=h/R,L=isFinite(h)?1+Math.floor(w*k):Bh;L>Bh&&console.warn(`sigmaRadians, ${h}, is too large and will clip, as it requested ${L} samples when the maximum is set to ${Bh}`);let z=[],B=0;for(let te=0;te<Bh;++te){let ue=te/k,me=Math.exp(-ue*ue/2);z.push(me),te===0?B+=me:te<L&&(B+=2*me)}for(let te=0;te<z.length;te++)z[te]=z[te]/B;A.envMap.value=e.texture,A.samples.value=L,A.weights.value=z,A.latitudinal.value=p==="latitudinal",r&&(A.poleAxis.value=r);let{_lodMax:$}=this;A.dTheta.value=R,A.mipInt.value=$-s;let H=this._sizeLods[c],G=3*H*(c>$-Uf?c-$+Uf:0),le=4*(this._cubeSize-H);V0(t,G,le,3*H,2*H),x.setRenderTarget(t),x.render(S,fw)}};function DB(i){let e=[],t=[],s=[],c=i,h=i-Uf+1+zI.length;for(let p=0;p<h;p++){let r=Math.pow(2,c);t.push(r);let x=1/r;p>i-Uf?x=zI[p-i+Uf-1]:p===0&&(x=0),s.push(x);let v=1/(r-1),w=-v/2,S=1+v/2,A=[w,w,S,w,S,S,w,w,S,S,w,S],I=6,R=6,k=3,L=2,z=1,B=new Float32Array(k*R*I),$=new Float32Array(L*R*I),H=new Float32Array(z*R*I);for(let le=0;le<I;le++){let te=le%3*2/3-1,ue=le>2?0:-1,me=[te,ue,0,te+2/3,ue,0,te+2/3,ue+1,0,te,ue,0,te+2/3,ue+1,0,te,ue+1,0];B.set(me,k*R*le),$.set(A,L*R*le);let se=[le,le,le,le,le,le];H.set(se,z*R*le)}let G=new er;G.setAttribute("position",new xr(B,k)),G.setAttribute("uv",new xr($,L)),G.setAttribute("faceIndex",new xr(H,z)),e.push(G),c>Uf&&c--}return{lodPlanes:e,sizeLods:t,sigmas:s}}function FI(i,e,t){let s=new Qs(i,e,t);return s.texture.mapping=Qm,s.texture.name="PMREM.cubeUv",s.scissorTest=!0,s}function V0(i,e,t,s,c){i.viewport.set(e,t,s,c),i.scissor.set(e,t,s,c)}function RB(i,e,t){let s=new Float32Array(Bh),c=new Be(0,1,0);return new eo({name:"SphericalGaussianBlur",defines:{n:Bh,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:s},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:c}},vertexShader:mw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Bl,depthTest:!1,depthWrite:!1})}function BI(){return new eo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:mw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Bl,depthTest:!1,depthWrite:!1})}function UI(){return new eo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:mw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Bl,depthTest:!1,depthWrite:!1})}function mw(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function PB(i){let e=new WeakMap,t=null;function s(r){if(r&&r.isTexture){let x=r.mapping,v=x===n0||x===i0,w=x===Ah||x===Mh;if(v||w)if(r.isRenderTargetTexture&&r.needsPMREMUpdate===!0){r.needsPMREMUpdate=!1;let S=e.get(r);return t===null&&(t=new U0(i)),S=v?t.fromEquirectangular(r,S):t.fromCubemap(r,S),e.set(r,S),S.texture}else{if(e.has(r))return e.get(r).texture;{let S=r.image;if(v&&S&&S.height>0||w&&S&&c(S)){t===null&&(t=new U0(i));let A=v?t.fromEquirectangular(r):t.fromCubemap(r);return e.set(r,A),r.addEventListener("dispose",h),A.texture}else return null}}}return r}function c(r){let x=0,v=6;for(let w=0;w<v;w++)r[w]!==void 0&&x++;return x===v}function h(r){let x=r.target;x.removeEventListener("dispose",h);let v=e.get(x);v!==void 0&&(e.delete(x),v.dispose())}function p(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:s,dispose:p}}function kB(i){let e={};function t(s){if(e[s]!==void 0)return e[s];let c;switch(s){case"WEBGL_depth_texture":c=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":c=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":c=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":c=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:c=i.getExtension(s)}return e[s]=c,c}return{has:function(s){return t(s)!==null},init:function(s){s.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(s){let c=t(s);return c===null&&console.warn("THREE.WebGLRenderer: "+s+" extension not supported."),c}}}function zB(i,e,t,s){let c={},h=new WeakMap;function p(S){let A=S.target;A.index!==null&&e.remove(A.index);for(let R in A.attributes)e.remove(A.attributes[R]);A.removeEventListener("dispose",p),delete c[A.id];let I=h.get(A);I&&(e.remove(I),h.delete(A)),s.releaseStatesOfGeometry(A),A.isInstancedBufferGeometry===!0&&delete A._maxInstanceCount,t.memory.geometries--}function r(S,A){return c[A.id]===!0||(A.addEventListener("dispose",p),c[A.id]=!0,t.memory.geometries++),A}function x(S){let A=S.attributes;for(let R in A)e.update(A[R],34962);let I=S.morphAttributes;for(let R in I){let k=I[R];for(let L=0,z=k.length;L<z;L++)e.update(k[L],34962)}}function v(S){let A=[],I=S.index,R=S.attributes.position,k=0;if(I!==null){let B=I.array;k=I.version;for(let $=0,H=B.length;$<H;$+=3){let G=B[$+0],le=B[$+1],te=B[$+2];A.push(G,le,le,te,te,G)}}else{let B=R.array;k=R.version;for(let $=0,H=B.length/3-1;$<H;$+=3){let G=$+0,le=$+1,te=$+2;A.push(G,le,le,te,te,G)}}let L=new(bI(A)?C0:I0)(A,1);L.version=k;let z=h.get(S);z&&e.remove(z),h.set(S,L)}function w(S){let A=h.get(S);if(A){let I=S.index;I!==null&&A.version<I.version&&v(S)}else v(S);return h.get(S)}return{get:r,update:x,getWireframeAttribute:w}}function OB(i,e,t,s){let c=s.isWebGL2,h;function p(A){h=A}let r,x;function v(A){r=A.type,x=A.bytesPerElement}function w(A,I){i.drawElements(h,I,r,A*x),t.update(I,h,1)}function S(A,I,R){if(R===0)return;let k,L;if(c)k=i,L="drawElementsInstanced";else if(k=e.get("ANGLE_instanced_arrays"),L="drawElementsInstancedANGLE",k===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}k[L](h,I,r,A*x,R),t.update(I,h,R)}this.setMode=p,this.setIndex=v,this.render=w,this.renderInstances=S}function NB(i){let e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function s(h,p,r){switch(t.calls++,p){case 4:t.triangles+=r*(h/3);break;case 1:t.lines+=r*(h/2);break;case 3:t.lines+=r*(h-1);break;case 2:t.lines+=r*h;break;case 0:t.points+=r*h;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",p);break}}function c(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:c,update:s}}function FB(i,e){return i[0]-e[0]}function BB(i,e){return Math.abs(e[1])-Math.abs(i[1])}function gw(i,e){let t=1,s=e.isInterleavedBufferAttribute?e.data.array:e.array;s instanceof Int8Array?t=127:s instanceof Int16Array?t=32767:s instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",s),i.divideScalar(t)}function UB(i,e,t){let s={},c=new Float32Array(8),h=new WeakMap,p=new Ui,r=[];for(let v=0;v<8;v++)r[v]=[v,0];function x(v,w,S,A){let I=v.morphTargetInfluences;if(e.isWebGL2===!0){let R=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,k=R!==void 0?R.length:0,L=h.get(w);if(L===void 0||L.count!==k){let re=function(){Xe.dispose(),h.delete(w),w.removeEventListener("dispose",re)};L!==void 0&&L.texture.dispose();let $=w.morphAttributes.position!==void 0,H=w.morphAttributes.normal!==void 0,G=w.morphAttributes.color!==void 0,le=w.morphAttributes.position||[],te=w.morphAttributes.normal||[],ue=w.morphAttributes.color||[],me=0;$===!0&&(me=1),H===!0&&(me=2),G===!0&&(me=3);let se=w.attributes.position.count*me,Y=1;se>e.maxTextureSize&&(Y=Math.ceil(se/e.maxTextureSize),se=e.maxTextureSize);let ye=new Float32Array(se*Y*4*k),Xe=new Tf(ye,se,Y,k);Xe.type=qc,Xe.needsUpdate=!0;let ge=me*4;for(let ve=0;ve<k;ve++){let ae=le[ve],de=te[ve],xe=ue[ve],De=se*Y*4*ve;for(let Ce=0;Ce<ae.count;Ce++){let pe=Ce*ge;$===!0&&(p.fromBufferAttribute(ae,Ce),ae.normalized===!0&&gw(p,ae),ye[De+pe+0]=p.x,ye[De+pe+1]=p.y,ye[De+pe+2]=p.z,ye[De+pe+3]=0),H===!0&&(p.fromBufferAttribute(de,Ce),de.normalized===!0&&gw(p,de),ye[De+pe+4]=p.x,ye[De+pe+5]=p.y,ye[De+pe+6]=p.z,ye[De+pe+7]=0),G===!0&&(p.fromBufferAttribute(xe,Ce),xe.normalized===!0&&gw(p,xe),ye[De+pe+8]=p.x,ye[De+pe+9]=p.y,ye[De+pe+10]=p.z,ye[De+pe+11]=xe.itemSize===4?p.w:1)}}L={count:k,texture:Xe,size:new Wt(se,Y)},h.set(w,L),w.addEventListener("dispose",re)}let z=0;for(let $=0;$<I.length;$++)z+=I[$];let B=w.morphTargetsRelative?1:1-z;A.getUniforms().setValue(i,"morphTargetBaseInfluence",B),A.getUniforms().setValue(i,"morphTargetInfluences",I),A.getUniforms().setValue(i,"morphTargetsTexture",L.texture,t),A.getUniforms().setValue(i,"morphTargetsTextureSize",L.size)}else{let R=I===void 0?0:I.length,k=s[w.id];if(k===void 0||k.length!==R){k=[];for(let H=0;H<R;H++)k[H]=[H,0];s[w.id]=k}for(let H=0;H<R;H++){let G=k[H];G[0]=H,G[1]=I[H]}k.sort(BB);for(let H=0;H<8;H++)H<R&&k[H][1]?(r[H][0]=k[H][0],r[H][1]=k[H][1]):(r[H][0]=Number.MAX_SAFE_INTEGER,r[H][1]=0);r.sort(FB);let L=w.morphAttributes.position,z=w.morphAttributes.normal,B=0;for(let H=0;H<8;H++){let G=r[H],le=G[0],te=G[1];le!==Number.MAX_SAFE_INTEGER&&te?(L&&w.getAttribute("morphTarget"+H)!==L[le]&&w.setAttribute("morphTarget"+H,L[le]),z&&w.getAttribute("morphNormal"+H)!==z[le]&&w.setAttribute("morphNormal"+H,z[le]),c[H]=te,B+=te):(L&&w.hasAttribute("morphTarget"+H)===!0&&w.deleteAttribute("morphTarget"+H),z&&w.hasAttribute("morphNormal"+H)===!0&&w.deleteAttribute("morphNormal"+H),c[H]=0)}let $=w.morphTargetsRelative?1:1-B;A.getUniforms().setValue(i,"morphTargetBaseInfluence",$),A.getUniforms().setValue(i,"morphTargetInfluences",c)}}return{update:x}}function VB(i,e,t,s){let c=new WeakMap;function h(x){let v=s.render.frame,w=x.geometry,S=e.get(x,w);return c.get(S)!==v&&(e.update(S),c.set(S,v)),x.isInstancedMesh&&(x.hasEventListener("dispose",r)===!1&&x.addEventListener("dispose",r),t.update(x.instanceMatrix,34962),x.instanceColor!==null&&t.update(x.instanceColor,34962)),S}function p(){c=new WeakMap}function r(x){let v=x.target;v.removeEventListener("dispose",r),t.remove(v.instanceMatrix),v.instanceColor!==null&&t.remove(v.instanceColor)}return{update:h,dispose:p}}var VI=new Qr,GI=new Tf,HI=new Kc,jI=new Of,WI=[],qI=[],XI=new Float32Array(16),ZI=new Float32Array(9),KI=new Float32Array(4);function Gf(i,e,t){let s=i[0];if(s<=0||s>0)return i;let c=e*t,h=WI[c];if(h===void 0&&(h=new Float32Array(c),WI[c]=h),e!==0){s.toArray(h,0);for(let p=1,r=0;p!==e;++p)r+=t,i[p].toArray(h,r)}return h}function to(i,e){if(i.length!==e.length)return!1;for(let t=0,s=i.length;t<s;t++)if(i[t]!==e[t])return!1;return!0}function Ws(i,e){for(let t=0,s=e.length;t<s;t++)i[t]=e[t]}function G0(i,e){let t=qI[e];t===void 0&&(t=new Int32Array(e),qI[e]=t);for(let s=0;s!==e;++s)t[s]=i.allocateTextureUnit();return t}function GB(i,e){let t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function HB(i,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(to(t,e))return;i.uniform2fv(this.addr,e),Ws(t,e)}}function jB(i,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(to(t,e))return;i.uniform3fv(this.addr,e),Ws(t,e)}}function WB(i,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(to(t,e))return;i.uniform4fv(this.addr,e),Ws(t,e)}}function qB(i,e){let t=this.cache,s=e.elements;if(s===void 0){if(to(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),Ws(t,e)}else{if(to(t,s))return;KI.set(s),i.uniformMatrix2fv(this.addr,!1,KI),Ws(t,s)}}function XB(i,e){let t=this.cache,s=e.elements;if(s===void 0){if(to(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),Ws(t,e)}else{if(to(t,s))return;ZI.set(s),i.uniformMatrix3fv(this.addr,!1,ZI),Ws(t,s)}}function ZB(i,e){let t=this.cache,s=e.elements;if(s===void 0){if(to(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),Ws(t,e)}else{if(to(t,s))return;XI.set(s),i.uniformMatrix4fv(this.addr,!1,XI),Ws(t,s)}}function KB(i,e){let t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function YB(i,e){let t=this.cache;to(t,e)||(i.uniform2iv(this.addr,e),Ws(t,e))}function JB(i,e){let t=this.cache;to(t,e)||(i.uniform3iv(this.addr,e),Ws(t,e))}function $B(i,e){let t=this.cache;to(t,e)||(i.uniform4iv(this.addr,e),Ws(t,e))}function QB(i,e){let t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function e4(i,e){let t=this.cache;to(t,e)||(i.uniform2uiv(this.addr,e),Ws(t,e))}function t4(i,e){let t=this.cache;to(t,e)||(i.uniform3uiv(this.addr,e),Ws(t,e))}function n4(i,e){let t=this.cache;to(t,e)||(i.uniform4uiv(this.addr,e),Ws(t,e))}function i4(i,e,t){let s=this.cache,c=t.allocateTextureUnit();s[0]!==c&&(i.uniform1i(this.addr,c),s[0]=c),t.setTexture2D(e||VI,c)}function r4(i,e,t){let s=this.cache,c=t.allocateTextureUnit();s[0]!==c&&(i.uniform1i(this.addr,c),s[0]=c),t.setTexture3D(e||HI,c)}function s4(i,e,t){let s=this.cache,c=t.allocateTextureUnit();s[0]!==c&&(i.uniform1i(this.addr,c),s[0]=c),t.setTextureCube(e||jI,c)}function o4(i,e,t){let s=this.cache,c=t.allocateTextureUnit();s[0]!==c&&(i.uniform1i(this.addr,c),s[0]=c),t.setTexture2DArray(e||GI,c)}function a4(i){switch(i){case 5126:return GB;case 35664:return HB;case 35665:return jB;case 35666:return WB;case 35674:return qB;case 35675:return XB;case 35676:return ZB;case 5124:case 35670:return KB;case 35667:case 35671:return YB;case 35668:case 35672:return JB;case 35669:case 35673:return $B;case 5125:return QB;case 36294:return e4;case 36295:return t4;case 36296:return n4;case 35678:case 36198:case 36298:case 36306:case 35682:return i4;case 35679:case 36299:case 36307:return r4;case 35680:case 36300:case 36308:case 36293:return s4;case 36289:case 36303:case 36311:case 36292:return o4}}function l4(i,e){i.uniform1fv(this.addr,e)}function c4(i,e){let t=Gf(e,this.size,2);i.uniform2fv(this.addr,t)}function u4(i,e){let t=Gf(e,this.size,3);i.uniform3fv(this.addr,t)}function h4(i,e){let t=Gf(e,this.size,4);i.uniform4fv(this.addr,t)}function d4(i,e){let t=Gf(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function f4(i,e){let t=Gf(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function p4(i,e){let t=Gf(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function m4(i,e){i.uniform1iv(this.addr,e)}function g4(i,e){i.uniform2iv(this.addr,e)}function _4(i,e){i.uniform3iv(this.addr,e)}function y4(i,e){i.uniform4iv(this.addr,e)}function v4(i,e){i.uniform1uiv(this.addr,e)}function x4(i,e){i.uniform2uiv(this.addr,e)}function b4(i,e){i.uniform3uiv(this.addr,e)}function w4(i,e){i.uniform4uiv(this.addr,e)}function T4(i,e,t){let s=e.length,c=G0(t,s);i.uniform1iv(this.addr,c);for(let h=0;h!==s;++h)t.setTexture2D(e[h]||VI,c[h])}function E4(i,e,t){let s=e.length,c=G0(t,s);i.uniform1iv(this.addr,c);for(let h=0;h!==s;++h)t.setTexture3D(e[h]||HI,c[h])}function S4(i,e,t){let s=e.length,c=G0(t,s);i.uniform1iv(this.addr,c);for(let h=0;h!==s;++h)t.setTextureCube(e[h]||jI,c[h])}function A4(i,e,t){let s=e.length,c=G0(t,s);i.uniform1iv(this.addr,c);for(let h=0;h!==s;++h)t.setTexture2DArray(e[h]||GI,c[h])}function M4(i){switch(i){case 5126:return l4;case 35664:return c4;case 35665:return u4;case 35666:return h4;case 35674:return d4;case 35675:return f4;case 35676:return p4;case 5124:case 35670:return m4;case 35667:case 35671:return g4;case 35668:case 35672:return _4;case 35669:case 35673:return y4;case 5125:return v4;case 36294:return x4;case 36295:return b4;case 36296:return w4;case 35678:case 36198:case 36298:case 36306:case 35682:return T4;case 35679:case 36299:case 36307:return E4;case 35680:case 36300:case 36308:case 36293:return S4;case 36289:case 36303:case 36311:case 36292:return A4}}function I4(i,e,t){this.id=i,this.addr=t,this.cache=[],this.setValue=a4(e.type)}function YI(i,e,t){this.id=i,this.addr=t,this.cache=[],this.size=e.size,this.setValue=M4(e.type)}YI.prototype.updateCache=function(i){let e=this.cache;i instanceof Float32Array&&e.length!==i.length&&(this.cache=new Float32Array(i.length)),Ws(e,i)};function JI(i){this.id=i,this.seq=[],this.map={}}JI.prototype.setValue=function(i,e,t){let s=this.seq;for(let c=0,h=s.length;c!==h;++c){let p=s[c];p.setValue(i,e[p.id],t)}};var _w=/(\w+)(\])?(\[|\.)?/g;function $I(i,e){i.seq.push(e),i.map[e.id]=e}function C4(i,e,t){let s=i.name,c=s.length;for(_w.lastIndex=0;;){let h=_w.exec(s),p=_w.lastIndex,r=h[1],x=h[2]==="]",v=h[3];if(x&&(r=r|0),v===void 0||v==="["&&p+2===c){$I(t,v===void 0?new I4(r,i,e):new YI(r,i,e));break}else{let S=t.map[r];S===void 0&&(S=new JI(r),$I(t,S)),t=S}}}function ru(i,e){this.seq=[],this.map={};let t=i.getProgramParameter(e,35718);for(let s=0;s<t;++s){let c=i.getActiveUniform(e,s),h=i.getUniformLocation(e,c.name);C4(c,h,this)}}ru.prototype.setValue=function(i,e,t,s){let c=this.map[e];c!==void 0&&c.setValue(i,t,s)};ru.prototype.setOptional=function(i,e,t){let s=e[t];s!==void 0&&this.setValue(i,t,s)};ru.upload=function(i,e,t,s){for(let c=0,h=e.length;c!==h;++c){let p=e[c],r=t[p.id];r.needsUpdate!==!1&&p.setValue(i,r.value,s)}};ru.seqWithValue=function(i,e){let t=[];for(let s=0,c=i.length;s!==c;++s){let h=i[s];h.id in e&&t.push(h)}return t};function QI(i,e,t){let s=i.createShader(e);return i.shaderSource(s,t),i.compileShader(s),s}var L4=0;function D4(i,e){let t=i.split(`
`),s=[],c=Math.max(e-6,0),h=Math.min(e+6,t.length);for(let p=c;p<h;p++)s.push(p+1+": "+t[p]);return s.join(`
`)}function R4(i){switch(i){case nl:return["Linear","( value )"];case Ar:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function e3(i,e,t){let s=i.getShaderParameter(e,35713),c=i.getShaderInfoLog(e).trim();if(s&&c==="")return"";let h=parseInt(/ERROR: 0:(\d+)/.exec(c)[1]);return t.toUpperCase()+`

`+c+`

`+D4(i.getShaderSource(e),h)}function P4(i,e){let t=R4(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function k4(i,e){let t;switch(e){case qM:t="Linear";break;case XM:t="Reinhard";break;case ZM:t="OptimizedCineon";break;case KM:t="ACESFilmic";break;case YM:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function z4(i){return[i.extensionDerivatives||!!i.envMapCubeUVHeight||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(yg).join(`
`)}function O4(i){let e=[];for(let t in i){let s=i[t];s!==!1&&e.push("#define "+t+" "+s)}return e.join(`
`)}function N4(i,e){let t={},s=i.getProgramParameter(e,35721);for(let c=0;c<s;c++){let h=i.getActiveAttrib(e,c),p=h.name,r=1;h.type===35674&&(r=2),h.type===35675&&(r=3),h.type===35676&&(r=4),t[p]={type:h.type,location:i.getAttribLocation(e,p),locationSize:r}}return t}function yg(i){return i!==""}function t3(i,e){return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function n3(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var F4=/^[ \t]*#include +<([\w\d./]+)>/gm;function yw(i){return i.replace(F4,B4)}function B4(i,e){let t=ki[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return yw(t)}var U4=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,V4=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function r3(i){return i.replace(V4,i3).replace(U4,G4)}function G4(i,e,t,s){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),i3(i,e,t,s)}function i3(i,e,t,s){let c="";for(let h=parseInt(e);h<parseInt(t);h++)c+=s.replace(/\[\s*i\s*\]/g,"[ "+h+" ]").replace(/UNROLLED_LOOP_INDEX/g,h);return c}function s3(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function H4(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===ob?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===EM?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===_f&&(e="SHADOWMAP_TYPE_VSM"),e}function j4(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Ah:case Mh:e="ENVMAP_TYPE_CUBE";break;case Qm:e="ENVMAP_TYPE_CUBE_UV";break}return e}function W4(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Mh:e="ENVMAP_MODE_REFRACTION";break}return e}function q4(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case $m:e="ENVMAP_BLENDING_MULTIPLY";break;case jM:e="ENVMAP_BLENDING_MIX";break;case WM:e="ENVMAP_BLENDING_ADD";break}return e}function X4(i){let e=i.envMapCubeUVHeight;if(e===null)return null;let t=Math.log2(e/32+1)+3,s=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:s,maxMip:t}}function Z4(i,e,t,s){let c=i.getContext(),h=t.defines,p=t.vertexShader,r=t.fragmentShader,x=H4(t),v=j4(t),w=W4(t),S=q4(t),A=X4(t),I=t.isWebGL2?"":z4(t),R=O4(h),k=c.createProgram(),L,z,B=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(L=[R].filter(yg).join(`
`),L.length>0&&(L+=`
`),z=[I,R].filter(yg).join(`
`),z.length>0&&(z+=`
`)):(L=[s3(t),"#define SHADER_NAME "+t.shaderName,R,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+w:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+x:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(yg).join(`
`),z=[I,s3(t),"#define SHADER_NAME "+t.shaderName,R,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+v:"",t.envMap?"#define "+w:"",t.envMap?"#define "+S:"",A?"#define CUBEUV_TEXEL_WIDTH "+A.texelWidth:"",A?"#define CUBEUV_TEXEL_HEIGHT "+A.texelHeight:"",A?"#define CUBEUV_MAX_MIP "+A.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+x:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==tl?"#define TONE_MAPPING":"",t.toneMapping!==tl?ki.tonemapping_pars_fragment:"",t.toneMapping!==tl?k4("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ki.encodings_pars_fragment,P4("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(yg).join(`
`)),p=yw(p),p=t3(p,t),p=n3(p,t),r=yw(r),r=t3(r,t),r=n3(r,t),p=r3(p),r=r3(r),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(B=`#version 300 es
`,L=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+L,z=["#define varying in",t.glslVersion===bf?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===bf?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+z);let $=B+L+p,H=B+z+r,G=QI(c,35633,$),le=QI(c,35632,H);if(c.attachShader(k,G),c.attachShader(k,le),t.index0AttributeName!==void 0?c.bindAttribLocation(k,0,t.index0AttributeName):t.morphTargets===!0&&c.bindAttribLocation(k,0,"position"),c.linkProgram(k),i.debug.checkShaderErrors){let me=c.getProgramInfoLog(k).trim(),se=c.getShaderInfoLog(G).trim(),Y=c.getShaderInfoLog(le).trim(),ye=!0,Xe=!0;if(c.getProgramParameter(k,35714)===!1){ye=!1;let ge=e3(c,G,"vertex"),re=e3(c,le,"fragment");console.error("THREE.WebGLProgram: Shader Error "+c.getError()+" - VALIDATE_STATUS "+c.getProgramParameter(k,35715)+`

Program Info Log: `+me+`
`+ge+`
`+re)}else me!==""?console.warn("THREE.WebGLProgram: Program Info Log:",me):(se===""||Y==="")&&(Xe=!1);Xe&&(this.diagnostics={runnable:ye,programLog:me,vertexShader:{log:se,prefix:L},fragmentShader:{log:Y,prefix:z}})}c.deleteShader(G),c.deleteShader(le);let te;this.getUniforms=function(){return te===void 0&&(te=new ru(c,k)),te};let ue;return this.getAttributes=function(){return ue===void 0&&(ue=N4(c,k)),ue},this.destroy=function(){s.releaseStatesOfProgram(this),c.deleteProgram(k),this.program=void 0},this.name=t.shaderName,this.id=L4++,this.cacheKey=e,this.usedTimes=1,this.program=k,this.vertexShader=G,this.fragmentShader=le,this}var K4=0,o3=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,s=e.fragmentShader,c=this._getShaderStage(t),h=this._getShaderStage(s),p=this._getShaderCacheForMaterial(e);return p.has(c)===!1&&(p.add(c),c.usedTimes++),p.has(h)===!1&&(p.add(h),h.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let s of t)s.usedTimes--,s.usedTimes===0&&this.shaderCache.delete(s.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache;return t.has(e)===!1&&t.set(e,new Set),t.get(e)}_getShaderStage(e){let t=this.shaderCache;if(t.has(e)===!1){let s=new a3(e);t.set(e,s)}return t.get(e)}},a3=class{constructor(e){this.id=K4++,this.code=e,this.usedTimes=0}};function Y4(i,e,t,s,c,h,p){let r=new S0,x=new o3,v=[],w=c.isWebGL2,S=c.logarithmicDepthBuffer,A=c.floatVertexTextures,I=c.maxVertexUniforms,R=c.vertexTextures,k=c.precision,L={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function z(Y){let Xe=Y.skeleton.bones;if(A)return 1024;{let re=Math.floor((I-20)/4),ve=Math.min(re,Xe.length);return ve<Xe.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+Xe.length+" bones. This GPU supports "+ve+"."),0):ve}}function B(Y,ye,Xe,ge,re){let ve=ge.fog,ae=re.geometry,de=Y.isMeshStandardMaterial?ge.environment:null,xe=(Y.isMeshStandardMaterial?t:e).get(Y.envMap||de),De=!!xe&&xe.mapping===Qm?xe.image.height:null,Ce=L[Y.type],pe=re.isSkinnedMesh?z(re):0;Y.precision!==null&&(k=c.getMaxPrecision(Y.precision),k!==Y.precision&&console.warn("THREE.WebGLProgram.getParameters:",Y.precision,"not supported, using",k,"instead."));let xt=ae.morphAttributes.position||ae.morphAttributes.normal||ae.morphAttributes.color,Ct=xt!==void 0?xt.length:0,ct=0;ae.morphAttributes.position!==void 0&&(ct=1),ae.morphAttributes.normal!==void 0&&(ct=2),ae.morphAttributes.color!==void 0&&(ct=3);let Qe,zt,Zt,Lt;if(Ce){let St=js[Ce];Qe=St.vertexShader,zt=St.fragmentShader}else Qe=Y.vertexShader,zt=Y.fragmentShader,x.update(Y),Zt=x.getVertexShaderID(Y),Lt=x.getFragmentShaderID(Y);let Re=i.getRenderTarget(),qt=Y.alphaTest>0,nt=Y.clearcoat>0;return{isWebGL2:w,shaderID:Ce,shaderName:Y.type,vertexShader:Qe,fragmentShader:zt,defines:Y.defines,customVertexShaderID:Zt,customFragmentShaderID:Lt,isRawShaderMaterial:Y.isRawShaderMaterial===!0,glslVersion:Y.glslVersion,precision:k,instancing:re.isInstancedMesh===!0,instancingColor:re.isInstancedMesh===!0&&re.instanceColor!==null,supportsVertexTextures:R,outputEncoding:Re===null?i.outputEncoding:Re.isXRRenderTarget===!0?Re.texture.encoding:nl,map:!!Y.map,matcap:!!Y.matcap,envMap:!!xe,envMapMode:xe&&xe.mapping,envMapCubeUVHeight:De,lightMap:!!Y.lightMap,aoMap:!!Y.aoMap,emissiveMap:!!Y.emissiveMap,bumpMap:!!Y.bumpMap,normalMap:!!Y.normalMap,objectSpaceNormalMap:Y.normalMapType===yI,tangentSpaceNormalMap:Y.normalMapType===kh,decodeVideoTexture:!!Y.map&&Y.map.isVideoTexture===!0&&Y.map.encoding===Ar,clearcoat:nt,clearcoatMap:nt&&!!Y.clearcoatMap,clearcoatRoughnessMap:nt&&!!Y.clearcoatRoughnessMap,clearcoatNormalMap:nt&&!!Y.clearcoatNormalMap,displacementMap:!!Y.displacementMap,roughnessMap:!!Y.roughnessMap,metalnessMap:!!Y.metalnessMap,specularMap:!!Y.specularMap,specularIntensityMap:!!Y.specularIntensityMap,specularColorMap:!!Y.specularColorMap,opaque:Y.transparent===!1&&Y.blending===Eh,alphaMap:!!Y.alphaMap,alphaTest:qt,gradientMap:!!Y.gradientMap,sheen:Y.sheen>0,sheenColorMap:!!Y.sheenColorMap,sheenRoughnessMap:!!Y.sheenRoughnessMap,transmission:Y.transmission>0,transmissionMap:!!Y.transmissionMap,thicknessMap:!!Y.thicknessMap,combine:Y.combine,vertexTangents:!!Y.normalMap&&!!ae.attributes.tangent,vertexColors:Y.vertexColors,vertexAlphas:Y.vertexColors===!0&&!!ae.attributes.color&&ae.attributes.color.itemSize===4,vertexUvs:!!Y.map||!!Y.bumpMap||!!Y.normalMap||!!Y.specularMap||!!Y.alphaMap||!!Y.emissiveMap||!!Y.roughnessMap||!!Y.metalnessMap||!!Y.clearcoatMap||!!Y.clearcoatRoughnessMap||!!Y.clearcoatNormalMap||!!Y.displacementMap||!!Y.transmissionMap||!!Y.thicknessMap||!!Y.specularIntensityMap||!!Y.specularColorMap||!!Y.sheenColorMap||!!Y.sheenRoughnessMap,uvsVertexOnly:!(!!Y.map||!!Y.bumpMap||!!Y.normalMap||!!Y.specularMap||!!Y.alphaMap||!!Y.emissiveMap||!!Y.roughnessMap||!!Y.metalnessMap||!!Y.clearcoatNormalMap||Y.transmission>0||!!Y.transmissionMap||!!Y.thicknessMap||!!Y.specularIntensityMap||!!Y.specularColorMap||Y.sheen>0||!!Y.sheenColorMap||!!Y.sheenRoughnessMap)&&!!Y.displacementMap,fog:!!ve,useFog:Y.fog,fogExp2:ve&&ve.isFogExp2,flatShading:!!Y.flatShading,sizeAttenuation:Y.sizeAttenuation,logarithmicDepthBuffer:S,skinning:re.isSkinnedMesh===!0&&pe>0,maxBones:pe,useVertexTexture:A,morphTargets:ae.morphAttributes.position!==void 0,morphNormals:ae.morphAttributes.normal!==void 0,morphColors:ae.morphAttributes.color!==void 0,morphTargetsCount:Ct,morphTextureStride:ct,numDirLights:ye.directional.length,numPointLights:ye.point.length,numSpotLights:ye.spot.length,numRectAreaLights:ye.rectArea.length,numHemiLights:ye.hemi.length,numDirLightShadows:ye.directionalShadowMap.length,numPointLightShadows:ye.pointShadowMap.length,numSpotLightShadows:ye.spotShadowMap.length,numClippingPlanes:p.numPlanes,numClipIntersection:p.numIntersection,dithering:Y.dithering,shadowMapEnabled:i.shadowMap.enabled&&Xe.length>0,shadowMapType:i.shadowMap.type,toneMapping:Y.toneMapped?i.toneMapping:tl,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:Y.premultipliedAlpha,doubleSided:Y.side===el,flipSided:Y.side===To,depthPacking:Y.depthPacking!==void 0?Y.depthPacking:!1,index0AttributeName:Y.index0AttributeName,extensionDerivatives:Y.extensions&&Y.extensions.derivatives,extensionFragDepth:Y.extensions&&Y.extensions.fragDepth,extensionDrawBuffers:Y.extensions&&Y.extensions.drawBuffers,extensionShaderTextureLOD:Y.extensions&&Y.extensions.shaderTextureLOD,rendererExtensionFragDepth:w||s.has("EXT_frag_depth"),rendererExtensionDrawBuffers:w||s.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:w||s.has("EXT_shader_texture_lod"),customProgramCacheKey:Y.customProgramCacheKey()}}function $(Y){let ye=[];if(Y.shaderID?ye.push(Y.shaderID):(ye.push(Y.customVertexShaderID),ye.push(Y.customFragmentShaderID)),Y.defines!==void 0)for(let Xe in Y.defines)ye.push(Xe),ye.push(Y.defines[Xe]);return Y.isRawShaderMaterial===!1&&(H(ye,Y),G(ye,Y),ye.push(i.outputEncoding)),ye.push(Y.customProgramCacheKey),ye.join()}function H(Y,ye){Y.push(ye.precision),Y.push(ye.outputEncoding),Y.push(ye.envMapMode),Y.push(ye.envMapCubeUVHeight),Y.push(ye.combine),Y.push(ye.vertexUvs),Y.push(ye.fogExp2),Y.push(ye.sizeAttenuation),Y.push(ye.maxBones),Y.push(ye.morphTargetsCount),Y.push(ye.morphAttributeCount),Y.push(ye.numDirLights),Y.push(ye.numPointLights),Y.push(ye.numSpotLights),Y.push(ye.numHemiLights),Y.push(ye.numRectAreaLights),Y.push(ye.numDirLightShadows),Y.push(ye.numPointLightShadows),Y.push(ye.numSpotLightShadows),Y.push(ye.shadowMapType),Y.push(ye.toneMapping),Y.push(ye.numClippingPlanes),Y.push(ye.numClipIntersection)}function G(Y,ye){r.disableAll(),ye.isWebGL2&&r.enable(0),ye.supportsVertexTextures&&r.enable(1),ye.instancing&&r.enable(2),ye.instancingColor&&r.enable(3),ye.map&&r.enable(4),ye.matcap&&r.enable(5),ye.envMap&&r.enable(6),ye.lightMap&&r.enable(7),ye.aoMap&&r.enable(8),ye.emissiveMap&&r.enable(9),ye.bumpMap&&r.enable(10),ye.normalMap&&r.enable(11),ye.objectSpaceNormalMap&&r.enable(12),ye.tangentSpaceNormalMap&&r.enable(13),ye.clearcoat&&r.enable(14),ye.clearcoatMap&&r.enable(15),ye.clearcoatRoughnessMap&&r.enable(16),ye.clearcoatNormalMap&&r.enable(17),ye.displacementMap&&r.enable(18),ye.specularMap&&r.enable(19),ye.roughnessMap&&r.enable(20),ye.metalnessMap&&r.enable(21),ye.gradientMap&&r.enable(22),ye.alphaMap&&r.enable(23),ye.alphaTest&&r.enable(24),ye.vertexColors&&r.enable(25),ye.vertexAlphas&&r.enable(26),ye.vertexUvs&&r.enable(27),ye.vertexTangents&&r.enable(28),ye.uvsVertexOnly&&r.enable(29),ye.fog&&r.enable(30),Y.push(r.mask),r.disableAll(),ye.useFog&&r.enable(0),ye.flatShading&&r.enable(1),ye.logarithmicDepthBuffer&&r.enable(2),ye.skinning&&r.enable(3),ye.useVertexTexture&&r.enable(4),ye.morphTargets&&r.enable(5),ye.morphNormals&&r.enable(6),ye.morphColors&&r.enable(7),ye.premultipliedAlpha&&r.enable(8),ye.shadowMapEnabled&&r.enable(9),ye.physicallyCorrectLights&&r.enable(10),ye.doubleSided&&r.enable(11),ye.flipSided&&r.enable(12),ye.depthPacking&&r.enable(13),ye.dithering&&r.enable(14),ye.specularIntensityMap&&r.enable(15),ye.specularColorMap&&r.enable(16),ye.transmission&&r.enable(17),ye.transmissionMap&&r.enable(18),ye.thicknessMap&&r.enable(19),ye.sheen&&r.enable(20),ye.sheenColorMap&&r.enable(21),ye.sheenRoughnessMap&&r.enable(22),ye.decodeVideoTexture&&r.enable(23),ye.opaque&&r.enable(24),Y.push(r.mask)}function le(Y){let ye=L[Y.type],Xe;if(ye){let ge=js[ye];Xe=pg.clone(ge.uniforms)}else Xe=Y.uniforms;return Xe}function te(Y,ye){let Xe;for(let ge=0,re=v.length;ge<re;ge++){let ve=v[ge];if(ve.cacheKey===ye){Xe=ve,++Xe.usedTimes;break}}return Xe===void 0&&(Xe=new Z4(i,ye,Y,h),v.push(Xe)),Xe}function ue(Y){if(--Y.usedTimes==0){let ye=v.indexOf(Y);v[ye]=v[v.length-1],v.pop(),Y.destroy()}}function me(Y){x.remove(Y)}function se(){x.dispose()}return{getParameters:B,getProgramCacheKey:$,getUniforms:le,acquireProgram:te,releaseProgram:ue,releaseShaderCache:me,programs:v,dispose:se}}function J4(){let i=new WeakMap;function e(h){let p=i.get(h);return p===void 0&&(p={},i.set(h,p)),p}function t(h){i.delete(h)}function s(h,p,r){i.get(h)[p]=r}function c(){i=new WeakMap}return{get:e,remove:t,update:s,dispose:c}}function $4(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function l3(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function c3(){let i=[],e=0,t=[],s=[],c=[];function h(){e=0,t.length=0,s.length=0,c.length=0}function p(S,A,I,R,k,L){let z=i[e];return z===void 0?(z={id:S.id,object:S,geometry:A,material:I,groupOrder:R,renderOrder:S.renderOrder,z:k,group:L},i[e]=z):(z.id=S.id,z.object=S,z.geometry=A,z.material=I,z.groupOrder=R,z.renderOrder=S.renderOrder,z.z=k,z.group=L),e++,z}function r(S,A,I,R,k,L){let z=p(S,A,I,R,k,L);I.transmission>0?s.push(z):I.transparent===!0?c.push(z):t.push(z)}function x(S,A,I,R,k,L){let z=p(S,A,I,R,k,L);I.transmission>0?s.unshift(z):I.transparent===!0?c.unshift(z):t.unshift(z)}function v(S,A){t.length>1&&t.sort(S||$4),s.length>1&&s.sort(A||l3),c.length>1&&c.sort(A||l3)}function w(){for(let S=e,A=i.length;S<A;S++){let I=i[S];if(I.id===null)break;I.id=null,I.object=null,I.geometry=null,I.material=null,I.group=null}}return{opaque:t,transmissive:s,transparent:c,init:h,push:r,unshift:x,finish:w,sort:v}}function Q4(){let i=new WeakMap;function e(s,c){let h;return i.has(s)===!1?(h=new c3,i.set(s,[h])):c>=i.get(s).length?(h=new c3,i.get(s).push(h)):h=i.get(s)[c],h}function t(){i=new WeakMap}return{get:e,dispose:t}}function eU(){let i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Be,color:new jn};break;case"SpotLight":t={position:new Be,direction:new Be,color:new jn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Be,color:new jn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Be,skyColor:new jn,groundColor:new jn};break;case"RectAreaLight":t={color:new jn,position:new Be,halfWidth:new Be,halfHeight:new Be};break}return i[e.id]=t,t}}}function tU(){let i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wt};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wt};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wt,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}var nU=0;function iU(i,e){return(e.castShadow?1:0)-(i.castShadow?1:0)}function rU(i,e){let t=new eU,s=tU(),c={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let w=0;w<9;w++)c.probe.push(new Be);let h=new Be,p=new Jn,r=new Jn;function x(w,S){let A=0,I=0,R=0;for(let me=0;me<9;me++)c.probe[me].set(0,0,0);let k=0,L=0,z=0,B=0,$=0,H=0,G=0,le=0;w.sort(iU);let te=S!==!0?Math.PI:1;for(let me=0,se=w.length;me<se;me++){let Y=w[me],ye=Y.color,Xe=Y.intensity,ge=Y.distance,re=Y.shadow&&Y.shadow.map?Y.shadow.map.texture:null;if(Y.isAmbientLight)A+=ye.r*Xe*te,I+=ye.g*Xe*te,R+=ye.b*Xe*te;else if(Y.isLightProbe)for(let ve=0;ve<9;ve++)c.probe[ve].addScaledVector(Y.sh.coefficients[ve],Xe);else if(Y.isDirectionalLight){let ve=t.get(Y);if(ve.color.copy(Y.color).multiplyScalar(Y.intensity*te),Y.castShadow){let ae=Y.shadow,de=s.get(Y);de.shadowBias=ae.bias,de.shadowNormalBias=ae.normalBias,de.shadowRadius=ae.radius,de.shadowMapSize=ae.mapSize,c.directionalShadow[k]=de,c.directionalShadowMap[k]=re,c.directionalShadowMatrix[k]=Y.shadow.matrix,H++}c.directional[k]=ve,k++}else if(Y.isSpotLight){let ve=t.get(Y);if(ve.position.setFromMatrixPosition(Y.matrixWorld),ve.color.copy(ye).multiplyScalar(Xe*te),ve.distance=ge,ve.coneCos=Math.cos(Y.angle),ve.penumbraCos=Math.cos(Y.angle*(1-Y.penumbra)),ve.decay=Y.decay,Y.castShadow){let ae=Y.shadow,de=s.get(Y);de.shadowBias=ae.bias,de.shadowNormalBias=ae.normalBias,de.shadowRadius=ae.radius,de.shadowMapSize=ae.mapSize,c.spotShadow[z]=de,c.spotShadowMap[z]=re,c.spotShadowMatrix[z]=Y.shadow.matrix,le++}c.spot[z]=ve,z++}else if(Y.isRectAreaLight){let ve=t.get(Y);ve.color.copy(ye).multiplyScalar(Xe),ve.halfWidth.set(Y.width*.5,0,0),ve.halfHeight.set(0,Y.height*.5,0),c.rectArea[B]=ve,B++}else if(Y.isPointLight){let ve=t.get(Y);if(ve.color.copy(Y.color).multiplyScalar(Y.intensity*te),ve.distance=Y.distance,ve.decay=Y.decay,Y.castShadow){let ae=Y.shadow,de=s.get(Y);de.shadowBias=ae.bias,de.shadowNormalBias=ae.normalBias,de.shadowRadius=ae.radius,de.shadowMapSize=ae.mapSize,de.shadowCameraNear=ae.camera.near,de.shadowCameraFar=ae.camera.far,c.pointShadow[L]=de,c.pointShadowMap[L]=re,c.pointShadowMatrix[L]=Y.shadow.matrix,G++}c.point[L]=ve,L++}else if(Y.isHemisphereLight){let ve=t.get(Y);ve.skyColor.copy(Y.color).multiplyScalar(Xe*te),ve.groundColor.copy(Y.groundColor).multiplyScalar(Xe*te),c.hemi[$]=ve,$++}}B>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(c.rectAreaLTC1=En.LTC_FLOAT_1,c.rectAreaLTC2=En.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(c.rectAreaLTC1=En.LTC_HALF_1,c.rectAreaLTC2=En.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),c.ambient[0]=A,c.ambient[1]=I,c.ambient[2]=R;let ue=c.hash;(ue.directionalLength!==k||ue.pointLength!==L||ue.spotLength!==z||ue.rectAreaLength!==B||ue.hemiLength!==$||ue.numDirectionalShadows!==H||ue.numPointShadows!==G||ue.numSpotShadows!==le)&&(c.directional.length=k,c.spot.length=z,c.rectArea.length=B,c.point.length=L,c.hemi.length=$,c.directionalShadow.length=H,c.directionalShadowMap.length=H,c.pointShadow.length=G,c.pointShadowMap.length=G,c.spotShadow.length=le,c.spotShadowMap.length=le,c.directionalShadowMatrix.length=H,c.pointShadowMatrix.length=G,c.spotShadowMatrix.length=le,ue.directionalLength=k,ue.pointLength=L,ue.spotLength=z,ue.rectAreaLength=B,ue.hemiLength=$,ue.numDirectionalShadows=H,ue.numPointShadows=G,ue.numSpotShadows=le,c.version=nU++)}function v(w,S){let A=0,I=0,R=0,k=0,L=0,z=S.matrixWorldInverse;for(let B=0,$=w.length;B<$;B++){let H=w[B];if(H.isDirectionalLight){let G=c.directional[A];G.direction.setFromMatrixPosition(H.matrixWorld),h.setFromMatrixPosition(H.target.matrixWorld),G.direction.sub(h),G.direction.transformDirection(z),A++}else if(H.isSpotLight){let G=c.spot[R];G.position.setFromMatrixPosition(H.matrixWorld),G.position.applyMatrix4(z),G.direction.setFromMatrixPosition(H.matrixWorld),h.setFromMatrixPosition(H.target.matrixWorld),G.direction.sub(h),G.direction.transformDirection(z),R++}else if(H.isRectAreaLight){let G=c.rectArea[k];G.position.setFromMatrixPosition(H.matrixWorld),G.position.applyMatrix4(z),r.identity(),p.copy(H.matrixWorld),p.premultiply(z),r.extractRotation(p),G.halfWidth.set(H.width*.5,0,0),G.halfHeight.set(0,H.height*.5,0),G.halfWidth.applyMatrix4(r),G.halfHeight.applyMatrix4(r),k++}else if(H.isPointLight){let G=c.point[I];G.position.setFromMatrixPosition(H.matrixWorld),G.position.applyMatrix4(z),I++}else if(H.isHemisphereLight){let G=c.hemi[L];G.direction.setFromMatrixPosition(H.matrixWorld),G.direction.transformDirection(z),G.direction.normalize(),L++}}}return{setup:x,setupView:v,state:c}}function u3(i,e){let t=new rU(i,e),s=[],c=[];function h(){s.length=0,c.length=0}function p(S){s.push(S)}function r(S){c.push(S)}function x(S){t.setup(s,S)}function v(S){t.setupView(s,S)}return{init:h,state:{lightsArray:s,shadowsArray:c,lights:t},setupLights:x,setupLightsView:v,pushLight:p,pushShadow:r}}function sU(i,e){let t=new WeakMap;function s(h,p=0){let r;return t.has(h)===!1?(r=new u3(i,e),t.set(h,[r])):p>=t.get(h).length?(r=new u3(i,e),t.get(h).push(r)):r=t.get(h)[p],r}function c(){t=new WeakMap}return{get:s,dispose:c}}var vg=class extends Zr{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=gI,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}};vg.prototype.isMeshDepthMaterial=!0;var xg=class extends Zr{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new Be,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};xg.prototype.isMeshDistanceMaterial=!0;var oU=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,aU=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function h3(i,e,t){let s=new Ff,c=new Wt,h=new Wt,p=new Ui,r=new vg({depthPacking:_I}),x=new xg,v={},w=t.maxTextureSize,S={0:To,1:yf,2:el},A=new eo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Wt},radius:{value:4}},vertexShader:oU,fragmentShader:aU}),I=A.clone();I.defines.HORIZONTAL_PASS=1;let R=new er;R.setAttribute("position",new xr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let k=new Hr(R,A),L=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ob,this.render=function(H,G,le){if(L.enabled===!1||L.autoUpdate===!1&&L.needsUpdate===!1||H.length===0)return;let te=i.getRenderTarget(),ue=i.getActiveCubeFace(),me=i.getActiveMipmapLevel(),se=i.state;se.setBlending(Bl),se.buffers.color.setClear(1,1,1,1),se.buffers.depth.setTest(!0),se.setScissorTest(!1);for(let Y=0,ye=H.length;Y<ye;Y++){let Xe=H[Y],ge=Xe.shadow;if(ge===void 0){console.warn("THREE.WebGLShadowMap:",Xe,"has no shadow.");continue}if(ge.autoUpdate===!1&&ge.needsUpdate===!1)continue;c.copy(ge.mapSize);let re=ge.getFrameExtents();if(c.multiply(re),h.copy(ge.mapSize),(c.x>w||c.y>w)&&(c.x>w&&(h.x=Math.floor(w/re.x),c.x=h.x*re.x,ge.mapSize.x=h.x),c.y>w&&(h.y=Math.floor(w/re.y),c.y=h.y*re.y,ge.mapSize.y=h.y)),ge.map===null&&!ge.isPointLightShadow&&this.type===_f&&(ge.map=new Qs(c.x,c.y),ge.map.texture.name=Xe.name+".shadowMap",ge.mapPass=new Qs(c.x,c.y),ge.camera.updateProjectionMatrix()),ge.map===null){let ae={minFilter:Qi,magFilter:Qi,format:ws};ge.map=new Qs(c.x,c.y,ae),ge.map.texture.name=Xe.name+".shadowMap",ge.camera.updateProjectionMatrix()}i.setRenderTarget(ge.map),i.clear();let ve=ge.getViewportCount();for(let ae=0;ae<ve;ae++){let de=ge.getViewport(ae);p.set(h.x*de.x,h.y*de.y,h.x*de.z,h.y*de.w),se.viewport(p),ge.updateMatrices(Xe,ae),s=ge.getFrustum(),$(G,le,ge.camera,Xe,this.type)}!ge.isPointLightShadow&&this.type===_f&&z(ge,le),ge.needsUpdate=!1}L.needsUpdate=!1,i.setRenderTarget(te,ue,me)};function z(H,G){let le=e.update(k);A.defines.VSM_SAMPLES!==H.blurSamples&&(A.defines.VSM_SAMPLES=H.blurSamples,I.defines.VSM_SAMPLES=H.blurSamples,A.needsUpdate=!0,I.needsUpdate=!0),A.uniforms.shadow_pass.value=H.map.texture,A.uniforms.resolution.value=H.mapSize,A.uniforms.radius.value=H.radius,i.setRenderTarget(H.mapPass),i.clear(),i.renderBufferDirect(G,null,le,A,k,null),I.uniforms.shadow_pass.value=H.mapPass.texture,I.uniforms.resolution.value=H.mapSize,I.uniforms.radius.value=H.radius,i.setRenderTarget(H.map),i.clear(),i.renderBufferDirect(G,null,le,I,k,null)}function B(H,G,le,te,ue,me){let se=null,Y=le.isPointLight===!0?H.customDistanceMaterial:H.customDepthMaterial;if(Y!==void 0?se=Y:se=le.isPointLight===!0?x:r,i.localClippingEnabled&&G.clipShadows===!0&&G.clippingPlanes.length!==0||G.displacementMap&&G.displacementScale!==0||G.alphaMap&&G.alphaTest>0){let ye=se.uuid,Xe=G.uuid,ge=v[ye];ge===void 0&&(ge={},v[ye]=ge);let re=ge[Xe];re===void 0&&(re=se.clone(),ge[Xe]=re),se=re}return se.visible=G.visible,se.wireframe=G.wireframe,me===_f?se.side=G.shadowSide!==null?G.shadowSide:G.side:se.side=G.shadowSide!==null?G.shadowSide:S[G.side],se.alphaMap=G.alphaMap,se.alphaTest=G.alphaTest,se.clipShadows=G.clipShadows,se.clippingPlanes=G.clippingPlanes,se.clipIntersection=G.clipIntersection,se.displacementMap=G.displacementMap,se.displacementScale=G.displacementScale,se.displacementBias=G.displacementBias,se.wireframeLinewidth=G.wireframeLinewidth,se.linewidth=G.linewidth,le.isPointLight===!0&&se.isMeshDistanceMaterial===!0&&(se.referencePosition.setFromMatrixPosition(le.matrixWorld),se.nearDistance=te,se.farDistance=ue),se}function $(H,G,le,te,ue){if(H.visible===!1)return;if(H.layers.test(G.layers)&&(H.isMesh||H.isLine||H.isPoints)&&(H.castShadow||H.receiveShadow&&ue===_f)&&(!H.frustumCulled||s.intersectsObject(H))){H.modelViewMatrix.multiplyMatrices(le.matrixWorldInverse,H.matrixWorld);let Y=e.update(H),ye=H.material;if(Array.isArray(ye)){let Xe=Y.groups;for(let ge=0,re=Xe.length;ge<re;ge++){let ve=Xe[ge],ae=ye[ve.materialIndex];if(ae&&ae.visible){let de=B(H,ae,te,le.near,le.far,ue);i.renderBufferDirect(le,null,Y,de,H,ve)}}}else if(ye.visible){let Xe=B(H,ye,te,le.near,le.far,ue);i.renderBufferDirect(le,null,Y,Xe,H,null)}}let se=H.children;for(let Y=0,ye=se.length;Y<ye;Y++)$(se[Y],G,le,te,ue)}}function lU(i,e,t){let s=t.isWebGL2;function c(){let Je=!1,sn=new Ui,nn=null,An=new Ui(0,0,0,0);return{setMask:function(Et){nn!==Et&&!Je&&(i.colorMask(Et,Et,Et,Et),nn=Et)},setLocked:function(Et){Je=Et},setClear:function(Et,Dn,un,Nn,Kn){Kn===!0&&(Et*=Nn,Dn*=Nn,un*=Nn),sn.set(Et,Dn,un,Nn),An.equals(sn)===!1&&(i.clearColor(Et,Dn,un,Nn),An.copy(sn))},reset:function(){Je=!1,nn=null,An.set(-1,0,0,0)}}}function h(){let Je=!1,sn=null,nn=null,An=null;return{setTest:function(Et){Et?ct(2929):Qe(2929)},setMask:function(Et){sn!==Et&&!Je&&(i.depthMask(Et),sn=Et)},setFunc:function(Et){if(nn!==Et){if(Et)switch(Et){case NM:i.depthFunc(512);break;case FM:i.depthFunc(519);break;case BM:i.depthFunc(513);break;case t0:i.depthFunc(515);break;case UM:i.depthFunc(514);break;case VM:i.depthFunc(518);break;case GM:i.depthFunc(516);break;case HM:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);nn=Et}},setLocked:function(Et){Je=Et},setClear:function(Et){An!==Et&&(i.clearDepth(Et),An=Et)},reset:function(){Je=!1,sn=null,nn=null,An=null}}}function p(){let Je=!1,sn=null,nn=null,An=null,Et=null,Dn=null,un=null,Nn=null,Kn=null;return{setTest:function(Gn){Je||(Gn?ct(2960):Qe(2960))},setMask:function(Gn){sn!==Gn&&!Je&&(i.stencilMask(Gn),sn=Gn)},setFunc:function(Gn,Ei,ln){(nn!==Gn||An!==Ei||Et!==ln)&&(i.stencilFunc(Gn,Ei,ln),nn=Gn,An=Ei,Et=ln)},setOp:function(Gn,Ei,ln){(Dn!==Gn||un!==Ei||Nn!==ln)&&(i.stencilOp(Gn,Ei,ln),Dn=Gn,un=Ei,Nn=ln)},setLocked:function(Gn){Je=Gn},setClear:function(Gn){Kn!==Gn&&(i.clearStencil(Gn),Kn=Gn)},reset:function(){Je=!1,sn=null,nn=null,An=null,Et=null,Dn=null,un=null,Nn=null,Kn=null}}}let r=new c,x=new h,v=new p,w={},S={},A=new WeakMap,I=[],R=null,k=!1,L=null,z=null,B=null,$=null,H=null,G=null,le=null,te=!1,ue=null,me=null,se=null,Y=null,ye=null,Xe=i.getParameter(35661),ge=!1,re=0,ve=i.getParameter(7938);ve.indexOf("WebGL")!==-1?(re=parseFloat(/^WebGL (\d)/.exec(ve)[1]),ge=re>=1):ve.indexOf("OpenGL ES")!==-1&&(re=parseFloat(/^OpenGL ES (\d)/.exec(ve)[1]),ge=re>=2);let ae=null,de={},xe=i.getParameter(3088),De=i.getParameter(2978),Ce=new Ui().fromArray(xe),pe=new Ui().fromArray(De);function xt(Je,sn,nn){let An=new Uint8Array(4),Et=i.createTexture();i.bindTexture(Je,Et),i.texParameteri(Je,10241,9728),i.texParameteri(Je,10240,9728);for(let Dn=0;Dn<nn;Dn++)i.texImage2D(sn+Dn,0,6408,1,1,0,6408,5121,An);return Et}let Ct={};Ct[3553]=xt(3553,3553,1),Ct[34067]=xt(34067,34069,6),r.setClear(0,0,0,1),x.setClear(1),v.setClear(0),ct(2929),x.setFunc(t0),St(!1),ut(sb),ct(2884),nt(Bl);function ct(Je){w[Je]!==!0&&(i.enable(Je),w[Je]=!0)}function Qe(Je){w[Je]!==!1&&(i.disable(Je),w[Je]=!1)}function zt(Je,sn){return S[Je]!==sn?(i.bindFramebuffer(Je,sn),S[Je]=sn,s&&(Je===36009&&(S[36160]=sn),Je===36160&&(S[36009]=sn)),!0):!1}function Zt(Je,sn){let nn=I,An=!1;if(Je)if(nn=A.get(sn),nn===void 0&&(nn=[],A.set(sn,nn)),Je.isWebGLMultipleRenderTargets){let Et=Je.texture;if(nn.length!==Et.length||nn[0]!==36064){for(let Dn=0,un=Et.length;Dn<un;Dn++)nn[Dn]=36064+Dn;nn.length=Et.length,An=!0}}else nn[0]!==36064&&(nn[0]=36064,An=!0);else nn[0]!==1029&&(nn[0]=1029,An=!0);An&&(t.isWebGL2?i.drawBuffers(nn):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(nn))}function Lt(Je){return R!==Je?(i.useProgram(Je),R=Je,!0):!1}let Re={[Sh]:32774,[AM]:32778,[MM]:32779};if(s)Re[hb]=32775,Re[db]=32776;else{let Je=e.get("EXT_blend_minmax");Je!==null&&(Re[hb]=Je.MIN_EXT,Re[db]=Je.MAX_EXT)}let qt={[IM]:0,[CM]:1,[LM]:768,[fb]:770,[OM]:776,[kM]:774,[RM]:772,[DM]:769,[pb]:771,[zM]:775,[PM]:773};function nt(Je,sn,nn,An,Et,Dn,un,Nn){if(Je===Bl){k===!0&&(Qe(3042),k=!1);return}if(k===!1&&(ct(3042),k=!0),Je!==SM){if(Je!==L||Nn!==te){if((z!==Sh||H!==Sh)&&(i.blendEquation(32774),z=Sh,H=Sh),Nn)switch(Je){case Eh:i.blendFuncSeparate(1,771,1,771);break;case lb:i.blendFunc(1,1);break;case cb:i.blendFuncSeparate(0,769,0,1);break;case ub:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Je);break}else switch(Je){case Eh:i.blendFuncSeparate(770,771,1,771);break;case lb:i.blendFunc(770,1);break;case cb:i.blendFuncSeparate(0,769,0,1);break;case ub:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Je);break}B=null,$=null,G=null,le=null,L=Je,te=Nn}return}Et=Et||sn,Dn=Dn||nn,un=un||An,(sn!==z||Et!==H)&&(i.blendEquationSeparate(Re[sn],Re[Et]),z=sn,H=Et),(nn!==B||An!==$||Dn!==G||un!==le)&&(i.blendFuncSeparate(qt[nn],qt[An],qt[Dn],qt[un]),B=nn,$=An,G=Dn,le=un),L=Je,te=null}function at(Je,sn){Je.side===el?Qe(2884):ct(2884);let nn=Je.side===To;sn&&(nn=!nn),St(nn),Je.blending===Eh&&Je.transparent===!1?nt(Bl):nt(Je.blending,Je.blendEquation,Je.blendSrc,Je.blendDst,Je.blendEquationAlpha,Je.blendSrcAlpha,Je.blendDstAlpha,Je.premultipliedAlpha),x.setFunc(Je.depthFunc),x.setTest(Je.depthTest),x.setMask(Je.depthWrite),r.setMask(Je.colorWrite);let An=Je.stencilWrite;v.setTest(An),An&&(v.setMask(Je.stencilWriteMask),v.setFunc(Je.stencilFunc,Je.stencilRef,Je.stencilFuncMask),v.setOp(Je.stencilFail,Je.stencilZFail,Je.stencilZPass)),Pn(Je.polygonOffset,Je.polygonOffsetFactor,Je.polygonOffsetUnits),Je.alphaToCoverage===!0?ct(32926):Qe(32926)}function St(Je){ue!==Je&&(Je?i.frontFace(2304):i.frontFace(2305),ue=Je)}function ut(Je){Je!==wM?(ct(2884),Je!==me&&(Je===sb?i.cullFace(1029):Je===TM?i.cullFace(1028):i.cullFace(1032))):Qe(2884),me=Je}function Ot(Je){Je!==se&&(ge&&i.lineWidth(Je),se=Je)}function Pn(Je,sn,nn){Je?(ct(32823),(Y!==sn||ye!==nn)&&(i.polygonOffset(sn,nn),Y=sn,ye=nn)):Qe(32823)}function bn(Je){Je?ct(3089):Qe(3089)}function wn(Je){Je===void 0&&(Je=33984+Xe-1),ae!==Je&&(i.activeTexture(Je),ae=Je)}function xn(Je,sn){ae===null&&wn();let nn=de[ae];nn===void 0&&(nn={type:void 0,texture:void 0},de[ae]=nn),(nn.type!==Je||nn.texture!==sn)&&(i.bindTexture(Je,sn||Ct[Je]),nn.type=Je,nn.texture=sn)}function ei(){let Je=de[ae];Je!==void 0&&Je.type!==void 0&&(i.bindTexture(Je.type,null),Je.type=void 0,Je.texture=void 0)}function ze(){try{i.compressedTexImage2D.apply(i,arguments)}catch(Je){console.error("THREE.WebGLState:",Je)}}function Ae(){try{i.texSubImage2D.apply(i,arguments)}catch(Je){console.error("THREE.WebGLState:",Je)}}function gt(){try{i.texSubImage3D.apply(i,arguments)}catch(Je){console.error("THREE.WebGLState:",Je)}}function Rt(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(Je){console.error("THREE.WebGLState:",Je)}}function Xt(){try{i.texStorage2D.apply(i,arguments)}catch(Je){console.error("THREE.WebGLState:",Je)}}function gn(){try{i.texStorage3D.apply(i,arguments)}catch(Je){console.error("THREE.WebGLState:",Je)}}function Tn(){try{i.texImage2D.apply(i,arguments)}catch(Je){console.error("THREE.WebGLState:",Je)}}function Ee(){try{i.texImage3D.apply(i,arguments)}catch(Je){console.error("THREE.WebGLState:",Je)}}function et(Je){Ce.equals(Je)===!1&&(i.scissor(Je.x,Je.y,Je.z,Je.w),Ce.copy(Je))}function rn(Je){pe.equals(Je)===!1&&(i.viewport(Je.x,Je.y,Je.z,Je.w),pe.copy(Je))}function tn(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),s===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),w={},ae=null,de={},S={},A=new WeakMap,I=[],R=null,k=!1,L=null,z=null,B=null,$=null,H=null,G=null,le=null,te=!1,ue=null,me=null,se=null,Y=null,ye=null,Ce.set(0,0,i.canvas.width,i.canvas.height),pe.set(0,0,i.canvas.width,i.canvas.height),r.reset(),x.reset(),v.reset()}return{buffers:{color:r,depth:x,stencil:v},enable:ct,disable:Qe,bindFramebuffer:zt,drawBuffers:Zt,useProgram:Lt,setBlending:nt,setMaterial:at,setFlipSided:St,setCullFace:ut,setLineWidth:Ot,setPolygonOffset:Pn,setScissorTest:bn,activeTexture:wn,bindTexture:xn,unbindTexture:ei,compressedTexImage2D:ze,texImage2D:Tn,texImage3D:Ee,texStorage2D:Xt,texStorage3D:gn,texSubImage2D:Ae,texSubImage3D:gt,compressedTexSubImage2D:Rt,scissor:et,viewport:rn,reset:tn}}function cU(i,e,t,s,c,h,p){let r=c.isWebGL2,x=c.maxTextures,v=c.maxCubemapSize,w=c.maxTextureSize,S=c.maxSamples,A=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,I=/OculusBrowser/g.test(navigator.userAgent),R=new WeakMap,k,L=new WeakMap,z=!1;try{z=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(ze){}function B(ze,Ae){return z?new OffscreenCanvas(ze,Ae):ug("canvas")}function $(ze,Ae,gt,Rt){let Xt=1;if((ze.width>Rt||ze.height>Rt)&&(Xt=Rt/Math.max(ze.width,ze.height)),Xt<1||Ae===!0)if(typeof HTMLImageElement!="undefined"&&ze instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&ze instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&ze instanceof ImageBitmap){let gn=Ae?f0:Math.floor,Tn=gn(Xt*ze.width),Ee=gn(Xt*ze.height);k===void 0&&(k=B(Tn,Ee));let et=gt?B(Tn,Ee):k;return et.width=Tn,et.height=Ee,et.getContext("2d").drawImage(ze,0,0,Tn,Ee),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ze.width+"x"+ze.height+") to ("+Tn+"x"+Ee+")."),et}else return"data"in ze&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ze.width+"x"+ze.height+")."),ze;return ze}function H(ze){return Vb(ze.width)&&Vb(ze.height)}function G(ze){return r?!1:ze.wrapS!==Zo||ze.wrapT!==Zo||ze.minFilter!==Qi&&ze.minFilter!==bs}function le(ze,Ae){return ze.generateMipmaps&&Ae&&ze.minFilter!==Qi&&ze.minFilter!==bs}function te(ze){i.generateMipmap(ze)}function ue(ze,Ae,gt,Rt,Xt=!1){if(r===!1)return Ae;if(ze!==null){if(i[ze]!==void 0)return i[ze];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ze+"'")}let gn=Ae;return Ae===6403&&(gt===5126&&(gn=33326),gt===5131&&(gn=33325),gt===5121&&(gn=33321)),Ae===33319&&(gt===5126&&(gn=33328),gt===5131&&(gn=33327),gt===5121&&(gn=33323)),Ae===6408&&(gt===5126&&(gn=34836),gt===5131&&(gn=34842),gt===5121&&(gn=Rt===Ar&&Xt===!1?35907:32856),gt===32819&&(gn=32854),gt===32820&&(gn=32855)),(gn===33325||gn===33326||gn===33327||gn===33328||gn===34842||gn===34836)&&e.get("EXT_color_buffer_float"),gn}function me(ze,Ae,gt){return le(ze,gt)===!0||ze.isFramebufferTexture&&ze.minFilter!==Qi&&ze.minFilter!==bs?Math.log2(Math.max(Ae.width,Ae.height))+1:ze.mipmaps!==void 0&&ze.mipmaps.length>0?ze.mipmaps.length:ze.isCompressedTexture&&Array.isArray(ze.image)?Ae.mipmaps.length:1}function se(ze){return ze===Qi||ze===gb||ze===_b?9728:9729}function Y(ze){let Ae=ze.target;Ae.removeEventListener("dispose",Y),Xe(Ae),Ae.isVideoTexture&&R.delete(Ae)}function ye(ze){let Ae=ze.target;Ae.removeEventListener("dispose",ye),re(Ae)}function Xe(ze){let Ae=s.get(ze);if(Ae.__webglInit===void 0)return;let gt=ze.source,Rt=L.get(gt);if(Rt){let Xt=Rt[Ae.__cacheKey];Xt.usedTimes--,Xt.usedTimes===0&&ge(ze),Object.keys(Rt).length===0&&L.delete(gt)}s.remove(ze)}function ge(ze){let Ae=s.get(ze);i.deleteTexture(Ae.__webglTexture);let gt=ze.source,Rt=L.get(gt);delete Rt[Ae.__cacheKey],p.memory.textures--}function re(ze){let Ae=ze.texture,gt=s.get(ze),Rt=s.get(Ae);if(Rt.__webglTexture!==void 0&&(i.deleteTexture(Rt.__webglTexture),p.memory.textures--),ze.depthTexture&&ze.depthTexture.dispose(),ze.isWebGLCubeRenderTarget)for(let Xt=0;Xt<6;Xt++)i.deleteFramebuffer(gt.__webglFramebuffer[Xt]),gt.__webglDepthbuffer&&i.deleteRenderbuffer(gt.__webglDepthbuffer[Xt]);else i.deleteFramebuffer(gt.__webglFramebuffer),gt.__webglDepthbuffer&&i.deleteRenderbuffer(gt.__webglDepthbuffer),gt.__webglMultisampledFramebuffer&&i.deleteFramebuffer(gt.__webglMultisampledFramebuffer),gt.__webglColorRenderbuffer&&i.deleteRenderbuffer(gt.__webglColorRenderbuffer),gt.__webglDepthRenderbuffer&&i.deleteRenderbuffer(gt.__webglDepthRenderbuffer);if(ze.isWebGLMultipleRenderTargets)for(let Xt=0,gn=Ae.length;Xt<gn;Xt++){let Tn=s.get(Ae[Xt]);Tn.__webglTexture&&(i.deleteTexture(Tn.__webglTexture),p.memory.textures--),s.remove(Ae[Xt])}s.remove(Ae),s.remove(ze)}let ve=0;function ae(){ve=0}function de(){let ze=ve;return ze>=x&&console.warn("THREE.WebGLTextures: Trying to use "+ze+" texture units while this GPU supports only "+x),ve+=1,ze}function xe(ze){let Ae=[];return Ae.push(ze.wrapS),Ae.push(ze.wrapT),Ae.push(ze.magFilter),Ae.push(ze.minFilter),Ae.push(ze.anisotropy),Ae.push(ze.internalFormat),Ae.push(ze.format),Ae.push(ze.type),Ae.push(ze.generateMipmaps),Ae.push(ze.premultiplyAlpha),Ae.push(ze.flipY),Ae.push(ze.unpackAlignment),Ae.push(ze.encoding),Ae.join()}function De(ze,Ae){let gt=s.get(ze);if(ze.isVideoTexture&&xn(ze),ze.isRenderTargetTexture===!1&&ze.version>0&&gt.__version!==ze.version){let Rt=ze.image;if(Rt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Rt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Zt(gt,ze,Ae);return}}t.activeTexture(33984+Ae),t.bindTexture(3553,gt.__webglTexture)}function Ce(ze,Ae){let gt=s.get(ze);if(ze.version>0&&gt.__version!==ze.version){Zt(gt,ze,Ae);return}t.activeTexture(33984+Ae),t.bindTexture(35866,gt.__webglTexture)}function pe(ze,Ae){let gt=s.get(ze);if(ze.version>0&&gt.__version!==ze.version){Zt(gt,ze,Ae);return}t.activeTexture(33984+Ae),t.bindTexture(32879,gt.__webglTexture)}function xt(ze,Ae){let gt=s.get(ze);if(ze.version>0&&gt.__version!==ze.version){Lt(gt,ze,Ae);return}t.activeTexture(33984+Ae),t.bindTexture(34067,gt.__webglTexture)}let Ct={[Ih]:10497,[Zo]:33071,[r0]:33648},ct={[Qi]:9728,[gb]:9984,[_b]:9986,[bs]:9729,[JM]:9985,[eg]:9987};function Qe(ze,Ae,gt){if(gt?(i.texParameteri(ze,10242,Ct[Ae.wrapS]),i.texParameteri(ze,10243,Ct[Ae.wrapT]),(ze===32879||ze===35866)&&i.texParameteri(ze,32882,Ct[Ae.wrapR]),i.texParameteri(ze,10240,ct[Ae.magFilter]),i.texParameteri(ze,10241,ct[Ae.minFilter])):(i.texParameteri(ze,10242,33071),i.texParameteri(ze,10243,33071),(ze===32879||ze===35866)&&i.texParameteri(ze,32882,33071),(Ae.wrapS!==Zo||Ae.wrapT!==Zo)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(ze,10240,se(Ae.magFilter)),i.texParameteri(ze,10241,se(Ae.minFilter)),Ae.minFilter!==Qi&&Ae.minFilter!==bs&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let Rt=e.get("EXT_texture_filter_anisotropic");if(Ae.type===qc&&e.has("OES_texture_float_linear")===!1||r===!1&&Ae.type===Ch&&e.has("OES_texture_half_float_linear")===!1)return;(Ae.anisotropy>1||s.get(Ae).__currentAnisotropy)&&(i.texParameterf(ze,Rt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ae.anisotropy,c.getMaxAnisotropy())),s.get(Ae).__currentAnisotropy=Ae.anisotropy)}}function zt(ze,Ae){let gt=!1;ze.__webglInit===void 0&&(ze.__webglInit=!0,Ae.addEventListener("dispose",Y));let Rt=Ae.source,Xt=L.get(Rt);Xt===void 0&&(Xt={},L.set(Rt,Xt));let gn=xe(Ae);if(gn!==ze.__cacheKey){Xt[gn]===void 0&&(Xt[gn]={texture:i.createTexture(),usedTimes:0},p.memory.textures++,gt=!0),Xt[gn].usedTimes++;let Tn=Xt[ze.__cacheKey];Tn!==void 0&&(Xt[ze.__cacheKey].usedTimes--,Tn.usedTimes===0&&ge(Ae)),ze.__cacheKey=gn,ze.__webglTexture=Xt[gn].texture}return gt}function Zt(ze,Ae,gt){let Rt=3553;Ae.isDataArrayTexture&&(Rt=35866),Ae.isData3DTexture&&(Rt=32879);let Xt=zt(ze,Ae),gn=Ae.source;if(t.activeTexture(33984+gt),t.bindTexture(Rt,ze.__webglTexture),gn.version!==gn.__currentVersion||Xt===!0){i.pixelStorei(37440,Ae.flipY),i.pixelStorei(37441,Ae.premultiplyAlpha),i.pixelStorei(3317,Ae.unpackAlignment),i.pixelStorei(37443,0);let Tn=G(Ae)&&H(Ae.image)===!1,Ee=$(Ae.image,Tn,!1,w);Ee=ei(Ae,Ee);let et=H(Ee)||r,rn=h.convert(Ae.format,Ae.encoding),tn=h.convert(Ae.type),Je=ue(Ae.internalFormat,rn,tn,Ae.encoding,Ae.isVideoTexture);Qe(Rt,Ae,et);let sn,nn=Ae.mipmaps,An=r&&Ae.isVideoTexture!==!0,Et=ze.__version===void 0,Dn=me(Ae,Ee,et);if(Ae.isDepthTexture)Je=6402,r?Ae.type===qc?Je=36012:Ae.type===tg?Je=33190:Ae.type===Lh?Je=35056:Je=33189:Ae.type===qc&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Ae.format===Xc&&Je===6402&&Ae.type!==vf&&Ae.type!==tg&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Ae.type=vf,tn=h.convert(Ae.type)),Ae.format===Dh&&Je===6402&&(Je=34041,Ae.type!==Lh&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Ae.type=Lh,tn=h.convert(Ae.type))),An&&Et?t.texStorage2D(3553,1,Je,Ee.width,Ee.height):t.texImage2D(3553,0,Je,Ee.width,Ee.height,0,rn,tn,null);else if(Ae.isDataTexture)if(nn.length>0&&et){An&&Et&&t.texStorage2D(3553,Dn,Je,nn[0].width,nn[0].height);for(let un=0,Nn=nn.length;un<Nn;un++)sn=nn[un],An?t.texSubImage2D(3553,un,0,0,sn.width,sn.height,rn,tn,sn.data):t.texImage2D(3553,un,Je,sn.width,sn.height,0,rn,tn,sn.data);Ae.generateMipmaps=!1}else An?(Et&&t.texStorage2D(3553,Dn,Je,Ee.width,Ee.height),t.texSubImage2D(3553,0,0,0,Ee.width,Ee.height,rn,tn,Ee.data)):t.texImage2D(3553,0,Je,Ee.width,Ee.height,0,rn,tn,Ee.data);else if(Ae.isCompressedTexture){An&&Et&&t.texStorage2D(3553,Dn,Je,nn[0].width,nn[0].height);for(let un=0,Nn=nn.length;un<Nn;un++)sn=nn[un],Ae.format!==ws?rn!==null?An?t.compressedTexSubImage2D(3553,un,0,0,sn.width,sn.height,rn,sn.data):t.compressedTexImage2D(3553,un,Je,sn.width,sn.height,0,sn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):An?t.texSubImage2D(3553,un,0,0,sn.width,sn.height,rn,tn,sn.data):t.texImage2D(3553,un,Je,sn.width,sn.height,0,rn,tn,sn.data)}else if(Ae.isDataArrayTexture)An?(Et&&t.texStorage3D(35866,Dn,Je,Ee.width,Ee.height,Ee.depth),t.texSubImage3D(35866,0,0,0,0,Ee.width,Ee.height,Ee.depth,rn,tn,Ee.data)):t.texImage3D(35866,0,Je,Ee.width,Ee.height,Ee.depth,0,rn,tn,Ee.data);else if(Ae.isData3DTexture)An?(Et&&t.texStorage3D(32879,Dn,Je,Ee.width,Ee.height,Ee.depth),t.texSubImage3D(32879,0,0,0,0,Ee.width,Ee.height,Ee.depth,rn,tn,Ee.data)):t.texImage3D(32879,0,Je,Ee.width,Ee.height,Ee.depth,0,rn,tn,Ee.data);else if(Ae.isFramebufferTexture)An&&Et?t.texStorage2D(3553,Dn,Je,Ee.width,Ee.height):t.texImage2D(3553,0,Je,Ee.width,Ee.height,0,rn,tn,null);else if(nn.length>0&&et){An&&Et&&t.texStorage2D(3553,Dn,Je,nn[0].width,nn[0].height);for(let un=0,Nn=nn.length;un<Nn;un++)sn=nn[un],An?t.texSubImage2D(3553,un,0,0,rn,tn,sn):t.texImage2D(3553,un,Je,rn,tn,sn);Ae.generateMipmaps=!1}else An?(Et&&t.texStorage2D(3553,Dn,Je,Ee.width,Ee.height),t.texSubImage2D(3553,0,0,0,rn,tn,Ee)):t.texImage2D(3553,0,Je,rn,tn,Ee);le(Ae,et)&&te(Rt),gn.__currentVersion=gn.version,Ae.onUpdate&&Ae.onUpdate(Ae)}ze.__version=Ae.version}function Lt(ze,Ae,gt){if(Ae.image.length!==6)return;let Rt=zt(ze,Ae),Xt=Ae.source;if(t.activeTexture(33984+gt),t.bindTexture(34067,ze.__webglTexture),Xt.version!==Xt.__currentVersion||Rt===!0){i.pixelStorei(37440,Ae.flipY),i.pixelStorei(37441,Ae.premultiplyAlpha),i.pixelStorei(3317,Ae.unpackAlignment),i.pixelStorei(37443,0);let gn=Ae.isCompressedTexture||Ae.image[0].isCompressedTexture,Tn=Ae.image[0]&&Ae.image[0].isDataTexture,Ee=[];for(let un=0;un<6;un++)!gn&&!Tn?Ee[un]=$(Ae.image[un],!1,!0,v):Ee[un]=Tn?Ae.image[un].image:Ae.image[un],Ee[un]=ei(Ae,Ee[un]);let et=Ee[0],rn=H(et)||r,tn=h.convert(Ae.format,Ae.encoding),Je=h.convert(Ae.type),sn=ue(Ae.internalFormat,tn,Je,Ae.encoding),nn=r&&Ae.isVideoTexture!==!0,An=ze.__version===void 0,Et=me(Ae,et,rn);Qe(34067,Ae,rn);let Dn;if(gn){nn&&An&&t.texStorage2D(34067,Et,sn,et.width,et.height);for(let un=0;un<6;un++){Dn=Ee[un].mipmaps;for(let Nn=0;Nn<Dn.length;Nn++){let Kn=Dn[Nn];Ae.format!==ws?tn!==null?nn?t.compressedTexSubImage2D(34069+un,Nn,0,0,Kn.width,Kn.height,tn,Kn.data):t.compressedTexImage2D(34069+un,Nn,sn,Kn.width,Kn.height,0,Kn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):nn?t.texSubImage2D(34069+un,Nn,0,0,Kn.width,Kn.height,tn,Je,Kn.data):t.texImage2D(34069+un,Nn,sn,Kn.width,Kn.height,0,tn,Je,Kn.data)}}}else{Dn=Ae.mipmaps,nn&&An&&(Dn.length>0&&Et++,t.texStorage2D(34067,Et,sn,Ee[0].width,Ee[0].height));for(let un=0;un<6;un++)if(Tn){nn?t.texSubImage2D(34069+un,0,0,0,Ee[un].width,Ee[un].height,tn,Je,Ee[un].data):t.texImage2D(34069+un,0,sn,Ee[un].width,Ee[un].height,0,tn,Je,Ee[un].data);for(let Nn=0;Nn<Dn.length;Nn++){let Gn=Dn[Nn].image[un].image;nn?t.texSubImage2D(34069+un,Nn+1,0,0,Gn.width,Gn.height,tn,Je,Gn.data):t.texImage2D(34069+un,Nn+1,sn,Gn.width,Gn.height,0,tn,Je,Gn.data)}}else{nn?t.texSubImage2D(34069+un,0,0,0,tn,Je,Ee[un]):t.texImage2D(34069+un,0,sn,tn,Je,Ee[un]);for(let Nn=0;Nn<Dn.length;Nn++){let Kn=Dn[Nn];nn?t.texSubImage2D(34069+un,Nn+1,0,0,tn,Je,Kn.image[un]):t.texImage2D(34069+un,Nn+1,sn,tn,Je,Kn.image[un])}}}le(Ae,rn)&&te(34067),Xt.__currentVersion=Xt.version,Ae.onUpdate&&Ae.onUpdate(Ae)}ze.__version=Ae.version}function Re(ze,Ae,gt,Rt,Xt){let gn=h.convert(gt.format,gt.encoding),Tn=h.convert(gt.type),Ee=ue(gt.internalFormat,gn,Tn,gt.encoding);s.get(Ae).__hasExternalTextures||(Xt===32879||Xt===35866?t.texImage3D(Xt,0,Ee,Ae.width,Ae.height,Ae.depth,0,gn,Tn,null):t.texImage2D(Xt,0,Ee,Ae.width,Ae.height,0,gn,Tn,null)),t.bindFramebuffer(36160,ze),wn(Ae)?A.framebufferTexture2DMultisampleEXT(36160,Rt,Xt,s.get(gt).__webglTexture,0,bn(Ae)):i.framebufferTexture2D(36160,Rt,Xt,s.get(gt).__webglTexture,0),t.bindFramebuffer(36160,null)}function qt(ze,Ae,gt){if(i.bindRenderbuffer(36161,ze),Ae.depthBuffer&&!Ae.stencilBuffer){let Rt=33189;if(gt||wn(Ae)){let Xt=Ae.depthTexture;Xt&&Xt.isDepthTexture&&(Xt.type===qc?Rt=36012:Xt.type===tg&&(Rt=33190));let gn=bn(Ae);wn(Ae)?A.renderbufferStorageMultisampleEXT(36161,gn,Rt,Ae.width,Ae.height):i.renderbufferStorageMultisample(36161,gn,Rt,Ae.width,Ae.height)}else i.renderbufferStorage(36161,Rt,Ae.width,Ae.height);i.framebufferRenderbuffer(36160,36096,36161,ze)}else if(Ae.depthBuffer&&Ae.stencilBuffer){let Rt=bn(Ae);gt&&wn(Ae)===!1?i.renderbufferStorageMultisample(36161,Rt,35056,Ae.width,Ae.height):wn(Ae)?A.renderbufferStorageMultisampleEXT(36161,Rt,35056,Ae.width,Ae.height):i.renderbufferStorage(36161,34041,Ae.width,Ae.height),i.framebufferRenderbuffer(36160,33306,36161,ze)}else{let Rt=Ae.isWebGLMultipleRenderTargets===!0?Ae.texture[0]:Ae.texture,Xt=h.convert(Rt.format,Rt.encoding),gn=h.convert(Rt.type),Tn=ue(Rt.internalFormat,Xt,gn,Rt.encoding),Ee=bn(Ae);gt&&wn(Ae)===!1?i.renderbufferStorageMultisample(36161,Ee,Tn,Ae.width,Ae.height):wn(Ae)?A.renderbufferStorageMultisampleEXT(36161,Ee,Tn,Ae.width,Ae.height):i.renderbufferStorage(36161,Tn,Ae.width,Ae.height)}i.bindRenderbuffer(36161,null)}function nt(ze,Ae){if(Ae&&Ae.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,ze),!(Ae.depthTexture&&Ae.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!s.get(Ae.depthTexture).__webglTexture||Ae.depthTexture.image.width!==Ae.width||Ae.depthTexture.image.height!==Ae.height)&&(Ae.depthTexture.image.width=Ae.width,Ae.depthTexture.image.height=Ae.height,Ae.depthTexture.needsUpdate=!0),De(Ae.depthTexture,0);let Rt=s.get(Ae.depthTexture).__webglTexture,Xt=bn(Ae);if(Ae.depthTexture.format===Xc)wn(Ae)?A.framebufferTexture2DMultisampleEXT(36160,36096,3553,Rt,0,Xt):i.framebufferTexture2D(36160,36096,3553,Rt,0);else if(Ae.depthTexture.format===Dh)wn(Ae)?A.framebufferTexture2DMultisampleEXT(36160,33306,3553,Rt,0,Xt):i.framebufferTexture2D(36160,33306,3553,Rt,0);else throw new Error("Unknown depthTexture format")}function at(ze){let Ae=s.get(ze),gt=ze.isWebGLCubeRenderTarget===!0;if(ze.depthTexture&&!Ae.__autoAllocateDepthBuffer){if(gt)throw new Error("target.depthTexture not supported in Cube render targets");nt(Ae.__webglFramebuffer,ze)}else if(gt){Ae.__webglDepthbuffer=[];for(let Rt=0;Rt<6;Rt++)t.bindFramebuffer(36160,Ae.__webglFramebuffer[Rt]),Ae.__webglDepthbuffer[Rt]=i.createRenderbuffer(),qt(Ae.__webglDepthbuffer[Rt],ze,!1)}else t.bindFramebuffer(36160,Ae.__webglFramebuffer),Ae.__webglDepthbuffer=i.createRenderbuffer(),qt(Ae.__webglDepthbuffer,ze,!1);t.bindFramebuffer(36160,null)}function St(ze,Ae,gt){let Rt=s.get(ze);Ae!==void 0&&Re(Rt.__webglFramebuffer,ze,ze.texture,36064,3553),gt!==void 0&&at(ze)}function ut(ze){let Ae=ze.texture,gt=s.get(ze),Rt=s.get(Ae);ze.addEventListener("dispose",ye),ze.isWebGLMultipleRenderTargets!==!0&&(Rt.__webglTexture===void 0&&(Rt.__webglTexture=i.createTexture()),Rt.__version=Ae.version,p.memory.textures++);let Xt=ze.isWebGLCubeRenderTarget===!0,gn=ze.isWebGLMultipleRenderTargets===!0,Tn=H(ze)||r;if(Xt){gt.__webglFramebuffer=[];for(let Ee=0;Ee<6;Ee++)gt.__webglFramebuffer[Ee]=i.createFramebuffer()}else if(gt.__webglFramebuffer=i.createFramebuffer(),gn)if(c.drawBuffers){let Ee=ze.texture;for(let et=0,rn=Ee.length;et<rn;et++){let tn=s.get(Ee[et]);tn.__webglTexture===void 0&&(tn.__webglTexture=i.createTexture(),p.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(r&&ze.samples>0&&wn(ze)===!1){gt.__webglMultisampledFramebuffer=i.createFramebuffer(),gt.__webglColorRenderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,gt.__webglColorRenderbuffer);let Ee=h.convert(Ae.format,Ae.encoding),et=h.convert(Ae.type),rn=ue(Ae.internalFormat,Ee,et,Ae.encoding),tn=bn(ze);i.renderbufferStorageMultisample(36161,tn,rn,ze.width,ze.height),t.bindFramebuffer(36160,gt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064,36161,gt.__webglColorRenderbuffer),i.bindRenderbuffer(36161,null),ze.depthBuffer&&(gt.__webglDepthRenderbuffer=i.createRenderbuffer(),qt(gt.__webglDepthRenderbuffer,ze,!0)),t.bindFramebuffer(36160,null)}if(Xt){t.bindTexture(34067,Rt.__webglTexture),Qe(34067,Ae,Tn);for(let Ee=0;Ee<6;Ee++)Re(gt.__webglFramebuffer[Ee],ze,Ae,36064,34069+Ee);le(Ae,Tn)&&te(34067),t.unbindTexture()}else if(gn){let Ee=ze.texture;for(let et=0,rn=Ee.length;et<rn;et++){let tn=Ee[et],Je=s.get(tn);t.bindTexture(3553,Je.__webglTexture),Qe(3553,tn,Tn),Re(gt.__webglFramebuffer,ze,tn,36064+et,3553),le(tn,Tn)&&te(3553)}t.unbindTexture()}else{let Ee=3553;(ze.isWebGL3DRenderTarget||ze.isWebGLArrayRenderTarget)&&(r?Ee=ze.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Ee,Rt.__webglTexture),Qe(Ee,Ae,Tn),Re(gt.__webglFramebuffer,ze,Ae,36064,Ee),le(Ae,Tn)&&te(Ee),t.unbindTexture()}ze.depthBuffer&&at(ze)}function Ot(ze){let Ae=H(ze)||r,gt=ze.isWebGLMultipleRenderTargets===!0?ze.texture:[ze.texture];for(let Rt=0,Xt=gt.length;Rt<Xt;Rt++){let gn=gt[Rt];if(le(gn,Ae)){let Tn=ze.isWebGLCubeRenderTarget?34067:3553,Ee=s.get(gn).__webglTexture;t.bindTexture(Tn,Ee),te(Tn),t.unbindTexture()}}}function Pn(ze){if(r&&ze.samples>0&&wn(ze)===!1){let Ae=ze.width,gt=ze.height,Rt=16384,Xt=[36064],gn=ze.stencilBuffer?33306:36096;ze.depthBuffer&&Xt.push(gn);let Tn=s.get(ze),Ee=Tn.__ignoreDepthValues!==void 0?Tn.__ignoreDepthValues:!1;Ee===!1&&(ze.depthBuffer&&(Rt|=256),ze.stencilBuffer&&(Rt|=1024)),t.bindFramebuffer(36008,Tn.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Tn.__webglFramebuffer),Ee===!0&&(i.invalidateFramebuffer(36008,[gn]),i.invalidateFramebuffer(36009,[gn])),i.blitFramebuffer(0,0,Ae,gt,0,0,Ae,gt,Rt,9728),I&&i.invalidateFramebuffer(36008,Xt),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,Tn.__webglMultisampledFramebuffer)}}function bn(ze){return Math.min(S,ze.samples)}function wn(ze){let Ae=s.get(ze);return r&&ze.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Ae.__useRenderToTexture!==!1}function xn(ze){let Ae=p.render.frame;R.get(ze)!==Ae&&(R.set(ze,Ae),ze.update())}function ei(ze,Ae){let gt=ze.encoding,Rt=ze.format,Xt=ze.type;return ze.isCompressedTexture===!0||ze.isVideoTexture===!0||ze.format===d0||gt!==nl&&(gt===Ar?r===!1?e.has("EXT_sRGB")===!0&&Rt===ws?(ze.format=d0,ze.minFilter=bs,ze.generateMipmaps=!1):Ae=Ul.sRGBToLinear(Ae):(Rt!==ws||Xt!==Wc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",gt)),Ae}this.allocateTextureUnit=de,this.resetTextureUnits=ae,this.setTexture2D=De,this.setTexture2DArray=Ce,this.setTexture3D=pe,this.setTextureCube=xt,this.rebindTextures=St,this.setupRenderTarget=ut,this.updateRenderTargetMipmap=Ot,this.updateMultisampleRenderTarget=Pn,this.setupDepthRenderbuffer=at,this.setupFrameBufferTexture=Re,this.useMultisampledRTT=wn}function d3(i,e,t){let s=t.isWebGL2;function c(h,p=null){let r;if(h===Wc)return 5121;if(h===tI)return 32819;if(h===nI)return 32820;if(h===$M)return 5120;if(h===QM)return 5122;if(h===vf)return 5123;if(h===eI)return 5124;if(h===tg)return 5125;if(h===qc)return 5126;if(h===Ch)return s?5131:(r=e.get("OES_texture_half_float"),r!==null?r.HALF_FLOAT_OES:null);if(h===iI)return 6406;if(h===ws)return 6408;if(h===sI)return 6409;if(h===oI)return 6410;if(h===Xc)return 6402;if(h===Dh)return 34041;if(h===ng)return 6403;if(h===rI)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(h===d0)return r=e.get("EXT_sRGB"),r!==null?r.SRGB_ALPHA_EXT:null;if(h===aI)return 36244;if(h===lI)return 33319;if(h===cI)return 33320;if(h===uI)return 36249;if(h===s0||h===o0||h===a0||h===l0)if(p===Ar)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(h===s0)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(h===o0)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(h===a0)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(h===l0)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(h===s0)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(h===o0)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(h===a0)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(h===l0)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(h===yb||h===vb||h===xb||h===bb)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(h===yb)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(h===vb)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(h===xb)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(h===bb)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(h===hI)return r=e.get("WEBGL_compressed_texture_etc1"),r!==null?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(h===wb||h===Tb)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(h===wb)return p===Ar?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(h===Tb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(h===Eb||h===Sb||h===Ab||h===Mb||h===Ib||h===Cb||h===Lb||h===Db||h===Rb||h===Pb||h===kb||h===zb||h===Ob||h===Nb)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(h===Eb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(h===Sb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(h===Ab)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(h===Mb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(h===Ib)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(h===Cb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(h===Lb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(h===Db)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(h===Rb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(h===Pb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(h===kb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(h===zb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(h===Ob)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(h===Nb)return p===Ar?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(h===Fb)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(h===Fb)return p===Ar?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(h===Lh)return s?34042:(r=e.get("WEBGL_depth_texture"),r!==null?r.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:c}}var H0=class extends Ss{constructor(e=[]){super();this.cameras=e}};H0.prototype.isArrayCamera=!0;var Zl=class extends Ki{constructor(){super();this.type="Group"}};Zl.prototype.isGroup=!0;var uU={type:"move"},j0=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Zl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Zl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Be,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Be),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Zl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Be,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Be),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,s){let c=null,h=null,p=null,r=this._targetRay,x=this._grip,v=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(r!==null&&(c=t.getPose(e.targetRaySpace,s),c!==null&&(r.matrix.fromArray(c.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),c.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(c.linearVelocity)):r.hasLinearVelocity=!1,c.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(c.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent(uU))),v&&e.hand){p=!0;for(let k of e.hand.values()){let L=t.getJointPose(k,s);if(v.joints[k.jointName]===void 0){let B=new Zl;B.matrixAutoUpdate=!1,B.visible=!1,v.joints[k.jointName]=B,v.add(B)}let z=v.joints[k.jointName];L!==null&&(z.matrix.fromArray(L.transform.matrix),z.matrix.decompose(z.position,z.rotation,z.scale),z.jointRadius=L.radius),z.visible=L!==null}let w=v.joints["index-finger-tip"],S=v.joints["thumb-tip"],A=w.position.distanceTo(S.position),I=.02,R=.005;v.inputState.pinching&&A>I+R?(v.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!v.inputState.pinching&&A<=I-R&&(v.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else x!==null&&e.gripSpace&&(h=t.getPose(e.gripSpace,s),h!==null&&(x.matrix.fromArray(h.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),h.linearVelocity?(x.hasLinearVelocity=!0,x.linearVelocity.copy(h.linearVelocity)):x.hasLinearVelocity=!1,h.angularVelocity?(x.hasAngularVelocity=!0,x.angularVelocity.copy(h.angularVelocity)):x.hasAngularVelocity=!1));return r!==null&&(r.visible=c!==null),x!==null&&(x.visible=h!==null),v!==null&&(v.visible=p!==null),this}},W0=class extends Qr{constructor(e,t,s,c,h,p,r,x,v,w){if(w=w!==void 0?w:Xc,w!==Xc&&w!==Dh)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&w===Xc&&(s=vf),s===void 0&&w===Dh&&(s=Lh),super(null,c,h,p,r,x,w,s,v),this.image={width:e,height:t},this.magFilter=r!==void 0?r:Qi,this.minFilter=x!==void 0?x:Qi,this.flipY=!1,this.generateMipmaps=!1}};W0.prototype.isDepthTexture=!0;var f3=class extends Sa{constructor(e,t){super();let s=this,c=null,h=1,p=null,r="local-floor",x=null,v=null,w=null,S=null,A=null,I=t.getContextAttributes(),R=null,k=null,L=[],z=new Map,B=new Ss;B.layers.enable(1),B.viewport=new Ui;let $=new Ss;$.layers.enable(2),$.viewport=new Ui;let H=[B,$],G=new H0;G.layers.enable(1),G.layers.enable(2);let le=null,te=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(de){let xe=L[de];return xe===void 0&&(xe=new j0,L[de]=xe),xe.getTargetRaySpace()},this.getControllerGrip=function(de){let xe=L[de];return xe===void 0&&(xe=new j0,L[de]=xe),xe.getGripSpace()},this.getHand=function(de){let xe=L[de];return xe===void 0&&(xe=new j0,L[de]=xe),xe.getHandSpace()};function ue(de){let xe=z.get(de.inputSource);xe&&xe.dispatchEvent({type:de.type,data:de.inputSource})}function me(){z.forEach(function(de,xe){de.disconnect(xe)}),z.clear(),le=null,te=null,e.setRenderTarget(R),S=null,w=null,v=null,c=null,k=null,ae.stop(),s.isPresenting=!1,s.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(de){h=de,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(de){r=de,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return p},this.getBaseLayer=function(){return w!==null?w:S},this.getBinding=function(){return v},this.getFrame=function(){return A},this.getSession=function(){return c},this.setSession=async function(de){if(c=de,c!==null){if(R=e.getRenderTarget(),c.addEventListener("select",ue),c.addEventListener("selectstart",ue),c.addEventListener("selectend",ue),c.addEventListener("squeeze",ue),c.addEventListener("squeezestart",ue),c.addEventListener("squeezeend",ue),c.addEventListener("end",me),c.addEventListener("inputsourceschange",se),I.xrCompatible!==!0&&await t.makeXRCompatible(),c.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let xe={antialias:c.renderState.layers===void 0?I.antialias:!0,alpha:I.alpha,depth:I.depth,stencil:I.stencil,framebufferScaleFactor:h};S=new XRWebGLLayer(c,t,xe),c.updateRenderState({baseLayer:S}),k=new Qs(S.framebufferWidth,S.framebufferHeight,{format:ws,type:Wc,encoding:e.outputEncoding})}else{let xe=null,De=null,Ce=null;I.depth&&(Ce=I.stencil?35056:33190,xe=I.stencil?Dh:Xc,De=I.stencil?Lh:vf);let pe={colorFormat:e.outputEncoding===Ar?35907:32856,depthFormat:Ce,scaleFactor:h};v=new XRWebGLBinding(c,t),w=v.createProjectionLayer(pe),c.updateRenderState({layers:[w]}),k=new Qs(w.textureWidth,w.textureHeight,{format:ws,type:Wc,depthTexture:new W0(w.textureWidth,w.textureHeight,De,void 0,void 0,void 0,void 0,void 0,void 0,xe),stencilBuffer:I.stencil,encoding:e.outputEncoding,samples:I.antialias?4:0});let xt=e.properties.get(k);xt.__ignoreDepthValues=w.ignoreDepthValues}k.isXRRenderTarget=!0,this.setFoveation(1),p=await c.requestReferenceSpace(r),ae.setContext(c),ae.start(),s.isPresenting=!0,s.dispatchEvent({type:"sessionstart"})}};function se(de){let xe=c.inputSources;for(let De=0;De<L.length;De++)z.set(xe[De],L[De]);for(let De=0;De<de.removed.length;De++){let Ce=de.removed[De],pe=z.get(Ce);pe&&(pe.dispatchEvent({type:"disconnected",data:Ce}),z.delete(Ce))}for(let De=0;De<de.added.length;De++){let Ce=de.added[De],pe=z.get(Ce);pe&&pe.dispatchEvent({type:"connected",data:Ce})}}let Y=new Be,ye=new Be;function Xe(de,xe,De){Y.setFromMatrixPosition(xe.matrixWorld),ye.setFromMatrixPosition(De.matrixWorld);let Ce=Y.distanceTo(ye),pe=xe.projectionMatrix.elements,xt=De.projectionMatrix.elements,Ct=pe[14]/(pe[10]-1),ct=pe[14]/(pe[10]+1),Qe=(pe[9]+1)/pe[5],zt=(pe[9]-1)/pe[5],Zt=(pe[8]-1)/pe[0],Lt=(xt[8]+1)/xt[0],Re=Ct*Zt,qt=Ct*Lt,nt=Ce/(-Zt+Lt),at=nt*-Zt;xe.matrixWorld.decompose(de.position,de.quaternion,de.scale),de.translateX(at),de.translateZ(nt),de.matrixWorld.compose(de.position,de.quaternion,de.scale),de.matrixWorldInverse.copy(de.matrixWorld).invert();let St=Ct+nt,ut=ct+nt,Ot=Re-at,Pn=qt+(Ce-at),bn=Qe*ct/ut*St,wn=zt*ct/ut*St;de.projectionMatrix.makePerspective(Ot,Pn,bn,wn,St,ut)}function ge(de,xe){xe===null?de.matrixWorld.copy(de.matrix):de.matrixWorld.multiplyMatrices(xe.matrixWorld,de.matrix),de.matrixWorldInverse.copy(de.matrixWorld).invert()}this.updateCamera=function(de){if(c===null)return;G.near=$.near=B.near=de.near,G.far=$.far=B.far=de.far,(le!==G.near||te!==G.far)&&(c.updateRenderState({depthNear:G.near,depthFar:G.far}),le=G.near,te=G.far);let xe=de.parent,De=G.cameras;ge(G,xe);for(let pe=0;pe<De.length;pe++)ge(De[pe],xe);G.matrixWorld.decompose(G.position,G.quaternion,G.scale),de.position.copy(G.position),de.quaternion.copy(G.quaternion),de.scale.copy(G.scale),de.matrix.copy(G.matrix),de.matrixWorld.copy(G.matrixWorld);let Ce=de.children;for(let pe=0,xt=Ce.length;pe<xt;pe++)Ce[pe].updateMatrixWorld(!0);De.length===2?Xe(G,B,$):G.projectionMatrix.copy(B.projectionMatrix)},this.getCamera=function(){return G},this.getFoveation=function(){if(w!==null)return w.fixedFoveation;if(S!==null)return S.fixedFoveation},this.setFoveation=function(de){w!==null&&(w.fixedFoveation=de),S!==null&&S.fixedFoveation!==void 0&&(S.fixedFoveation=de)};let re=null;function ve(de,xe){if(x=xe.getViewerPose(p),A=xe,x!==null){let Ce=x.views;S!==null&&(e.setRenderTargetFramebuffer(k,S.framebuffer),e.setRenderTarget(k));let pe=!1;Ce.length!==G.cameras.length&&(G.cameras.length=0,pe=!0);for(let xt=0;xt<Ce.length;xt++){let Ct=Ce[xt],ct=null;if(S!==null)ct=S.getViewport(Ct);else{let zt=v.getViewSubImage(w,Ct);ct=zt.viewport,xt===0&&(e.setRenderTargetTextures(k,zt.colorTexture,w.ignoreDepthValues?void 0:zt.depthStencilTexture),e.setRenderTarget(k))}let Qe=H[xt];Qe.matrix.fromArray(Ct.transform.matrix),Qe.projectionMatrix.fromArray(Ct.projectionMatrix),Qe.viewport.set(ct.x,ct.y,ct.width,ct.height),xt===0&&G.matrix.copy(Qe.matrix),pe===!0&&G.cameras.push(Qe)}}let De=c.inputSources;for(let Ce=0;Ce<L.length;Ce++){let pe=L[Ce],xt=De[Ce];pe.update(xt,xe,p)}re&&re(de,xe),A=null}let ae=new kI;ae.setAnimationLoop(ve),this.setAnimationLoop=function(de){re=de},this.dispose=function(){}}};function hU(i,e){function t(k,L){k.fogColor.value.copy(L.color),L.isFog?(k.fogNear.value=L.near,k.fogFar.value=L.far):L.isFogExp2&&(k.fogDensity.value=L.density)}function s(k,L,z,B,$){L.isMeshBasicMaterial||L.isMeshLambertMaterial?c(k,L):L.isMeshToonMaterial?(c(k,L),w(k,L)):L.isMeshPhongMaterial?(c(k,L),v(k,L)):L.isMeshStandardMaterial?(c(k,L),S(k,L),L.isMeshPhysicalMaterial&&A(k,L,$)):L.isMeshMatcapMaterial?(c(k,L),I(k,L)):L.isMeshDepthMaterial?c(k,L):L.isMeshDistanceMaterial?(c(k,L),R(k,L)):L.isMeshNormalMaterial?c(k,L):L.isLineBasicMaterial?(h(k,L),L.isLineDashedMaterial&&p(k,L)):L.isPointsMaterial?r(k,L,z,B):L.isSpriteMaterial?x(k,L):L.isShadowMaterial?(k.color.value.copy(L.color),k.opacity.value=L.opacity):L.isShaderMaterial&&(L.uniformsNeedUpdate=!1)}function c(k,L){k.opacity.value=L.opacity,L.color&&k.diffuse.value.copy(L.color),L.emissive&&k.emissive.value.copy(L.emissive).multiplyScalar(L.emissiveIntensity),L.map&&(k.map.value=L.map),L.alphaMap&&(k.alphaMap.value=L.alphaMap),L.bumpMap&&(k.bumpMap.value=L.bumpMap,k.bumpScale.value=L.bumpScale,L.side===To&&(k.bumpScale.value*=-1)),L.displacementMap&&(k.displacementMap.value=L.displacementMap,k.displacementScale.value=L.displacementScale,k.displacementBias.value=L.displacementBias),L.emissiveMap&&(k.emissiveMap.value=L.emissiveMap),L.normalMap&&(k.normalMap.value=L.normalMap,k.normalScale.value.copy(L.normalScale),L.side===To&&k.normalScale.value.negate()),L.specularMap&&(k.specularMap.value=L.specularMap),L.alphaTest>0&&(k.alphaTest.value=L.alphaTest);let z=e.get(L).envMap;if(z&&(k.envMap.value=z,k.flipEnvMap.value=z.isCubeTexture&&z.isRenderTargetTexture===!1?-1:1,k.reflectivity.value=L.reflectivity,k.ior.value=L.ior,k.refractionRatio.value=L.refractionRatio),L.lightMap){k.lightMap.value=L.lightMap;let H=i.physicallyCorrectLights!==!0?Math.PI:1;k.lightMapIntensity.value=L.lightMapIntensity*H}L.aoMap&&(k.aoMap.value=L.aoMap,k.aoMapIntensity.value=L.aoMapIntensity);let B;L.map?B=L.map:L.specularMap?B=L.specularMap:L.displacementMap?B=L.displacementMap:L.normalMap?B=L.normalMap:L.bumpMap?B=L.bumpMap:L.roughnessMap?B=L.roughnessMap:L.metalnessMap?B=L.metalnessMap:L.alphaMap?B=L.alphaMap:L.emissiveMap?B=L.emissiveMap:L.clearcoatMap?B=L.clearcoatMap:L.clearcoatNormalMap?B=L.clearcoatNormalMap:L.clearcoatRoughnessMap?B=L.clearcoatRoughnessMap:L.specularIntensityMap?B=L.specularIntensityMap:L.specularColorMap?B=L.specularColorMap:L.transmissionMap?B=L.transmissionMap:L.thicknessMap?B=L.thicknessMap:L.sheenColorMap?B=L.sheenColorMap:L.sheenRoughnessMap&&(B=L.sheenRoughnessMap),B!==void 0&&(B.isWebGLRenderTarget&&(B=B.texture),B.matrixAutoUpdate===!0&&B.updateMatrix(),k.uvTransform.value.copy(B.matrix));let $;L.aoMap?$=L.aoMap:L.lightMap&&($=L.lightMap),$!==void 0&&($.isWebGLRenderTarget&&($=$.texture),$.matrixAutoUpdate===!0&&$.updateMatrix(),k.uv2Transform.value.copy($.matrix))}function h(k,L){k.diffuse.value.copy(L.color),k.opacity.value=L.opacity}function p(k,L){k.dashSize.value=L.dashSize,k.totalSize.value=L.dashSize+L.gapSize,k.scale.value=L.scale}function r(k,L,z,B){k.diffuse.value.copy(L.color),k.opacity.value=L.opacity,k.size.value=L.size*z,k.scale.value=B*.5,L.map&&(k.map.value=L.map),L.alphaMap&&(k.alphaMap.value=L.alphaMap),L.alphaTest>0&&(k.alphaTest.value=L.alphaTest);let $;L.map?$=L.map:L.alphaMap&&($=L.alphaMap),$!==void 0&&($.matrixAutoUpdate===!0&&$.updateMatrix(),k.uvTransform.value.copy($.matrix))}function x(k,L){k.diffuse.value.copy(L.color),k.opacity.value=L.opacity,k.rotation.value=L.rotation,L.map&&(k.map.value=L.map),L.alphaMap&&(k.alphaMap.value=L.alphaMap),L.alphaTest>0&&(k.alphaTest.value=L.alphaTest);let z;L.map?z=L.map:L.alphaMap&&(z=L.alphaMap),z!==void 0&&(z.matrixAutoUpdate===!0&&z.updateMatrix(),k.uvTransform.value.copy(z.matrix))}function v(k,L){k.specular.value.copy(L.specular),k.shininess.value=Math.max(L.shininess,1e-4)}function w(k,L){L.gradientMap&&(k.gradientMap.value=L.gradientMap)}function S(k,L){k.roughness.value=L.roughness,k.metalness.value=L.metalness,L.roughnessMap&&(k.roughnessMap.value=L.roughnessMap),L.metalnessMap&&(k.metalnessMap.value=L.metalnessMap),e.get(L).envMap&&(k.envMapIntensity.value=L.envMapIntensity)}function A(k,L,z){k.ior.value=L.ior,L.sheen>0&&(k.sheenColor.value.copy(L.sheenColor).multiplyScalar(L.sheen),k.sheenRoughness.value=L.sheenRoughness,L.sheenColorMap&&(k.sheenColorMap.value=L.sheenColorMap),L.sheenRoughnessMap&&(k.sheenRoughnessMap.value=L.sheenRoughnessMap)),L.clearcoat>0&&(k.clearcoat.value=L.clearcoat,k.clearcoatRoughness.value=L.clearcoatRoughness,L.clearcoatMap&&(k.clearcoatMap.value=L.clearcoatMap),L.clearcoatRoughnessMap&&(k.clearcoatRoughnessMap.value=L.clearcoatRoughnessMap),L.clearcoatNormalMap&&(k.clearcoatNormalScale.value.copy(L.clearcoatNormalScale),k.clearcoatNormalMap.value=L.clearcoatNormalMap,L.side===To&&k.clearcoatNormalScale.value.negate())),L.transmission>0&&(k.transmission.value=L.transmission,k.transmissionSamplerMap.value=z.texture,k.transmissionSamplerSize.value.set(z.width,z.height),L.transmissionMap&&(k.transmissionMap.value=L.transmissionMap),k.thickness.value=L.thickness,L.thicknessMap&&(k.thicknessMap.value=L.thicknessMap),k.attenuationDistance.value=L.attenuationDistance,k.attenuationColor.value.copy(L.attenuationColor)),k.specularIntensity.value=L.specularIntensity,k.specularColor.value.copy(L.specularColor),L.specularIntensityMap&&(k.specularIntensityMap.value=L.specularIntensityMap),L.specularColorMap&&(k.specularColorMap.value=L.specularColorMap)}function I(k,L){L.matcap&&(k.matcap.value=L.matcap)}function R(k,L){k.referencePosition.value.copy(L.referencePosition),k.nearDistance.value=L.nearDistance,k.farDistance.value=L.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:s}}function dU(){let i=ug("canvas");return i.style.display="block",i}function sr(i={}){let e=i.canvas!==void 0?i.canvas:dU(),t=i.context!==void 0?i.context:null,s=i.depth!==void 0?i.depth:!0,c=i.stencil!==void 0?i.stencil:!0,h=i.antialias!==void 0?i.antialias:!1,p=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,r=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,x=i.powerPreference!==void 0?i.powerPreference:"default",v=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1,w;i.context!==void 0?w=t.getContextAttributes().alpha:w=i.alpha!==void 0?i.alpha:!1;let S=null,A=null,I=[],R=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=nl,this.physicallyCorrectLights=!1,this.toneMapping=tl,this.toneMappingExposure=1;let k=this,L=!1,z=0,B=0,$=null,H=-1,G=null,le=new Ui,te=new Ui,ue=null,me=e.width,se=e.height,Y=1,ye=null,Xe=null,ge=new Ui(0,0,me,se),re=new Ui(0,0,me,se),ve=!1,ae=new Ff,de=!1,xe=!1,De=null,Ce=new Jn,pe=new Wt,xt=new Be,Ct={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ct(){return $===null?Y:1}let Qe=t;function zt(N,K){for(let ne=0;ne<N.length;ne++){let oe=N[ne],be=e.getContext(oe,K);if(be!==null)return be}return null}try{let N={alpha:!0,depth:s,stencil:c,antialias:h,premultipliedAlpha:p,preserveDrawingBuffer:r,powerPreference:x,failIfMajorPerformanceCaveat:v};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${e0}`),e.addEventListener("webglcontextlost",Je,!1),e.addEventListener("webglcontextrestored",sn,!1),Qe===null){let K=["webgl2","webgl","experimental-webgl"];if(k.isWebGL1Renderer===!0&&K.shift(),Qe=zt(K,N),Qe===null)throw zt(K)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Qe.getShaderPrecisionFormat===void 0&&(Qe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(N){throw console.error("THREE.WebGLRenderer: "+N.message),N}let Zt,Lt,Re,qt,nt,at,St,ut,Ot,Pn,bn,wn,xn,ei,ze,Ae,gt,Rt,Xt,gn,Tn,Ee,et;function rn(){Zt=new kB(Qe),Lt=new IB(Qe,Zt,i),Zt.init(Lt),Ee=new d3(Qe,Zt,Lt),Re=new lU(Qe,Zt,Lt),qt=new NB(Qe),nt=new J4,at=new cU(Qe,Zt,Re,nt,Lt,Ee,qt),St=new LB(k),ut=new PB(k),Ot=new JN(Qe,Lt),et=new AB(Qe,Zt,Ot,Lt),Pn=new zB(Qe,Ot,qt,et),bn=new VB(Qe,Pn,Ot,qt),Xt=new UB(Qe,Lt,at),Ae=new CB(nt),wn=new Y4(k,St,ut,Zt,Lt,et,Ae),xn=new hU(k,nt),ei=new Q4,ze=new sU(Zt,Lt),Rt=new SB(k,St,Re,bn,w,p),gt=new h3(k,bn,Lt),gn=new MB(Qe,Zt,qt,Lt),Tn=new OB(Qe,Zt,qt,Lt),qt.programs=wn.programs,k.capabilities=Lt,k.extensions=Zt,k.properties=nt,k.renderLists=ei,k.shadowMap=gt,k.state=Re,k.info=qt}rn();let tn=new f3(k,Qe);this.xr=tn,this.getContext=function(){return Qe},this.getContextAttributes=function(){return Qe.getContextAttributes()},this.forceContextLoss=function(){let N=Zt.get("WEBGL_lose_context");N&&N.loseContext()},this.forceContextRestore=function(){let N=Zt.get("WEBGL_lose_context");N&&N.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(N){N!==void 0&&(Y=N,this.setSize(me,se,!1))},this.getSize=function(N){return N.set(me,se)},this.setSize=function(N,K,ne){if(tn.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}me=N,se=K,e.width=Math.floor(N*Y),e.height=Math.floor(K*Y),ne!==!1&&(e.style.width=N+"px",e.style.height=K+"px"),this.setViewport(0,0,N,K)},this.getDrawingBufferSize=function(N){return N.set(me*Y,se*Y).floor()},this.setDrawingBufferSize=function(N,K,ne){me=N,se=K,Y=ne,e.width=Math.floor(N*ne),e.height=Math.floor(K*ne),this.setViewport(0,0,N,K)},this.getCurrentViewport=function(N){return N.copy(le)},this.getViewport=function(N){return N.copy(ge)},this.setViewport=function(N,K,ne,oe){N.isVector4?ge.set(N.x,N.y,N.z,N.w):ge.set(N,K,ne,oe),Re.viewport(le.copy(ge).multiplyScalar(Y).floor())},this.getScissor=function(N){return N.copy(re)},this.setScissor=function(N,K,ne,oe){N.isVector4?re.set(N.x,N.y,N.z,N.w):re.set(N,K,ne,oe),Re.scissor(te.copy(re).multiplyScalar(Y).floor())},this.getScissorTest=function(){return ve},this.setScissorTest=function(N){Re.setScissorTest(ve=N)},this.setOpaqueSort=function(N){ye=N},this.setTransparentSort=function(N){Xe=N},this.getClearColor=function(N){return N.copy(Rt.getClearColor())},this.setClearColor=function(){Rt.setClearColor.apply(Rt,arguments)},this.getClearAlpha=function(){return Rt.getClearAlpha()},this.setClearAlpha=function(){Rt.setClearAlpha.apply(Rt,arguments)},this.clear=function(N=!0,K=!0,ne=!0){let oe=0;N&&(oe|=16384),K&&(oe|=256),ne&&(oe|=1024),Qe.clear(oe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Je,!1),e.removeEventListener("webglcontextrestored",sn,!1),ei.dispose(),ze.dispose(),nt.dispose(),St.dispose(),ut.dispose(),bn.dispose(),et.dispose(),wn.dispose(),tn.dispose(),tn.removeEventListener("sessionstart",Nn),tn.removeEventListener("sessionend",Kn),De&&(De.dispose(),De=null),Gn.stop()};function Je(N){N.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),L=!0}function sn(){console.log("THREE.WebGLRenderer: Context Restored."),L=!1;let N=qt.autoReset,K=gt.enabled,ne=gt.autoUpdate,oe=gt.needsUpdate,be=gt.type;rn(),qt.autoReset=N,gt.enabled=K,gt.autoUpdate=ne,gt.needsUpdate=oe,gt.type=be}function nn(N){let K=N.target;K.removeEventListener("dispose",nn),An(K)}function An(N){Et(N),nt.remove(N)}function Et(N){let K=nt.get(N).programs;K!==void 0&&(K.forEach(function(ne){wn.releaseProgram(ne)}),N.isShaderMaterial&&wn.releaseShaderCache(N))}this.renderBufferDirect=function(N,K,ne,oe,be,Fe){K===null&&(K=Ct);let Ne=be.isMesh&&be.matrixWorld.determinant()<0,Ke=Ft(N,K,ne,oe,be);Re.setMaterial(oe,Ne);let rt=ne.index,Pt=ne.attributes.position;if(rt===null){if(Pt===void 0||Pt.count===0)return}else if(rt.count===0)return;let _t=1;oe.wireframe===!0&&(rt=Pn.getWireframeAttribute(ne),_t=2),et.setup(be,oe,Ke,ne,rt);let Jt,Ht=gn;rt!==null&&(Jt=Ot.get(rt),Ht=Tn,Ht.setIndex(Jt));let cn=rt!==null?rt.count:Pt.count,In=ne.drawRange.start*_t,Wn=ne.drawRange.count*_t,$n=Fe!==null?Fe.start*_t:0,hn=Fe!==null?Fe.count*_t:Infinity,yi=Math.max(In,$n),Qn=Math.min(cn,In+Wn,$n+hn)-1,Rr=Math.max(0,Qn-yi+1);if(Rr!==0){if(be.isMesh)oe.wireframe===!0?(Re.setLineWidth(oe.wireframeLinewidth*ct()),Ht.setMode(1)):Ht.setMode(4);else if(be.isLine){let Fr=oe.linewidth;Fr===void 0&&(Fr=1),Re.setLineWidth(Fr*ct()),be.isLineSegments?Ht.setMode(1):be.isLineLoop?Ht.setMode(2):Ht.setMode(3)}else be.isPoints?Ht.setMode(0):be.isSprite&&Ht.setMode(4);if(be.isInstancedMesh)Ht.renderInstances(yi,Rr,be.count);else if(ne.isInstancedBufferGeometry){let Fr=Math.min(ne.instanceCount,ne._maxInstanceCount);Ht.renderInstances(yi,Rr,Fr)}else Ht.render(yi,Rr)}},this.compile=function(N,K){A=ze.get(N),A.init(),R.push(A),N.traverseVisible(function(ne){ne.isLight&&ne.layers.test(K.layers)&&(A.pushLight(ne),ne.castShadow&&A.pushShadow(ne))}),A.setupLights(k.physicallyCorrectLights),N.traverse(function(ne){let oe=ne.material;if(oe)if(Array.isArray(oe))for(let be=0;be<oe.length;be++){let Fe=oe[be];Un(Fe,N,ne)}else Un(oe,N,ne)}),R.pop(),A=null};let Dn=null;function un(N){Dn&&Dn(N)}function Nn(){Gn.stop()}function Kn(){Gn.start()}let Gn=new kI;Gn.setAnimationLoop(un),typeof self!="undefined"&&Gn.setContext(self),this.setAnimationLoop=function(N){Dn=N,tn.setAnimationLoop(N),N===null?Gn.stop():Gn.start()},tn.addEventListener("sessionstart",Nn),tn.addEventListener("sessionend",Kn),this.render=function(N,K){if(K!==void 0&&K.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(L===!0)return;N.autoUpdate===!0&&N.updateMatrixWorld(),K.parent===null&&K.updateMatrixWorld(),tn.enabled===!0&&tn.isPresenting===!0&&(tn.cameraAutoUpdate===!0&&tn.updateCamera(K),K=tn.getCamera()),N.isScene===!0&&N.onBeforeRender(k,N,K,$),A=ze.get(N,R.length),A.init(),R.push(A),Ce.multiplyMatrices(K.projectionMatrix,K.matrixWorldInverse),ae.setFromProjectionMatrix(Ce),xe=this.localClippingEnabled,de=Ae.init(this.clippingPlanes,xe,K),S=ei.get(N,I.length),S.init(),I.push(S),Ei(N,K,0,k.sortObjects),S.finish(),k.sortObjects===!0&&S.sort(ye,Xe),de===!0&&Ae.beginShadows();let ne=A.state.shadowsArray;if(gt.render(ne,N,K),de===!0&&Ae.endShadows(),this.info.autoReset===!0&&this.info.reset(),Rt.render(S,N),A.setupLights(k.physicallyCorrectLights),K.isArrayCamera){let oe=K.cameras;for(let be=0,Fe=oe.length;be<Fe;be++){let Ne=oe[be];ln(S,N,Ne,Ne.viewport)}}else ln(S,N,K);$!==null&&(at.updateMultisampleRenderTarget($),at.updateRenderTargetMipmap($)),N.isScene===!0&&N.onAfterRender(k,N,K),et.resetDefaultState(),H=-1,G=null,R.pop(),R.length>0?A=R[R.length-1]:A=null,I.pop(),I.length>0?S=I[I.length-1]:S=null};function Ei(N,K,ne,oe){if(N.visible===!1)return;if(N.layers.test(K.layers)){if(N.isGroup)ne=N.renderOrder;else if(N.isLOD)N.autoUpdate===!0&&N.update(K);else if(N.isLight)A.pushLight(N),N.castShadow&&A.pushShadow(N);else if(N.isSprite){if(!N.frustumCulled||ae.intersectsSprite(N)){oe&&xt.setFromMatrixPosition(N.matrixWorld).applyMatrix4(Ce);let Ne=bn.update(N),Ke=N.material;Ke.visible&&S.push(N,Ne,Ke,ne,xt.z,null)}}else if((N.isMesh||N.isLine||N.isPoints)&&(N.isSkinnedMesh&&N.skeleton.frame!==qt.render.frame&&(N.skeleton.update(),N.skeleton.frame=qt.render.frame),!N.frustumCulled||ae.intersectsObject(N))){oe&&xt.setFromMatrixPosition(N.matrixWorld).applyMatrix4(Ce);let Ne=bn.update(N),Ke=N.material;if(Array.isArray(Ke)){let rt=Ne.groups;for(let Pt=0,_t=rt.length;Pt<_t;Pt++){let Jt=rt[Pt],Ht=Ke[Jt.materialIndex];Ht&&Ht.visible&&S.push(N,Ne,Ht,ne,xt.z,Jt)}}else Ke.visible&&S.push(N,Ne,Ke,ne,xt.z,null)}}let Fe=N.children;for(let Ne=0,Ke=Fe.length;Ne<Ke;Ne++)Ei(Fe[Ne],K,ne,oe)}function ln(N,K,ne,oe){let be=N.opaque,Fe=N.transmissive,Ne=N.transparent;A.setupLightsView(ne),Fe.length>0&&li(be,K,ne),oe&&Re.viewport(le.copy(oe)),be.length>0&&$t(be,K,ne),Fe.length>0&&$t(Fe,K,ne),Ne.length>0&&$t(Ne,K,ne),Re.buffers.depth.setTest(!0),Re.buffers.depth.setMask(!0),Re.buffers.color.setMask(!0),Re.setPolygonOffset(!1)}function li(N,K,ne){let oe=Lt.isWebGL2;De===null&&(De=new Qs(1,1,{generateMipmaps:!0,type:Ee.convert(Ch)!==null?Ch:Wc,minFilter:eg,samples:oe&&h===!0?4:0})),k.getDrawingBufferSize(pe),oe?De.setSize(pe.x,pe.y):De.setSize(f0(pe.x),f0(pe.y));let be=k.getRenderTarget();k.setRenderTarget(De),k.clear();let Fe=k.toneMapping;k.toneMapping=tl,$t(N,K,ne),k.toneMapping=Fe,at.updateMultisampleRenderTarget(De),at.updateRenderTargetMipmap(De),k.setRenderTarget(be)}function $t(N,K,ne){let oe=K.isScene===!0?K.overrideMaterial:null;for(let be=0,Fe=N.length;be<Fe;be++){let Ne=N[be],Ke=Ne.object,rt=Ne.geometry,Pt=oe===null?Ne.material:oe,_t=Ne.group;Ke.layers.test(ne.layers)&&kn(Ke,K,ne,rt,Pt,_t)}}function kn(N,K,ne,oe,be,Fe){N.onBeforeRender(k,K,ne,oe,be,Fe),N.modelViewMatrix.multiplyMatrices(ne.matrixWorldInverse,N.matrixWorld),N.normalMatrix.getNormalMatrix(N.modelViewMatrix),be.onBeforeRender(k,K,ne,oe,N,Fe),be.transparent===!0&&be.side===el?(be.side=To,be.needsUpdate=!0,k.renderBufferDirect(ne,K,oe,be,N,Fe),be.side=yf,be.needsUpdate=!0,k.renderBufferDirect(ne,K,oe,be,N,Fe),be.side=el):k.renderBufferDirect(ne,K,oe,be,N,Fe),N.onAfterRender(k,K,ne,oe,be,Fe)}function Un(N,K,ne){K.isScene!==!0&&(K=Ct);let oe=nt.get(N),be=A.state.lights,Fe=A.state.shadowsArray,Ne=be.state.version,Ke=wn.getParameters(N,be.state,Fe,K,ne),rt=wn.getProgramCacheKey(Ke),Pt=oe.programs;oe.environment=N.isMeshStandardMaterial?K.environment:null,oe.fog=K.fog,oe.envMap=(N.isMeshStandardMaterial?ut:St).get(N.envMap||oe.environment),Pt===void 0&&(N.addEventListener("dispose",nn),Pt=new Map,oe.programs=Pt);let _t=Pt.get(rt);if(_t!==void 0){if(oe.currentProgram===_t&&oe.lightsStateVersion===Ne)return Yn(N,Ke),_t}else Ke.uniforms=wn.getUniforms(N),N.onBuild(ne,Ke,k),N.onBeforeCompile(Ke,k),_t=wn.acquireProgram(Ke,rt),Pt.set(rt,_t),oe.uniforms=Ke.uniforms;let Jt=oe.uniforms;(!N.isShaderMaterial&&!N.isRawShaderMaterial||N.clipping===!0)&&(Jt.clippingPlanes=Ae.uniform),Yn(N,Ke),oe.needsLights=X(N),oe.lightsStateVersion=Ne,oe.needsLights&&(Jt.ambientLightColor.value=be.state.ambient,Jt.lightProbe.value=be.state.probe,Jt.directionalLights.value=be.state.directional,Jt.directionalLightShadows.value=be.state.directionalShadow,Jt.spotLights.value=be.state.spot,Jt.spotLightShadows.value=be.state.spotShadow,Jt.rectAreaLights.value=be.state.rectArea,Jt.ltc_1.value=be.state.rectAreaLTC1,Jt.ltc_2.value=be.state.rectAreaLTC2,Jt.pointLights.value=be.state.point,Jt.pointLightShadows.value=be.state.pointShadow,Jt.hemisphereLights.value=be.state.hemi,Jt.directionalShadowMap.value=be.state.directionalShadowMap,Jt.directionalShadowMatrix.value=be.state.directionalShadowMatrix,Jt.spotShadowMap.value=be.state.spotShadowMap,Jt.spotShadowMatrix.value=be.state.spotShadowMatrix,Jt.pointShadowMap.value=be.state.pointShadowMap,Jt.pointShadowMatrix.value=be.state.pointShadowMatrix);let Ht=_t.getUniforms(),cn=ru.seqWithValue(Ht.seq,Jt);return oe.currentProgram=_t,oe.uniformsList=cn,_t}function Yn(N,K){let ne=nt.get(N);ne.outputEncoding=K.outputEncoding,ne.instancing=K.instancing,ne.skinning=K.skinning,ne.morphTargets=K.morphTargets,ne.morphNormals=K.morphNormals,ne.morphColors=K.morphColors,ne.morphTargetsCount=K.morphTargetsCount,ne.numClippingPlanes=K.numClippingPlanes,ne.numIntersection=K.numClipIntersection,ne.vertexAlphas=K.vertexAlphas,ne.vertexTangents=K.vertexTangents,ne.toneMapping=K.toneMapping}function Ft(N,K,ne,oe,be){K.isScene!==!0&&(K=Ct),at.resetTextureUnits();let Fe=K.fog,Ne=oe.isMeshStandardMaterial?K.environment:null,Ke=$===null?k.outputEncoding:$.isXRRenderTarget===!0?$.texture.encoding:nl,rt=(oe.isMeshStandardMaterial?ut:St).get(oe.envMap||Ne),Pt=oe.vertexColors===!0&&!!ne.attributes.color&&ne.attributes.color.itemSize===4,_t=!!oe.normalMap&&!!ne.attributes.tangent,Jt=!!ne.morphAttributes.position,Ht=!!ne.morphAttributes.normal,cn=!!ne.morphAttributes.color,In=oe.toneMapped?k.toneMapping:tl,Wn=ne.morphAttributes.position||ne.morphAttributes.normal||ne.morphAttributes.color,$n=Wn!==void 0?Wn.length:0,hn=nt.get(oe),yi=A.state.lights;if(de===!0&&(xe===!0||N!==G)){let yr=N===G&&oe.id===H;Ae.setState(oe,N,yr)}let Qn=!1;oe.version===hn.__version?(hn.needsLights&&hn.lightsStateVersion!==yi.state.version||hn.outputEncoding!==Ke||be.isInstancedMesh&&hn.instancing===!1||!be.isInstancedMesh&&hn.instancing===!0||be.isSkinnedMesh&&hn.skinning===!1||!be.isSkinnedMesh&&hn.skinning===!0||hn.envMap!==rt||oe.fog&&hn.fog!==Fe||hn.numClippingPlanes!==void 0&&(hn.numClippingPlanes!==Ae.numPlanes||hn.numIntersection!==Ae.numIntersection)||hn.vertexAlphas!==Pt||hn.vertexTangents!==_t||hn.morphTargets!==Jt||hn.morphNormals!==Ht||hn.morphColors!==cn||hn.toneMapping!==In||Lt.isWebGL2===!0&&hn.morphTargetsCount!==$n)&&(Qn=!0):(Qn=!0,hn.__version=oe.version);let Rr=hn.currentProgram;Qn===!0&&(Rr=Un(oe,K,be));let Fr=!1,Tt=!1,hs=!1,Si=Rr.getUniforms(),As=hn.uniforms;if(Re.useProgram(Rr.program)&&(Fr=!0,Tt=!0,hs=!0),oe.id!==H&&(H=oe.id,Tt=!0),Fr||G!==N){if(Si.setValue(Qe,"projectionMatrix",N.projectionMatrix),Lt.logarithmicDepthBuffer&&Si.setValue(Qe,"logDepthBufFC",2/(Math.log(N.far+1)/Math.LN2)),G!==N&&(G=N,Tt=!0,hs=!0),oe.isShaderMaterial||oe.isMeshPhongMaterial||oe.isMeshToonMaterial||oe.isMeshStandardMaterial||oe.envMap){let yr=Si.map.cameraPosition;yr!==void 0&&yr.setValue(Qe,xt.setFromMatrixPosition(N.matrixWorld))}(oe.isMeshPhongMaterial||oe.isMeshToonMaterial||oe.isMeshLambertMaterial||oe.isMeshBasicMaterial||oe.isMeshStandardMaterial||oe.isShaderMaterial)&&Si.setValue(Qe,"isOrthographic",N.isOrthographicCamera===!0),(oe.isMeshPhongMaterial||oe.isMeshToonMaterial||oe.isMeshLambertMaterial||oe.isMeshBasicMaterial||oe.isMeshStandardMaterial||oe.isShaderMaterial||oe.isShadowMaterial||be.isSkinnedMesh)&&Si.setValue(Qe,"viewMatrix",N.matrixWorldInverse)}if(be.isSkinnedMesh){Si.setOptional(Qe,be,"bindMatrix"),Si.setOptional(Qe,be,"bindMatrixInverse");let yr=be.skeleton;yr&&(Lt.floatVertexTextures?(yr.boneTexture===null&&yr.computeBoneTexture(),Si.setValue(Qe,"boneTexture",yr.boneTexture,at),Si.setValue(Qe,"boneTextureSize",yr.boneTextureSize)):Si.setOptional(Qe,yr,"boneMatrices"))}let ia=ne.morphAttributes;return(ia.position!==void 0||ia.normal!==void 0||ia.color!==void 0&&Lt.isWebGL2===!0)&&Xt.update(be,ne,oe,Rr),(Tt||hn.receiveShadow!==be.receiveShadow)&&(hn.receiveShadow=be.receiveShadow,Si.setValue(Qe,"receiveShadow",be.receiveShadow)),Tt&&(Si.setValue(Qe,"toneMappingExposure",k.toneMappingExposure),hn.needsLights&&he(As,hs),Fe&&oe.fog&&xn.refreshFogUniforms(As,Fe),xn.refreshMaterialUniforms(As,oe,Y,se,De),ru.upload(Qe,hn.uniformsList,As,at)),oe.isShaderMaterial&&oe.uniformsNeedUpdate===!0&&(ru.upload(Qe,hn.uniformsList,As,at),oe.uniformsNeedUpdate=!1),oe.isSpriteMaterial&&Si.setValue(Qe,"center",be.center),Si.setValue(Qe,"modelViewMatrix",be.modelViewMatrix),Si.setValue(Qe,"normalMatrix",be.normalMatrix),Si.setValue(Qe,"modelMatrix",be.matrixWorld),Rr}function he(N,K){N.ambientLightColor.needsUpdate=K,N.lightProbe.needsUpdate=K,N.directionalLights.needsUpdate=K,N.directionalLightShadows.needsUpdate=K,N.pointLights.needsUpdate=K,N.pointLightShadows.needsUpdate=K,N.spotLights.needsUpdate=K,N.spotLightShadows.needsUpdate=K,N.rectAreaLights.needsUpdate=K,N.hemisphereLights.needsUpdate=K}function X(N){return N.isMeshLambertMaterial||N.isMeshToonMaterial||N.isMeshPhongMaterial||N.isMeshStandardMaterial||N.isShadowMaterial||N.isShaderMaterial&&N.lights===!0}this.getActiveCubeFace=function(){return z},this.getActiveMipmapLevel=function(){return B},this.getRenderTarget=function(){return $},this.setRenderTargetTextures=function(N,K,ne){nt.get(N.texture).__webglTexture=K,nt.get(N.depthTexture).__webglTexture=ne;let oe=nt.get(N);oe.__hasExternalTextures=!0,oe.__hasExternalTextures&&(oe.__autoAllocateDepthBuffer=ne===void 0,oe.__autoAllocateDepthBuffer||Zt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),oe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(N,K){let ne=nt.get(N);ne.__webglFramebuffer=K,ne.__useDefaultFramebuffer=K===void 0},this.setRenderTarget=function(N,K=0,ne=0){$=N,z=K,B=ne;let oe=!0;if(N){let rt=nt.get(N);rt.__useDefaultFramebuffer!==void 0?(Re.bindFramebuffer(36160,null),oe=!1):rt.__webglFramebuffer===void 0?at.setupRenderTarget(N):rt.__hasExternalTextures&&at.rebindTextures(N,nt.get(N.texture).__webglTexture,nt.get(N.depthTexture).__webglTexture)}let be=null,Fe=!1,Ne=!1;if(N){let rt=N.texture;(rt.isData3DTexture||rt.isDataArrayTexture)&&(Ne=!0);let Pt=nt.get(N).__webglFramebuffer;N.isWebGLCubeRenderTarget?(be=Pt[K],Fe=!0):Lt.isWebGL2&&N.samples>0&&at.useMultisampledRTT(N)===!1?be=nt.get(N).__webglMultisampledFramebuffer:be=Pt,le.copy(N.viewport),te.copy(N.scissor),ue=N.scissorTest}else le.copy(ge).multiplyScalar(Y).floor(),te.copy(re).multiplyScalar(Y).floor(),ue=ve;if(Re.bindFramebuffer(36160,be)&&Lt.drawBuffers&&oe&&Re.drawBuffers(N,be),Re.viewport(le),Re.scissor(te),Re.setScissorTest(ue),Fe){let rt=nt.get(N.texture);Qe.framebufferTexture2D(36160,36064,34069+K,rt.__webglTexture,ne)}else if(Ne){let rt=nt.get(N.texture),Pt=K||0;Qe.framebufferTextureLayer(36160,36064,rt.__webglTexture,ne||0,Pt)}H=-1},this.readRenderTargetPixels=function(N,K,ne,oe,be,Fe,Ne){if(!(N&&N.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ke=nt.get(N).__webglFramebuffer;if(N.isWebGLCubeRenderTarget&&Ne!==void 0&&(Ke=Ke[Ne]),Ke){Re.bindFramebuffer(36160,Ke);try{let rt=N.texture,Pt=rt.format,_t=rt.type;if(Pt!==ws&&Ee.convert(Pt)!==Qe.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Jt=_t===Ch&&(Zt.has("EXT_color_buffer_half_float")||Lt.isWebGL2&&Zt.has("EXT_color_buffer_float"));if(_t!==Wc&&Ee.convert(_t)!==Qe.getParameter(35738)&&!(_t===qc&&(Lt.isWebGL2||Zt.has("OES_texture_float")||Zt.has("WEBGL_color_buffer_float")))&&!Jt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}K>=0&&K<=N.width-oe&&ne>=0&&ne<=N.height-be&&Qe.readPixels(K,ne,oe,be,Ee.convert(Pt),Ee.convert(_t),Fe)}finally{let rt=$!==null?nt.get($).__webglFramebuffer:null;Re.bindFramebuffer(36160,rt)}}},this.copyFramebufferToTexture=function(N,K,ne=0){if(K.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}let oe=Math.pow(2,-ne),be=Math.floor(K.image.width*oe),Fe=Math.floor(K.image.height*oe);at.setTexture2D(K,0),Qe.copyTexSubImage2D(3553,ne,0,0,N.x,N.y,be,Fe),Re.unbindTexture()},this.copyTextureToTexture=function(N,K,ne,oe=0){let be=K.image.width,Fe=K.image.height,Ne=Ee.convert(ne.format),Ke=Ee.convert(ne.type);at.setTexture2D(ne,0),Qe.pixelStorei(37440,ne.flipY),Qe.pixelStorei(37441,ne.premultiplyAlpha),Qe.pixelStorei(3317,ne.unpackAlignment),K.isDataTexture?Qe.texSubImage2D(3553,oe,N.x,N.y,be,Fe,Ne,Ke,K.image.data):K.isCompressedTexture?Qe.compressedTexSubImage2D(3553,oe,N.x,N.y,K.mipmaps[0].width,K.mipmaps[0].height,Ne,K.mipmaps[0].data):Qe.texSubImage2D(3553,oe,N.x,N.y,Ne,Ke,K.image),oe===0&&ne.generateMipmaps&&Qe.generateMipmap(3553),Re.unbindTexture()},this.copyTextureToTexture3D=function(N,K,ne,oe,be=0){if(k.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Fe=N.max.x-N.min.x+1,Ne=N.max.y-N.min.y+1,Ke=N.max.z-N.min.z+1,rt=Ee.convert(oe.format),Pt=Ee.convert(oe.type),_t;if(oe.isData3DTexture)at.setTexture3D(oe,0),_t=32879;else if(oe.isDataArrayTexture)at.setTexture2DArray(oe,0),_t=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Qe.pixelStorei(37440,oe.flipY),Qe.pixelStorei(37441,oe.premultiplyAlpha),Qe.pixelStorei(3317,oe.unpackAlignment);let Jt=Qe.getParameter(3314),Ht=Qe.getParameter(32878),cn=Qe.getParameter(3316),In=Qe.getParameter(3315),Wn=Qe.getParameter(32877),$n=ne.isCompressedTexture?ne.mipmaps[0]:ne.image;Qe.pixelStorei(3314,$n.width),Qe.pixelStorei(32878,$n.height),Qe.pixelStorei(3316,N.min.x),Qe.pixelStorei(3315,N.min.y),Qe.pixelStorei(32877,N.min.z),ne.isDataTexture||ne.isData3DTexture?Qe.texSubImage3D(_t,be,K.x,K.y,K.z,Fe,Ne,Ke,rt,Pt,$n.data):ne.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Qe.compressedTexSubImage3D(_t,be,K.x,K.y,K.z,Fe,Ne,Ke,rt,$n.data)):Qe.texSubImage3D(_t,be,K.x,K.y,K.z,Fe,Ne,Ke,rt,Pt,$n),Qe.pixelStorei(3314,Jt),Qe.pixelStorei(32878,Ht),Qe.pixelStorei(3316,cn),Qe.pixelStorei(3315,In),Qe.pixelStorei(32877,Wn),be===0&&oe.generateMipmaps&&Qe.generateMipmap(_t),Re.unbindTexture()},this.initTexture=function(N){at.setTexture2D(N,0),Re.unbindTexture()},this.resetState=function(){z=0,B=0,$=null,Re.reset(),et.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}sr.prototype.isWebGLRenderer=!0;var vw=class extends sr{};vw.prototype.isWebGL1Renderer=!0;var bg=class{constructor(e,t=25e-5){this.name="",this.color=new jn(e),this.density=t}clone(){return new bg(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}};bg.prototype.isFogExp2=!0;var wg=class{constructor(e,t=1,s=1e3){this.name="",this.color=new jn(e),this.near=t,this.far=s}clone(){return new wg(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}};wg.prototype.isFog=!0;var Hf=class extends Ki{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}};Hf.prototype.isScene=!0;var Vh=class{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=xf,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ko()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,s){e*=this.stride,s*=t.stride;for(let c=0,h=this.stride;c<h;c++)this.array[e+c]=t.array[s+c];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ko()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(t,this.stride);return s.setUsage(this.usage),s}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ko()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};Vh.prototype.isInterleavedBuffer=!0;var no=new Be,io=class{constructor(e,t,s,c=!1){this.name="",this.data=e,this.itemSize=t,this.offset=s,this.normalized=c===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,s=this.data.count;t<s;t++)no.fromBufferAttribute(this,t),no.applyMatrix4(e),this.setXYZ(t,no.x,no.y,no.z);return this}applyNormalMatrix(e){for(let t=0,s=this.count;t<s;t++)no.fromBufferAttribute(this,t),no.applyNormalMatrix(e),this.setXYZ(t,no.x,no.y,no.z);return this}transformDirection(e){for(let t=0,s=this.count;t<s;t++)no.fromBufferAttribute(this,t),no.transformDirection(e),this.setXYZ(t,no.x,no.y,no.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=s,this}setXYZ(e,t,s,c){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=s,this.data.array[e+2]=c,this}setXYZW(e,t,s,c,h){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=s,this.data.array[e+2]=c,this.data.array[e+3]=h,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let s=0;s<this.count;s++){let c=s*this.data.stride+this.offset;for(let h=0;h<this.itemSize;h++)t.push(this.data.array[c+h])}return new xr(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new io(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let s=0;s<this.count;s++){let c=s*this.data.stride+this.offset;for(let h=0;h<this.itemSize;h++)t.push(this.data.array[c+h])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};io.prototype.isInterleavedBufferAttribute=!0;var Tg=class extends Zr{constructor(e){super();this.type="SpriteMaterial",this.color=new jn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}};Tg.prototype.isSpriteMaterial=!0;var jf,Eg=new Be,Wf=new Be,qf=new Be,Xf=new Wt,Sg=new Wt,p3=new Jn,q0=new Be,Ag=new Be,X0=new Be,m3=new Wt,xw=new Wt,g3=new Wt,bw=class extends Ki{constructor(e){super();if(this.type="Sprite",jf===void 0){jf=new er;let t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),s=new Vh(t,5);jf.setIndex([0,1,2,0,2,3]),jf.setAttribute("position",new io(s,3,0,!1)),jf.setAttribute("uv",new io(s,2,3,!1))}this.geometry=jf,this.material=e!==void 0?e:new Tg,this.center=new Wt(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Wf.setFromMatrixScale(this.matrixWorld),p3.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),qf.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Wf.multiplyScalar(-qf.z);let s=this.material.rotation,c,h;s!==0&&(h=Math.cos(s),c=Math.sin(s));let p=this.center;Z0(q0.set(-.5,-.5,0),qf,p,Wf,c,h),Z0(Ag.set(.5,-.5,0),qf,p,Wf,c,h),Z0(X0.set(.5,.5,0),qf,p,Wf,c,h),m3.set(0,0),xw.set(1,0),g3.set(1,1);let r=e.ray.intersectTriangle(q0,Ag,X0,!1,Eg);if(r===null&&(Z0(Ag.set(-.5,.5,0),qf,p,Wf,c,h),xw.set(0,1),r=e.ray.intersectTriangle(q0,X0,Ag,!1,Eg),r===null))return;let x=e.ray.origin.distanceTo(Eg);x<e.near||x>e.far||t.push({distance:x,point:Eg.clone(),uv:Gr.getUV(Eg,q0,Ag,X0,m3,xw,g3,new Wt),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};bw.prototype.isSprite=!0;function Z0(i,e,t,s,c,h){Xf.subVectors(i,t).addScalar(.5).multiply(s),c!==void 0?(Sg.x=h*Xf.x-c*Xf.y,Sg.y=c*Xf.x+h*Xf.y):Sg.copy(Xf),i.copy(e),i.x+=Sg.x,i.y+=Sg.y,i.applyMatrix4(p3)}var _3=new Be,y3=new Ui,v3=new Ui,fU=new Be,x3=new Jn,K0=class extends Hr{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Jn,this.bindMatrixInverse=new Jn}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new Ui,t=this.geometry.attributes.skinWeight;for(let s=0,c=t.count;s<c;s++){e.fromBufferAttribute(t,s);let h=1/e.manhattanLength();h!==Infinity?e.multiplyScalar(h):e.set(1,0,0,0),t.setXYZW(s,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){let s=this.skeleton,c=this.geometry;y3.fromBufferAttribute(c.attributes.skinIndex,e),v3.fromBufferAttribute(c.attributes.skinWeight,e),_3.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let h=0;h<4;h++){let p=v3.getComponent(h);if(p!==0){let r=y3.getComponent(h);x3.multiplyMatrices(s.bones[r].matrixWorld,s.boneInverses[r]),t.addScaledVector(fU.copy(_3).applyMatrix4(x3),p)}}return t.applyMatrix4(this.bindMatrixInverse)}};K0.prototype.isSkinnedMesh=!0;var ww=class extends Ki{constructor(){super();this.type="Bone"}};ww.prototype.isBone=!0;var Kl=class extends Qr{constructor(e=null,t=1,s=1,c,h,p,r,x,v=Qi,w=Qi,S,A){super(null,p,r,x,v,w,c,h,S,A);this.image={data:e,width:t,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};Kl.prototype.isDataTexture=!0;var Mg=class extends xr{constructor(e,t,s,c=1){typeof s=="number"&&(c=s,s=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,s),this.meshPerAttribute=c}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};Mg.prototype.isInstancedBufferAttribute=!0;var b3=new Jn,w3=new Jn,Y0=[],Ig=new Hr,Tw=class extends Hr{constructor(e,t,s){super(e,t);this.instanceMatrix=new Mg(new Float32Array(s*16),16),this.instanceColor=null,this.count=s,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let s=this.matrixWorld,c=this.count;if(Ig.geometry=this.geometry,Ig.material=this.material,Ig.material!==void 0)for(let h=0;h<c;h++){this.getMatrixAt(h,b3),w3.multiplyMatrices(s,b3),Ig.matrixWorld=w3,Ig.raycast(e,Y0);for(let p=0,r=Y0.length;p<r;p++){let x=Y0[p];x.instanceId=h,x.object=this,t.push(x)}Y0.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Mg(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};Tw.prototype.isInstancedMesh=!0;var Yl=class extends Zr{constructor(e){super();this.type="LineBasicMaterial",this.color=new jn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}};Yl.prototype.isLineBasicMaterial=!0;var T3=new Be,E3=new Be,S3=new Jn,Ew=new Qc,J0=new Jo,Cg=class extends Ki{constructor(e=new er,t=new Yl){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,s=[0];for(let c=1,h=t.count;c<h;c++)T3.fromBufferAttribute(t,c-1),E3.fromBufferAttribute(t,c),s[c]=s[c-1],s[c]+=T3.distanceTo(E3);e.setAttribute("lineDistance",new br(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){let s=this.geometry,c=this.matrixWorld,h=e.params.Line.threshold,p=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),J0.copy(s.boundingSphere),J0.applyMatrix4(c),J0.radius+=h,e.ray.intersectsSphere(J0)===!1)return;S3.copy(c).invert(),Ew.copy(e.ray).applyMatrix4(S3);let r=h/((this.scale.x+this.scale.y+this.scale.z)/3),x=r*r,v=new Be,w=new Be,S=new Be,A=new Be,I=this.isLineSegments?2:1;if(s.isBufferGeometry){let R=s.index,L=s.attributes.position;if(R!==null){let z=Math.max(0,p.start),B=Math.min(R.count,p.start+p.count);for(let $=z,H=B-1;$<H;$+=I){let G=R.getX($),le=R.getX($+1);if(v.fromBufferAttribute(L,G),w.fromBufferAttribute(L,le),Ew.distanceSqToSegment(v,w,A,S)>x)continue;A.applyMatrix4(this.matrixWorld);let ue=e.ray.origin.distanceTo(A);ue<e.near||ue>e.far||t.push({distance:ue,point:S.clone().applyMatrix4(this.matrixWorld),index:$,face:null,faceIndex:null,object:this})}}else{let z=Math.max(0,p.start),B=Math.min(L.count,p.start+p.count);for(let $=z,H=B-1;$<H;$+=I){if(v.fromBufferAttribute(L,$),w.fromBufferAttribute(L,$+1),Ew.distanceSqToSegment(v,w,A,S)>x)continue;A.applyMatrix4(this.matrixWorld);let le=e.ray.origin.distanceTo(A);le<e.near||le>e.far||t.push({distance:le,point:S.clone().applyMatrix4(this.matrixWorld),index:$,face:null,faceIndex:null,object:this})}}}else s.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,s=Object.keys(t);if(s.length>0){let c=t[s[0]];if(c!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let h=0,p=c.length;h<p;h++){let r=c[h].name||String(h);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=h}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};Cg.prototype.isLine=!0;var A3=new Be,M3=new Be,Zf=class extends Cg{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,s=[];for(let c=0,h=t.count;c<h;c+=2)A3.fromBufferAttribute(t,c),M3.fromBufferAttribute(t,c+1),s[c]=c===0?0:s[c-1],s[c+1]=s[c]+A3.distanceTo(M3);e.setAttribute("lineDistance",new br(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};Zf.prototype.isLineSegments=!0;var Sw=class extends Cg{constructor(e,t){super(e,t);this.type="LineLoop"}};Sw.prototype.isLineLoop=!0;var Lg=class extends Zr{constructor(e){super();this.type="PointsMaterial",this.color=new jn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}};Lg.prototype.isPointsMaterial=!0;var I3=new Jn,Aw=new Qc,$0=new Jo,Q0=new Be,Mw=class extends Ki{constructor(e=new er,t=new Lg){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){let s=this.geometry,c=this.matrixWorld,h=e.params.Points.threshold,p=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),$0.copy(s.boundingSphere),$0.applyMatrix4(c),$0.radius+=h,e.ray.intersectsSphere($0)===!1)return;I3.copy(c).invert(),Aw.copy(e.ray).applyMatrix4(I3);let r=h/((this.scale.x+this.scale.y+this.scale.z)/3),x=r*r;if(s.isBufferGeometry){let v=s.index,S=s.attributes.position;if(v!==null){let A=Math.max(0,p.start),I=Math.min(v.count,p.start+p.count);for(let R=A,k=I;R<k;R++){let L=v.getX(R);Q0.fromBufferAttribute(S,L),C3(Q0,L,x,c,e,t,this)}}else{let A=Math.max(0,p.start),I=Math.min(S.count,p.start+p.count);for(let R=A,k=I;R<k;R++)Q0.fromBufferAttribute(S,R),C3(Q0,R,x,c,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,s=Object.keys(t);if(s.length>0){let c=t[s[0]];if(c!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let h=0,p=c.length;h<p;h++){let r=c[h].name||String(h);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=h}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};Mw.prototype.isPoints=!0;function C3(i,e,t,s,c,h,p){let r=Aw.distanceSqToPoint(i);if(r<t){let x=new Be;Aw.closestPointToPoint(i,x),x.applyMatrix4(s);let v=c.ray.origin.distanceTo(x);if(v<c.near||v>c.far)return;h.push({distance:v,distanceToRay:Math.sqrt(r),point:x,index:e,face:null,object:p})}}var Iw=class extends Qr{constructor(e,t,s,c,h,p,r,x,v){super(e,t,s,c,h,p,r,x,v);this.minFilter=p!==void 0?p:bs,this.magFilter=h!==void 0?h:bs,this.generateMipmaps=!1;let w=this;function S(){w.needsUpdate=!0,e.requestVideoFrameCallback(S)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(S)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}};Iw.prototype.isVideoTexture=!0;var Cw=class extends Qr{constructor(e,t,s){super({width:e,height:t});this.format=s,this.magFilter=Qi,this.minFilter=Qi,this.generateMipmaps=!1,this.needsUpdate=!0}};Cw.prototype.isFramebufferTexture=!0;var Lw=class extends Qr{constructor(e,t,s,c,h,p,r,x,v,w,S,A){super(null,p,r,x,v,w,c,h,S,A);this.image={width:t,height:s},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}};Lw.prototype.isCompressedTexture=!0;var Dw=class extends Qr{constructor(e,t,s,c,h,p,r,x,v){super(e,t,s,c,h,p,r,x,v);this.needsUpdate=!0}};Dw.prototype.isCanvasTexture=!0;var Eo=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let s=this.getUtoTmapping(e);return this.getPoint(s,t)}getPoints(e=5){let t=[];for(let s=0;s<=e;s++)t.push(this.getPoint(s/e));return t}getSpacedPoints(e=5){let t=[];for(let s=0;s<=e;s++)t.push(this.getPointAt(s/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],s,c=this.getPoint(0),h=0;t.push(0);for(let p=1;p<=e;p++)s=this.getPoint(p/e),h+=s.distanceTo(c),t.push(h),c=s;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let s=this.getLengths(),c=0,h=s.length,p;t?p=t:p=e*s[h-1];let r=0,x=h-1,v;for(;r<=x;)if(c=Math.floor(r+(x-r)/2),v=s[c]-p,v<0)r=c+1;else if(v>0)x=c-1;else{x=c;break}if(c=x,s[c]===p)return c/(h-1);let w=s[c],A=s[c+1]-w,I=(p-w)/A;return(c+I)/(h-1)}getTangent(e,t){let s=1e-4,c=e-s,h=e+s;c<0&&(c=0),h>1&&(h=1);let p=this.getPoint(c),r=this.getPoint(h),x=t||(p.isVector2?new Wt:new Be);return x.copy(r).sub(p).normalize(),x}getTangentAt(e,t){let s=this.getUtoTmapping(e);return this.getTangent(s,t)}computeFrenetFrames(e,t){let s=new Be,c=[],h=[],p=[],r=new Be,x=new Jn;for(let I=0;I<=e;I++){let R=I/e;c[I]=this.getTangentAt(R,new Be)}h[0]=new Be,p[0]=new Be;let v=Number.MAX_VALUE,w=Math.abs(c[0].x),S=Math.abs(c[0].y),A=Math.abs(c[0].z);w<=v&&(v=w,s.set(1,0,0)),S<=v&&(v=S,s.set(0,1,0)),A<=v&&s.set(0,0,1),r.crossVectors(c[0],s).normalize(),h[0].crossVectors(c[0],r),p[0].crossVectors(c[0],h[0]);for(let I=1;I<=e;I++){if(h[I]=h[I-1].clone(),p[I]=p[I-1].clone(),r.crossVectors(c[I-1],c[I]),r.length()>Number.EPSILON){r.normalize();let R=Math.acos(as(c[I-1].dot(c[I]),-1,1));h[I].applyMatrix4(x.makeRotationAxis(r,R))}p[I].crossVectors(c[I],h[I])}if(t===!0){let I=Math.acos(as(h[0].dot(h[e]),-1,1));I/=e,c[0].dot(r.crossVectors(h[0],h[e]))>0&&(I=-I);for(let R=1;R<=e;R++)h[R].applyMatrix4(x.makeRotationAxis(c[R],I*R)),p[R].crossVectors(c[R],h[R])}return{tangents:c,normals:h,binormals:p}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},Kf=class extends Eo{constructor(e=0,t=0,s=1,c=1,h=0,p=Math.PI*2,r=!1,x=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=s,this.yRadius=c,this.aStartAngle=h,this.aEndAngle=p,this.aClockwise=r,this.aRotation=x}getPoint(e,t){let s=t||new Wt,c=Math.PI*2,h=this.aEndAngle-this.aStartAngle,p=Math.abs(h)<Number.EPSILON;for(;h<0;)h+=c;for(;h>c;)h-=c;h<Number.EPSILON&&(p?h=0:h=c),this.aClockwise===!0&&!p&&(h===c?h=-c:h=h-c);let r=this.aStartAngle+e*h,x=this.aX+this.xRadius*Math.cos(r),v=this.aY+this.yRadius*Math.sin(r);if(this.aRotation!==0){let w=Math.cos(this.aRotation),S=Math.sin(this.aRotation),A=x-this.aX,I=v-this.aY;x=A*w-I*S+this.aX,v=A*S+I*w+this.aY}return s.set(x,v)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};Kf.prototype.isEllipseCurve=!0;var ev=class extends Kf{constructor(e,t,s,c,h,p){super(e,t,s,s,c,h,p);this.type="ArcCurve"}};ev.prototype.isArcCurve=!0;function Rw(){let i=0,e=0,t=0,s=0;function c(h,p,r,x){i=h,e=r,t=-3*h+3*p-2*r-x,s=2*h-2*p+r+x}return{initCatmullRom:function(h,p,r,x,v){c(p,r,v*(r-h),v*(x-p))},initNonuniformCatmullRom:function(h,p,r,x,v,w,S){let A=(p-h)/v-(r-h)/(v+w)+(r-p)/w,I=(r-p)/w-(x-p)/(w+S)+(x-r)/S;A*=w,I*=w,c(p,r,A,I)},calc:function(h){let p=h*h,r=p*h;return i+e*h+t*p+s*r}}}var tv=new Be,Pw=new Rw,kw=new Rw,zw=new Rw,nv=class extends Eo{constructor(e=[],t=!1,s="centripetal",c=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=s,this.tension=c}getPoint(e,t=new Be){let s=t,c=this.points,h=c.length,p=(h-(this.closed?0:1))*e,r=Math.floor(p),x=p-r;this.closed?r+=r>0?0:(Math.floor(Math.abs(r)/h)+1)*h:x===0&&r===h-1&&(r=h-2,x=1);let v,w;this.closed||r>0?v=c[(r-1)%h]:(tv.subVectors(c[0],c[1]).add(c[0]),v=tv);let S=c[r%h],A=c[(r+1)%h];if(this.closed||r+2<h?w=c[(r+2)%h]:(tv.subVectors(c[h-1],c[h-2]).add(c[h-1]),w=tv),this.curveType==="centripetal"||this.curveType==="chordal"){let I=this.curveType==="chordal"?.5:.25,R=Math.pow(v.distanceToSquared(S),I),k=Math.pow(S.distanceToSquared(A),I),L=Math.pow(A.distanceToSquared(w),I);k<1e-4&&(k=1),R<1e-4&&(R=k),L<1e-4&&(L=k),Pw.initNonuniformCatmullRom(v.x,S.x,A.x,w.x,R,k,L),kw.initNonuniformCatmullRom(v.y,S.y,A.y,w.y,R,k,L),zw.initNonuniformCatmullRom(v.z,S.z,A.z,w.z,R,k,L)}else this.curveType==="catmullrom"&&(Pw.initCatmullRom(v.x,S.x,A.x,w.x,this.tension),kw.initCatmullRom(v.y,S.y,A.y,w.y,this.tension),zw.initCatmullRom(v.z,S.z,A.z,w.z,this.tension));return s.set(Pw.calc(x),kw.calc(x),zw.calc(x)),s}copy(e){super.copy(e),this.points=[];for(let t=0,s=e.points.length;t<s;t++){let c=e.points[t];this.points.push(c.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,s=this.points.length;t<s;t++){let c=this.points[t];e.points.push(c.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,s=e.points.length;t<s;t++){let c=e.points[t];this.points.push(new Be().fromArray(c))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};nv.prototype.isCatmullRomCurve3=!0;function L3(i,e,t,s,c){let h=(s-e)*.5,p=(c-t)*.5,r=i*i,x=i*r;return(2*t-2*s+h+p)*x+(-3*t+3*s-2*h-p)*r+h*i+t}function pU(i,e){let t=1-i;return t*t*e}function mU(i,e){return 2*(1-i)*i*e}function gU(i,e){return i*i*e}function Dg(i,e,t,s){return pU(i,e)+mU(i,t)+gU(i,s)}function _U(i,e){let t=1-i;return t*t*t*e}function yU(i,e){let t=1-i;return 3*t*t*i*e}function vU(i,e){return 3*(1-i)*i*i*e}function xU(i,e){return i*i*i*e}function Rg(i,e,t,s,c){return _U(i,e)+yU(i,t)+vU(i,s)+xU(i,c)}var Pg=class extends Eo{constructor(e=new Wt,t=new Wt,s=new Wt,c=new Wt){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=s,this.v3=c}getPoint(e,t=new Wt){let s=t,c=this.v0,h=this.v1,p=this.v2,r=this.v3;return s.set(Rg(e,c.x,h.x,p.x,r.x),Rg(e,c.y,h.y,p.y,r.y)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};Pg.prototype.isCubicBezierCurve=!0;var iv=class extends Eo{constructor(e=new Be,t=new Be,s=new Be,c=new Be){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=s,this.v3=c}getPoint(e,t=new Be){let s=t,c=this.v0,h=this.v1,p=this.v2,r=this.v3;return s.set(Rg(e,c.x,h.x,p.x,r.x),Rg(e,c.y,h.y,p.y,r.y),Rg(e,c.z,h.z,p.z,r.z)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};iv.prototype.isCubicBezierCurve3=!0;var Yf=class extends Eo{constructor(e=new Wt,t=new Wt){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Wt){let s=t;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let s=t||new Wt;return s.copy(this.v2).sub(this.v1).normalize(),s}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};Yf.prototype.isLineCurve=!0;var Ow=class extends Eo{constructor(e=new Be,t=new Be){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new Be){let s=t;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},kg=class extends Eo{constructor(e=new Wt,t=new Wt,s=new Wt){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=s}getPoint(e,t=new Wt){let s=t,c=this.v0,h=this.v1,p=this.v2;return s.set(Dg(e,c.x,h.x,p.x),Dg(e,c.y,h.y,p.y)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};kg.prototype.isQuadraticBezierCurve=!0;var rv=class extends Eo{constructor(e=new Be,t=new Be,s=new Be){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=s}getPoint(e,t=new Be){let s=t,c=this.v0,h=this.v1,p=this.v2;return s.set(Dg(e,c.x,h.x,p.x),Dg(e,c.y,h.y,p.y),Dg(e,c.z,h.z,p.z)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};rv.prototype.isQuadraticBezierCurve3=!0;var zg=class extends Eo{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new Wt){let s=t,c=this.points,h=(c.length-1)*e,p=Math.floor(h),r=h-p,x=c[p===0?p:p-1],v=c[p],w=c[p>c.length-2?c.length-1:p+1],S=c[p>c.length-3?c.length-1:p+2];return s.set(L3(r,x.x,v.x,w.x,S.x),L3(r,x.y,v.y,w.y,S.y)),s}copy(e){super.copy(e),this.points=[];for(let t=0,s=e.points.length;t<s;t++){let c=e.points[t];this.points.push(c.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,s=this.points.length;t<s;t++){let c=this.points[t];e.points.push(c.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,s=e.points.length;t<s;t++){let c=e.points[t];this.points.push(new Wt().fromArray(c))}return this}};zg.prototype.isSplineCurve=!0;var D3=Object.freeze({__proto__:null,ArcCurve:ev,CatmullRomCurve3:nv,CubicBezierCurve:Pg,CubicBezierCurve3:iv,EllipseCurve:Kf,LineCurve:Yf,LineCurve3:Ow,QuadraticBezierCurve:kg,QuadraticBezierCurve3:rv,SplineCurve:zg}),Nw=class extends Eo{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Yf(t,e))}getPoint(e,t){let s=e*this.getLength(),c=this.getCurveLengths(),h=0;for(;h<c.length;){if(c[h]>=s){let p=c[h]-s,r=this.curves[h],x=r.getLength(),v=x===0?0:1-p/x;return r.getPointAt(v,t)}h++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let s=0,c=this.curves.length;s<c;s++)t+=this.curves[s].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let s=0;s<=e;s++)t.push(this.getPoint(s/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],s;for(let c=0,h=this.curves;c<h.length;c++){let p=h[c],r=p.isEllipseCurve?e*2:p.isLineCurve||p.isLineCurve3?1:p.isSplineCurve?e*p.points.length:e,x=p.getPoints(r);for(let v=0;v<x.length;v++){let w=x[v];s&&s.equals(w)||(t.push(w),s=w)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,s=e.curves.length;t<s;t++){let c=e.curves[t];this.curves.push(c.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,s=this.curves.length;t<s;t++){let c=this.curves[t];e.curves.push(c.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,s=e.curves.length;t<s;t++){let c=e.curves[t];this.curves.push(new D3[c.type]().fromJSON(c))}return this}},Og=class extends Nw{constructor(e){super();this.type="Path",this.currentPoint=new Wt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,s=e.length;t<s;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let s=new Yf(this.currentPoint.clone(),new Wt(e,t));return this.curves.push(s),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,s,c){let h=new kg(this.currentPoint.clone(),new Wt(e,t),new Wt(s,c));return this.curves.push(h),this.currentPoint.set(s,c),this}bezierCurveTo(e,t,s,c,h,p){let r=new Pg(this.currentPoint.clone(),new Wt(e,t),new Wt(s,c),new Wt(h,p));return this.curves.push(r),this.currentPoint.set(h,p),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),s=new zg(t);return this.curves.push(s),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,s,c,h,p){let r=this.currentPoint.x,x=this.currentPoint.y;return this.absarc(e+r,t+x,s,c,h,p),this}absarc(e,t,s,c,h,p){return this.absellipse(e,t,s,s,c,h,p),this}ellipse(e,t,s,c,h,p,r,x){let v=this.currentPoint.x,w=this.currentPoint.y;return this.absellipse(e+v,t+w,s,c,h,p,r,x),this}absellipse(e,t,s,c,h,p,r,x){let v=new Kf(e,t,s,c,h,p,r,x);if(this.curves.length>0){let S=v.getPoint(0);S.equals(this.currentPoint)||this.lineTo(S.x,S.y)}this.curves.push(v);let w=v.getPoint(1);return this.currentPoint.copy(w),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}};var lW=new Be,cW=new Be,uW=new Be,hW=new Gr;var Gh=class extends Og{constructor(e){super(e);this.uuid=Ko(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let s=0,c=this.holes.length;s<c;s++)t[s]=this.holes[s].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,s=e.holes.length;t<s;t++){let c=e.holes[t];this.holes.push(c.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,s=this.holes.length;t<s;t++){let c=this.holes[t];e.holes.push(c.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,s=e.holes.length;t<s;t++){let c=e.holes[t];this.holes.push(new Og().fromJSON(c))}return this}},wU={triangulate:function(i,e,t=2){let s=e&&e.length,c=s?e[0]*t:i.length,h=R3(i,0,c,t,!0),p=[];if(!h||h.next===h.prev)return p;let r,x,v,w,S,A,I;if(s&&(h=bU(i,e,h,t)),i.length>80*t){r=v=i[0],x=w=i[1];for(let R=t;R<c;R+=t)S=i[R],A=i[R+1],S<r&&(r=S),A<x&&(x=A),S>v&&(v=S),A>w&&(w=A);I=Math.max(v-r,w-x),I=I!==0?1/I:0}return Ng(h,p,t,r,x,I),p}};function R3(i,e,t,s,c){let h,p;if(c===TU(i,e,t,s)>0)for(h=e;h<t;h+=s)p=P3(h,i[h],i[h+1],p);else for(h=t-s;h>=e;h-=s)p=P3(h,i[h],i[h+1],p);return p&&sv(p,p.next)&&(Fg(p),p=p.next),p}function su(i,e){if(!i)return i;e||(e=i);let t=i,s;do if(s=!1,!t.steiner&&(sv(t,t.next)||Nr(t.prev,t,t.next)===0)){if(Fg(t),t=e=t.prev,t===t.next)break;s=!0}else t=t.next;while(s||t!==e);return e}function Ng(i,e,t,s,c,h,p){if(!i)return;!p&&h&&IU(i,s,c,h);let r=i,x,v;for(;i.prev!==i.next;){if(x=i.prev,v=i.next,h?SU(i,s,c,h):EU(i)){e.push(x.i/t),e.push(i.i/t),e.push(v.i/t),Fg(i),i=v.next,r=v.next;continue}if(i=v,i===r){p?p===1?(i=AU(su(i),e,t),Ng(i,e,t,s,c,h,2)):p===2&&MU(i,e,t,s,c,h):Ng(su(i),e,t,s,c,h,1);break}}}function EU(i){let e=i.prev,t=i,s=i.next;if(Nr(e,t,s)>=0)return!1;let c=i.next.next;for(;c!==i.prev;){if(Jf(e.x,e.y,t.x,t.y,s.x,s.y,c.x,c.y)&&Nr(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function SU(i,e,t,s){let c=i.prev,h=i,p=i.next;if(Nr(c,h,p)>=0)return!1;let r=c.x<h.x?c.x<p.x?c.x:p.x:h.x<p.x?h.x:p.x,x=c.y<h.y?c.y<p.y?c.y:p.y:h.y<p.y?h.y:p.y,v=c.x>h.x?c.x>p.x?c.x:p.x:h.x>p.x?h.x:p.x,w=c.y>h.y?c.y>p.y?c.y:p.y:h.y>p.y?h.y:p.y,S=Fw(r,x,e,t,s),A=Fw(v,w,e,t,s),I=i.prevZ,R=i.nextZ;for(;I&&I.z>=S&&R&&R.z<=A;){if(I!==i.prev&&I!==i.next&&Jf(c.x,c.y,h.x,h.y,p.x,p.y,I.x,I.y)&&Nr(I.prev,I,I.next)>=0||(I=I.prevZ,R!==i.prev&&R!==i.next&&Jf(c.x,c.y,h.x,h.y,p.x,p.y,R.x,R.y)&&Nr(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;I&&I.z>=S;){if(I!==i.prev&&I!==i.next&&Jf(c.x,c.y,h.x,h.y,p.x,p.y,I.x,I.y)&&Nr(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;R&&R.z<=A;){if(R!==i.prev&&R!==i.next&&Jf(c.x,c.y,h.x,h.y,p.x,p.y,R.x,R.y)&&Nr(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function AU(i,e,t){let s=i;do{let c=s.prev,h=s.next.next;!sv(c,h)&&k3(c,s,s.next,h)&&Bg(c,h)&&Bg(h,c)&&(e.push(c.i/t),e.push(s.i/t),e.push(h.i/t),Fg(s),Fg(s.next),s=i=h),s=s.next}while(s!==i);return su(s)}function MU(i,e,t,s,c,h){let p=i;do{let r=p.next.next;for(;r!==p.prev;){if(p.i!==r.i&&CU(p,r)){let x=z3(p,r);p=su(p,p.next),x=su(x,x.next),Ng(p,e,t,s,c,h),Ng(x,e,t,s,c,h);return}r=r.next}p=p.next}while(p!==i)}function bU(i,e,t,s){let c=[],h,p,r,x,v;for(h=0,p=e.length;h<p;h++)r=e[h]*s,x=h<p-1?e[h+1]*s:i.length,v=R3(i,r,x,s,!1),v===v.next&&(v.steiner=!0),c.push(RU(v));for(c.sort(LU),h=0;h<c.length;h++)DU(c[h],t),t=su(t,t.next);return t}function LU(i,e){return i.x-e.x}function DU(i,e){if(e=PU(i,e),e){let t=z3(e,i);su(e,e.next),su(t,t.next)}}function PU(i,e){let t=e,s=i.x,c=i.y,h=-Infinity,p;do{if(c<=t.y&&c>=t.next.y&&t.next.y!==t.y){let A=t.x+(c-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(A<=s&&A>h){if(h=A,A===s){if(c===t.y)return t;if(c===t.next.y)return t.next}p=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!p)return null;if(s===h)return p;let r=p,x=p.x,v=p.y,w=Infinity,S;t=p;do s>=t.x&&t.x>=x&&s!==t.x&&Jf(c<v?s:h,c,x,v,c<v?h:s,c,t.x,t.y)&&(S=Math.abs(c-t.y)/(s-t.x),Bg(t,i)&&(S<w||S===w&&(t.x>p.x||t.x===p.x&&kU(p,t)))&&(p=t,w=S)),t=t.next;while(t!==r);return p}function kU(i,e){return Nr(i.prev,i,e.prev)<0&&Nr(e.next,i,i.next)<0}function IU(i,e,t,s){let c=i;do c.z===null&&(c.z=Fw(c.x,c.y,e,t,s)),c.prevZ=c.prev,c.nextZ=c.next,c=c.next;while(c!==i);c.prevZ.nextZ=null,c.prevZ=null,zU(c)}function zU(i){let e,t,s,c,h,p,r,x,v=1;do{for(t=i,i=null,h=null,p=0;t;){for(p++,s=t,r=0,e=0;e<v&&(r++,s=s.nextZ,!!s);e++);for(x=v;r>0||x>0&&s;)r!==0&&(x===0||!s||t.z<=s.z)?(c=t,t=t.nextZ,r--):(c=s,s=s.nextZ,x--),h?h.nextZ=c:i=c,c.prevZ=h,h=c;t=s}h.nextZ=null,v*=2}while(p>1);return i}function Fw(i,e,t,s,c){return i=32767*(i-t)*c,e=32767*(e-s)*c,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function RU(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function Jf(i,e,t,s,c,h,p,r){return(c-p)*(e-r)-(i-p)*(h-r)>=0&&(i-p)*(s-r)-(t-p)*(e-r)>=0&&(t-p)*(h-r)-(c-p)*(s-r)>=0}function CU(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!OU(i,e)&&(Bg(i,e)&&Bg(e,i)&&NU(i,e)&&(Nr(i.prev,i,e.prev)||Nr(i,e.prev,e))||sv(i,e)&&Nr(i.prev,i,i.next)>0&&Nr(e.prev,e,e.next)>0)}function Nr(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function sv(i,e){return i.x===e.x&&i.y===e.y}function k3(i,e,t,s){let c=av(Nr(i,e,t)),h=av(Nr(i,e,s)),p=av(Nr(t,s,i)),r=av(Nr(t,s,e));return!!(c!==h&&p!==r||c===0&&ov(i,t,e)||h===0&&ov(i,s,e)||p===0&&ov(t,i,s)||r===0&&ov(t,e,s))}function ov(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function av(i){return i>0?1:i<0?-1:0}function OU(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&k3(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function Bg(i,e){return Nr(i.prev,i,i.next)<0?Nr(i,e,i.next)>=0&&Nr(i,i.prev,e)>=0:Nr(i,e,i.prev)<0||Nr(i,i.next,e)<0}function NU(i,e){let t=i,s=!1,c=(i.x+e.x)/2,h=(i.y+e.y)/2;do t.y>h!=t.next.y>h&&t.next.y!==t.y&&c<(t.next.x-t.x)*(h-t.y)/(t.next.y-t.y)+t.x&&(s=!s),t=t.next;while(t!==i);return s}function z3(i,e){let t=new Bw(i.i,i.x,i.y),s=new Bw(e.i,e.x,e.y),c=i.next,h=e.prev;return i.next=e,e.prev=i,t.next=c,c.prev=t,s.next=t,t.prev=s,h.next=s,s.prev=h,s}function P3(i,e,t,s){let c=new Bw(i,e,t);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function Fg(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Bw(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function TU(i,e,t,s){let c=0;for(let h=e,p=t-s;h<t;h+=s)c+=(i[p]-i[h])*(i[h+1]+i[p+1]),p=h;return c}var sl=class{static area(e){let t=e.length,s=0;for(let c=t-1,h=0;h<t;c=h++)s+=e[c].x*e[h].y-e[h].x*e[c].y;return s*.5}static isClockWise(e){return sl.area(e)<0}static triangulateShape(e,t){let s=[],c=[],h=[];O3(e),N3(s,e);let p=e.length;t.forEach(O3);for(let x=0;x<t.length;x++)c.push(p),p+=t[x].length,N3(s,t[x]);let r=wU.triangulate(s,c);for(let x=0;x<r.length;x+=3)h.push(r.slice(x,x+3));return h}};function O3(i){let e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function N3(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}var Jl=class extends er{constructor(e=new Gh([new Wt(.5,.5),new Wt(-.5,.5),new Wt(-.5,-.5),new Wt(.5,-.5)]),t={}){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let s=this,c=[],h=[];for(let r=0,x=e.length;r<x;r++){let v=e[r];p(v)}this.setAttribute("position",new br(c,3)),this.setAttribute("uv",new br(h,2)),this.computeVertexNormals();function p(r){let x=[],v=t.curveSegments!==void 0?t.curveSegments:12,w=t.steps!==void 0?t.steps:1,S=t.depth!==void 0?t.depth:1,A=t.bevelEnabled!==void 0?t.bevelEnabled:!0,I=t.bevelThickness!==void 0?t.bevelThickness:.2,R=t.bevelSize!==void 0?t.bevelSize:I-.1,k=t.bevelOffset!==void 0?t.bevelOffset:0,L=t.bevelSegments!==void 0?t.bevelSegments:3,z=t.extrudePath,B=t.UVGenerator!==void 0?t.UVGenerator:FU;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),S=t.amount);let $,H=!1,G,le,te,ue;z&&($=z.getSpacedPoints(w),H=!0,A=!1,G=z.computeFrenetFrames(w,!1),le=new Be,te=new Be,ue=new Be),A||(L=0,I=0,R=0,k=0);let me=r.extractPoints(v),se=me.shape,Y=me.holes;if(!sl.isClockWise(se)){se=se.reverse();for(let nt=0,at=Y.length;nt<at;nt++){let St=Y[nt];sl.isClockWise(St)&&(Y[nt]=St.reverse())}}let Xe=sl.triangulateShape(se,Y),ge=se;for(let nt=0,at=Y.length;nt<at;nt++){let St=Y[nt];se=se.concat(St)}function re(nt,at,St){return at||console.error("THREE.ExtrudeGeometry: vec does not exist"),at.clone().multiplyScalar(St).add(nt)}let ve=se.length,ae=Xe.length;function de(nt,at,St){let ut,Ot,Pn,bn=nt.x-at.x,wn=nt.y-at.y,xn=St.x-nt.x,ei=St.y-nt.y,ze=bn*bn+wn*wn,Ae=bn*ei-wn*xn;if(Math.abs(Ae)>Number.EPSILON){let gt=Math.sqrt(ze),Rt=Math.sqrt(xn*xn+ei*ei),Xt=at.x-wn/gt,gn=at.y+bn/gt,Tn=St.x-ei/Rt,Ee=St.y+xn/Rt,et=((Tn-Xt)*ei-(Ee-gn)*xn)/(bn*ei-wn*xn);ut=Xt+bn*et-nt.x,Ot=gn+wn*et-nt.y;let rn=ut*ut+Ot*Ot;if(rn<=2)return new Wt(ut,Ot);Pn=Math.sqrt(rn/2)}else{let gt=!1;bn>Number.EPSILON?xn>Number.EPSILON&&(gt=!0):bn<-Number.EPSILON?xn<-Number.EPSILON&&(gt=!0):Math.sign(wn)===Math.sign(ei)&&(gt=!0),gt?(ut=-wn,Ot=bn,Pn=Math.sqrt(ze)):(ut=bn,Ot=wn,Pn=Math.sqrt(ze/2))}return new Wt(ut/Pn,Ot/Pn)}let xe=[];for(let nt=0,at=ge.length,St=at-1,ut=nt+1;nt<at;nt++,St++,ut++)St===at&&(St=0),ut===at&&(ut=0),xe[nt]=de(ge[nt],ge[St],ge[ut]);let De=[],Ce,pe=xe.concat();for(let nt=0,at=Y.length;nt<at;nt++){let St=Y[nt];Ce=[];for(let ut=0,Ot=St.length,Pn=Ot-1,bn=ut+1;ut<Ot;ut++,Pn++,bn++)Pn===Ot&&(Pn=0),bn===Ot&&(bn=0),Ce[ut]=de(St[ut],St[Pn],St[bn]);De.push(Ce),pe=pe.concat(Ce)}for(let nt=0;nt<L;nt++){let at=nt/L,St=I*Math.cos(at*Math.PI/2),ut=R*Math.sin(at*Math.PI/2)+k;for(let Ot=0,Pn=ge.length;Ot<Pn;Ot++){let bn=re(ge[Ot],xe[Ot],ut);zt(bn.x,bn.y,-St)}for(let Ot=0,Pn=Y.length;Ot<Pn;Ot++){let bn=Y[Ot];Ce=De[Ot];for(let wn=0,xn=bn.length;wn<xn;wn++){let ei=re(bn[wn],Ce[wn],ut);zt(ei.x,ei.y,-St)}}}let xt=R+k;for(let nt=0;nt<ve;nt++){let at=A?re(se[nt],pe[nt],xt):se[nt];H?(te.copy(G.normals[0]).multiplyScalar(at.x),le.copy(G.binormals[0]).multiplyScalar(at.y),ue.copy($[0]).add(te).add(le),zt(ue.x,ue.y,ue.z)):zt(at.x,at.y,0)}for(let nt=1;nt<=w;nt++)for(let at=0;at<ve;at++){let St=A?re(se[at],pe[at],xt):se[at];H?(te.copy(G.normals[nt]).multiplyScalar(St.x),le.copy(G.binormals[nt]).multiplyScalar(St.y),ue.copy($[nt]).add(te).add(le),zt(ue.x,ue.y,ue.z)):zt(St.x,St.y,S/w*nt)}for(let nt=L-1;nt>=0;nt--){let at=nt/L,St=I*Math.cos(at*Math.PI/2),ut=R*Math.sin(at*Math.PI/2)+k;for(let Ot=0,Pn=ge.length;Ot<Pn;Ot++){let bn=re(ge[Ot],xe[Ot],ut);zt(bn.x,bn.y,S+St)}for(let Ot=0,Pn=Y.length;Ot<Pn;Ot++){let bn=Y[Ot];Ce=De[Ot];for(let wn=0,xn=bn.length;wn<xn;wn++){let ei=re(bn[wn],Ce[wn],ut);H?zt(ei.x,ei.y+$[w-1].y,$[w-1].x+St):zt(ei.x,ei.y,S+St)}}}Ct(),ct();function Ct(){let nt=c.length/3;if(A){let at=0,St=ve*at;for(let ut=0;ut<ae;ut++){let Ot=Xe[ut];Zt(Ot[2]+St,Ot[1]+St,Ot[0]+St)}at=w+L*2,St=ve*at;for(let ut=0;ut<ae;ut++){let Ot=Xe[ut];Zt(Ot[0]+St,Ot[1]+St,Ot[2]+St)}}else{for(let at=0;at<ae;at++){let St=Xe[at];Zt(St[2],St[1],St[0])}for(let at=0;at<ae;at++){let St=Xe[at];Zt(St[0]+ve*w,St[1]+ve*w,St[2]+ve*w)}}s.addGroup(nt,c.length/3-nt,0)}function ct(){let nt=c.length/3,at=0;Qe(ge,at),at+=ge.length;for(let St=0,ut=Y.length;St<ut;St++){let Ot=Y[St];Qe(Ot,at),at+=Ot.length}s.addGroup(nt,c.length/3-nt,1)}function Qe(nt,at){let St=nt.length;for(;--St>=0;){let ut=St,Ot=St-1;Ot<0&&(Ot=nt.length-1);for(let Pn=0,bn=w+L*2;Pn<bn;Pn++){let wn=ve*Pn,xn=ve*(Pn+1),ei=at+ut+wn,ze=at+Ot+wn,Ae=at+Ot+xn,gt=at+ut+xn;Lt(ei,ze,Ae,gt)}}}function zt(nt,at,St){x.push(nt),x.push(at),x.push(St)}function Zt(nt,at,St){Re(nt),Re(at),Re(St);let ut=c.length/3,Ot=B.generateTopUV(s,c,ut-3,ut-2,ut-1);qt(Ot[0]),qt(Ot[1]),qt(Ot[2])}function Lt(nt,at,St,ut){Re(nt),Re(at),Re(ut),Re(at),Re(St),Re(ut);let Ot=c.length/3,Pn=B.generateSideWallUV(s,c,Ot-6,Ot-3,Ot-2,Ot-1);qt(Pn[0]),qt(Pn[1]),qt(Pn[3]),qt(Pn[1]),qt(Pn[2]),qt(Pn[3])}function Re(nt){c.push(x[nt*3+0]),c.push(x[nt*3+1]),c.push(x[nt*3+2])}function qt(nt){h.push(nt.x),h.push(nt.y)}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes,s=this.parameters.options;return BU(t,s,e)}static fromJSON(e,t){let s=[];for(let h=0,p=e.shapes.length;h<p;h++){let r=t[e.shapes[h]];s.push(r)}let c=e.options.extrudePath;return c!==void 0&&(e.options.extrudePath=new D3[c.type]().fromJSON(c)),new Jl(s,e.options)}},FU={generateTopUV:function(i,e,t,s,c){let h=e[t*3],p=e[t*3+1],r=e[s*3],x=e[s*3+1],v=e[c*3],w=e[c*3+1];return[new Wt(h,p),new Wt(r,x),new Wt(v,w)]},generateSideWallUV:function(i,e,t,s,c,h){let p=e[t*3],r=e[t*3+1],x=e[t*3+2],v=e[s*3],w=e[s*3+1],S=e[s*3+2],A=e[c*3],I=e[c*3+1],R=e[c*3+2],k=e[h*3],L=e[h*3+1],z=e[h*3+2];return Math.abs(r-w)<Math.abs(p-v)?[new Wt(p,1-x),new Wt(v,1-S),new Wt(A,1-R),new Wt(k,1-z)]:[new Wt(r,1-x),new Wt(w,1-S),new Wt(I,1-R),new Wt(L,1-z)]}};function BU(i,e,t){if(t.shapes=[],Array.isArray(i))for(let s=0,c=i.length;s<c;s++){let h=i[s];t.shapes.push(h.uuid)}else t.shapes.push(i.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}var $f=class extends er{constructor(e=new Gh([new Wt(0,.5),new Wt(-.5,-.5),new Wt(.5,-.5)]),t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let s=[],c=[],h=[],p=[],r=0,x=0;if(Array.isArray(e)===!1)v(e);else for(let w=0;w<e.length;w++)v(e[w]),this.addGroup(r,x,w),r+=x,x=0;this.setIndex(s),this.setAttribute("position",new br(c,3)),this.setAttribute("normal",new br(h,3)),this.setAttribute("uv",new br(p,2));function v(w){let S=c.length/3,A=w.extractPoints(t),I=A.shape,R=A.holes;sl.isClockWise(I)===!1&&(I=I.reverse());for(let L=0,z=R.length;L<z;L++){let B=R[L];sl.isClockWise(B)===!0&&(R[L]=B.reverse())}let k=sl.triangulateShape(I,R);for(let L=0,z=R.length;L<z;L++){let B=R[L];I=I.concat(B)}for(let L=0,z=I.length;L<z;L++){let B=I[L];c.push(B.x,B.y,0),h.push(0,0,1),p.push(B.x,B.y)}for(let L=0,z=k.length;L<z;L++){let B=k[L],$=B[0]+S,H=B[1]+S,G=B[2]+S;s.push($,H,G),x+=3}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes;return UU(t,e)}static fromJSON(e,t){let s=[];for(let c=0,h=e.shapes.length;c<h;c++){let p=t[e.shapes[c]];s.push(p)}return new $f(s,e.curveSegments)}};function UU(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,s=i.length;t<s;t++){let c=i[t];e.shapes.push(c.uuid)}else e.shapes.push(i.uuid);return e}var lv=class extends er{constructor(e=null){super();if(this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){let t=[],s=new Set,c=new Be,h=new Be;if(e.index!==null){let p=e.attributes.position,r=e.index,x=e.groups;x.length===0&&(x=[{start:0,count:r.count,materialIndex:0}]);for(let v=0,w=x.length;v<w;++v){let S=x[v],A=S.start,I=S.count;for(let R=A,k=A+I;R<k;R+=3)for(let L=0;L<3;L++){let z=r.getX(R+L),B=r.getX(R+(L+1)%3);c.fromBufferAttribute(p,z),h.fromBufferAttribute(p,B),F3(c,h,s)===!0&&(t.push(c.x,c.y,c.z),t.push(h.x,h.y,h.z))}}}else{let p=e.attributes.position;for(let r=0,x=p.count/3;r<x;r++)for(let v=0;v<3;v++){let w=3*r+v,S=3*r+(v+1)%3;c.fromBufferAttribute(p,w),h.fromBufferAttribute(p,S),F3(c,h,s)===!0&&(t.push(c.x,c.y,c.z),t.push(h.x,h.y,h.z))}}this.setAttribute("position",new br(t,3))}}};function F3(i,e,t){let s=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,c=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(s)===!0||t.has(c)===!0?!1:(t.add(s),t.add(c),!0)}var cv=class extends Zr{constructor(e){super();this.type="ShadowMaterial",this.color=new jn(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}};cv.prototype.isShadowMaterial=!0;var Hh=class extends eo{constructor(e){super(e);this.type="RawShaderMaterial"}};Hh.prototype.isRawShaderMaterial=!0;var Ug=class extends Zr{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new jn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}};Ug.prototype.isMeshStandardMaterial=!0;var uv=class extends Ug{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Wt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return as(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new jn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new jn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new jn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}};uv.prototype.isMeshPhysicalMaterial=!0;var hv=class extends Zr{constructor(e){super();this.type="MeshPhongMaterial",this.color=new jn(16777215),this.specular=new jn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$m,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}};hv.prototype.isMeshPhongMaterial=!0;var dv=class extends Zr{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new jn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};dv.prototype.isMeshToonMaterial=!0;var fv=class extends Zr{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}};fv.prototype.isMeshNormalMaterial=!0;var pv=class extends Zr{constructor(e){super();this.type="MeshLambertMaterial",this.color=new jn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$m,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};pv.prototype.isMeshLambertMaterial=!0;var mv=class extends Zr{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new jn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}};mv.prototype.isMeshMatcapMaterial=!0;var gv=class extends Yl{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}};gv.prototype.isLineDashedMaterial=!0;var VU={ShadowMaterial:cv,SpriteMaterial:Tg,RawShaderMaterial:Hh,ShaderMaterial:eo,PointsMaterial:Lg,MeshPhysicalMaterial:uv,MeshStandardMaterial:Ug,MeshPhongMaterial:hv,MeshToonMaterial:dv,MeshNormalMaterial:fv,MeshLambertMaterial:pv,MeshDepthMaterial:vg,MeshDistanceMaterial:xg,MeshBasicMaterial:Xl,MeshMatcapMaterial:mv,LineDashedMaterial:gv,LineBasicMaterial:Yl,Material:Zr};Zr.fromType=function(i){return new VU[i]};var Mr={arraySlice:function(i,e,t){return Mr.isTypedArray(i)?new i.constructor(i.subarray(e,t!==void 0?t:i.length)):i.slice(e,t)},convertArray:function(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){function e(c,h){return i[c]-i[h]}let t=i.length,s=new Array(t);for(let c=0;c!==t;++c)s[c]=c;return s.sort(e),s},sortedArray:function(i,e,t){let s=i.length,c=new i.constructor(s);for(let h=0,p=0;p!==s;++h){let r=t[h]*e;for(let x=0;x!==e;++x)c[p++]=i[r+x]}return c},flattenJSON:function(i,e,t,s){let c=1,h=i[0];for(;h!==void 0&&h[s]===void 0;)h=i[c++];if(h===void 0)return;let p=h[s];if(p!==void 0)if(Array.isArray(p))do p=h[s],p!==void 0&&(e.push(h.time),t.push.apply(t,p)),h=i[c++];while(h!==void 0);else if(p.toArray!==void 0)do p=h[s],p!==void 0&&(e.push(h.time),p.toArray(t,t.length)),h=i[c++];while(h!==void 0);else do p=h[s],p!==void 0&&(e.push(h.time),t.push(p)),h=i[c++];while(h!==void 0)},subclip:function(i,e,t,s,c=30){let h=i.clone();h.name=e;let p=[];for(let x=0;x<h.tracks.length;++x){let v=h.tracks[x],w=v.getValueSize(),S=[],A=[];for(let I=0;I<v.times.length;++I){let R=v.times[I]*c;if(!(R<t||R>=s)){S.push(v.times[I]);for(let k=0;k<w;++k)A.push(v.values[I*w+k])}}S.length!==0&&(v.times=Mr.convertArray(S,v.times.constructor),v.values=Mr.convertArray(A,v.values.constructor),p.push(v))}h.tracks=p;let r=Infinity;for(let x=0;x<h.tracks.length;++x)r>h.tracks[x].times[0]&&(r=h.tracks[x].times[0]);for(let x=0;x<h.tracks.length;++x)h.tracks[x].shift(-1*r);return h.resetDuration(),h},makeClipAdditive:function(i,e=0,t=i,s=30){s<=0&&(s=30);let c=t.tracks.length,h=e/s;for(let p=0;p<c;++p){let r=t.tracks[p],x=r.ValueTypeName;if(x==="bool"||x==="string")continue;let v=i.tracks.find(function(z){return z.name===r.name&&z.ValueTypeName===x});if(v===void 0)continue;let w=0,S=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(w=S/3);let A=0,I=v.getValueSize();v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(A=I/3);let R=r.times.length-1,k;if(h<=r.times[0]){let z=w,B=S-w;k=Mr.arraySlice(r.values,z,B)}else if(h>=r.times[R]){let z=R*S+w,B=z+S-w;k=Mr.arraySlice(r.values,z,B)}else{let z=r.createInterpolant(),B=w,$=S-w;z.evaluate(h),k=Mr.arraySlice(z.resultBuffer,B,$)}x==="quaternion"&&new us().fromArray(k).normalize().conjugate().toArray(k);let L=v.times.length;for(let z=0;z<L;++z){let B=z*I+A;if(x==="quaternion")us.multiplyQuaternionsFlat(v.values,B,k,0,v.values,B);else{let $=I-A*2;for(let H=0;H<$;++H)v.values[B+H]-=k[H]}}}return i.blendMode=Bb,i}},ol=class{constructor(e,t,s,c){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=c!==void 0?c:new t.constructor(s),this.sampleValues=t,this.valueSize=s,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,s=this._cachedIndex,c=t[s],h=t[s-1];e:{t:{let p;n:{i:if(!(e<c)){for(let r=s+2;;){if(c===void 0){if(e<h)break i;return s=t.length,this._cachedIndex=s,this.afterEnd_(s-1,e,h)}if(s===r)break;if(h=c,c=t[++s],e<c)break t}p=t.length;break n}if(!(e>=h)){let r=t[1];e<r&&(s=2,h=r);for(let x=s-2;;){if(h===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,c);if(s===x)break;if(c=h,h=t[--s-1],e>=h)break t}p=s,s=0;break n}break e}for(;s<p;){let r=s+p>>>1;e<t[r]?p=r:s=r+1}if(c=t[s],h=t[s-1],h===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,c);if(c===void 0)return s=t.length,this._cachedIndex=s,this.afterEnd_(s-1,h,e)}this._cachedIndex=s,this.intervalChanged_(s,h,c)}return this.interpolate_(s,h,e,c)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,s=this.sampleValues,c=this.valueSize,h=e*c;for(let p=0;p!==c;++p)t[p]=s[h+p];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}};ol.prototype.beforeStart_=ol.prototype.copySampleValue_;ol.prototype.afterEnd_=ol.prototype.copySampleValue_;var Uw=class extends ol{constructor(e,t,s,c){super(e,t,s,c);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Rh,endingEnd:Rh}}intervalChanged_(e,t,s){let c=this.parameterPositions,h=e-2,p=e+1,r=c[h],x=c[p];if(r===void 0)switch(this.getSettings_().endingStart){case Ph:h=e,r=2*t-s;break;case sg:h=c.length-2,r=t+c[h]-c[h+1];break;default:h=e,r=s}if(x===void 0)switch(this.getSettings_().endingEnd){case Ph:p=e,x=2*s-t;break;case sg:p=1,x=s+c[1]-c[0];break;default:p=e-1,x=t}let v=(s-t)*.5,w=this.valueSize;this._weightPrev=v/(t-r),this._weightNext=v/(x-s),this._offsetPrev=h*w,this._offsetNext=p*w}interpolate_(e,t,s,c){let h=this.resultBuffer,p=this.sampleValues,r=this.valueSize,x=e*r,v=x-r,w=this._offsetPrev,S=this._offsetNext,A=this._weightPrev,I=this._weightNext,R=(s-t)/(c-t),k=R*R,L=k*R,z=-A*L+2*A*k-A*R,B=(1+A)*L+(-1.5-2*A)*k+(-.5+A)*R+1,$=(-1-I)*L+(1.5+I)*k+.5*R,H=I*L-I*k;for(let G=0;G!==r;++G)h[G]=z*p[w+G]+B*p[v+G]+$*p[x+G]+H*p[S+G];return h}},_v=class extends ol{constructor(e,t,s,c){super(e,t,s,c)}interpolate_(e,t,s,c){let h=this.resultBuffer,p=this.sampleValues,r=this.valueSize,x=e*r,v=x-r,w=(s-t)/(c-t),S=1-w;for(let A=0;A!==r;++A)h[A]=p[v+A]*S+p[x+A]*w;return h}},Vw=class extends ol{constructor(e,t,s,c){super(e,t,s,c)}interpolate_(e){return this.copySampleValue_(e-1)}},Qo=class{constructor(e,t,s,c){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Mr.convertArray(t,this.TimeBufferType),this.values=Mr.convertArray(s,this.ValueBufferType),this.setInterpolation(c||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,s;if(t.toJSON!==this.toJSON)s=t.toJSON(e);else{s={name:e.name,times:Mr.convertArray(e.times,Array),values:Mr.convertArray(e.values,Array)};let c=e.getInterpolation();c!==e.DefaultInterpolation&&(s.interpolation=c)}return s.type=e.ValueTypeName,s}InterpolantFactoryMethodDiscrete(e){return new Vw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new _v(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Uw(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case ig:t=this.InterpolantFactoryMethodDiscrete;break;case rg:t=this.InterpolantFactoryMethodLinear;break;case c0:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let s="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(s);return console.warn("THREE.KeyframeTrack:",s),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ig;case this.InterpolantFactoryMethodLinear:return rg;case this.InterpolantFactoryMethodSmooth:return c0}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let s=0,c=t.length;s!==c;++s)t[s]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let s=0,c=t.length;s!==c;++s)t[s]*=e}return this}trim(e,t){let s=this.times,c=s.length,h=0,p=c-1;for(;h!==c&&s[h]<e;)++h;for(;p!==-1&&s[p]>t;)--p;if(++p,h!==0||p!==c){h>=p&&(p=Math.max(p,1),h=p-1);let r=this.getValueSize();this.times=Mr.arraySlice(s,h,p),this.values=Mr.arraySlice(this.values,h*r,p*r)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let s=this.times,c=this.values,h=s.length;h===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let p=null;for(let r=0;r!==h;r++){let x=s[r];if(typeof x=="number"&&isNaN(x)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,r,x),e=!1;break}if(p!==null&&p>x){console.error("THREE.KeyframeTrack: Out of order keys.",this,r,x,p),e=!1;break}p=x}if(c!==void 0&&Mr.isTypedArray(c))for(let r=0,x=c.length;r!==x;++r){let v=c[r];if(isNaN(v)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,r,v),e=!1;break}}return e}optimize(){let e=Mr.arraySlice(this.times),t=Mr.arraySlice(this.values),s=this.getValueSize(),c=this.getInterpolation()===c0,h=e.length-1,p=1;for(let r=1;r<h;++r){let x=!1,v=e[r],w=e[r+1];if(v!==w&&(r!==1||v!==e[0]))if(c)x=!0;else{let S=r*s,A=S-s,I=S+s;for(let R=0;R!==s;++R){let k=t[S+R];if(k!==t[A+R]||k!==t[I+R]){x=!0;break}}}if(x){if(r!==p){e[p]=e[r];let S=r*s,A=p*s;for(let I=0;I!==s;++I)t[A+I]=t[S+I]}++p}}if(h>0){e[p]=e[h];for(let r=h*s,x=p*s,v=0;v!==s;++v)t[x+v]=t[r+v];++p}return p!==e.length?(this.times=Mr.arraySlice(e,0,p),this.values=Mr.arraySlice(t,0,p*s)):(this.times=e,this.values=t),this}clone(){let e=Mr.arraySlice(this.times,0),t=Mr.arraySlice(this.values,0),s=this.constructor,c=new s(this.name,e,t);return c.createInterpolant=this.createInterpolant,c}};Qo.prototype.TimeBufferType=Float32Array;Qo.prototype.ValueBufferType=Float32Array;Qo.prototype.DefaultInterpolation=rg;var ou=class extends Qo{};ou.prototype.ValueTypeName="bool";ou.prototype.ValueBufferType=Array;ou.prototype.DefaultInterpolation=ig;ou.prototype.InterpolantFactoryMethodLinear=void 0;ou.prototype.InterpolantFactoryMethodSmooth=void 0;var yv=class extends Qo{};yv.prototype.ValueTypeName="color";var Qf=class extends Qo{};Qf.prototype.ValueTypeName="number";var Gw=class extends ol{constructor(e,t,s,c){super(e,t,s,c)}interpolate_(e,t,s,c){let h=this.resultBuffer,p=this.sampleValues,r=this.valueSize,x=(s-t)/(c-t),v=e*r;for(let w=v+r;v!==w;v+=4)us.slerpFlat(h,0,p,v-r,p,v,x);return h}},jh=class extends Qo{InterpolantFactoryMethodLinear(e){return new Gw(this.times,this.values,this.getValueSize(),e)}};jh.prototype.ValueTypeName="quaternion";jh.prototype.DefaultInterpolation=rg;jh.prototype.InterpolantFactoryMethodSmooth=void 0;var au=class extends Qo{};au.prototype.ValueTypeName="string";au.prototype.ValueBufferType=Array;au.prototype.DefaultInterpolation=ig;au.prototype.InterpolantFactoryMethodLinear=void 0;au.prototype.InterpolantFactoryMethodSmooth=void 0;var ep=class extends Qo{};ep.prototype.ValueTypeName="vector";var vv=class{constructor(e,t=-1,s,c=u0){this.name=e,this.tracks=s,this.duration=t,this.blendMode=c,this.uuid=Ko(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],s=e.tracks,c=1/(e.fps||1);for(let p=0,r=s.length;p!==r;++p)t.push(GU(s[p]).scale(c));let h=new this(e.name,e.duration,t,e.blendMode);return h.uuid=e.uuid,h}static toJSON(e){let t=[],s=e.tracks,c={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let h=0,p=s.length;h!==p;++h)t.push(Qo.toJSON(s[h]));return c}static CreateFromMorphTargetSequence(e,t,s,c){let h=t.length,p=[];for(let r=0;r<h;r++){let x=[],v=[];x.push((r+h-1)%h,r,(r+1)%h),v.push(0,1,0);let w=Mr.getKeyframeOrder(x);x=Mr.sortedArray(x,1,w),v=Mr.sortedArray(v,1,w),!c&&x[0]===0&&(x.push(h),v.push(v[0])),p.push(new Qf(".morphTargetInfluences["+t[r].name+"]",x,v).scale(1/s))}return new this(e,-1,p)}static findByName(e,t){let s=e;if(!Array.isArray(e)){let c=e;s=c.geometry&&c.geometry.animations||c.animations}for(let c=0;c<s.length;c++)if(s[c].name===t)return s[c];return null}static CreateClipsFromMorphTargetSequences(e,t,s){let c={},h=/^([\w-]*?)([\d]+)$/;for(let r=0,x=e.length;r<x;r++){let v=e[r],w=v.name.match(h);if(w&&w.length>1){let S=w[1],A=c[S];A||(c[S]=A=[]),A.push(v)}}let p=[];for(let r in c)p.push(this.CreateFromMorphTargetSequence(r,c[r],t,s));return p}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let s=function(S,A,I,R,k){if(I.length!==0){let L=[],z=[];Mr.flattenJSON(I,L,z,R),L.length!==0&&k.push(new S(A,L,z))}},c=[],h=e.name||"default",p=e.fps||30,r=e.blendMode,x=e.length||-1,v=e.hierarchy||[];for(let S=0;S<v.length;S++){let A=v[S].keys;if(!(!A||A.length===0))if(A[0].morphTargets){let I={},R;for(R=0;R<A.length;R++)if(A[R].morphTargets)for(let k=0;k<A[R].morphTargets.length;k++)I[A[R].morphTargets[k]]=-1;for(let k in I){let L=[],z=[];for(let B=0;B!==A[R].morphTargets.length;++B){let $=A[R];L.push($.time),z.push($.morphTarget===k?1:0)}c.push(new Qf(".morphTargetInfluence["+k+"]",L,z))}x=I.length*p}else{let I=".bones["+t[S].name+"]";s(ep,I+".position",A,"pos",c),s(jh,I+".quaternion",A,"rot",c),s(ep,I+".scale",A,"scl",c)}}return c.length===0?null:new this(h,x,c,r)}resetDuration(){let e=this.tracks,t=0;for(let s=0,c=e.length;s!==c;++s){let h=this.tracks[s];t=Math.max(t,h.times[h.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function HU(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Qf;case"vector":case"vector2":case"vector3":case"vector4":return ep;case"color":return yv;case"quaternion":return jh;case"bool":case"boolean":return ou;case"string":return au}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function GU(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=HU(i.type);if(i.times===void 0){let t=[],s=[];Mr.flattenJSON(i.keys,t,s,"value"),i.times=t,i.values=s}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}var Wh={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}},Hw=class{constructor(e,t,s){let c=this,h=!1,p=0,r=0,x,v=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=s,this.itemStart=function(w){r++,h===!1&&c.onStart!==void 0&&c.onStart(w,p,r),h=!0},this.itemEnd=function(w){p++,c.onProgress!==void 0&&c.onProgress(w,p,r),p===r&&(h=!1,c.onLoad!==void 0&&c.onLoad())},this.itemError=function(w){c.onError!==void 0&&c.onError(w)},this.resolveURL=function(w){return x?x(w):w},this.setURLModifier=function(w){return x=w,this},this.addHandler=function(w,S){return v.push(w,S),this},this.removeHandler=function(w){let S=v.indexOf(w);return S!==-1&&v.splice(S,2),this},this.getHandler=function(w){for(let S=0,A=v.length;S<A;S+=2){let I=v[S],R=v[S+1];if(I.global&&(I.lastIndex=0),I.test(w))return R}return null}}},B3=new Hw,al=class{constructor(e){this.manager=e!==void 0?e:B3,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let s=this;return new Promise(function(c,h){s.load(e,c,t,h)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},$l={},jw=class extends al{constructor(e){super(e)}load(e,t,s,c){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let h=Wh.get(e);if(h!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(h),this.manager.itemEnd(e)},0),h;if($l[e]!==void 0){$l[e].push({onLoad:t,onProgress:s,onError:c});return}$l[e]=[],$l[e].push({onLoad:t,onProgress:s,onError:c});let p=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),r=this.mimeType,x=this.responseType;fetch(p).then(v=>{if(v.status===200||v.status===0){if(v.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||v.body===void 0||v.body.getReader===void 0)return v;let w=$l[e],S=v.body.getReader(),A=v.headers.get("Content-Length"),I=A?parseInt(A):0,R=I!==0,k=0,L=new ReadableStream({start(z){B();function B(){S.read().then(({done:$,value:H})=>{if($)z.close();else{k+=H.byteLength;let G=new ProgressEvent("progress",{lengthComputable:R,loaded:k,total:I});for(let le=0,te=w.length;le<te;le++){let ue=w[le];ue.onProgress&&ue.onProgress(G)}z.enqueue(H),B()}})}}});return new Response(L)}else throw Error(`fetch for "${v.url}" responded with ${v.status}: ${v.statusText}`)}).then(v=>{switch(x){case"arraybuffer":return v.arrayBuffer();case"blob":return v.blob();case"document":return v.text().then(w=>new DOMParser().parseFromString(w,r));case"json":return v.json();default:if(r===void 0)return v.text();{let S=/charset="?([^;"\s]*)"?/i.exec(r),A=S&&S[1]?S[1].toLowerCase():void 0,I=new TextDecoder(A);return v.arrayBuffer().then(R=>I.decode(R))}}}).then(v=>{Wh.add(e,v);let w=$l[e];delete $l[e];for(let S=0,A=w.length;S<A;S++){let I=w[S];I.onLoad&&I.onLoad(v)}}).catch(v=>{let w=$l[e];if(w===void 0)throw this.manager.itemError(e),v;delete $l[e];for(let S=0,A=w.length;S<A;S++){let I=w[S];I.onError&&I.onError(v)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};var xv=class extends al{constructor(e){super(e)}load(e,t,s,c){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let h=this,p=Wh.get(e);if(p!==void 0)return h.manager.itemStart(e),setTimeout(function(){t&&t(p),h.manager.itemEnd(e)},0),p;let r=ug("img");function x(){w(),Wh.add(e,this),t&&t(this),h.manager.itemEnd(e)}function v(S){w(),c&&c(S),h.manager.itemError(e),h.manager.itemEnd(e)}function w(){r.removeEventListener("load",x,!1),r.removeEventListener("error",v,!1)}return r.addEventListener("load",x,!1),r.addEventListener("error",v,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(r.crossOrigin=this.crossOrigin),h.manager.itemStart(e),r.src=e,r}},Ww=class extends al{constructor(e){super(e)}load(e,t,s,c){let h=new Of,p=new xv(this.manager);p.setCrossOrigin(this.crossOrigin),p.setPath(this.path);let r=0;function x(v){p.load(e[v],function(w){h.images[v]=w,r++,r===6&&(h.needsUpdate=!0,t&&t(h))},void 0,c)}for(let v=0;v<e.length;++v)x(v);return h}};var qw=class extends al{constructor(e){super(e)}load(e,t,s,c){let h=new Qr,p=new xv(this.manager);return p.setCrossOrigin(this.crossOrigin),p.setPath(this.path),p.load(e,function(r){h.image=r,h.needsUpdate=!0,t!==void 0&&t(h)},s,c),h}},ea=class extends Ki{constructor(e,t=1){super();this.type="Light",this.color=new jn(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};ea.prototype.isLight=!0;var Xw=class extends ea{constructor(e,t,s){super(e,s);this.type="HemisphereLight",this.position.copy(Ki.DefaultUp),this.updateMatrix(),this.groundColor=new jn(t)}copy(e){return ea.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}};Xw.prototype.isHemisphereLight=!0;var U3=new Jn,V3=new Be,G3=new Be,bv=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Wt(512,512),this.map=null,this.mapPass=null,this.matrix=new Jn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ff,this._frameExtents=new Wt(1,1),this._viewportCount=1,this._viewports=[new Ui(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,s=this.matrix;V3.setFromMatrixPosition(e.matrixWorld),t.position.copy(V3),G3.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(G3),t.updateMatrixWorld(),U3.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(U3),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(t.projectionMatrix),s.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},Zw=class extends bv{constructor(){super(new Ss(50,1,.5,500));this.focus=1}updateMatrices(e){let t=this.camera,s=lg*2*e.angle*this.focus,c=this.mapSize.width/this.mapSize.height,h=e.distance||t.far;(s!==t.fov||c!==t.aspect||h!==t.far)&&(t.fov=s,t.aspect=c,t.far=h,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}};Zw.prototype.isSpotLightShadow=!0;var Kw=class extends ea{constructor(e,t,s=0,c=Math.PI/3,h=0,p=1){super(e,t);this.type="SpotLight",this.position.copy(Ki.DefaultUp),this.updateMatrix(),this.target=new Ki,this.distance=s,this.angle=c,this.penumbra=h,this.decay=p,this.shadow=new Zw}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};Kw.prototype.isSpotLight=!0;var H3=new Jn,Vg=new Be,Yw=new Be,Jw=class extends bv{constructor(){super(new Ss(90,1,.5,500));this._frameExtents=new Wt(4,2),this._viewportCount=6,this._viewports=[new Ui(2,1,1,1),new Ui(0,1,1,1),new Ui(3,1,1,1),new Ui(1,1,1,1),new Ui(3,0,1,1),new Ui(1,0,1,1)],this._cubeDirections=[new Be(1,0,0),new Be(-1,0,0),new Be(0,0,1),new Be(0,0,-1),new Be(0,1,0),new Be(0,-1,0)],this._cubeUps=[new Be(0,1,0),new Be(0,1,0),new Be(0,1,0),new Be(0,1,0),new Be(0,0,1),new Be(0,0,-1)]}updateMatrices(e,t=0){let s=this.camera,c=this.matrix,h=e.distance||s.far;h!==s.far&&(s.far=h,s.updateProjectionMatrix()),Vg.setFromMatrixPosition(e.matrixWorld),s.position.copy(Vg),Yw.copy(s.position),Yw.add(this._cubeDirections[t]),s.up.copy(this._cubeUps[t]),s.lookAt(Yw),s.updateMatrixWorld(),c.makeTranslation(-Vg.x,-Vg.y,-Vg.z),H3.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(H3)}};Jw.prototype.isPointLightShadow=!0;var $w=class extends ea{constructor(e,t,s=0,c=1){super(e,t);this.type="PointLight",this.distance=s,this.decay=c,this.shadow=new Jw}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}};$w.prototype.isPointLight=!0;var Qw=class extends bv{constructor(){super(new _g(-5,5,5,-5,.5,500))}};Qw.prototype.isDirectionalLightShadow=!0;var eT=class extends ea{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy(Ki.DefaultUp),this.updateMatrix(),this.target=new Ki,this.shadow=new Qw}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};eT.prototype.isDirectionalLight=!0;var tT=class extends ea{constructor(e,t){super(e,t);this.type="AmbientLight"}};tT.prototype.isAmbientLight=!0;var nT=class extends ea{constructor(e,t,s=10,c=10){super(e,t);this.type="RectAreaLight",this.width=s,this.height=c}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}};nT.prototype.isRectAreaLight=!0;var wv=class{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Be)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let s=e.x,c=e.y,h=e.z,p=this.coefficients;return t.copy(p[0]).multiplyScalar(.282095),t.addScaledVector(p[1],.488603*c),t.addScaledVector(p[2],.488603*h),t.addScaledVector(p[3],.488603*s),t.addScaledVector(p[4],1.092548*(s*c)),t.addScaledVector(p[5],1.092548*(c*h)),t.addScaledVector(p[6],.315392*(3*h*h-1)),t.addScaledVector(p[7],1.092548*(s*h)),t.addScaledVector(p[8],.546274*(s*s-c*c)),t}getIrradianceAt(e,t){let s=e.x,c=e.y,h=e.z,p=this.coefficients;return t.copy(p[0]).multiplyScalar(.886227),t.addScaledVector(p[1],2*.511664*c),t.addScaledVector(p[2],2*.511664*h),t.addScaledVector(p[3],2*.511664*s),t.addScaledVector(p[4],2*.429043*s*c),t.addScaledVector(p[5],2*.429043*c*h),t.addScaledVector(p[6],.743125*h*h-.247708),t.addScaledVector(p[7],2*.429043*s*h),t.addScaledVector(p[8],.429043*(s*s-c*c)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let s=0;s<9;s++)this.coefficients[s].addScaledVector(e.coefficients[s],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let s=0;s<9;s++)this.coefficients[s].lerp(e.coefficients[s],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let s=this.coefficients;for(let c=0;c<9;c++)s[c].fromArray(e,t+c*3);return this}toArray(e=[],t=0){let s=this.coefficients;for(let c=0;c<9;c++)s[c].toArray(e,t+c*3);return e}static getBasisAt(e,t){let s=e.x,c=e.y,h=e.z;t[0]=.282095,t[1]=.488603*c,t[2]=.488603*h,t[3]=.488603*s,t[4]=1.092548*s*c,t[5]=1.092548*c*h,t[6]=.315392*(3*h*h-1),t[7]=1.092548*s*h,t[8]=.546274*(s*s-c*c)}};wv.prototype.isSphericalHarmonics3=!0;var Gg=class extends ea{constructor(e=new wv,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}};Gg.prototype.isLightProbe=!0;var iT=class{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let s=0,c=e.length;s<c;s++)t+=String.fromCharCode(e[s]);try{return decodeURIComponent(escape(t))}catch(s){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}},Hg=class extends er{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=Infinity}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}};Hg.prototype.isInstancedBufferGeometry=!0;var rT=class extends al{constructor(e){super(e);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,s,c){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let h=this,p=Wh.get(e);if(p!==void 0)return h.manager.itemStart(e),setTimeout(function(){t&&t(p),h.manager.itemEnd(e)},0),p;let r={};r.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",r.headers=this.requestHeader,fetch(e,r).then(function(x){return x.blob()}).then(function(x){return createImageBitmap(x,Object.assign(h.options,{colorSpaceConversion:"none"}))}).then(function(x){Wh.add(e,x),t&&t(x),h.manager.itemEnd(e)}).catch(function(x){c&&c(x),h.manager.itemError(e),h.manager.itemEnd(e)}),h.manager.itemStart(e)}};rT.prototype.isImageBitmapLoader=!0;var Tv,j3={getContext:function(){return Tv===void 0&&(Tv=new(window.AudioContext||window.webkitAudioContext)),Tv},setContext:function(i){Tv=i}},sT=class extends al{constructor(e){super(e)}load(e,t,s,c){let h=this,p=new jw(this.manager);p.setResponseType("arraybuffer"),p.setPath(this.path),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(e,function(r){try{let x=r.slice(0);j3.getContext().decodeAudioData(x,function(w){t(w)})}catch(x){c?c(x):console.error(x),h.manager.itemError(e)}},s,c)}},oT=class extends Gg{constructor(e,t,s=1){super(void 0,s);let c=new jn().set(e),h=new jn().set(t),p=new Be(c.r,c.g,c.b),r=new Be(h.r,h.g,h.b),x=Math.sqrt(Math.PI),v=x*Math.sqrt(.75);this.sh.coefficients[0].copy(p).add(r).multiplyScalar(x),this.sh.coefficients[1].copy(p).sub(r).multiplyScalar(v)}};oT.prototype.isHemisphereLightProbe=!0;var aT=class extends Gg{constructor(e,t=1){super(void 0,t);let s=new jn().set(e);this.sh.coefficients[0].set(s.r,s.g,s.b).multiplyScalar(2*Math.sqrt(Math.PI))}};aT.prototype.isAmbientLightProbe=!0;var lT=class extends Ki{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};var cT=class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let s=0;s<t.length;s++)e+=t[s];return e/t.length}},uT=class{constructor(e,t,s){this.binding=e,this.valueSize=s;let c,h,p;switch(t){case"quaternion":c=this._slerp,h=this._slerpAdditive,p=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(s*6),this._workIndex=5;break;case"string":case"bool":c=this._select,h=this._select,p=this._setAdditiveIdentityOther,this.buffer=new Array(s*5);break;default:c=this._lerp,h=this._lerpAdditive,p=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(s*5)}this._mixBufferRegion=c,this._mixBufferRegionAdditive=h,this._setIdentity=p,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let s=this.buffer,c=this.valueSize,h=e*c+c,p=this.cumulativeWeight;if(p===0){for(let r=0;r!==c;++r)s[h+r]=s[r];p=t}else{p+=t;let r=t/p;this._mixBufferRegion(s,h,0,r,c)}this.cumulativeWeight=p}accumulateAdditive(e){let t=this.buffer,s=this.valueSize,c=s*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,c,0,e,s),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,s=this.buffer,c=e*t+t,h=this.cumulativeWeight,p=this.cumulativeWeightAdditive,r=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,h<1){let x=t*this._origIndex;this._mixBufferRegion(s,c,x,1-h,t)}p>0&&this._mixBufferRegionAdditive(s,c,this._addIndex*t,1,t);for(let x=t,v=t+t;x!==v;++x)if(s[x]!==s[x+t]){r.setValue(s,c);break}}saveOriginalState(){let e=this.binding,t=this.buffer,s=this.valueSize,c=s*this._origIndex;e.getValue(t,c);for(let h=s,p=c;h!==p;++h)t[h]=t[c+h%s];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let s=e;s<t;s++)this.buffer[s]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let s=0;s<this.valueSize;s++)this.buffer[t+s]=this.buffer[e+s]}_select(e,t,s,c,h){if(c>=.5)for(let p=0;p!==h;++p)e[t+p]=e[s+p]}_slerp(e,t,s,c){us.slerpFlat(e,t,e,t,e,s,c)}_slerpAdditive(e,t,s,c,h){let p=this._workIndex*h;us.multiplyQuaternionsFlat(e,p,e,t,e,s),us.slerpFlat(e,t,e,t,e,p,c)}_lerp(e,t,s,c,h){let p=1-c;for(let r=0;r!==h;++r){let x=t+r;e[x]=e[x]*p+e[s+r]*c}}_lerpAdditive(e,t,s,c,h){for(let p=0;p!==h;++p){let r=t+p;e[r]=e[r]+e[s+p]*c}}},hT="\\[\\]\\.:\\/",jU=new RegExp("["+hT+"]","g"),dT="[^"+hT+"]",WU="[^"+hT.replace("\\.","")+"]",qU=/((?:WC+[\/:])*)/.source.replace("WC",dT),XU=/(WCOD+)?/.source.replace("WCOD",WU),ZU=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",dT),KU=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",dT),YU=new RegExp("^"+qU+XU+ZU+KU+"$"),JU=["material","materials","bones"],W3=class{constructor(e,t,s){let c=s||ji.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,c)}getValue(e,t){this.bind();let s=this._targetGroup.nCachedObjects_,c=this._bindings[s];c!==void 0&&c.getValue(e,t)}setValue(e,t){let s=this._bindings;for(let c=this._targetGroup.nCachedObjects_,h=s.length;c!==h;++c)s[c].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,s=e.length;t!==s;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,s=e.length;t!==s;++t)e[t].unbind()}},ji=class{constructor(e,t,s){this.path=t,this.parsedPath=s||ji.parseTrackName(t),this.node=ji.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,s){return e&&e.isAnimationObjectGroup?new ji.Composite(e,t,s):new ji(e,t,s)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(jU,"")}static parseTrackName(e){let t=YU.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let s={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},c=s.nodeName&&s.nodeName.lastIndexOf(".");if(c!==void 0&&c!==-1){let h=s.nodeName.substring(c+1);JU.indexOf(h)!==-1&&(s.nodeName=s.nodeName.substring(0,c),s.objectName=h)}if(s.propertyName===null||s.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return s}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let s=e.skeleton.getBoneByName(t);if(s!==void 0)return s}if(e.children){let s=function(h){for(let p=0;p<h.length;p++){let r=h[p];if(r.name===t||r.uuid===t)return r;let x=s(r.children);if(x)return x}return null},c=s(e.children);if(c)return c}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let s=this.resolvedProperty;for(let c=0,h=s.length;c!==h;++c)e[t++]=s[c]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let s=this.resolvedProperty;for(let c=0,h=s.length;c!==h;++c)s[c]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let s=this.resolvedProperty;for(let c=0,h=s.length;c!==h;++c)s[c]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let s=this.resolvedProperty;for(let c=0,h=s.length;c!==h;++c)s[c]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,s=t.objectName,c=t.propertyName,h=t.propertyIndex;if(e||(e=ji.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(s){let v=t.objectIndex;switch(s){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let w=0;w<e.length;w++)if(e[w].name===v){v=w;break}break;default:if(e[s]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[s]}if(v!==void 0){if(e[v]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[v]}}let p=e[c];if(p===void 0){let v=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+v+"."+c+" but it wasn't found.",e);return}let r=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?r=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(r=this.Versioning.MatrixWorldNeedsUpdate);let x=this.BindingType.Direct;if(h!==void 0){if(c==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[h]!==void 0&&(h=e.morphTargetDictionary[h])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}x=this.BindingType.ArrayElement,this.resolvedProperty=p,this.propertyIndex=h}else p.fromArray!==void 0&&p.toArray!==void 0?(x=this.BindingType.HasFromToArray,this.resolvedProperty=p):Array.isArray(p)?(x=this.BindingType.EntireArray,this.resolvedProperty=p):this.propertyName=c;this.getValue=this.GetterByBindingType[x],this.setValue=this.SetterByBindingTypeAndVersioning[x][r]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};ji.Composite=W3;ji.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ji.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ji.prototype.GetterByBindingType=[ji.prototype._getValue_direct,ji.prototype._getValue_array,ji.prototype._getValue_arrayElement,ji.prototype._getValue_toArray];ji.prototype.SetterByBindingTypeAndVersioning=[[ji.prototype._setValue_direct,ji.prototype._setValue_direct_setNeedsUpdate,ji.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ji.prototype._setValue_array,ji.prototype._setValue_array_setNeedsUpdate,ji.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ji.prototype._setValue_arrayElement,ji.prototype._setValue_arrayElement_setNeedsUpdate,ji.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ji.prototype._setValue_fromArray,ji.prototype._setValue_fromArray_setNeedsUpdate,ji.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var fT=class{constructor(){this.uuid=Ko(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let s=0,c=arguments.length;s!==c;++s)e[arguments[s].uuid]=s;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e=this._objects,t=this._indicesByUUID,s=this._paths,c=this._parsedPaths,h=this._bindings,p=h.length,r,x=e.length,v=this.nCachedObjects_;for(let w=0,S=arguments.length;w!==S;++w){let A=arguments[w],I=A.uuid,R=t[I];if(R===void 0){R=x++,t[I]=R,e.push(A);for(let k=0,L=p;k!==L;++k)h[k].push(new ji(A,s[k],c[k]))}else if(R<v){r=e[R];let k=--v,L=e[k];t[L.uuid]=R,e[R]=L,t[I]=k,e[k]=A;for(let z=0,B=p;z!==B;++z){let $=h[z],H=$[k],G=$[R];$[R]=H,G===void 0&&(G=new ji(A,s[z],c[z])),$[k]=G}}else e[R]!==r&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=v}remove(){let e=this._objects,t=this._indicesByUUID,s=this._bindings,c=s.length,h=this.nCachedObjects_;for(let p=0,r=arguments.length;p!==r;++p){let x=arguments[p],v=x.uuid,w=t[v];if(w!==void 0&&w>=h){let S=h++,A=e[S];t[A.uuid]=w,e[w]=A,t[v]=S,e[S]=x;for(let I=0,R=c;I!==R;++I){let k=s[I],L=k[S],z=k[w];k[w]=L,k[S]=z}}}this.nCachedObjects_=h}uncache(){let e=this._objects,t=this._indicesByUUID,s=this._bindings,c=s.length,h=this.nCachedObjects_,p=e.length;for(let r=0,x=arguments.length;r!==x;++r){let v=arguments[r],w=v.uuid,S=t[w];if(S!==void 0)if(delete t[w],S<h){let A=--h,I=e[A],R=--p,k=e[R];t[I.uuid]=S,e[S]=I,t[k.uuid]=A,e[A]=k,e.pop();for(let L=0,z=c;L!==z;++L){let B=s[L],$=B[A],H=B[R];B[S]=$,B[A]=H,B.pop()}}else{let A=--p,I=e[A];A>0&&(t[I.uuid]=S),e[S]=I,e.pop();for(let R=0,k=c;R!==k;++R){let L=s[R];L[S]=L[A],L.pop()}}}this.nCachedObjects_=h}subscribe_(e,t){let s=this._bindingsIndicesByPath,c=s[e],h=this._bindings;if(c!==void 0)return h[c];let p=this._paths,r=this._parsedPaths,x=this._objects,v=x.length,w=this.nCachedObjects_,S=new Array(v);c=h.length,s[e]=c,p.push(e),r.push(t),h.push(S);for(let A=w,I=x.length;A!==I;++A){let R=x[A];S[A]=new ji(R,e,t)}return S}unsubscribe_(e){let t=this._bindingsIndicesByPath,s=t[e];if(s!==void 0){let c=this._paths,h=this._parsedPaths,p=this._bindings,r=p.length-1,x=p[r],v=e[r];t[v]=s,p[s]=x,p.pop(),h[s]=h[r],h.pop(),c[s]=c[r],c.pop()}}};fT.prototype.isAnimationObjectGroup=!0;var q3=class{constructor(e,t,s=null,c=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=s,this.blendMode=c;let h=t.tracks,p=h.length,r=new Array(p),x={endingStart:Rh,endingEnd:Rh};for(let v=0;v!==p;++v){let w=h[v].createInterpolant(null);r[v]=w,w.settings=x}this._interpolantSettings=x,this._interpolants=r,this._propertyBindings=new Array(p),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=fI,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=Infinity,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,s){if(e.fadeOut(t),this.fadeIn(t),s){let c=this._clip.duration,h=e._clip.duration,p=h/c,r=c/h;e.warp(1,p,t),this.warp(r,1,t)}return this}crossFadeTo(e,t,s){return e.crossFadeFrom(this,t,s)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,s){let c=this._mixer,h=c.time,p=this.timeScale,r=this._timeScaleInterpolant;r===null&&(r=c._lendControlInterpolant(),this._timeScaleInterpolant=r);let x=r.parameterPositions,v=r.sampleValues;return x[0]=h,x[1]=h+s,v[0]=e/p,v[1]=t/p,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,s,c){if(!this.enabled){this._updateWeight(e);return}let h=this._startTime;if(h!==null){let x=(e-h)*s;if(x<0||s===0)return;this._startTime=null,t=s*x}t*=this._updateTimeScale(e);let p=this._updateTime(t),r=this._updateWeight(e);if(r>0){let x=this._interpolants,v=this._propertyBindings;switch(this.blendMode){case Bb:for(let w=0,S=x.length;w!==S;++w)x[w].evaluate(p),v[w].accumulateAdditive(r);break;case u0:default:for(let w=0,S=x.length;w!==S;++w)x[w].evaluate(p),v[w].accumulate(c,r)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let s=this._weightInterpolant;if(s!==null){let c=s.evaluate(e)[0];t*=c,e>s.parameterPositions[1]&&(this.stopFading(),c===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let s=this._timeScaleInterpolant;s!==null&&(t*=s.evaluate(e)[0],e>s.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,s=this.loop,c=this.time+e,h=this._loopCount,p=s===pI;if(e===0)return h===-1?c:p&&(h&1)==1?t-c:c;if(s===dI){h===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(c>=t)c=t;else if(c<0)c=0;else{this.time=c;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=c,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(h===-1&&(e>=0?(h=0,this._setEndings(!0,this.repetitions===0,p)):this._setEndings(this.repetitions===0,!0,p)),c>=t||c<0){let r=Math.floor(c/t);c-=t*r,h+=Math.abs(r);let x=this.repetitions-h;if(x<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,c=e>0?t:0,this.time=c,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(x===1){let v=e<0;this._setEndings(v,!v,p)}else this._setEndings(!1,!1,p);this._loopCount=h,this.time=c,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=c;if(p&&(h&1)==1)return t-c}return c}_setEndings(e,t,s){let c=this._interpolantSettings;s?(c.endingStart=Ph,c.endingEnd=Ph):(e?c.endingStart=this.zeroSlopeAtStart?Ph:Rh:c.endingStart=sg,t?c.endingEnd=this.zeroSlopeAtEnd?Ph:Rh:c.endingEnd=sg)}_scheduleFading(e,t,s){let c=this._mixer,h=c.time,p=this._weightInterpolant;p===null&&(p=c._lendControlInterpolant(),this._weightInterpolant=p);let r=p.parameterPositions,x=p.sampleValues;return r[0]=h,x[0]=t,r[1]=h+e,x[1]=s,this}},pT=class extends Sa{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let s=e._localRoot||this._root,c=e._clip.tracks,h=c.length,p=e._propertyBindings,r=e._interpolants,x=s.uuid,v=this._bindingsByRootAndName,w=v[x];w===void 0&&(w={},v[x]=w);for(let S=0;S!==h;++S){let A=c[S],I=A.name,R=w[I];if(R!==void 0)++R.referenceCount,p[S]=R;else{if(R=p[S],R!==void 0){R._cacheIndex===null&&(++R.referenceCount,this._addInactiveBinding(R,x,I));continue}let k=t&&t._propertyBindings[S].binding.parsedPath;R=new uT(ji.create(s,I,k),A.ValueTypeName,A.getValueSize()),++R.referenceCount,this._addInactiveBinding(R,x,I),p[S]=R}r[S].resultBuffer=R.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let s=(e._localRoot||this._root).uuid,c=e._clip.uuid,h=this._actionsByClip[c];this._bindAction(e,h&&h.knownActions[0]),this._addInactiveAction(e,c,s)}let t=e._propertyBindings;for(let s=0,c=t.length;s!==c;++s){let h=t[s];h.useCount++==0&&(this._lendBinding(h),h.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let s=0,c=t.length;s!==c;++s){let h=t[s];--h.useCount==0&&(h.restoreOriginalState(),this._takeBackBinding(h))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,s){let c=this._actions,h=this._actionsByClip,p=h[t];if(p===void 0)p={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,h[t]=p;else{let r=p.knownActions;e._byClipCacheIndex=r.length,r.push(e)}e._cacheIndex=c.length,c.push(e),p.actionByRoot[s]=e}_removeInactiveAction(e){let t=this._actions,s=t[t.length-1],c=e._cacheIndex;s._cacheIndex=c,t[c]=s,t.pop(),e._cacheIndex=null;let h=e._clip.uuid,p=this._actionsByClip,r=p[h],x=r.knownActions,v=x[x.length-1],w=e._byClipCacheIndex;v._byClipCacheIndex=w,x[w]=v,x.pop(),e._byClipCacheIndex=null;let S=r.actionByRoot,A=(e._localRoot||this._root).uuid;delete S[A],x.length===0&&delete p[h],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let s=0,c=t.length;s!==c;++s){let h=t[s];--h.referenceCount==0&&this._removeInactiveBinding(h)}}_lendAction(e){let t=this._actions,s=e._cacheIndex,c=this._nActiveActions++,h=t[c];e._cacheIndex=c,t[c]=e,h._cacheIndex=s,t[s]=h}_takeBackAction(e){let t=this._actions,s=e._cacheIndex,c=--this._nActiveActions,h=t[c];e._cacheIndex=c,t[c]=e,h._cacheIndex=s,t[s]=h}_addInactiveBinding(e,t,s){let c=this._bindingsByRootAndName,h=this._bindings,p=c[t];p===void 0&&(p={},c[t]=p),p[s]=e,e._cacheIndex=h.length,h.push(e)}_removeInactiveBinding(e){let t=this._bindings,s=e.binding,c=s.rootNode.uuid,h=s.path,p=this._bindingsByRootAndName,r=p[c],x=t[t.length-1],v=e._cacheIndex;x._cacheIndex=v,t[v]=x,t.pop(),delete r[h],Object.keys(r).length===0&&delete p[c]}_lendBinding(e){let t=this._bindings,s=e._cacheIndex,c=this._nActiveBindings++,h=t[c];e._cacheIndex=c,t[c]=e,h._cacheIndex=s,t[s]=h}_takeBackBinding(e){let t=this._bindings,s=e._cacheIndex,c=--this._nActiveBindings,h=t[c];e._cacheIndex=c,t[c]=e,h._cacheIndex=s,t[s]=h}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,s=e[t];return s===void 0&&(s=new _v(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),s.__cacheIndex=t,e[t]=s),s}_takeBackControlInterpolant(e){let t=this._controlInterpolants,s=e.__cacheIndex,c=--this._nActiveControlInterpolants,h=t[c];e.__cacheIndex=c,t[c]=e,h.__cacheIndex=s,t[s]=h}clipAction(e,t,s){let c=t||this._root,h=c.uuid,p=typeof e=="string"?vv.findByName(c,e):e,r=p!==null?p.uuid:e,x=this._actionsByClip[r],v=null;if(s===void 0&&(p!==null?s=p.blendMode:s=u0),x!==void 0){let S=x.actionByRoot[h];if(S!==void 0&&S.blendMode===s)return S;v=x.knownActions[0],p===null&&(p=v._clip)}if(p===null)return null;let w=new q3(this,p,t,s);return this._bindAction(w,v),this._addInactiveAction(w,r,h),w}existingAction(e,t){let s=t||this._root,c=s.uuid,h=typeof e=="string"?vv.findByName(s,e):e,p=h?h.uuid:e,r=this._actionsByClip[p];return r!==void 0&&r.actionByRoot[c]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let s=t-1;s>=0;--s)e[s].stop();return this}update(e){e*=this.timeScale;let t=this._actions,s=this._nActiveActions,c=this.time+=e,h=Math.sign(e),p=this._accuIndex^=1;for(let v=0;v!==s;++v)t[v]._update(c,e,h,p);let r=this._bindings,x=this._nActiveBindings;for(let v=0;v!==x;++v)r[v].apply(p);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,s=e.uuid,c=this._actionsByClip,h=c[s];if(h!==void 0){let p=h.knownActions;for(let r=0,x=p.length;r!==x;++r){let v=p[r];this._deactivateAction(v);let w=v._cacheIndex,S=t[t.length-1];v._cacheIndex=null,v._byClipCacheIndex=null,S._cacheIndex=w,t[w]=S,t.pop(),this._removeInactiveBindingsForAction(v)}delete c[s]}}uncacheRoot(e){let t=e.uuid,s=this._actionsByClip;for(let p in s){let r=s[p].actionByRoot,x=r[t];x!==void 0&&(this._deactivateAction(x),this._removeInactiveAction(x))}let c=this._bindingsByRootAndName,h=c[t];if(h!==void 0)for(let p in h){let r=h[p];r.restoreOriginalState(),this._removeInactiveBinding(r)}}uncacheAction(e,t){let s=this.existingAction(e,t);s!==null&&(this._deactivateAction(s),this._removeInactiveAction(s))}};pT.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var jg=class{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new jg(this.value.clone===void 0?this.value:this.value.clone())}},lu=class extends Vh{constructor(e,t,s=1){super(e,t);this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}};lu.prototype.isInstancedInterleavedBuffer=!0;var mT=class{constructor(e,t,s,c,h){this.buffer=e,this.type=t,this.itemSize=s,this.elementSize=c,this.count=h,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}};mT.prototype.isGLBufferAttribute=!0;var Wg=class{constructor(e=1,t=0,s=0){return this.radius=e,this.phi=t,this.theta=s,this}set(e,t,s){return this.radius=e,this.phi=t,this.theta=s,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){let e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,s){return this.radius=Math.sqrt(e*e+t*t+s*s),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,s),this.phi=Math.acos(as(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}};var X3=new Wt,qh=class{constructor(e=new Wt(Infinity,Infinity),t=new Wt(-Infinity,-Infinity)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let s=X3.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return X3.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};qh.prototype.isBox2=!0;var Z3=new Be,Ev=new Be,qg=class{constructor(e=new Be,t=new Be){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Z3.subVectors(e,this.start),Ev.subVectors(this.end,this.start);let s=Ev.dot(Ev),h=Ev.dot(Z3)/s;return t&&(h=as(h,0,1)),h}closestPointToPoint(e,t,s){let c=this.closestPointToPointParameter(e,t);return this.delta(s).multiplyScalar(c).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}};var cu=new Be,Sv=new Jn,gT=new Jn,_T=class extends Zf{constructor(e){let t=K3(e),s=new er,c=[],h=[],p=new jn(0,0,1),r=new jn(0,1,0);for(let v=0;v<t.length;v++){let w=t[v];w.parent&&w.parent.isBone&&(c.push(0,0,0),c.push(0,0,0),h.push(p.r,p.g,p.b),h.push(r.r,r.g,r.b))}s.setAttribute("position",new br(c,3)),s.setAttribute("color",new br(h,3));let x=new Yl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(s,x);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,s=this.geometry,c=s.getAttribute("position");gT.copy(this.root.matrixWorld).invert();for(let h=0,p=0;h<t.length;h++){let r=t[h];r.parent&&r.parent.isBone&&(Sv.multiplyMatrices(gT,r.matrixWorld),cu.setFromMatrixPosition(Sv),c.setXYZ(p,cu.x,cu.y,cu.z),Sv.multiplyMatrices(gT,r.parent.matrixWorld),cu.setFromMatrixPosition(Sv),c.setXYZ(p+1,cu.x,cu.y,cu.z),p+=2)}s.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}};function K3(i){let e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,K3(i.children[t]));return e}var yT=class extends Zf{constructor(e=10,t=10,s=4473924,c=8947848){s=new jn(s),c=new jn(c);let h=t/2,p=e/t,r=e/2,x=[],v=[];for(let A=0,I=0,R=-r;A<=t;A++,R+=p){x.push(-r,0,R,r,0,R),x.push(R,0,-r,R,0,r);let k=A===h?s:c;k.toArray(v,I),I+=3,k.toArray(v,I),I+=3,k.toArray(v,I),I+=3,k.toArray(v,I),I+=3}let w=new er;w.setAttribute("position",new br(x,3)),w.setAttribute("color",new br(v,3));let S=new Yl({vertexColors:!0,toneMapped:!1});super(w,S);this.type="GridHelper"}};var Av=class extends Zf{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],s=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],c=new er;c.setAttribute("position",new br(t,3)),c.setAttribute("color",new br(s,3));let h=new Yl({vertexColors:!0,toneMapped:!1});super(c,h);this.type="AxesHelper"}setColors(e,t,s){let c=new jn,h=this.geometry.attributes.color.array;return c.set(e),c.toArray(h,0),c.toArray(h,3),c.set(t),c.toArray(h,6),c.toArray(h,9),c.set(s),c.toArray(h,12),c.toArray(h,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};var Y3=new ArrayBuffer(4),dW=new Float32Array(Y3),fW=new Uint32Array(Y3),ll=new Uint32Array(512),cl=new Uint32Array(512);for(let i=0;i<256;++i){let e=i-127;e<-27?(ll[i]=0,ll[i|256]=32768,cl[i]=24,cl[i|256]=24):e<-14?(ll[i]=1024>>-e-14,ll[i|256]=1024>>-e-14|32768,cl[i]=-e-1,cl[i|256]=-e-1):e<=15?(ll[i]=e+15<<10,ll[i|256]=e+15<<10|32768,cl[i]=13,cl[i|256]=13):e<128?(ll[i]=31744,ll[i|256]=64512,cl[i]=24,cl[i|256]=24):(ll[i]=31744,ll[i|256]=64512,cl[i]=13,cl[i|256]=13)}var J3=new Uint32Array(2048),Xg=new Uint32Array(64),$U=new Uint32Array(64);for(let i=1;i<1024;++i){let e=i<<13,t=0;for(;(e&8388608)==0;)e<<=1,t-=8388608;e&=~8388608,t+=947912704,J3[i]=e|t}for(let i=1024;i<2048;++i)J3[i]=939524096+(i-1024<<13);for(let i=1;i<31;++i)Xg[i]=i<<23;Xg[31]=1199570944;Xg[32]=2147483648;for(let i=33;i<63;++i)Xg[i]=2147483648+(i-32<<23);Xg[63]=3347054592;for(let i=1;i<64;++i)i!==32&&($U[i]=1024);Eo.create=function(i,e){return console.log("THREE.Curve.create() has been deprecated"),i.prototype=Object.create(Eo.prototype),i.prototype.constructor=i,i.prototype.getPoint=e,i};Og.prototype.fromPoints=function(i){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(i)};yT.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};_T.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};al.prototype.extractUrlBase=function(i){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),iT.extractUrlBase(i)};al.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};qh.prototype.center=function(i){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(i)};qh.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};qh.prototype.isIntersectionBox=function(i){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};qh.prototype.size=function(i){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(i)};Ts.prototype.center=function(i){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(i)};Ts.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Ts.prototype.isIntersectionBox=function(i){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};Ts.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};Ts.prototype.size=function(i){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(i)};Hl.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")};Jo.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Ff.prototype.setFromMatrix=function(i){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(i)};qg.prototype.center=function(i){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(i)};ls.prototype.flattenToArrayOffset=function(i,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)};ls.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};ls.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};ls.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)};ls.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};ls.prototype.getInverse=function(i){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};Jn.prototype.extractPosition=function(i){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(i)};Jn.prototype.flattenToArrayOffset=function(i,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,e)};Jn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Be().setFromMatrixColumn(this,3)};Jn.prototype.setRotationFromQuaternion=function(i){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(i)};Jn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Jn.prototype.multiplyVector3=function(i){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Jn.prototype.multiplyVector4=function(i){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Jn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Jn.prototype.rotateAxis=function(i){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),i.transformDirection(this)};Jn.prototype.crossVector=function(i){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Jn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Jn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Jn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Jn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Jn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Jn.prototype.applyToBufferAttribute=function(i){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)};Jn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Jn.prototype.makeFrustum=function(i,e,t,s,c,h){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(i,e,s,t,c,h)};Jn.prototype.getInverse=function(i){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()};Ca.prototype.isIntersectionLine=function(i){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(i)};us.prototype.multiplyVector3=function(i){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),i.applyQuaternion(this)};us.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};Qc.prototype.isIntersectionBox=function(i){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)};Qc.prototype.isIntersectionPlane=function(i){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(i)};Qc.prototype.isIntersectionSphere=function(i){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)};Gr.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Gr.prototype.barycoordFromPoint=function(i,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(i,e)};Gr.prototype.midpoint=function(i){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(i)};Gr.prototypenormal=function(i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(i)};Gr.prototype.plane=function(i){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(i)};Gr.barycoordFromPoint=function(i,e,t,s,c){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Gr.getBarycoord(i,e,t,s,c)};Gr.normal=function(i,e,t,s){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Gr.getNormal(i,e,t,s)};Gh.prototype.extractAllPoints=function(i){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(i)};Gh.prototype.extrude=function(i){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Jl(this,i)};Gh.prototype.makeGeometry=function(i){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new $f(this,i)};Wt.prototype.fromAttribute=function(i,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)};Wt.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};Wt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Be.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};Be.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};Be.prototype.getPositionFromMatrix=function(i){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(i)};Be.prototype.getScaleFromMatrix=function(i){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(i)};Be.prototype.getColumnFromMatrix=function(i,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,i)};Be.prototype.applyProjection=function(i){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(i)};Be.prototype.fromAttribute=function(i,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)};Be.prototype.distanceToManhattan=function(i){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)};Be.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Ui.prototype.fromAttribute=function(i,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,e,t)};Ui.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Ki.prototype.getChildByName=function(i){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(i)};Ki.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Ki.prototype.translate=function(i,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,i)};Ki.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Ki.prototype.applyMatrix=function(i){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(Ki.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Hr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(Hr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),mI},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});K0.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Ss.prototype.setLens=function(i,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(i)};Object.defineProperties(ea.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}});Object.defineProperties(xr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===og},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(og)}}});xr.prototype.setDynamic=function(i){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?og:xf),this};xr.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},xr.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};er.prototype.addIndex=function(i){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(i)};er.prototype.addAttribute=function(i,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(i,new xr(arguments[1],arguments[2]))):i==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(i,e)};er.prototype.addDrawCall=function(i,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(i,e)};er.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};er.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};er.prototype.removeAttribute=function(i){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(i)};er.prototype.applyMatrix=function(i){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)};Object.defineProperties(er.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Vh.prototype.setDynamic=function(i){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(i===!0?og:xf),this};Vh.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Jl.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};Jl.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};Jl.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Hf.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};jg.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this};Object.defineProperties(Zr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new jn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===ab}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(eo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}});sr.prototype.clearTarget=function(i,e,t,s){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(i),this.clear(e,t,s)};sr.prototype.animate=function(i){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(i)};sr.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};sr.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};sr.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};sr.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};sr.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};sr.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};sr.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};sr.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};sr.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};sr.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};sr.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};sr.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};sr.prototype.enableScissorTest=function(i){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(i)};sr.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};sr.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};sr.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};sr.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};sr.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};sr.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};sr.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};sr.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};sr.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};sr.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(sr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=i===!0?Ar:nl}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});Object.defineProperties(h3.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Qs.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}});lT.prototype.load=function(i){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let e=this;return new sT().load(i,function(s){e.setBuffer(s)}),this};cT.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};gg.prototype.updateCubeMap=function(i,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(i,e)};gg.prototype.clear=function(i,e,t,s){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(i,e,t,s)};Ul.crossOrigin=void 0;Ul.loadTexture=function(i,e,t,s){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let c=new qw;c.setCrossOrigin(this.crossOrigin);let h=c.load(i,t,void 0,s);return e&&(h.mapping=e),h};Ul.loadTextureCube=function(i,e,t,s){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let c=new Ww;c.setCrossOrigin(this.crossOrigin);let h=c.load(i,t,void 0,s);return e&&(h.mapping=e),h};Ul.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Ul.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:e0}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=e0);var $3={type:"change"},vT={type:"start"},Q3={type:"end"},xT=class extends Sa{constructor(e,t){super();t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Be,this.minDistance=0,this.maxDistance=Infinity,this.minZoom=0,this.maxZoom=Infinity,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-Infinity,this.maxAzimuthAngle=Infinity,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Hc.ROTATE,MIDDLE:Hc.DOLLY,RIGHT:Hc.PAN},this.touches={ONE:jc.ROTATE,TWO:jc.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(Ee){Ee.addEventListener("keydown",ei),this._domElementKeyEvents=Ee},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent($3),s.update(),h=c.NONE},this.update=function(){let Ee=new Be,et=new us().setFromUnitVectors(e.up,new Be(0,1,0)),rn=et.clone().invert(),tn=new Be,Je=new us,sn=2*Math.PI;return function(){let An=s.object.position;Ee.copy(An).sub(s.target),Ee.applyQuaternion(et),r.setFromVector3(Ee),s.autoRotate&&h===c.NONE&&me(te()),s.enableDamping?(r.theta+=x.theta*s.dampingFactor,r.phi+=x.phi*s.dampingFactor):(r.theta+=x.theta,r.phi+=x.phi);let Et=s.minAzimuthAngle,Dn=s.maxAzimuthAngle;return isFinite(Et)&&isFinite(Dn)&&(Et<-Math.PI?Et+=sn:Et>Math.PI&&(Et-=sn),Dn<-Math.PI?Dn+=sn:Dn>Math.PI&&(Dn-=sn),Et<=Dn?r.theta=Math.max(Et,Math.min(Dn,r.theta)):r.theta=r.theta>(Et+Dn)/2?Math.max(Et,r.theta):Math.min(Dn,r.theta)),r.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,r.phi)),r.makeSafe(),r.radius*=v,r.radius=Math.max(s.minDistance,Math.min(s.maxDistance,r.radius)),s.enableDamping===!0?s.target.addScaledVector(w,s.dampingFactor):s.target.add(w),Ee.setFromSpherical(r),Ee.applyQuaternion(rn),An.copy(s.target).add(Ee),s.object.lookAt(s.target),s.enableDamping===!0?(x.theta*=1-s.dampingFactor,x.phi*=1-s.dampingFactor,w.multiplyScalar(1-s.dampingFactor)):(x.set(0,0,0),w.set(0,0,0)),v=1,S||tn.distanceToSquared(s.object.position)>p||8*(1-Je.dot(s.object.quaternion))>p?(s.dispatchEvent($3),tn.copy(s.object.position),Je.copy(s.object.quaternion),S=!1,!0):!1}}(),this.dispose=function(){s.domElement.removeEventListener("contextmenu",gt),s.domElement.removeEventListener("pointerdown",St),s.domElement.removeEventListener("pointercancel",Pn),s.domElement.removeEventListener("wheel",xn),s.domElement.removeEventListener("pointermove",ut),s.domElement.removeEventListener("pointerup",Ot),s._domElementKeyEvents!==null&&s._domElementKeyEvents.removeEventListener("keydown",ei)};let s=this,c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},h=c.NONE,p=1e-6,r=new Wg,x=new Wg,v=1,w=new Be,S=!1,A=new Wt,I=new Wt,R=new Wt,k=new Wt,L=new Wt,z=new Wt,B=new Wt,$=new Wt,H=new Wt,G=[],le={};function te(){return 2*Math.PI/60/60*s.autoRotateSpeed}function ue(){return Math.pow(.95,s.zoomSpeed)}function me(Ee){x.theta-=Ee}function se(Ee){x.phi-=Ee}let Y=function(){let Ee=new Be;return function(rn,tn){Ee.setFromMatrixColumn(tn,0),Ee.multiplyScalar(-rn),w.add(Ee)}}(),ye=function(){let Ee=new Be;return function(rn,tn){s.screenSpacePanning===!0?Ee.setFromMatrixColumn(tn,1):(Ee.setFromMatrixColumn(tn,0),Ee.crossVectors(s.object.up,Ee)),Ee.multiplyScalar(rn),w.add(Ee)}}(),Xe=function(){let Ee=new Be;return function(rn,tn){let Je=s.domElement;if(s.object.isPerspectiveCamera){let sn=s.object.position;Ee.copy(sn).sub(s.target);let nn=Ee.length();nn*=Math.tan(s.object.fov/2*Math.PI/180),Y(2*rn*nn/Je.clientHeight,s.object.matrix),ye(2*tn*nn/Je.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(Y(rn*(s.object.right-s.object.left)/s.object.zoom/Je.clientWidth,s.object.matrix),ye(tn*(s.object.top-s.object.bottom)/s.object.zoom/Je.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function ge(Ee){s.object.isPerspectiveCamera?v/=Ee:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*Ee)),s.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function re(Ee){s.object.isPerspectiveCamera?v*=Ee:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/Ee)),s.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function ve(Ee){A.set(Ee.clientX,Ee.clientY)}function ae(Ee){B.set(Ee.clientX,Ee.clientY)}function de(Ee){k.set(Ee.clientX,Ee.clientY)}function xe(Ee){I.set(Ee.clientX,Ee.clientY),R.subVectors(I,A).multiplyScalar(s.rotateSpeed);let et=s.domElement;me(2*Math.PI*R.x/et.clientHeight),se(2*Math.PI*R.y/et.clientHeight),A.copy(I),s.update()}function De(Ee){$.set(Ee.clientX,Ee.clientY),H.subVectors($,B),H.y>0?ge(ue()):H.y<0&&re(ue()),B.copy($),s.update()}function Ce(Ee){L.set(Ee.clientX,Ee.clientY),z.subVectors(L,k).multiplyScalar(s.panSpeed),Xe(z.x,z.y),k.copy(L),s.update()}function pe(Ee){Ee.deltaY<0?re(ue()):Ee.deltaY>0&&ge(ue()),s.update()}function xt(Ee){let et=!1;switch(Ee.code){case s.keys.UP:Xe(0,s.keyPanSpeed),et=!0;break;case s.keys.BOTTOM:Xe(0,-s.keyPanSpeed),et=!0;break;case s.keys.LEFT:Xe(s.keyPanSpeed,0),et=!0;break;case s.keys.RIGHT:Xe(-s.keyPanSpeed,0),et=!0;break}et&&(Ee.preventDefault(),s.update())}function Ct(){if(G.length===1)A.set(G[0].pageX,G[0].pageY);else{let Ee=.5*(G[0].pageX+G[1].pageX),et=.5*(G[0].pageY+G[1].pageY);A.set(Ee,et)}}function ct(){if(G.length===1)k.set(G[0].pageX,G[0].pageY);else{let Ee=.5*(G[0].pageX+G[1].pageX),et=.5*(G[0].pageY+G[1].pageY);k.set(Ee,et)}}function Qe(){let Ee=G[0].pageX-G[1].pageX,et=G[0].pageY-G[1].pageY,rn=Math.sqrt(Ee*Ee+et*et);B.set(0,rn)}function zt(){s.enableZoom&&Qe(),s.enablePan&&ct()}function Zt(){s.enableZoom&&Qe(),s.enableRotate&&Ct()}function Lt(Ee){if(G.length==1)I.set(Ee.pageX,Ee.pageY);else{let rn=Tn(Ee),tn=.5*(Ee.pageX+rn.x),Je=.5*(Ee.pageY+rn.y);I.set(tn,Je)}R.subVectors(I,A).multiplyScalar(s.rotateSpeed);let et=s.domElement;me(2*Math.PI*R.x/et.clientHeight),se(2*Math.PI*R.y/et.clientHeight),A.copy(I)}function Re(Ee){if(G.length===1)L.set(Ee.pageX,Ee.pageY);else{let et=Tn(Ee),rn=.5*(Ee.pageX+et.x),tn=.5*(Ee.pageY+et.y);L.set(rn,tn)}z.subVectors(L,k).multiplyScalar(s.panSpeed),Xe(z.x,z.y),k.copy(L)}function qt(Ee){let et=Tn(Ee),rn=Ee.pageX-et.x,tn=Ee.pageY-et.y,Je=Math.sqrt(rn*rn+tn*tn);$.set(0,Je),H.set(0,Math.pow($.y/B.y,s.zoomSpeed)),ge(H.y),B.copy($)}function nt(Ee){s.enableZoom&&qt(Ee),s.enablePan&&Re(Ee)}function at(Ee){s.enableZoom&&qt(Ee),s.enableRotate&&Lt(Ee)}function St(Ee){s.enabled!==!1&&(G.length===0&&(s.domElement.setPointerCapture(Ee.pointerId),s.domElement.addEventListener("pointermove",ut),s.domElement.addEventListener("pointerup",Ot)),Rt(Ee),Ee.pointerType==="touch"?ze(Ee):bn(Ee))}function ut(Ee){s.enabled!==!1&&(Ee.pointerType==="touch"?Ae(Ee):wn(Ee))}function Ot(Ee){Xt(Ee),G.length===0&&(s.domElement.releasePointerCapture(Ee.pointerId),s.domElement.removeEventListener("pointermove",ut),s.domElement.removeEventListener("pointerup",Ot)),s.dispatchEvent(Q3),h=c.NONE}function Pn(Ee){Xt(Ee)}function bn(Ee){let et;switch(Ee.button){case 0:et=s.mouseButtons.LEFT;break;case 1:et=s.mouseButtons.MIDDLE;break;case 2:et=s.mouseButtons.RIGHT;break;default:et=-1}switch(et){case Hc.DOLLY:if(s.enableZoom===!1)return;ae(Ee),h=c.DOLLY;break;case Hc.ROTATE:if(Ee.ctrlKey||Ee.metaKey||Ee.shiftKey){if(s.enablePan===!1)return;de(Ee),h=c.PAN}else{if(s.enableRotate===!1)return;ve(Ee),h=c.ROTATE}break;case Hc.PAN:if(Ee.ctrlKey||Ee.metaKey||Ee.shiftKey){if(s.enableRotate===!1)return;ve(Ee),h=c.ROTATE}else{if(s.enablePan===!1)return;de(Ee),h=c.PAN}break;default:h=c.NONE}h!==c.NONE&&s.dispatchEvent(vT)}function wn(Ee){if(s.enabled!==!1)switch(h){case c.ROTATE:if(s.enableRotate===!1)return;xe(Ee);break;case c.DOLLY:if(s.enableZoom===!1)return;De(Ee);break;case c.PAN:if(s.enablePan===!1)return;Ce(Ee);break}}function xn(Ee){s.enabled===!1||s.enableZoom===!1||h!==c.NONE||(Ee.preventDefault(),s.dispatchEvent(vT),pe(Ee),s.dispatchEvent(Q3))}function ei(Ee){s.enabled===!1||s.enablePan===!1||xt(Ee)}function ze(Ee){switch(gn(Ee),G.length){case 1:switch(s.touches.ONE){case jc.ROTATE:if(s.enableRotate===!1)return;Ct(),h=c.TOUCH_ROTATE;break;case jc.PAN:if(s.enablePan===!1)return;ct(),h=c.TOUCH_PAN;break;default:h=c.NONE}break;case 2:switch(s.touches.TWO){case jc.DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;zt(),h=c.TOUCH_DOLLY_PAN;break;case jc.DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;Zt(),h=c.TOUCH_DOLLY_ROTATE;break;default:h=c.NONE}break;default:h=c.NONE}h!==c.NONE&&s.dispatchEvent(vT)}function Ae(Ee){switch(gn(Ee),h){case c.TOUCH_ROTATE:if(s.enableRotate===!1)return;Lt(Ee),s.update();break;case c.TOUCH_PAN:if(s.enablePan===!1)return;Re(Ee),s.update();break;case c.TOUCH_DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;nt(Ee),s.update();break;case c.TOUCH_DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;at(Ee),s.update();break;default:h=c.NONE}}function gt(Ee){s.enabled!==!1&&Ee.preventDefault()}function Rt(Ee){G.push(Ee)}function Xt(Ee){delete le[Ee.pointerId];for(let et=0;et<G.length;et++)if(G[et].pointerId==Ee.pointerId){G.splice(et,1);return}}function gn(Ee){let et=le[Ee.pointerId];et===void 0&&(et=new Wt,le[Ee.pointerId]=et),et.set(Ee.pageX,Ee.pageY)}function Tn(Ee){let et=Ee.pointerId===G[0].pointerId?G[1]:G[0];return le[et.pointerId]}s.domElement.addEventListener("contextmenu",gt),s.domElement.addEventListener("pointerdown",St),s.domElement.addEventListener("pointercancel",Pn),s.domElement.addEventListener("wheel",xn,{passive:!1}),this.update()}};var Xh=class extends Ki{constructor(e=document.createElement("div")){super();this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}};Xh.prototype.isCSS2DObject=!0;var uu=new Be,eC=new Jn,tC=new Jn,nC=new Be,iC=new Be,bT=class{constructor(e={}){let t=this,s,c,h,p,r={objects:new WeakMap},x=e.element!==void 0?e.element:document.createElement("div");x.style.overflow="hidden",this.domElement=x,this.getSize=function(){return{width:s,height:c}},this.render=function(I,R){I.autoUpdate===!0&&I.updateMatrixWorld(),R.parent===null&&R.updateMatrixWorld(),eC.copy(R.matrixWorldInverse),tC.multiplyMatrices(R.projectionMatrix,eC),v(I,I,R),A(I)},this.setSize=function(I,R){s=I,c=R,h=s/2,p=c/2,x.style.width=I+"px",x.style.height=R+"px"};function v(I,R,k){if(I.isCSS2DObject){uu.setFromMatrixPosition(I.matrixWorld),uu.applyMatrix4(tC);let L=I.visible===!0&&uu.z>=-1&&uu.z<=1&&I.layers.test(k.layers)===!0;if(I.element.style.display=L===!0?"":"none",L===!0){I.onBeforeRender(t,R,k);let B=I.element;/apple/i.test(navigator.vendor)?B.style.transform="translate(-50%,-50%) translate("+Math.round(uu.x*h+h)+"px,"+Math.round(-uu.y*p+p)+"px)":B.style.transform="translate(-50%,-50%) translate("+(uu.x*h+h)+"px,"+(-uu.y*p+p)+"px)",B.parentNode!==x&&x.appendChild(B),I.onAfterRender(t,R,k)}let z={distanceToCameraSquared:w(k,I)};r.objects.set(I,z)}for(let L=0,z=I.children.length;L<z;L++)v(I.children[L],R,k)}function w(I,R){return nC.setFromMatrixPosition(I.matrixWorld),iC.setFromMatrixPosition(R.matrixWorld),nC.distanceToSquared(iC)}function S(I){let R=[];return I.traverse(function(k){k.isCSS2DObject&&R.push(k)}),R}function A(I){let R=S(I).sort(function(L,z){if(L.renderOrder!==z.renderOrder)return z.renderOrder-L.renderOrder;let B=r.objects.get(L).distanceToCameraSquared,$=r.objects.get(z).distanceToCameraSquared;return B-$}),k=R.length;for(let L=0,z=R.length;L<z;L++)R[L].element.style.zIndex=k-L}}};var rC=new Ts,Mv=new Be,Zg=class extends Hg{constructor(){super();this.type="LineSegmentsGeometry";let e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(s),this.setAttribute("position",new br(e,3)),this.setAttribute("uv",new br(t,2))}applyMatrix4(e){let t=this.attributes.instanceStart,s=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),s.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let s=new lu(t,6,1);return this.setAttribute("instanceStart",new io(s,3,0)),this.setAttribute("instanceEnd",new io(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let s=new lu(t,6,1);return this.setAttribute("instanceColorStart",new io(s,3,0)),this.setAttribute("instanceColorEnd",new io(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new lv(e.geometry)),this}fromLineSegments(e){let t=e.geometry;if(t.isGeometry){console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ts);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),rC.setFromBufferAttribute(t),this.boundingBox.union(rC))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Jo),this.boundingBox===null&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){let s=this.boundingSphere.center;this.boundingBox.getCenter(s);let c=0;for(let h=0,p=e.count;h<p;h++)Mv.fromBufferAttribute(e,h),c=Math.max(c,s.distanceToSquared(Mv)),Mv.fromBufferAttribute(t,h),c=Math.max(c,s.distanceToSquared(Mv));this.boundingSphere.radius=Math.sqrt(c),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}};Zg.prototype.isLineSegmentsGeometry=!0;var ta=class extends Zg{constructor(){super();this.type="LineGeometry"}setPositions(e){let t=e.length-3,s=new Float32Array(2*t);for(let c=0;c<t;c+=3)s[2*c]=e[c],s[2*c+1]=e[c+1],s[2*c+2]=e[c+2],s[2*c+3]=e[c+3],s[2*c+4]=e[c+4],s[2*c+5]=e[c+5];return super.setPositions(s),this}setColors(e){let t=e.length-3,s=new Float32Array(2*t);for(let c=0;c<t;c+=3)s[2*c]=e[c],s[2*c+1]=e[c+1],s[2*c+2]=e[c+2],s[2*c+3]=e[c+3],s[2*c+4]=e[c+4],s[2*c+5]=e[c+5];return super.setColors(s),this}fromLine(e){let t=e.geometry;if(t.isGeometry){console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}};ta.prototype.isLineGeometry=!0;En.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Wt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};js.line={uniforms:pg.merge([En.common,En.fog,En.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var hu=class extends eo{constructor(e){super({type:"LineMaterial",uniforms:pg.clone(js.line.uniforms),vertexShader:js.line.vertexShader,fragmentShader:js.line.fragmentShader,clipping:!0});Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(t){Boolean(t)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}};hu.prototype.isLineMaterial=!0;var sC=new Be,oC=new Be,zs=new Ui,Os=new Ui,ul=new Ui,wT=new Be,TT=new Jn,qs=new qg,aC=new Be,Iv=new Ts,Cv=new Jo,hl=new Ui,dl,ET,lC,Zh;function cC(i,e,t){return hl.set(0,0,-e,1).applyMatrix4(i.projectionMatrix),hl.multiplyScalar(1/hl.w),hl.x=Zh/t.width,hl.y=Zh/t.height,hl.applyMatrix4(i.projectionMatrixInverse),hl.multiplyScalar(1/hl.w),Math.abs(Math.max(hl.x,hl.y))}function p6(i,e){for(let t=0,s=ET.count;t<s;t++){qs.start.fromBufferAttribute(ET,t),qs.end.fromBufferAttribute(lC,t);let c=new Be,h=new Be;dl.distanceSqToSegment(qs.start,qs.end,h,c),h.distanceTo(c)<Zh*.5&&e.push({point:h,pointOnLine:c,distance:dl.origin.distanceTo(h),object:i,face:null,faceIndex:t,uv:null,uv2:null})}}function m6(i,e,t){let s=e.projectionMatrix,h=i.material.resolution,p=i.matrixWorld,r=i.geometry,x=r.attributes.instanceStart,v=r.attributes.instanceEnd,w=-e.near;dl.at(1,ul),ul.w=1,ul.applyMatrix4(e.matrixWorldInverse),ul.applyMatrix4(s),ul.multiplyScalar(1/ul.w),ul.x*=h.x/2,ul.y*=h.y/2,ul.z=0,wT.copy(ul),TT.multiplyMatrices(e.matrixWorldInverse,p);for(let S=0,A=x.count;S<A;S++){if(zs.fromBufferAttribute(x,S),Os.fromBufferAttribute(v,S),zs.w=1,Os.w=1,zs.applyMatrix4(TT),Os.applyMatrix4(TT),zs.z>w&&Os.z>w)continue;if(zs.z>w){let B=zs.z-Os.z,$=(zs.z-w)/B;zs.lerp(Os,$)}else if(Os.z>w){let B=Os.z-zs.z,$=(Os.z-w)/B;Os.lerp(zs,$)}zs.applyMatrix4(s),Os.applyMatrix4(s),zs.multiplyScalar(1/zs.w),Os.multiplyScalar(1/Os.w),zs.x*=h.x/2,zs.y*=h.y/2,Os.x*=h.x/2,Os.y*=h.y/2,qs.start.copy(zs),qs.start.z=0,qs.end.copy(Os),qs.end.z=0;let R=qs.closestPointToPointParameter(wT,!0);qs.at(R,aC);let k=p0.lerp(zs.z,Os.z,R),L=k>=-1&&k<=1,z=wT.distanceTo(aC)<Zh*.5;if(L&&z){qs.start.fromBufferAttribute(x,S),qs.end.fromBufferAttribute(v,S),qs.start.applyMatrix4(p),qs.end.applyMatrix4(p);let B=new Be,$=new Be;dl.distanceSqToSegment(qs.start,qs.end,$,B),t.push({point:$,pointOnLine:B,distance:dl.origin.distanceTo($),object:i,face:null,faceIndex:S,uv:null,uv2:null})}}}var ST=class extends Hr{constructor(e=new Zg,t=new hu({color:Math.random()*16777215})){super(e,t);this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,s=e.attributes.instanceEnd,c=new Float32Array(2*t.count);for(let p=0,r=0,x=t.count;p<x;p++,r+=2)sC.fromBufferAttribute(t,p),oC.fromBufferAttribute(s,p),c[r]=r===0?0:c[r-1],c[r+1]=c[r]+sC.distanceTo(oC);let h=new lu(c,2,1);return e.setAttribute("instanceDistanceStart",new io(h,1,0)),e.setAttribute("instanceDistanceEnd",new io(h,1,1)),this}raycast(e,t){let s=this.material.worldUnits,c=e.camera;c===null&&!s&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');let h=e.params.Line2!==void 0&&e.params.Line2.threshold||0;dl=e.ray;let p=this.matrixWorld,r=this.geometry,x=this.material;Zh=x.linewidth+h,ET=r.attributes.instanceStart,lC=r.attributes.instanceEnd,r.boundingSphere===null&&r.computeBoundingSphere(),Cv.copy(r.boundingSphere).applyMatrix4(p);let v;if(s)v=Zh*.5;else{let S=Math.max(c.near,Cv.distanceToPoint(dl.origin));v=cC(c,S,x.resolution)}if(Cv.radius+=v,dl.intersectsSphere(Cv)===!1)return;r.boundingBox===null&&r.computeBoundingBox(),Iv.copy(r.boundingBox).applyMatrix4(p);let w;if(s)w=Zh*.5;else{let S=Math.max(c.near,Iv.distanceToPoint(dl.origin));w=cC(c,S,x.resolution)}Iv.expandByScalar(w),dl.intersectsBox(Iv)!==!1&&(s?p6(this,t):m6(this,c,t))}};ST.prototype.isLineSegments2=!0;var Ql=class extends ST{constructor(e=new ta,t=new hu({color:Math.random()*16777215})){super(e,t);this.type="Line2"}};Ql.prototype.isLine2=!0;function uC(i){let e=[];for(let x=0;x<i.length;x++)e.push(i[x][0][0].elevation);let t=[Math.min(...e),Math.max(...e)+.1],s=t[0],c=0,h=[],p=0,r=[];for(;s<t[1]&&c<e.length-1;)Math.abs(s-e[c])<Math.abs(s-e[c+1])?h.push(c):h.push(c+1),r.push([c,c+1]),p=s,s+=.1,s>e[c+1]&&c++;return e.length===1&&(h.push(0),r.push([0,0])),{output:h,domain:[e[0],p],range:t,elevations:e,bracket:r}}function hC(i){let e={0:["#242424","#14466c","#0FCBFF","#1D9E00","#95F44C","#FFF700","#FF9F0F","#EB7900","#FF1F1F","#AD1100","#FFB8F5","#CA57FF","#4A009E"],1:["#ffffff","#FC52FF","#871FFF","#0011CC","#0088CC","#B3F0FF","#42FF42","#009402","#A3A3A3","#8A0000","#FF5269","#FFB3E0","#FFF1C2","#FF9214","#B85C00","#572100","#000000"],2:["#ffffff","#FC52FF","#871FFF","#0011CC","#0088CC","#B3F0FF","#42FF42","#009402","#A3A3A3","#8A0000","#FF5269","#FFB3E0","#FFF1C2","#FF9214","#B85C00","#572100","#000000"]},t={0:[0,80],1:[-300,300],2:[-300,300]},s={0:[0,10,20,25,30,35,40,45,50,60,65,70,80],1:[-300,-140,-120,-100,-80,-60,-40,-20,0,20,40,60,80,100,120,140,300],2:[-300,-140,-120,-100,-80,-60,-40,-20,0,20,40,60,80,100,120,140,300]},c=e[i],h=s[i],p=document.createElement("CANVAS");p.width=1200,p.height=1;var r=p.getContext("2d");r.clearRect(0,0,p.width,p.height);var x=r.createLinearGradient(0,0,1200,0),v=t[i][1],w=t[i][0],S=c.length;for(let A=0;A<S;++A)x.addColorStop((h[A]-w)/(v-w),c[A]);return r.fillStyle=x,r.fillRect(0,0,1200,10),r.getImageData(0,0,1200,1)}function AT(i){let e=document.createElement("CANVAS");e.width=100,e.height=50;let t=10,s=e.getContext("2d"),c=0,h=0,p=100,r=50;return i==="selected"&&(s.fillStyle="#0FB7E5"),i==="unselected"&&(s.fillStyle="#949494"),s.beginPath(),s.moveTo(c+t,h),s.lineTo(c+p-t,h),s.quadraticCurveTo(c+p,h,c+p,h+t),s.lineTo(c+p,h+r-t),s.quadraticCurveTo(c+p,h+r,c+p-t,h+r),s.lineTo(c+t,h+r),s.quadraticCurveTo(c,h+r,c,h+r-t),s.lineTo(c,h+t),s.quadraticCurveTo(c,h,c+t,h),s.closePath(),s.fill(),s.getImageData(0,0,p,r)}var MT="http://www.w3.org/1999/xhtml",dC={svg:"http://www.w3.org/2000/svg",xhtml:MT,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function fC(i){var e=i+="",t=e.indexOf(":");return t>=0&&(e=i.slice(0,t))!=="xmlns"&&(i=i.slice(t+1)),dC.hasOwnProperty(e)?{space:dC[e],local:i}:i}function g6(i){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===MT&&e.documentElement.namespaceURI===MT?e.createElement(i):e.createElementNS(t,i)}}function _6(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function pC(i){var e=fC(i);return(e.local?_6:g6)(e)}function y6(){}function mC(i){return i==null?y6:function(){return this.querySelector(i)}}function v6(i){typeof i!="function"&&(i=mC(i));for(var e=this._groups,t=e.length,s=new Array(t),c=0;c<t;++c)for(var h=e[c],p=h.length,r=s[c]=new Array(p),x,v,w=0;w<p;++w)(x=h[w])&&(v=i.call(x,x.__data__,w,h))&&("__data__"in x&&(v.__data__=x.__data__),r[w]=v);return new na(s,this._parents)}function x6(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function b6(){return[]}function w6(i){return i==null?b6:function(){return this.querySelectorAll(i)}}function T6(i){return function(){return x6(i.apply(this,arguments))}}function E6(i){typeof i=="function"?i=T6(i):i=w6(i);for(var e=this._groups,t=e.length,s=[],c=[],h=0;h<t;++h)for(var p=e[h],r=p.length,x,v=0;v<r;++v)(x=p[v])&&(s.push(i.call(x,x.__data__,v,p)),c.push(x));return new na(s,c)}function S6(i){return function(){return this.matches(i)}}function gC(i){return function(e){return e.matches(i)}}var A6=Array.prototype.find;function M6(i){return function(){return A6.call(this.children,i)}}function I6(){return this.firstElementChild}function C6(i){return this.select(i==null?I6:M6(typeof i=="function"?i:gC(i)))}var L6=Array.prototype.filter;function D6(){return Array.from(this.children)}function R6(i){return function(){return L6.call(this.children,i)}}function P6(i){return this.selectAll(i==null?D6:R6(typeof i=="function"?i:gC(i)))}function k6(i){typeof i!="function"&&(i=S6(i));for(var e=this._groups,t=e.length,s=new Array(t),c=0;c<t;++c)for(var h=e[c],p=h.length,r=s[c]=[],x,v=0;v<p;++v)(x=h[v])&&i.call(x,x.__data__,v,h)&&r.push(x);return new na(s,this._parents)}function _C(i){return new Array(i.length)}function z6(){return new na(this._enter||this._groups.map(_C),this._parents)}function Lv(i,e){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=e}Lv.prototype={constructor:Lv,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,e){return this._parent.insertBefore(i,e)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function O6(i){return function(){return i}}function N6(i,e,t,s,c,h){for(var p=0,r,x=e.length,v=h.length;p<v;++p)(r=e[p])?(r.__data__=h[p],s[p]=r):t[p]=new Lv(i,h[p]);for(;p<x;++p)(r=e[p])&&(c[p]=r)}function F6(i,e,t,s,c,h,p){var r,x,v=new Map,w=e.length,S=h.length,A=new Array(w),I;for(r=0;r<w;++r)(x=e[r])&&(A[r]=I=p.call(x,x.__data__,r,e)+"",v.has(I)?c[r]=x:v.set(I,x));for(r=0;r<S;++r)I=p.call(i,h[r],r,h)+"",(x=v.get(I))?(s[r]=x,x.__data__=h[r],v.delete(I)):t[r]=new Lv(i,h[r]);for(r=0;r<w;++r)(x=e[r])&&v.get(A[r])===x&&(c[r]=x)}function B6(i){return i.__data__}function V6(i,e){if(!arguments.length)return Array.from(this,B6);var t=e?F6:N6,s=this._parents,c=this._groups;typeof i!="function"&&(i=O6(i));for(var h=c.length,p=new Array(h),r=new Array(h),x=new Array(h),v=0;v<h;++v){var w=s[v],S=c[v],A=S.length,I=U6(i.call(w,w&&w.__data__,v,s)),R=I.length,k=r[v]=new Array(R),L=p[v]=new Array(R),z=x[v]=new Array(A);t(w,S,k,L,z,I,e);for(var B=0,$=0,H,G;B<R;++B)if(H=k[B]){for(B>=$&&($=B+1);!(G=L[$])&&++$<R;);H._next=G||null}}return p=new na(p,s),p._enter=r,p._exit=x,p}function U6(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function G6(){return new na(this._exit||this._groups.map(_C),this._parents)}function H6(i,e,t){var s=this.enter(),c=this,h=this.exit();return typeof i=="function"?(s=i(s),s&&(s=s.selection())):s=s.append(i+""),e!=null&&(c=e(c),c&&(c=c.selection())),t==null?h.remove():t(h),s&&c?s.merge(c).order():c}function j6(i){for(var e=i.selection?i.selection():i,t=this._groups,s=e._groups,c=t.length,h=s.length,p=Math.min(c,h),r=new Array(c),x=0;x<p;++x)for(var v=t[x],w=s[x],S=v.length,A=r[x]=new Array(S),I,R=0;R<S;++R)(I=v[R]||w[R])&&(A[R]=I);for(;x<c;++x)r[x]=t[x];return new na(r,this._parents)}function W6(){for(var i=this._groups,e=-1,t=i.length;++e<t;)for(var s=i[e],c=s.length-1,h=s[c],p;--c>=0;)(p=s[c])&&(h&&p.compareDocumentPosition(h)^4&&h.parentNode.insertBefore(p,h),h=p);return this}function X6(i){i||(i=q6);function e(S,A){return S&&A?i(S.__data__,A.__data__):!S-!A}for(var t=this._groups,s=t.length,c=new Array(s),h=0;h<s;++h){for(var p=t[h],r=p.length,x=c[h]=new Array(r),v,w=0;w<r;++w)(v=p[w])&&(x[w]=v);x.sort(e)}return new na(c,this._parents).order()}function q6(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function Z6(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function K6(){return Array.from(this)}function Y6(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var s=i[e],c=0,h=s.length;c<h;++c){var p=s[c];if(p)return p}return null}function J6(){let i=0;for(let e of this)++i;return i}function $6(){return!this.node()}function Q6(i){for(var e=this._groups,t=0,s=e.length;t<s;++t)for(var c=e[t],h=0,p=c.length,r;h<p;++h)(r=c[h])&&i.call(r,r.__data__,h,c);return this}function eV(i){return function(){this.removeAttribute(i)}}function tV(i){return function(){this.removeAttributeNS(i.space,i.local)}}function nV(i,e){return function(){this.setAttribute(i,e)}}function iV(i,e){return function(){this.setAttributeNS(i.space,i.local,e)}}function rV(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(i):this.setAttribute(i,t)}}function sV(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,t)}}function oV(i,e){var t=fC(i);if(arguments.length<2){var s=this.node();return t.local?s.getAttributeNS(t.space,t.local):s.getAttribute(t)}return this.each((e==null?t.local?tV:eV:typeof e=="function"?t.local?sV:rV:t.local?iV:nV)(t,e))}function yC(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function aV(i){return function(){this.style.removeProperty(i)}}function lV(i,e,t){return function(){this.style.setProperty(i,e,t)}}function cV(i,e,t){return function(){var s=e.apply(this,arguments);s==null?this.style.removeProperty(i):this.style.setProperty(i,s,t)}}function hV(i,e,t){return arguments.length>1?this.each((e==null?aV:typeof e=="function"?cV:lV)(i,e,t??"")):uV(this.node(),i)}function uV(i,e){return i.style.getPropertyValue(e)||yC(i).getComputedStyle(i,null).getPropertyValue(e)}function dV(i){return function(){delete this[i]}}function fV(i,e){return function(){this[i]=e}}function pV(i,e){return function(){var t=e.apply(this,arguments);t==null?delete this[i]:this[i]=t}}function mV(i,e){return arguments.length>1?this.each((e==null?dV:typeof e=="function"?pV:fV)(i,e)):this.node()[i]}function vC(i){return i.trim().split(/^|\s+/)}function IT(i){return i.classList||new xC(i)}function xC(i){this._node=i,this._names=vC(i.getAttribute("class")||"")}xC.prototype={add:function(i){var e=this._names.indexOf(i);e<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var e=this._names.indexOf(i);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function bC(i,e){for(var t=IT(i),s=-1,c=e.length;++s<c;)t.add(e[s])}function wC(i,e){for(var t=IT(i),s=-1,c=e.length;++s<c;)t.remove(e[s])}function gV(i){return function(){bC(this,i)}}function _V(i){return function(){wC(this,i)}}function yV(i,e){return function(){(e.apply(this,arguments)?bC:wC)(this,i)}}function vV(i,e){var t=vC(i+"");if(arguments.length<2){for(var s=IT(this.node()),c=-1,h=t.length;++c<h;)if(!s.contains(t[c]))return!1;return!0}return this.each((typeof e=="function"?yV:e?gV:_V)(t,e))}function xV(){this.textContent=""}function bV(i){return function(){this.textContent=i}}function wV(i){return function(){var e=i.apply(this,arguments);this.textContent=e??""}}function TV(i){return arguments.length?this.each(i==null?xV:(typeof i=="function"?wV:bV)(i)):this.node().textContent}function EV(){this.innerHTML=""}function SV(i){return function(){this.innerHTML=i}}function AV(i){return function(){var e=i.apply(this,arguments);this.innerHTML=e??""}}function MV(i){return arguments.length?this.each(i==null?EV:(typeof i=="function"?AV:SV)(i)):this.node().innerHTML}function IV(){this.nextSibling&&this.parentNode.appendChild(this)}function CV(){return this.each(IV)}function LV(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function DV(){return this.each(LV)}function RV(i){var e=typeof i=="function"?i:pC(i);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function PV(){return null}function kV(i,e){var t=typeof i=="function"?i:pC(i),s=e==null?PV:typeof e=="function"?e:mC(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),s.apply(this,arguments)||null)})}function zV(){var i=this.parentNode;i&&i.removeChild(this)}function OV(){return this.each(zV)}function NV(){var i=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function FV(){var i=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function BV(i){return this.select(i?FV:NV)}function UV(i){return arguments.length?this.property("__data__",i):this.node().__data__}function VV(i){return function(e){i.call(this,e,this.__data__)}}function GV(i){return i.trim().split(/^|\s+/).map(function(e){var t="",s=e.indexOf(".");return s>=0&&(t=e.slice(s+1),e=e.slice(0,s)),{type:e,name:t}})}function HV(i){return function(){var e=this.__on;if(!!e){for(var t=0,s=-1,c=e.length,h;t<c;++t)h=e[t],(!i.type||h.type===i.type)&&h.name===i.name?this.removeEventListener(h.type,h.listener,h.options):e[++s]=h;++s?e.length=s:delete this.__on}}}function jV(i,e,t){return function(){var s=this.__on,c,h=VV(e);if(s){for(var p=0,r=s.length;p<r;++p)if((c=s[p]).type===i.type&&c.name===i.name){this.removeEventListener(c.type,c.listener,c.options),this.addEventListener(c.type,c.listener=h,c.options=t),c.value=e;return}}this.addEventListener(i.type,h,t),c={type:i.type,name:i.name,value:e,listener:h,options:t},s?s.push(c):this.__on=[c]}}function WV(i,e,t){var s=GV(i+""),c,h=s.length,p;if(arguments.length<2){var r=this.node().__on;if(r){for(var x=0,v=r.length,w;x<v;++x)for(c=0,w=r[x];c<h;++c)if((p=s[c]).type===w.type&&p.name===w.name)return w.value}return}for(r=e?jV:HV,c=0;c<h;++c)this.each(r(s[c],e,t));return this}function TC(i,e,t){var s=yC(i),c=s.CustomEvent;typeof c=="function"?c=new c(e,t):(c=s.document.createEvent("Event"),t?(c.initEvent(e,t.bubbles,t.cancelable),c.detail=t.detail):c.initEvent(e,!1,!1)),i.dispatchEvent(c)}function qV(i,e){return function(){return TC(this,i,e)}}function XV(i,e){return function(){return TC(this,i,e.apply(this,arguments))}}function ZV(i,e){return this.each((typeof e=="function"?XV:qV)(i,e))}function*KV(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var s=i[e],c=0,h=s.length,p;c<h;++c)(p=s[c])&&(yield p)}var YV=[null];function na(i,e){this._groups=i,this._parents=e}function JV(){return this}na.prototype={constructor:na,select:v6,selectAll:E6,selectChild:C6,selectChildren:P6,filter:k6,data:V6,enter:z6,exit:G6,join:H6,merge:j6,selection:JV,order:W6,sort:X6,call:Z6,nodes:K6,node:Y6,size:J6,empty:$6,each:Q6,attr:oV,style:hV,property:mV,classed:vV,text:TV,html:MV,raise:CV,lower:DV,append:RV,insert:kV,remove:OV,clone:BV,datum:UV,on:WV,dispatch:ZV,[Symbol.iterator]:KV};function ro(i){return typeof i=="string"?new na([[document.querySelector(i)]],[document.documentElement]):new na([[i]],YV)}var $V={value:()=>{}};function EC(){for(var i=0,e=arguments.length,t={},s;i<e;++i){if(!(s=arguments[i]+"")||s in t||/[\s.]/.test(s))throw new Error("illegal type: "+s);t[s]=[]}return new Dv(t)}function Dv(i){this._=i}function QV(i,e){return i.trim().split(/^|\s+/).map(function(t){var s="",c=t.indexOf(".");if(c>=0&&(s=t.slice(c+1),t=t.slice(0,c)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:s}})}Dv.prototype=EC.prototype={constructor:Dv,on:function(i,e){var t=this._,s=QV(i+"",t),c,h=-1,p=s.length;if(arguments.length<2){for(;++h<p;)if((c=(i=s[h]).type)&&(c=e8(t[c],i.name)))return c;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++h<p;)if(c=(i=s[h]).type)t[c]=SC(t[c],i.name,e);else if(e==null)for(c in t)t[c]=SC(t[c],i.name,null);return this},copy:function(){var i={},e=this._;for(var t in e)i[t]=e[t].slice();return new Dv(i)},call:function(i,e){if((c=arguments.length-2)>0)for(var t=new Array(c),s=0,c,h;s<c;++s)t[s]=arguments[s+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(h=this._[i],s=0,c=h.length;s<c;++s)h[s].value.apply(e,t)},apply:function(i,e,t){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var s=this._[i],c=0,h=s.length;c<h;++c)s[c].value.apply(e,t)}};function e8(i,e){for(var t=0,s=i.length,c;t<s;++t)if((c=i[t]).name===e)return c.value}function SC(i,e,t){for(var s=0,c=i.length;s<c;++s)if(i[s].name===e){i[s]=$V,i=i.slice(0,s).concat(i.slice(s+1));break}return t!=null&&i.push({name:e,value:t}),i}function t8(i){let e;for(;e=i.sourceEvent;)i=e;return i}function AC(i,e){if(i=t8(i),e===void 0&&(e=i.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var s=t.createSVGPoint();return s.x=i.clientX,s.y=i.clientY,s=s.matrixTransform(e.getScreenCTM().inverse()),[s.x,s.y]}if(e.getBoundingClientRect){var c=e.getBoundingClientRect();return[i.clientX-c.left-e.clientLeft,i.clientY-c.top-e.clientTop]}}return[i.pageX,i.pageY]}var n8={passive:!1},Kg={capture:!0,passive:!1};function CT(i){i.stopImmediatePropagation()}function tp(i){i.preventDefault(),i.stopImmediatePropagation()}function i8(i){var e=i.document.documentElement,t=ro(i).on("dragstart.drag",tp,Kg);"onselectstart"in e?t.on("selectstart.drag",tp,Kg):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function r8(i,e){var t=i.document.documentElement,s=ro(i).on("dragstart.drag",null);e&&(s.on("click.drag",tp,Kg),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in t?s.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}var Rv=i=>()=>i;function LT(i,{sourceEvent:e,subject:t,target:s,identifier:c,active:h,x:p,y:r,dx:x,dy:v,dispatch:w}){Object.defineProperties(this,{type:{value:i,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:c,enumerable:!0,configurable:!0},active:{value:h,enumerable:!0,configurable:!0},x:{value:p,enumerable:!0,configurable:!0},y:{value:r,enumerable:!0,configurable:!0},dx:{value:x,enumerable:!0,configurable:!0},dy:{value:v,enumerable:!0,configurable:!0},_:{value:w}})}LT.prototype.on=function(){var i=this._.on.apply(this._,arguments);return i===this._?this:i};function s8(i){return!i.ctrlKey&&!i.button}function o8(){return this.parentNode}function a8(i,e){return e??{x:i.x,y:i.y}}function l8(){return navigator.maxTouchPoints||"ontouchstart"in this}function Pv(){var i=s8,e=o8,t=a8,s=l8,c={},h=EC("start","drag","end"),p=0,r,x,v,w,S=0;function A(H){H.on("mousedown.drag",I).filter(s).on("touchstart.drag",L).on("touchmove.drag",z,n8).on("touchend.drag touchcancel.drag",B).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function I(H,G){if(!(w||!i.call(this,H,G))){var le=$(this,e.call(this,H,G),H,G,"mouse");!le||(ro(H.view).on("mousemove.drag",R,Kg).on("mouseup.drag",k,Kg),i8(H.view),CT(H),v=!1,r=H.clientX,x=H.clientY,le("start",H))}}function R(H){if(tp(H),!v){var G=H.clientX-r,le=H.clientY-x;v=G*G+le*le>S}c.mouse("drag",H)}function k(H){ro(H.view).on("mousemove.drag mouseup.drag",null),r8(H.view,v),tp(H),c.mouse("end",H)}function L(H,G){if(!!i.call(this,H,G)){var le=H.changedTouches,te=e.call(this,H,G),ue=le.length,me,se;for(me=0;me<ue;++me)(se=$(this,te,H,G,le[me].identifier,le[me]))&&(CT(H),se("start",H,le[me]))}}function z(H){var G=H.changedTouches,le=G.length,te,ue;for(te=0;te<le;++te)(ue=c[G[te].identifier])&&(tp(H),ue("drag",H,G[te]))}function B(H){var G=H.changedTouches,le=G.length,te,ue;for(w&&clearTimeout(w),w=setTimeout(function(){w=null},500),te=0;te<le;++te)(ue=c[G[te].identifier])&&(CT(H),ue("end",H,G[te]))}function $(H,G,le,te,ue,me){var se=h.copy(),Y=AC(me||le,G),ye,Xe,ge;if((ge=t.call(H,new LT("beforestart",{sourceEvent:le,target:A,identifier:ue,active:p,x:Y[0],y:Y[1],dx:0,dy:0,dispatch:se}),te))!=null)return ye=ge.x-Y[0]||0,Xe=ge.y-Y[1]||0,function re(ve,ae,de){var xe=Y,De;switch(ve){case"start":c[ue]=re,De=p++;break;case"end":delete c[ue],--p;case"drag":Y=AC(de||ae,G),De=p;break}se.call(ve,H,new LT(ve,{sourceEvent:ae,subject:ge,target:A,identifier:ue,active:De,x:Y[0]+ye,y:Y[1]+Xe,dx:Y[0]-xe[0],dy:Y[1]-xe[1],dispatch:se}),te)}}return A.filter=function(H){return arguments.length?(i=typeof H=="function"?H:Rv(!!H),A):i},A.container=function(H){return arguments.length?(e=typeof H=="function"?H:Rv(H),A):e},A.subject=function(H){return arguments.length?(t=typeof H=="function"?H:Rv(H),A):t},A.touchable=function(H){return arguments.length?(s=typeof H=="function"?H:Rv(!!H),A):s},A.on=function(){var H=h.on.apply(h,arguments);return H===h?A:H},A.clickDistance=function(H){return arguments.length?(S=(H=+H)*H,A):Math.sqrt(S)},A}function MC(i,e,t){let s=i.slice();return s[29]=e[t],s}function IC(i){let e,t=i[29]+"",s,c,h;return{c(){e=Ie("option"),s=On(t),c=ot(),e.__value=h=i[29],e.value=e.__value},m(p,r){Gt(p,e,r),Q(e,s),Q(e,c)},p:Vn,d(p){p&&Bt(e)}}}function c8(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L,z,B,$,H,G,le,te,ue,me,se,Y,ye,Xe,ge,re,ve,ae=i[5],de=[];for(let xe=0;xe<ae.length;xe+=1)de[xe]=IC(MC(i,ae,xe));return{c(){e=Ie("div"),t=Ie("div"),s=Ie("p"),s.textContent="Edit transparency",c=ot(),h=Ie("div"),p=Ie("button"),p.textContent="Reset",r=ot(),x=Ie("button"),x.textContent="Close",v=ot(),w=Ie("div"),S=Ie("span"),S.textContent="Presets",A=ot(),I=Ie("select");for(let xe=0;xe<de.length;xe+=1)de[xe].c();R=ot(),k=Ie("div"),L=Ie("div"),z=Ie("canvas"),B=ot(),$=Ie("p"),$.textContent="opaque",H=ot(),G=Ie("p"),G.textContent="transparent",le=ot(),te=Ie("canvas"),ue=ot(),me=Ie("div"),se=Ie("p"),se.textContent="Overlays",Y=ot(),ye=Ie("label"),Xe=Ie("input"),ge=On(`
            Z-Axis`),Z(s,"class","title svelte-csvks8"),Z(p,"class","reset svelte-csvks8"),Z(x,"class","close svelte-csvks8"),Z(h,"class","button-container svelte-csvks8"),Z(I,"class","s svelte-csvks8"),i[4]===void 0&&_a(()=>i[10].call(I)),Z(w,"class","preset-container svelte-csvks8"),Z(t,"class","top svelte-csvks8"),Z(z,"class","window svelte-csvks8"),Z($,"class","opaque svelte-csvks8"),Z(G,"class","transparent svelte-csvks8"),Z(L,"class","canvas-wrapper"),Z(te,"class","colorbar svelte-csvks8"),Z(k,"class","window-wrapper svelte-csvks8"),Z(se,"class","title svelte-csvks8"),Z(Xe,"type","checkbox"),Z(ye,"class","overlay-label svelte-csvks8"),Z(me,"id","z-axis"),Z(me,"class","svelte-csvks8"),Z(e,"class","menu3d-wrapper svelte-csvks8"),Rn(e,"hidden",!i[1])},m(xe,De){Gt(xe,e,De),Q(e,t),Q(t,s),Q(t,c),Q(t,h),Q(h,p),Q(h,r),Q(h,x),Q(t,v),Q(t,w),Q(w,S),Q(w,A),Q(w,I);for(let Ce=0;Ce<de.length;Ce+=1)de[Ce].m(I,null);ih(I,i[4]),Q(e,R),Q(e,k),Q(k,L),Q(L,z),i[11](z),Q(L,B),Q(L,$),Q(L,H),Q(L,G),Q(k,le),Q(k,te),i[12](te),Q(e,ue),Q(e,me),Q(me,se),Q(me,Y),Q(me,ye),Q(ye,Xe),Xe.checked=i[0],Q(ye,ge),re||(ve=[mn(p,"click",i[6]),mn(x,"click",i[7]),mn(I,"change",i[10]),mn(I,"change",i[8]),mn(Xe,"change",i[13])],re=!0)},p(xe,De){if(De[0]&32){ae=xe[5];let Ce;for(Ce=0;Ce<ae.length;Ce+=1){let pe=MC(xe,ae,Ce);de[Ce]?de[Ce].p(pe,De):(de[Ce]=IC(pe),de[Ce].c(),de[Ce].m(I,null))}for(;Ce<de.length;Ce+=1)de[Ce].d(1);de.length=ae.length}De[0]&48&&ih(I,xe[4]),De[0]&1&&(Xe.checked=xe[0]),De[0]&2&&Rn(e,"hidden",!xe[1])},i:Vn,o:Vn,d(xe){xe&&Bt(e),Is(de,xe),i[11](null),i[12](null),re=!1,cr(ve)}}}function u8(i,e,t){let{REFLECTIVITY:s,VELOCITY:c,VELOCITY_DEALIASED:h}=yo,p,r,x,v,w=new Array(350),S=[],A,I="Default",R=["Default","Hail","Hurricane","Snow"],{imageData:k=void 0}=e,{showZ:L}=e,{showTrans:z}=e;function B({x:ve,y:ae}){ve=Math.round(ve),ve<10&&(ve=10),ae<10&&(ae=10),ve>360&&(ve=360),ae>210&&(ae=210),S=[ve,ae]}function $({x:ve,y:ae}){ve=Math.round(ve);let de=!1;ve<10&&(ve=10,de=!0),ae<10&&(ae=10),ve>360&&(ve=360,de=!0),ae>210&&(ae=210);let xe=S[1],De=S[0],Ce=Math.abs(ve-De);if(de){S=[ve,ae];return}if(ve-De<0)for(let pe=ve;pe<De;pe++){let xt=ae*((De-pe)/Ce)+xe*((pe-ve)/Ce);w[pe-10]=(Math.min(Math.max(xt,10),210)-10)/200}else for(let pe=De;pe<ve;pe++){let xt=xe*((ve-pe)/Ce)+ae*((pe-De)/Ce);w[pe-10]=(Math.min(Math.max(xt,10),210)-10)/200}ve>=10&&ve<=360&&(w[ve-10]=(Math.min(Math.max(ae,10),210)-10)/200),S=[ve,ae]}function H(){x.clearRect(0,0,p.width,p.height),x.fillStyle="black",x.fillRect(10,10,350,200),x.strokeStyle="white",x.lineWidth=3,x.lineJoin="round",x.lineCap="round",x.beginPath(),x.moveTo(10,w[0]*200+10);for(let ve=1;ve<w.length;ve++)x.lineTo(ve+10,w[ve]*200+10);x.stroke()}function G(){if(!p)return;let ve=window.devicePixelRatio||1;t(2,p.style.width="370px",p),t(2,p.style.height="220px",p),t(2,p.width=p.clientWidth*ve,p),t(2,p.height=p.clientHeight*ve,p),x.scale(ve,ve),A.render(s),H()}function le(){if(!!r){t(3,r.style.width="350px",r),t(3,r.style.height="20px",r),t(3,r.width=r.clientWidth,r),t(3,r.height=r.clientHeight,r),A.render(s),t(9,k=v.getImageData(0,0,350,1));for(let ve=0;ve<w.length;ve++)t(9,k.data[4*ve+3]=255*(1-w[ve]),k)}}function te(){if(A.render(s),v.canvas.width!==0){t(9,k=v.getImageData(0,0,350,1));for(let ve=0;ve<w.length;ve++)t(9,k.data[4*ve+3]=255*(1-w[ve]),k)}}function ue(ve){if(ve==="Snow"){for(let ae=0;ae<15;ae++)w[ae]=1;for(let ae=15;ae<90;ae++)w[ae]=1-Math.pow((ae-15)/200,1.5);for(let ae=90;ae<105;ae++)w[ae]=1;for(let ae=105;ae<350;ae++)w[ae]=1-Math.min(1,Math.pow((ae-105)/200,.35))}if(ve==="Default"){for(let ae=0;ae<25;ae++)w[ae]=1;for(let ae=25;ae<w.length;ae++)w[ae]=Math.min(1-Math.pow(ae/350,1),1)}if(ve==="Hail"){for(let ae=0;ae<15;ae++)w[ae]=1;for(let ae=15;ae<90;ae++)w[ae]=1-Math.pow((ae-15)/200,1.5);for(let ae=90;ae<200;ae++)w[ae]=1;for(let ae=200;ae<270;ae++)w[ae]=1-Math.pow((ae-200)/175,2);for(let ae=270;ae<280;ae++)w[ae]=1;for(let ae=280;ae<350;ae++)w[ae]=1-Math.min(1,Math.pow((ae-280)/200,.15))}if(ve==="Hurricane"){for(let ae=0;ae<15;ae++)w[ae]=1;for(let ae=15;ae<90;ae++)w[ae]=1-Math.pow((ae-15)/200,1.5);for(let ae=90;ae<150;ae++)w[ae]=1;for(let ae=150;ae<350;ae++)w[ae]=1-Math.min(1,Math.pow((ae-150)/200,.35))}}Zs(()=>{new IntersectionObserver(G).observe(p),new IntersectionObserver(le).observe(r),ue("Default"),x=p.getContext("2d"),v=r.getContext("2d",{willReadFrequently:!0});let de=window.devicePixelRatio||1;p.addEventListener("contextmenu",xe=>{xe.preventDefault()}),t(2,p.style.width="370px",p),t(2,p.style.height="220px",p),t(2,p.width=p.clientWidth*de,p),t(2,p.height=p.clientHeight*de,p),x.scale(de,de),t(3,r.style.width="350px",r),t(3,r.style.height="20px",r),t(3,r.width=r.clientWidth,r),t(3,r.height=r.clientHeight,r),A=aM(r,v,de),A.render(s),ro(p).call(Pv().container(p).on("start",B).on("drag",$).on("end",te).on("start.render drag.render",H)),H(),te()});function me(){ue(I),H(),te()}function se(){t(1,z=!1)}function Y(){ue(I),H(),te()}function ye(){I=Em(this),t(4,I),t(5,R)}function Xe(ve){wi[ve?"unshift":"push"](()=>{p=ve,t(2,p)})}function ge(ve){wi[ve?"unshift":"push"](()=>{r=ve,t(3,r)})}function re(){L=this.checked,t(0,L)}return i.$$set=ve=>{"imageData"in ve&&t(9,k=ve.imageData),"showZ"in ve&&t(0,L=ve.showZ),"showTrans"in ve&&t(1,z=ve.showTrans)},[L,z,p,r,I,R,me,se,Y,k,ye,Xe,ge,re]}var CC=class extends gi{constructor(e){super();Ti(this,e,u8,c8,ai,{imageData:9,showZ:0,showTrans:1},null,[-1,-1])}},LC=CC;function DC(i){let e,t,s,c,h,p,r,x;return{c(){e=Ie("div"),t=Ie("p"),s=On(i[6]),c=ot(),h=Ie("div"),p=Ie("p"),r=Ie("i"),x=On(i[8]),Z(e,"class","inc svelte-16kuaxj"),Z(h,"class","notice svelte-16kuaxj")},m(v,w){Gt(v,e,w),Q(e,t),Q(t,s),Gt(v,c,w),Gt(v,h,w),Q(h,p),Q(p,r),Q(r,x)},p(v,w){w[0]&64&&si(s,v[6]),w[0]&256&&si(x,v[8])},d(v){v&&Bt(e),v&&Bt(c),v&&Bt(h)}}}function RC(i){let e,t,s;return{c(){e=Ie("button"),e.innerHTML=`<div class="circle svelte-16kuaxj"></div> 
            <div class="circle svelte-16kuaxj"></div> 
            <div class="circle svelte-16kuaxj"></div>`,Z(e,"class","svelte-16kuaxj")},m(c,h){Gt(c,e,h),t||(s=mn(e,"click",i[12]),t=!0)},p:Vn,d(c){c&&Bt(e),t=!1,s()}}}function PC(i){let e;return{c(){e=Ie("div"),e.innerHTML=`<div class="scene svelte-16kuaxj"><div class="cube svelte-16kuaxj"><div class="cube__face cube__face--front svelte-16kuaxj"></div> 
                <div class="cube__face cube__face--back svelte-16kuaxj"></div> 
                <div class="cube__face cube__face--right svelte-16kuaxj"></div> 
                <div class="cube__face cube__face--left svelte-16kuaxj"></div> 
                <div class="cube__face cube__face--top svelte-16kuaxj"></div> 
                <div class="cube__face cube__face--bottom svelte-16kuaxj"></div></div></div>`,Z(e,"class","loader svelte-16kuaxj")},m(t,s){Gt(t,e,s)},d(t){t&&Bt(e)}}}function h8(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L=i[9]===!1&&kC===!0&&DC(i),z=i[2]===i[10]&&RC(i),B=i[9]===!0&&PC(i);function $(te){i[21](te)}function H(te){i[22](te)}function G(te){i[23](te)}let le={};return i[7]!==void 0&&(le.showTrans=i[7]),i[1]!==void 0&&(le.showZ=i[1]),i[0]!==void 0&&(le.imageData=i[0]),S=new LC({props:le}),wi.push(()=>_o(S,"showTrans",$)),wi.push(()=>_o(S,"showZ",H)),wi.push(()=>_o(S,"imageData",G)),{c(){e=Ie("canvas"),t=ot(),s=Ie("div"),c=Ie("canvas"),h=ot(),p=Ie("div"),r=ot(),L&&L.c(),x=ot(),z&&z.c(),v=ot(),B&&B.c(),w=ot(),mr(S.$$.fragment),Z(e,"class","atlas svelte-16kuaxj"),Z(e,"id","atlas"),Z(e,"width","900"),Z(e,"height","224"),Z(c,"class","can svelte-16kuaxj"),Z(c,"id","can"),Z(p,"class","v svelte-16kuaxj"),Z(s,"class","wrapper svelte-16kuaxj"),Rn(s,"hidden",!(i[2]===i[10]||i[2]===i[11]))},m(te,ue){Gt(te,e,ue),i[19](e),Gt(te,t,ue),Gt(te,s,ue),Q(s,c),i[20](c),Q(s,h),Q(s,p),Q(s,r),L&&L.m(s,null),Q(s,x),z&&z.m(s,null),Q(s,v),B&&B.m(s,null),Q(s,w),dr(S,s,null),i[24](s),k=!0},p(te,ue){te[9]===!1&&kC===!0?L?L.p(te,ue):(L=DC(te),L.c(),L.m(s,x)):L&&(L.d(1),L=null),te[2]===te[10]?z?z.p(te,ue):(z=RC(te),z.c(),z.m(s,v)):z&&(z.d(1),z=null),te[9]===!0?B||(B=PC(te),B.c(),B.m(s,w)):B&&(B.d(1),B=null);let me={};!A&&ue[0]&128&&(A=!0,me.showTrans=te[7],po(()=>A=!1)),!I&&ue[0]&2&&(I=!0,me.showZ=te[1],po(()=>I=!1)),!R&&ue[0]&1&&(R=!0,me.imageData=te[0],po(()=>R=!1)),S.$set(me),ue[0]&3076&&Rn(s,"hidden",!(te[2]===te[10]||te[2]===te[11]))},i(te){k||(ri(S.$$.fragment,te),k=!0)},o(te){mi(S.$$.fragment,te),k=!1},d(te){te&&Bt(e),i[19](null),te&&Bt(t),te&&Bt(s),i[20](null),L&&L.d(),z&&z.d(),B&&B.d(),fr(S),i[24](null)}}}var zC=1e-5,kC=!0;function kv(i,e,t,s){let c=s*(Math.PI/180),h=t*(Math.PI/180),p=e*(Math.PI/180),r=i*(Math.PI/180),x=Math.fround(Math.sin(Math.fround(p))*Math.sin(Math.fround(c)))+Math.fround(Math.cos(Math.fround(p))*Math.cos(Math.fround(c))*Math.cos(Math.fround(h-r))),v=Math.sin(p)*Math.sin(c)+Math.cos(p)*Math.cos(c)*Math.cos(h-r),w=Math.acos(v),S=Math.fround(Math.acos(x)),A=w/Math.sin(w),I=A*Math.cos(c)*Math.sin(h-r)*6371e3,R=A*(Math.cos(p)*Math.sin(c)-Math.sin(p)*Math.cos(c)*Math.cos(h-r))*6371e3;return[I,R]}function OC(i){return i>=315||i<45?1:i>=45&&i<135?2:i>=135&&i<225?3:i>=225&&i<315?4:null}function d8(i,e,t){let s,c,h,p,r,x,v,w;It(i,Xr,$t=>t(2,s=$t)),It(i,Cs,$t=>t(15,c=$t)),It(i,bh,$t=>t(16,h=$t)),It(i,xh,$t=>t(17,p=$t)),It(i,Ya,$t=>t(9,r=$t)),It(i,_i,$t=>t(52,x=$t)),It(i,ni,$t=>t(53,v=$t)),It(i,xo,$t=>t(18,w=$t));let{MODE3D:S,CROSS:A}=vs,I,R,k,L,z,B,$,H,G,le,te="",ue=[],me=[],se,Y,ye,Xe=!1,ge=new Float32Array(108),re=new Float32Array(18),ve=new Float32Array([0,0,0,0,60,0]),ae,de,xe,De,Ce,pe={x:[0,0],y:[0,0],z:[0,0]},xt,Ct,ct={},Qe,zt="",Zt,Lt=!1,Re=!1,qt,nt,at=new Uint8Array([255,255,255,255]),St=new Kc(new Uint8Array([255]),1,1,1);St.format=ng,St.minFilter=Qi,St.magFilter=Qi,St.unpackAlignment=1,St.needsUpdate=!0;let ut=new Kl(at,1,1,ws);ut.minFilter=Qi,ut.magFilter=Qi,ut.unpackAlignment=1,ut.needsUpdate=!0;let Ot=`
        in vec3 position;
        uniform mat4 modelMatrix;
		uniform mat4 modelViewMatrix;
        uniform mat4 projectionMatrix;
        uniform mat4 viewMatrix;

        uniform vec3 u_eye_pos;
        out vec3 outPosition;

        void main() {
            vec3 dif = vec3(position.xyz) - u_eye_pos;

            vec4 outpos = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);
            outPosition = position.xyz;
            gl_Position = outpos;
        }
    `,Pn=`

        precision highp float;
        precision highp sampler3D;

        uniform vec3 u_eye_pos;
        uniform sampler3D volume;
        uniform highp sampler2D table;
        uniform highp sampler2D tf;
        uniform highp sampler2D bracket;
        uniform vec3 u_plane_center;
        uniform vec3 u_plane_normal;

        //values held in texture
        uniform vec2 u_table_domain;
        //for decoding
        uniform float u_table_max;

        uniform float u_scale;
        uniform float u_offset;
        uniform float u_bin1;
        uniform float u_ngates;
        uniform float u_binMax;
        uniform float u_num_elevations;

        in vec3 outPosition;
        out vec4 color;

        float intersect_plane(vec3 dir) {
            float denominator = dot(u_plane_normal, dir);
            if (abs(denominator) > 0.0001) {
                vec3 difference = u_plane_center - u_eye_pos;
                float t = dot(difference, u_plane_normal)/denominator;

                if (t > 0.000000001) {
                    return t;
                }
            }

            return -1.0;
        }

        float lint(vec4 inputs, float c) {
            
            float y0 = inputs.y;
            float y1 = inputs.w;
            float x0 = inputs.x;
            float x1 = inputs.z;
            if (x1 < x0) {
                return 0.0;
            }
            float x = c;
            float y = y0*(1.0-((x-x0)/(x1-x0)))
            + y1*((x-x0)/(x1-x0));

            return y;
        }

        void main() {
            float b = 0.0;
            float newBelow = 0.0;
            float belowVal = 0.0;
            vec4 below = vec4(0,0,0,0);
            vec4 above = vec4(0,0,0,0);
            float elevation = 0.0;
            float d = 0.0;

        

            vec3 p = outPosition;

            
                //spherical radius
               
                vec3 pcopy = p;
                pcopy.y = pcopy.y/3.0;
                float r = sqrt(p.x*p.x + pcopy.y*pcopy.y + p.z*p.z);

                b = mod(degrees(atan(p.z, p.x)) + 90.0, 360.0);

                elevation = degrees(atan(pcopy.y/sqrt(p.x*p.x + p.z*p.z)));
                d = sqrt(r*r - pcopy.y*pcopy.y);

                //advance if above or below highest or lowest elevation
                if (elevation > u_table_domain.y || elevation < u_table_domain.x) {
                    color = vec4(0,0,0,0);
                    return;
                }

                //get idxs of two closest 
                vec4 two = texture(bracket, vec2((elevation - u_table_domain.x)/(u_table_domain.y-u_table_domain.x), 0.0));

                //need number of levels as uniform
                float aboveZ = (two.y*255.0)/u_num_elevations;
                float belowZ = (two.x*255.0)/u_num_elevations;

                above = texture(table, vec2(aboveZ, 0.0));
                below = texture(table, vec2(belowZ, 0.0));

                //elevations above and below in degrees
                float aboveVal = (above.x+above.y*(1.0/255.0))
                        *(u_table_max - u_table_domain.x) + u_table_domain.x;

                belowVal = (below.x+below.y*(1.0/255.0))
                        *(u_table_max - u_table_domain.x) + u_table_domain.x;

                if (elevation < belowVal) {
                    belowZ = (two.x*255.0 - 1.0)/u_num_elevations;
                    aboveZ = (two.y*255.0 - 1.0)/u_num_elevations;
                    above = texture(table, vec2(aboveZ, 0.0));
                    below = texture(table, vec2(belowZ, 0.0));
                    //elevations above and below in degrees
                    aboveVal = (above.x+above.y*(1.0/255.0))
                            *(u_table_max - u_table_domain.x) + u_table_domain.x;
                    belowVal = (below.x+below.y*(1.0/255.0))
                            *(u_table_max - u_table_domain.x) + u_table_domain.x;
                } else if (elevation > aboveVal) {
                    belowZ = (two.x*255.0 + 1.0)/u_num_elevations;
                    aboveZ = (two.y*255.0 + 1.0)/u_num_elevations;
                    above = texture(table, vec2(aboveZ, 0.0));
                    below = texture(table, vec2(belowZ, 0.0));
                    //elevations above and below in degrees
                    aboveVal = (above.x+above.y*(1.0/255.0))
                            *(u_table_max - u_table_domain.x) + u_table_domain.x;
                    belowVal = (below.x+below.y*(1.0/255.0))
                            *(u_table_max - u_table_domain.x) + u_table_domain.x;
                }

                //get whether elevation closer to beam above or below
                float average = (aboveVal + belowVal)/2.0;
                float closestStep = step(average, elevation);

                float newAbove = d/cos(radians(aboveVal));
                newBelow = d/cos(radians(belowVal));

                if (newAbove < u_bin1 || newBelow < u_bin1 || newAbove > u_binMax || newBelow > u_binMax) {
                    color = vec4(0,0,0,0);
                    return;
                } else {
                    newAbove = newAbove - u_bin1;
                    newBelow = newBelow - u_bin1;
                }
                float newVal;
                //was closer to below
                if (closestStep == 0.0) {
                    newVal = texture(volume, vec3(newBelow/u_ngates, b/360.0, belowZ)).r;
                } else { //was closer to above
                    newVal = texture(volume, vec3(newAbove/u_ngates, b/360.0, aboveZ)).r;
                }

                //Needs to be divided by range_max in km
                float valAbove = texture(volume, vec3(newAbove/u_ngates, b/360.0, aboveZ)).r;
                float valBelow = texture(volume, vec3(newBelow/u_ngates, b/360.0, belowZ)).r;

                vec4 forLint = vec4(belowVal, valBelow, aboveVal, valAbove);
                newVal = lint(forLint, elevation);

                float dbzVal = (newVal*255.0 - u_offset)/u_scale;

                if (dbzVal < 10.0) {
                    color = vec4(0,0,0,0);
                    return;
                }

                vec4 val_color = vec4(texture(tf, vec2(max(dbzVal,0.0)/80.0, 0.0)).rgb, 1.0);

                color = val_color;
            

            //color = vec4(t_hit/100.0, 0.0, 0.0, 1.0);
        }
    `,bn=`
        in vec3 position;
        uniform mat4 modelMatrix;
		uniform mat4 modelViewMatrix;
        uniform mat4 projectionMatrix;
        uniform mat4 viewMatrix;
        //uniform mat4 modelMatrix;
        
        //uniform vec3 cameraPos;
        uniform vec3 u_eye_pos;
        uniform vec2 u_radar_pos;
        uniform float u_height_scale;

        //out vec3 vOrigin;
        //out vec3 vDirection;
        out vec3 vray_dir;

        mat4 scaling;

        void main() {


            vec3 pcopy = vec3(position.x, position.y, position.z);
            vec3 dif = pcopy - u_eye_pos;
            vray_dir = dif;
           
            vec4 outpos = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);

            gl_Position = outpos;
        
        }
    `,wn=`
        precision highp float;
        precision highp sampler3D;

        in vec3 vray_dir;
        out vec4 color;

        uniform vec3 u_eye_pos;
        uniform vec2 u_x_domain;
        uniform vec2 u_y_domain;
        uniform vec2 u_z_domain;
        uniform sampler3D volume;
        uniform highp sampler2D table;
        uniform highp sampler2D tf;
        uniform highp sampler2D bracket;

        //values held in texture
        uniform vec2 u_table_domain;
        //for decoding
        uniform float u_table_max;

        uniform float u_scale;
        uniform float u_offset;
        uniform float u_bin1;
        uniform float u_ngates;
        uniform float u_binMax;
        uniform float u_num_elevations;

        vec2 intersect_box(vec3 dir) {
            vec3 inv_dir = 1.0 / dir;

            vec3 box_min = vec3(u_x_domain.x, u_y_domain.x, u_z_domain.x);
            vec3 box_max = vec3(u_x_domain.y, u_y_domain.y, u_z_domain.y);
            
            vec3 tmin_tmp = (box_min - u_eye_pos) * inv_dir;
            vec3 tmax_tmp = (box_max - u_eye_pos) * inv_dir;
            vec3 tmin = min(tmin_tmp, tmax_tmp);
            vec3 tmax = max(tmin_tmp, tmax_tmp);
            float t0 = max(tmin.x, max(tmin.y, tmin.z));
            float t1 = min(tmax.x, min(tmax.y, tmax.z));
            return vec2(t0, t1);
        }


        float lint(vec4 inputs, float c) {
            
            float y0 = inputs.y;
            float y1 = inputs.w;
            float x0 = inputs.x;
            float x1 = inputs.z;
            if (x1 < x0) {
                return 0.0;
            }
            float x = c;
            float y = y0*(1.0-((x-x0)/(x1-x0)))
            + y1*((x-x0)/(x1-x0));

            return y;
        }

        // Pseudo-random number gen from
        // http://www.reedbeta.com/blog/quick-and-easy-gpu-random-numbers-in-d3d11/
        // with some tweaks for the range of values
        float wang_hash(int seed) {
            seed = (seed ^ 61) ^ (seed >> 16);
            seed *= 9;
            seed = seed ^ (seed >> 4);
            seed *= 0x27d4eb2d;
            seed = seed ^ (seed >> 15);
            return float(seed % 2147483647) / float(2147483647);
        }
        

        void main(){
            vec3 ray_dir = normalize(vray_dir);

            vec2 t_hit = intersect_box(ray_dir);
            
            if (t_hit.x > t_hit.y) {
                color = vec4(0,0,0,0);
                return;
            }

            t_hit.x = max(t_hit.x, 0.0);
            
            float b = 0.0;
            float newBelow = 0.0;
            float belowVal = 0.0;
            vec4 below = vec4(0,0,0,0);
            vec4 above = vec4(0,0,0,0);
            float elevation = 0.0;
            
            float d = 0.0;
            float outt = 0.0;
            int broke = 0;
            
            float dt = 0.25;

            //vec3 p = u_eye_pos + (t_hit.x * ray_dir);
            

            //float offset = wang_hash(int(gl_FragCoord.x + 400.0 * gl_FragCoord.y));

            vec3 p = u_eye_pos + (t_hit.x) * ray_dir;

            for (float t = t_hit.x; t < t_hit.y; t += dt) {
                //spherical radius
               
                vec3 pcopy = p;
                pcopy.y = pcopy.y/3.0;
               
                float r = sqrt(p.x*p.x + pcopy.y*pcopy.y + p.z*p.z);

                b = mod(degrees(atan(p.z, p.x)) + 90.0, 360.0);

                elevation = degrees(atan(pcopy.y/sqrt(p.x*p.x + p.z*p.z)));
                d = sqrt(r*r - pcopy.y*pcopy.y);

                //advance if above or below highest or lowest elevation
                if (elevation > u_table_domain.y || elevation < u_table_domain.x) {
                   p += ray_dir * dt;
                   continue;
                }

                //get idxs of two closest 
                vec4 two = texture(bracket, vec2((elevation - u_table_domain.x)/(u_table_domain.y - u_table_domain.x), 0.0));

                //need number of levels as uniform
                float aboveZ = (two.y*255.0)/u_num_elevations;
                float belowZ = (two.x*255.0)/u_num_elevations;

                above = texture(table, vec2(aboveZ, 0.0));
                below = texture(table, vec2(belowZ, 0.0));

                //elevations above and below in degrees
                float aboveVal = (above.x+above.y*(1.0/255.0))
                        *(u_table_max - u_table_domain.x) + u_table_domain.x;

                belowVal = (below.x+below.y*(1.0/255.0))
                        *(u_table_max - u_table_domain.x) + u_table_domain.x;


                if (elevation < belowVal) {
                    belowZ = (two.x*255.0 - 1.0)/u_num_elevations;
                    aboveZ = (two.y*255.0 - 1.0)/u_num_elevations;
                    above = texture(table, vec2(aboveZ, 0.0));
                    below = texture(table, vec2(belowZ, 0.0));
                    //elevations above and below in degrees
                    aboveVal = (above.x+above.y*(1.0/255.0))
                            *(u_table_max - u_table_domain.x) + u_table_domain.x;
                    belowVal = (below.x+below.y*(1.0/255.0))
                            *(u_table_max - u_table_domain.x) + u_table_domain.x;
                } else if (elevation > aboveVal) {
                    belowZ = (two.x*255.0 + 1.0)/u_num_elevations;
                    aboveZ = (two.y*255.0 + 1.0)/u_num_elevations;
                    above = texture(table, vec2(aboveZ, 0.0));
                    below = texture(table, vec2(belowZ, 0.0));
                    //elevations above and below in degrees
                    aboveVal = (above.x+above.y*(1.0/255.0))
                            *(u_table_max - u_table_domain.x) + u_table_domain.x;
                    belowVal = (below.x+below.y*(1.0/255.0))
                            *(u_table_max - u_table_domain.x) + u_table_domain.x;
                }

                float newAbove = d/cos(radians(aboveVal));
                newBelow = d/cos(radians(belowVal));

                //if (newAbove < u_bin1 || newBelow < u_bin1) {
                if (newAbove < u_bin1 || newBelow < u_bin1 || newAbove > u_binMax || newBelow > u_binMax) {
                    p += ray_dir * dt;
                    continue;
                } else {
                    newAbove = newAbove - u_bin1;
                    newBelow = newBelow - u_bin1;
                }

                //Needs to be divided by range_max in km
                float valAbove = texture(volume, vec3(newAbove/u_ngates, b/360.0, aboveZ)).r;
                float valBelow = texture(volume, vec3(newBelow/u_ngates, b/360.0, belowZ)).r;

                vec4 forLint = vec4(belowVal, valBelow, aboveVal, valAbove);
                float newVal = lint(forLint, elevation);

                float dbzVal = (newVal*255.0 - u_offset)/u_scale;

                vec4 val_color = vec4(texture(tf, vec2(max(dbzVal,0.0)/80.0, 0.0)).rgba);
                float alpha = 1.0-pow((1.0 - val_color.a),0.3);
                //float alpha = 1.0 - (1.0 - val_color.a);
                color.rgb += (1.0 - color.a) * alpha * val_color.rgb;
                color.a += (1.0 - color.a) * alpha;

                if (color.a >= 0.95) {
                    break;
                }
                p += ray_dir * dt;  
            } 
        }
    `;function xn(){s===S&&(Tn.clear(),L.remove(B),ue.forEach($t=>L.remove($t)),me.forEach($t=>L.remove($t)),gt(),L.remove(de),L.add(z),t(6,te="Drag bounding box on map.")),s===A&&(t(7,Xe=!1),Tn.clear(),L.remove(z),gt(),L.remove(de),me.forEach($t=>L.remove($t)),L.add(B),t(6,te="Drag line on map.")),s!=A&&s!=S&&(Re=!1)}function ei($t=s){if(L&&Tn){if(Tn.clear(),gt(),me.forEach(kn=>L.remove(kn)),L.remove(de),$t===S){L.remove(z);for(let kn=0;kn<ge.length;kn++)z.geometry.attributes.position.needsUpdate=!0,z.geometry.attributes.position.array[kn]=0}else{L.remove(B);for(let kn=0;kn<re.length;kn++)B.geometry.attributes.position.needsUpdate=!0,B.geometry.attributes.position.array[kn]=0}$t===A&&ue.forEach(kn=>L.remove(kn))}}function ze(){if(h===null||!w.lat||!w.lon)return;L.getObjectByName("meshPlane")||L.add(B);let $t=h[0],kn=h[1],Un=kv(w.lon,w.lat,$t.lng,$t.lat),Yn=kv(w.lon,w.lat,kn.lng,kn.lat),Ft=Yn[0]/1e3,he=Un[0]/1e3,X=-Un[1]/1e3,N=-Yn[1]/1e3,K=6e4/1e3,ne=0,oe=[Ft-he,N-X],be=[(Ft+he)/2,(N+X)/2,K/3],Fe;if(Math.abs(oe[0])<zC)Fe=[1,0,0];else if(Math.abs(oe[1])<zC)Fe=[0,1,0];else{let cn=[1,-oe[0]/oe[1]],In=Math.sqrt(cn[0]*cn[0]+cn[1]*cn[1]);Fe=[cn[0]/In,cn[1]/In,0]}oe[0]*-Fe[1]+oe[1]*Fe[0]>0&&(Fe=Fe.map(cn=>-cn));let Ke=new Float32Array([he,ne,X,Ft,ne,N,he,K,X,he,K,X,Ft,ne,N,Ft,K,N]);B.geometry.attributes.position.needsUpdate=!0;for(let cn=0;cn<Ke.length;cn++)B.geometry.attributes.position.array[cn]=Ke[cn];let rt=Ft-he,Pt=N-X,_t=Math.sqrt(rt*rt+Pt*Pt),Jt=K,Ht;if(et&&Ee){if(_t>Jt){let cn=Math.atan(Math.tan(Ee.fov*Math.PI/180/2)*Ee.aspect);Ht=_t/2/Math.tan(cn)}else Ht=Jt/2/Math.tan(Ee.fov*Math.PI/180/2);Ht*=1.33,Ee.position.set(be[0]+Fe[0]*Ht,be[2]+Fe[2]*Ht,be[1]+Fe[1]*Ht),et.target=new Be(be[0],be[2],be[1]),B.material.uniforms.u_plane_normal.value=new Be(Fe[0],Fe[2],Fe[1]),B.material.uniforms.u_plane_center.value=new Be(be[0],be[2],be[1]),et.update(),ue[0].position.copy(new Be(he,ne,X)),ue[1].position.copy(new Be(Ft,ne,N)),L.getObjectByName("A")||ue.forEach(cn=>L.add(cn)),pe.x=[he,Ft],pe.y=[X,N],pe.z=[ne,K]}(s===A||s===S)&&Lt&&!L.getObjectByName("zAxis")&&Lt&&L.add(de),Re=!0,tn(!0,[he,ne,X])}function Ae($t){let kn=L.getObjectByName($t);kn&&(kn.children&&kn.children.forEach(Un=>{Un.geometry.dispose(),Un.material.dispose()}),L.remove(kn))}function gt($t=!1){if(Ae("ticks"),$t){let kn=new Zl;return kn.name="ticks",kn}return null}function Rt($t,kn=!1,Un=null){let Yn=2,Ft=1.5;if(!(OC($t)===Zt&&!kn)){if(Un){let he=[pe.x[1]-pe.x[0],pe.y[1]-pe.y[0]],X=Math.sqrt(he[0]*he[0]+he[1]*he[1]),N=[he[0]/X,he[1]/X],K=gt(!0);Zt=OC($t);let ne=[Un[0]-N[0]*Ft,pe.z[0],Un[2]-N[1]*Ft,Un[0]-N[0]*Ft,pe.z[1],Un[2]-N[1]*Ft],oe=0,be=0,Fe=0;for(;oe<=pe.z[1]/3;){oe%4==0&&(me[Fe].position.copy(new Be(Un[0]-N[0]*Yn-N[0]*Ft,oe*3,Un[2]-N[1]*Yn-N[1]*Ft)),L.getObjectByName(oe.toString())||L.add(me[Fe]),Fe++);let Ne=[];Ne.push(Un[0]-N[0]*Ft,oe*3,Un[2]-N[1]*Ft),be%2==0?Ne.push(Un[0]-N[0]*Yn-N[0]*Ft,oe*3,Un[2]-N[1]*Yn-N[1]*Ft):Ne.push(Un[0]-N[0]*Yn/2-N[0]*Ft,oe*3,Un[2]-N[1]*Yn/2-N[1]*Ft),be++,oe+=2;let Ke=new ta;Ke.setPositions(Ne);let rt=new Ql(Ke,ae);K.add(rt)}me[me.length-1].position.copy(new Be(Un[0]-N[0]*Ft,-4,Un[2]-N[1]*Ft)),L.getObjectByName("title")||L.add(me[me.length-1]),de.geometry.setPositions(new Float32Array(ne)),L.add(K),de.geometry.attributes.position.needsUpdate=!0,de.computeLineDistances(),de.scale.set(1,1,1);return}if(s!==A){if($t>=315||$t<45){let he=gt(!0);Zt=1;let X=[pe.x[0]-Ft,pe.z[0],pe.y[1],pe.x[0]-Ft,pe.z[1],pe.y[1]],N=0,K=0,ne=0;for(;N<=pe.z[1]/3;){N%4==0&&(me[ne].position.copy(new Be(pe.x[0]-Ft-Yn,N*3,pe.y[1])),L.getObjectByName(N.toString())||L.add(me[ne]),ne++);let oe=[];oe.push(pe.x[0]-Ft,N*3,pe.y[1]),K%2==0?oe.push(pe.x[0]-Ft-Yn,N*3,pe.y[1]):oe.push(pe.x[0]-Ft-Yn/1.5,N*3,pe.y[1]),K++,N+=2;let be=new ta;be.setPositions(oe);let Fe=new Ql(be,ae);he.add(Fe)}me[me.length-1].position.copy(new Be(pe.x[0]-Ft,-4,pe.y[1])),L.getObjectByName("title")||L.add(me[me.length-1]),de.geometry.setPositions(new Float32Array(X)),L.add(he)}else if($t>=45&&$t<135){let he=gt(!0);Zt=2;let X=[pe.x[0],pe.z[0],pe.y[0]-Ft,pe.x[0],pe.z[1],pe.y[0]-Ft],N=0,K=0,ne=0;for(;N<=pe.z[1]/3;){N%4==0&&(me[ne].position.copy(new Be(pe.x[0],N*3,pe.y[0]-Ft-Yn)),L.getObjectByName(N.toString())||L.add(me[ne]),ne++);let oe=[];oe.push(pe.x[0],N*3,pe.y[0]-Ft),K%2==0?oe.push(pe.x[0],N*3,pe.y[0]-Ft-Yn):oe.push(pe.x[0],N*3,pe.y[0]-Ft-Yn/1.5),K++,N+=2;let be=new ta;be.setPositions(oe);let Fe=new Ql(be,ae);he.add(Fe)}me[me.length-1].position.copy(new Be(pe.x[0],-4,pe.y[0]-Ft)),L.getObjectByName("title")||L.add(me[me.length-1]),de.geometry.setPositions(X),L.add(he)}else if($t>=135&&$t<225){let he=gt(!0);Zt=3;let X=[pe.x[1]+Ft,pe.z[0],pe.y[0],pe.x[1]+Ft,pe.z[1],pe.y[0]],N=0,K=0,ne=0;for(;N<=pe.z[1]/3;){N%4==0&&(me[ne].position.copy(new Be(pe.x[1]+Ft+Yn,N*3,pe.y[0])),L.getObjectByName(N.toString())||L.add(me[ne]),ne++);let oe=[];oe.push(pe.x[1]+Ft,N*3,pe.y[0]),K%2==0?oe.push(pe.x[1]+Ft+Yn,N*3,pe.y[0]):oe.push(pe.x[1]+Ft+Yn/1.5,N*3,pe.y[0]),K++,N+=2;let be=new ta;be.setPositions(oe);let Fe=new Ql(be,ae);he.add(Fe)}me[me.length-1].position.copy(new Be(pe.x[1]+Ft,-4,pe.y[0])),L.getObjectByName("title")||L.add(me[me.length-1]),de.geometry.setPositions(X),L.add(he)}else if($t>=225&&$t<315){let he=gt(!0);Zt=4;let X=[pe.x[1],pe.z[0],pe.y[1]+Ft,pe.x[1],pe.z[1],pe.y[1]+Ft],N=0,K=0,ne=0;for(;N<=pe.z[1]/3;){N%4==0&&(me[ne].position.copy(new Be(pe.x[1],N*3,pe.y[1]+Ft+Yn)),L.getObjectByName(N.toString())||L.add(me[ne]),ne++);let oe=[];oe.push(pe.x[1],N*3,pe.y[1]+Ft),K%2==0?oe.push(pe.x[1],N*3,pe.y[1]+Ft+Yn):oe.push(pe.x[1],N*3,pe.y[1]+Ft+Yn/1.5),K++,N+=2;let be=new ta;be.setPositions(oe);let Fe=new Ql(be,ae);he.add(Fe)}me[me.length-1].position.copy(new Be(pe.x[1],-4,pe.y[1]+Ft)),L.getObjectByName("title")||L.add(me[me.length-1]),de.geometry.setPositions(X),L.add(he)}de.geometry.attributes.position.needsUpdate=!0,de.computeLineDistances(),de.scale.set(1,1,1)}}}function Xt(){if(p===null||!w.lat||!w.lon)return;L.getObjectByName("mesh")||L.add(z);let $t=p[0],kn=p[1],Un=kv(w.lon,w.lat,$t.lng,$t.lat),Yn=kv(w.lon,w.lat,kn.lng,kn.lat),Ft=Yn[0]/1e3,he=Un[0]/1e3,X=-Un[1]/1e3,N=-Yn[1]/1e3,K=6e4/1e3,ne=0;pe.x=[he,Ft],pe.y=[X,N],pe.z=[ne,K];let oe=(X+N)/2,be=(he+Ft)/2;z.material.uniforms.u_x_domain.value=new Wt(he,Ft),z.material.uniforms.u_y_domain.value=new Wt(ne,K),z.material.uniforms.u_z_domain.value=new Wt(X,N);let Fe=new Float32Array([he,ne,N,Ft,ne,N,he,K,N,he,K,N,Ft,ne,N,Ft,K,N,Ft,ne,N,Ft,ne,X,Ft,K,N,Ft,K,N,Ft,ne,X,Ft,K,X,Ft,ne,X,he,ne,X,Ft,K,X,Ft,K,X,he,ne,X,he,K,X,he,ne,X,he,ne,N,he,K,X,he,K,X,he,ne,N,he,K,N,Ft,K,X,he,K,X,Ft,K,N,Ft,K,N,he,K,X,he,K,N,Ft,ne,N,he,ne,N,Ft,ne,X,Ft,ne,X,he,ne,N,he,ne,X]),Ne=new Float32Array([he,ne,N,Ft,ne,N,Ft,K,N,he,K,N,he,ne,X,he,K,X,Ft,K,X,Ft,ne,X,he,K,X,he,K,N,Ft,K,N,Ft,K,X,he,ne,X,Ft,ne,X,Ft,ne,N,he,ne,N,Ft,ne,X,Ft,K,X,Ft,K,N,Ft,ne,N,he,ne,X,he,ne,N,he,K,N,he,K,X]),Ke=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];z.geometry.attributes.position.needsUpdate=!0;for(let rt=0;rt<Fe.length;rt++)z.geometry.attributes.position.array[rt]=Fe[rt];if(et&&Ee){let rt=Math.abs(he-Ft),Pt=Math.abs(X-N),_t=Math.max(Math.max(rt,Pt)*1.8,60);Ee.position.set(be,20,oe+_t),et.target=new Be(be,20,oe),et.update()}Re=!0,(s===A||s===S)&&Lt&&!L.getObjectByName("zAxis")&&Lt&&L.add(de),tn(!0)}function gn(){let $t,kn,Un,Yn,Ft,he,X,N=c[x[0].file];if(N&&N.float&&N.size)$t=N.float,kn=N.size,Un=N.scale,Yn=N.offset,Ft=N.bin1,he=N.binMax,X=N.ngates;else return;let K=uC(v[x[0].file].scans);if(qt&&K.elevations.length===qt.length&&nt===N.fileName)return;qt=K.elevations,nt=N.fileName,qt.length<2?(on(Ya,r=!1,r),(s===S||s===A)&&tn(),t(8,zt="Not enough sweeps to render 3D.")):t(8,zt="");let ne=999,oe=-999;for(let Ht=0;Ht<$t.length;Ht++)$t[Ht]>oe&&(oe=$t[Ht]),$t[Ht]<ne&&(ne=$t[Ht]);H&&H.dispose(),H=new Kc($t,kn[0],kn[1],kn[2]),H.format=ng,H.minFilter=bs,H.magFilter=bs,H.wrapS=Ih,H.wrapT=Ih,H.unpackAlignment=1,H.needsUpdate=!0,z.material.uniforms.volume.value=H,B.material.uniforms.volume.value=H;let be=K.output,Fe=K.domain,Ne=K.elevations,Ke=K.bracket,rt=K.range;z.material.uniforms.u_table_domain.value=Fe,z.material.uniforms.u_table_max.value=rt[1],z.material.uniforms.u_scale.value=Un,z.material.uniforms.u_offset.value=Yn,z.material.uniforms.u_bin1.value=Ft/1e3,z.material.uniforms.u_ngates.value=X,z.material.uniforms.u_binMax.value=he/1e3,z.material.uniforms.u_num_elevations.value=kn[2]-1,B.material.uniforms.u_table_domain.value=Fe,B.material.uniforms.u_table_max.value=rt[1],B.material.uniforms.u_scale.value=Un,B.material.uniforms.u_offset.value=Yn,B.material.uniforms.u_bin1.value=Ft/1e3,B.material.uniforms.u_ngates.value=X,B.material.uniforms.u_binMax.value=he/1e3,B.material.uniforms.u_num_elevations.value=kn[2]-1;let Pt=hC(0),_t=new Uint8Array(Ne.length*4),Jt=new Uint8Array(be.length*4);for(let Ht=0;Ht<Ne.length;Ht++){let cn=(Ne[Ht]-rt[0])/(rt[1]-rt[0]),In=cn*255,Wn=Math.floor(cn*255)/255,$n=In%1,hn=Math.floor($n*255),yi=Wn*255;_t[Ht*4]=yi,_t[Ht*4+1]=hn}for(let Ht=0;Ht<Ke.length;Ht++)Jt[Ht*4]=Ke[Ht][0],Jt[Ht*4+1]=Ke[Ht][1];G&&G.dispose(),G=new Kl(_t,Ne.length,1,ws),Y&&Y.dispose(),se&&se.dispose(),se=new Kl(ye.data,ye.data.length/4,1,ws),Y=new Kl(Pt.data,Pt.data.length/4,1,ws),le&&le.dispose(),le=new Kl(Jt,be.length,1,ws),G.minFilter=Qi,G.magFilter=Qi,G.unpackAlignment=1,G.needsUpdate=!0,se.minFilter=Qi,se.magFilter=Qi,se.unpackAlignment=1,se.needsUpdate=!0,Y.minFilter=Qi,Y.magFilter=Qi,Y.unpackAlignment=1,Y.needsUpdate=!0,le.minFilter=Qi,le.magFilter=Qi,le.unpackAlignment=1,le.needsUpdate=!0,z.material.uniforms.table.value=G,z.material.uniforms.tf.value=se,z.material.uniforms.bracket.value=le,B.material.uniforms.table.value=G,B.material.uniforms.tf.value=Y,B.material.uniforms.bracket.value=le,on(Ya,r=!1,r),(s===S||s===A)&&tn()}let Tn,Ee,et,rn;function tn($t=!1,kn=null){let Un;if(Ee){let Yn=new Be;Ee.getWorldDirection(Yn),Yn.y=0,Yn.normalize(),Un=Math.atan2(Yn.x,-Yn.z)*(180/Math.PI),Un&&Un<0&&(Un+=360)}z&&s===S?(z.material=xe,Tn.render(L,Ee),z.material=De,z.material.uniforms.u_eye_pos.value.copy(Ee.position),Lt&&Re&&Rt(Un,$t)):B&&s===A&&(B.material.uniforms.u_eye_pos.value.copy(Ee.position),Lt&&Re&&Rt(Un,$t,kn)),Tn.render(L,Ee),$.render(L,Ee)}function Je(){!I||(Ee.aspect=I.clientWidth/I.clientHeight,Ee.updateProjectionMatrix(),Tn.setSize(I.clientWidth,I.clientHeight),$.setSize(I.clientWidth,I.clientHeight),tn())}function sn($t){let kn=new er,Un=new Float32Array([-1,1,0,0,1,0,-1,-1,0,0,1,0,0,-1,0,-1,-1,0,0,1,0,1,1,0,0,-1,0,1,1,0,1,-1,0,0,-1,0]),Yn=[];for(let Ft=0;Ft<$t.length;Ft++){let he=ct[$t[Ft]].x,X=ct[$t[Ft]].y,N=ct[$t[Ft]].width,K=ct[$t[Ft]].height;Yn.push(he,X,he+N,X,he,X+K,he+N,X,he+N,X+K,he,X+K)}return kn.setAttribute("position",new xr(Un,3)),kn.setAttribute("uv",new xr(new Float32Array(Yn),2)),kn}let nn=`
        precision highp float;
        in vec3 position;
        in vec2 uv;

        //uniform mat4 modelMatrix;
		uniform mat4 modelViewMatrix;
        uniform mat4 projectionMatrix;
        //uniform mat4 viewMatrix;

        uniform vec2 res;
       

        out vec2 vUv;

        void main() {
            vUv = uv/res;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    
    `,An=`
        precision highp float;
        precision highp sampler2D;
        in vec2 vUv;
        uniform highp sampler2D atlas;

        out vec4 fragColor;

        void main() {
           float distance = texture(atlas, vUv).r;
           float alpha = smoothstep(0.5-0.01, 0.5+0.01, distance);
           fragColor = vec4(1.0,1.0,1.0,alpha);
        }
     
    
    `;Zs(()=>{new IntersectionObserver(Je).observe(I),Tn=new sr({canvas:I,antialias:!0});let kn=document.getElementById("can");Tn.setSize(kn.clientWidth,kn.clientHeight);let Un=Tn.getContext();Un.blendFuncSeparate(Un.SRC_ALPHA,Un.ONE_MINUS_SRC_ALPHA,Un.ONE,Un.ONE),Un.enable(Un.BLEND),Ee=new Ss(75,kn.clientWidth/kn.clientHeight,.001,1e3),Ee.position.set(100,0,100),Ee.near=.1,$=new bT,$.setSize(kn.clientWidth,kn.clientHeight),$.domElement.style.position="absolute",$.domElement.style.top="0px",$.domElement.style.pointerEvents="none",R.appendChild($.domElement);let Yn=document.createElement("div");Yn.className="crosslabel",Yn.textContent="A";let Ft=document.createElement("div");Ft.className="crosslabel",Ft.textContent="B",ue.push(new Xh(Yn)),ue.push(new Xh(Ft)),ue[0].name="A",ue[1].name="B";for(let Fe=0;Fe<=20;Fe+=4){let Ne=document.createElement("div");Ne.className="axis-label",Ne.textContent=Fe.toString(),me.push(new Xh(Ne)),me[me.length-1].name=Fe.toString()}let he=document.createElement("div");he.className="axis-label",he.textContent="[km]",me.push(new Xh(he)),me[me.length-1].name="title",L=new Hf,L.background=new jn(7368816),et=new xT(Ee,Tn.domElement),et.target=new Be(0,0,0),et.enableZoom=!0;let X=new rl(10,10,10),N=new Xl({color:65280,wireframe:!1});rn=new Hr(X,N),rn.position.set(0,0,0);let K=new Av(50);xe=new Xl({side:el}),De=new Hh({glslVersion:bf,uniforms:{volume:{value:St},u_eye_pos:{value:new Be},u_x_domain:{value:new Wt},u_y_domain:{value:new Wt},u_z_domain:{value:new Wt},u_table_domain:{value:new Wt},u_table_max:{value:0},u_radar_pos:{value:new Wt},u_height_scale:{value:0},u_scale:{value:0},u_offset:{value:0},u_bin1:{value:0},u_ngates:{value:0},u_binMax:{value:0},u_num_elevations:{value:0},table:{value:ut},tf:{value:ut},bracket:{value:ut}},vertexShader:bn,fragmentShader:wn,transparent:!0,side:To,depthWrite:!0,depthTest:!0});let ne=new Hh({glslVersion:bf,uniforms:{volume:{value:St},u_eye_pos:{value:new Be},u_plane_center:{value:new Be},u_plane_normal:{value:new Be},u_table_domain:{value:new Wt},u_table_max:{value:0},u_radar_pos:{value:new Wt},u_height_scale:{value:0},u_scale:{value:0},u_offset:{value:0},u_bin1:{value:0},u_ngates:{value:0},u_binMax:{value:0},u_num_elevations:{value:0},table:{value:ut},tf:{value:ut},bracket:{value:ut}},vertexShader:Ot,fragmentShader:Pn,transparent:!0,side:el}),oe=new er,be=new er;oe.setAttribute("position",new xr(ge,3)),be.setAttribute("position",new xr(re,3)),z=new Hr(oe,De),z.frustumCulled=!1,B=new Hr(be,ne),B.frustumCulled=!1,B.name="meshPlane",z.name="mesh",Ce=new ta,Ce.setPositions(ve),ae=new hu({color:15461355,linewidth:1.5,vertexColors:!1,worldUnits:!1,dashed:!1,alphaToCoverage:!0,depthTest:!0,depthWrite:!0,resolution:new Wt(kn.clientWidth,kn.clientHeight)}),de=new Ql(Ce,ae),de.name="zAxis",de.computeLineDistances(),de.scale.set(1,1,1),et.addEventListener("change",Fe=>tn(!1,null,Fe)),tn()});function Et(){if(se){se.needsUpdate=!0;let $t=ye.data,kn=se.image.data,Un=se.image.width*se.image.height;for(let Yn=0;Yn<Un;Yn++){let Ft=Yn*4;kn[Ft]=$t[Ft],kn[Ft+1]=$t[Ft+1],kn[Ft+2]=$t[Ft+2],kn[Ft+3]=$t[Ft+3]}tn()}}function Dn(){L&&Lt?(L.getObjectByName("zAxis")||L.add(de),s===A&&tn(!0,[pe.x[0],pe.z[0],pe.y[0]]),s===S&&tn(!0)):L&&!Lt&&(me.forEach($t=>L.remove($t)),gt(),L.remove(de),tn())}function un(){t(7,Xe=!Xe)}function Nn($t){wi[$t?"unshift":"push"](()=>{k=$t,t(5,k)})}function Kn($t){wi[$t?"unshift":"push"](()=>{I=$t,t(3,I)})}function Gn($t){Xe=$t,t(7,Xe)}function Ei($t){Lt=$t,t(1,Lt)}function ln($t){ye=$t,t(0,ye)}function li($t){wi[$t?"unshift":"push"](()=>{R=$t,t(4,R)})}return i.$$.update=()=>{if(i.$$.dirty[0]&262144){e:ei()}if(i.$$.dirty[0]&4){e:xn()}if(i.$$.dirty[0]&131072){e:Xt()}if(i.$$.dirty[0]&65536){e:ze()}if(i.$$.dirty[0]&32768){e:gn()}if(i.$$.dirty[0]&1){e:Et()}if(i.$$.dirty[0]&2){e:Dn()}},[ye,Lt,s,I,R,k,te,Xe,zt,r,S,A,un,ei,gn,c,h,p,w,Nn,Kn,Gn,Ei,ln,li]}var NC=class extends gi{constructor(e){super();Ti(this,e,d8,h8,ai,{removeMeshes:13,loadTexture:14},null,[-1,-1,-1])}get removeMeshes(){return this.$$.ctx[13]}get loadTexture(){return this.$$.ctx[14]}},FC=NC;function BC(i,e,t){let s=i.slice();return s[27]=e[t],s}function UC(i,e,t){let s=i.slice();return s[30]=e[t],s[32]=t,s}function VC(i){let e,t,s;function c(r,x){return r[6]?p8:f8}let h=c(i,[-1,-1]),p=h(i);return{c(){e=Ie("button"),p.c(),Z(e,"class","chevron-button svelte-srv42e")},m(r,x){Gt(r,e,x),p.m(e,null),t||(s=mn(e,"click",i[7]),t=!0)},p(r,x){h!==(h=c(r,x))&&(p.d(1),p=h(r),p&&(p.c(),p.m(e,null)))},d(r){r&&Bt(e),p.d(),t=!1,s()}}}function f8(i){let e,t;return{c(){e=ii("svg"),t=ii("path"),Z(t,"d","m6 9 6 6 6-6"),Z(e,"xmlns","http://www.w3.org/2000/svg"),Z(e,"width","18"),Z(e,"height","18"),Z(e,"viewBox","0 0 24 24"),Z(e,"fill","none"),Z(e,"stroke","currentColor"),Z(e,"stroke-width","2"),Z(e,"stroke-linecap","round"),Z(e,"stroke-linejoin","round"),Z(e,"class","lucide lucide-chevron-down button-svg down svelte-srv42e")},m(s,c){Gt(s,e,c),Q(e,t)},d(s){s&&Bt(e)}}}function p8(i){let e,t;return{c(){e=ii("svg"),t=ii("path"),Z(t,"d","m18 15-6-6-6 6"),Z(e,"xmlns","http://www.w3.org/2000/svg"),Z(e,"width","18"),Z(e,"height","18"),Z(e,"viewBox","0 0 24 24"),Z(e,"fill","none"),Z(e,"stroke","currentColor"),Z(e,"stroke-width","2"),Z(e,"stroke-linecap","round"),Z(e,"stroke-linejoin","round"),Z(e,"class","lucide lucide-chevron-up button-svg down svelte-srv42e")},m(s,c){Gt(s,e,c),Q(e,t)},d(s){s&&Bt(e)}}}function HC(i){let e,t=i[3],s=[];for(let c=0;c<t.length;c+=1)s[c]=GC(BC(i,t,c));return{c(){for(let c=0;c<s.length;c+=1)s[c].c();e=Gs()},m(c,h){for(let p=0;p<s.length;p+=1)s[p].m(c,h);Gt(c,e,h)},p(c,h){if(h[0]&287){t=c[3];let p;for(p=0;p<t.length;p+=1){let r=BC(c,t,p);s[p]?s[p].p(r,h):(s[p]=GC(r),s[p].c(),s[p].m(e.parentNode,e))}for(;p<s.length;p+=1)s[p].d(1);s.length=t.length}},d(c){Is(s,c),c&&Bt(e)}}}function jC(i){let e,t,s=i[30][0].date.toUTCString().replace("GMT","UTC")+"",c,h,p;return{c(){e=Ie("div"),t=Ie("span"),c=On(s),Z(t,"class","spanclass jet svelte-srv42e"),Rn(t,"active",i[0]===i[4]+"-"+i[30][0].idx),Z(e,"class","item svelte-srv42e")},m(r,x){Gt(r,e,x),Q(e,t),Q(t,c),h||(p=mn(t,"click",function(){Jr(i[8]({scan:i[30],fileName:i[1],station:i[2],fileNumber:i[4],index:i[32]}))&&i[8]({scan:i[30],fileName:i[1],station:i[2],fileNumber:i[4],index:i[32]}).apply(this,arguments)}),h=!0)},p(r,x){i=r,x[0]&8&&s!==(s=i[30][0].date.toUTCString().replace("GMT","UTC")+"")&&si(c,s),x[0]&25&&Rn(t,"active",i[0]===i[4]+"-"+i[30][0].idx)},d(r){r&&Bt(e),h=!1,p()}}}function GC(i){let e,t=i[27][0][0].elevation.toFixed(1)+"",s,c,h,p,r,x=i[27],v=[];for(let w=0;w<x.length;w+=1)v[w]=jC(UC(i,x,w));return{c(){e=Ie("h3"),s=On(t),c=On("°"),h=ot(),p=Ie("div");for(let w=0;w<v.length;w+=1)v[w].c();r=ot(),Z(e,"class","jet bold svelte-srv42e"),Z(p,"class","listul svelte-srv42e")},m(w,S){Gt(w,e,S),Q(e,s),Q(e,c),Gt(w,h,S),Gt(w,p,S);for(let A=0;A<v.length;A+=1)v[A].m(p,null);Q(p,r)},p(w,S){if(S[0]&8&&t!==(t=w[27][0][0].elevation.toFixed(1)+"")&&si(s,t),S[0]&287){x=w[27];let A;for(A=0;A<x.length;A+=1){let I=UC(w,x,A);v[A]?v[A].p(I,S):(v[A]=jC(I),v[A].c(),v[A].m(p,r))}for(;A<v.length;A+=1)v[A].d(1);v.length=x.length}},d(w){w&&Bt(e),w&&Bt(h),w&&Bt(p),Is(v,w)}}}function m8(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L=(i[5]===void 0?"":i[5])+"",z,B,$,H=(i[2]===void 0?"":i[2])+"",G,le,te,ue,me,se,Y=i[2]&&VC(i),ye=i[2]&&HC(i);return{c(){e=Ie("div"),t=Ie("div"),s=Ie("button"),s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2 button-svg svelte-srv42e"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>',c=ot(),h=Ie("table"),p=Ie("tbody"),r=Ie("tr"),r.innerHTML=`<td class="file svelte-srv42e">File</td> 
                    <td class="vcp svelte-srv42e">VCP</td> 
                    <td class="vcp svelte-srv42e">Radar</td>`,x=ot(),v=Ie("tr"),w=Ie("td"),S=Ie("div"),A=Ie("span"),I=On(i[1]),R=ot(),k=Ie("td"),z=On(L),B=ot(),$=Ie("td"),G=On(H),le=ot(),Y&&Y.c(),te=ot(),ue=Ie("div"),ye&&ye.c(),Z(s,"class","trash-button svelte-srv42e"),Z(r,"class","title-tr svelte-srv42e"),Tm(A,"position","absolute"),Z(S,"class","relative-table svelte-srv42e"),Z(w,"class","file content svelte-srv42e"),Z(k,"class","vcp content svelte-srv42e"),Z($,"class","vcp content svelte-srv42e"),Z(h,"class","svelte-srv42e"),Z(t,"class","table-wrapper svelte-srv42e"),Z(ue,"class","scan-container svelte-srv42e"),Rn(ue,"activeListing",!!i[6]),Z(e,"class","table-content svelte-srv42e")},m(Xe,ge){Gt(Xe,e,ge),Q(e,t),Q(t,s),Q(t,c),Q(t,h),Q(h,p),Q(p,r),Q(p,x),Q(p,v),Q(v,w),Q(w,S),Q(S,A),Q(A,I),Q(v,R),Q(v,k),Q(k,z),Q(v,B),Q(v,$),Q($,G),Q(t,le),Y&&Y.m(t,null),Q(e,te),Q(e,ue),ye&&ye.m(ue,null),me||(se=mn(s,"click",i[17]),me=!0)},p(Xe,ge){ge[0]&2&&si(I,Xe[1]),ge[0]&32&&L!==(L=(Xe[5]===void 0?"":Xe[5])+"")&&si(z,L),ge[0]&4&&H!==(H=(Xe[2]===void 0?"":Xe[2])+"")&&si(G,H),Xe[2]?Y?Y.p(Xe,ge):(Y=VC(Xe),Y.c(),Y.m(t,null)):Y&&(Y.d(1),Y=null),Xe[2]?ye?ye.p(Xe,ge):(ye=HC(Xe),ye.c(),ye.m(ue,null)):ye&&(ye.d(1),ye=null),ge[0]&64&&Rn(ue,"activeListing",!!Xe[6])},i:Vn,o:Vn,d(Xe){Xe&&Bt(e),Y&&Y.d(),ye&&ye.d(),me=!1,se()}}}function g8(i,e,t){let s,c,h,p;It(i,Vr,ge=>t(19,c=ge)),It(i,ni,ge=>t(20,h=ge)),It(i,_i,ge=>t(16,p=ge));let{REFLECTIVITY:r,VELOCITY:x,VELOCITY_DEALIASED:v}=yo,{fileName:w}=e,{station:S}=e,{localScans:A}=e,{fileNumber:I}=e,{percent:R}=e,{vcp:k}=e,{active:L=void 0}=e,{loaded:z}=e,{scans:B}=e,{idxs:$}=e,{radarMetadata:H}=e,{elevationFiles:G}=e,{date:le}=e,te=!1,ue={[r]:0,[x]:1,[v]:2},me=bo();function se(){t(6,te=!te)}function Y(ge){t(0,L=ge.fileName+ge.scan[0].idx),rr.handleClick({elevation:ge.scan[0].rounded,station:ge.station,index:ge.index})}function ye(){let ge=h,re=c;Object.assign(re,{fileNames:[],elevations:[],stations:[],scans:[]}),re.fileNames=[],re.stations=[],re.scans={},re.elevations={};let ve={},ae={};for(let de=0;de<ge.length;de++)ge[de]!=null&&(re.fileNames.push(ge[de].fileName),re.stations.indexOf(ge[de].station)<0&&re.stations.push(ge[de].station),ge[de].station in ve?ve[ge[de].station]=ve[ge[de].station].concat(Object.keys(ge[de].idxs)):ve[ge[de].station]=Object.keys(ge[de].idxs),ge[de].station in ae?ae[ge[de].station]=ae[ge[de].station].concat(ge[de].scans):ae[ge[de].station]=ge[de].scans);for(let de=0;de<re.stations.length;de++){let xe=re.stations[de];re.elevations[xe]=[],re.scans[xe]={},re.elevations[xe]=Array.from(new Set(ve[xe])).sort(function(Ce,pe){return+Ce-+pe});let De=ae[xe];for(let Ce=0;Ce<re.elevations[xe].length;Ce++)re.scans[xe][re.elevations[xe][Ce]]=[];for(let Ce=0;Ce<De.length;Ce++)re.scans[xe][De[Ce][0][0].rounded].push(...De[Ce]);for(let Ce in re.scans[xe])re.scans[xe][Ce]=re.scans[xe][Ce].sort(function(pe,xt){return pe[0].date-xt[0].date})}}let Xe=()=>sh(I);return i.$$set=ge=>{"fileName"in ge&&t(1,w=ge.fileName),"station"in ge&&t(2,S=ge.station),"localScans"in ge&&t(3,A=ge.localScans),"fileNumber"in ge&&t(4,I=ge.fileNumber),"percent"in ge&&t(9,R=ge.percent),"vcp"in ge&&t(5,k=ge.vcp),"active"in ge&&t(0,L=ge.active),"loaded"in ge&&t(10,z=ge.loaded),"scans"in ge&&t(11,B=ge.scans),"idxs"in ge&&t(12,$=ge.idxs),"radarMetadata"in ge&&t(13,H=ge.radarMetadata),"elevationFiles"in ge&&t(14,G=ge.elevationFiles),"date"in ge&&t(15,le=ge.date)},i.$$.update=()=>{if(i.$$.dirty[0]&64){e:s=te?"down":"up"}if(i.$$.dirty[0]&65536){e:t(0,L=p[0]&&p[0].scan?p[0].scan.scan[0].fileNumber+"-"+p[0].scan.scan[0].idx:void 0)}},[L,w,S,A,I,k,te,se,Y,R,z,B,$,H,G,le,p,Xe]}var WC=class extends gi{constructor(e){super();Ti(this,e,g8,m8,ai,{fileName:1,station:2,localScans:3,fileNumber:4,percent:9,vcp:5,active:0,loaded:10,scans:11,idxs:12,radarMetadata:13,elevationFiles:14,date:15},null,[-1,-1])}},qC=WC;function XC(i,e,t){let s=i.slice();return s[9]=e[t],s}function ZC(i){let e,t,s,c,h=[i[9],{localScans:i[9].scans}];function p(v){i[6](v)}function r(v){i[7](v)}let x={};for(let v=0;v<h.length;v+=1)x=e1(x,h[v]);return i[0]!==void 0&&(x.active=i[0]),i[1]!==void 0&&(x.loading=i[1]),e=new qC({props:x}),wi.push(()=>_o(e,"active",p)),wi.push(()=>_o(e,"loading",r)),{c(){mr(e.$$.fragment)},m(v,w){dr(e,v,w),c=!0},p(v,w){let S=w&4?f1(h,[p1(v[9]),{localScans:v[9].scans}]):{};!t&&w&1&&(t=!0,S.active=v[0],po(()=>t=!1)),!s&&w&2&&(s=!0,S.loading=v[1],po(()=>s=!1)),e.$set(S)},i(v){c||(ri(e.$$.fragment,v),c=!0)},o(v){mi(e.$$.fragment,v),c=!1},d(v){fr(e,v)}}}function KC(i,e){let t,s,c,h=e[9]&&e[9].scans&&ZC(e);return{key:i,first:null,c(){t=Gs(),h&&h.c(),s=Gs(),this.first=t},m(p,r){Gt(p,t,r),h&&h.m(p,r),Gt(p,s,r),c=!0},p(p,r){e=p,e[9]&&e[9].scans?h?(h.p(e,r),r&4&&ri(h,1)):(h=ZC(e),h.c(),ri(h,1),h.m(s.parentNode,s)):h&&(mo(),mi(h,1,1,()=>{h=null}),go())},i(p){c||(ri(h),c=!0)},o(p){mi(h),c=!1},d(p){p&&Bt(t),h&&h.d(p),p&&Bt(s)}}}function _8(i){let e,t=[],s=new Map,c,h=i[2],p=r=>r[9].fileNumber;for(let r=0;r<h.length;r+=1){let x=XC(i,h,r),v=p(x);s.set(v,t[r]=KC(v,x))}return{c(){e=Ie("div");for(let r=0;r<t.length;r+=1)t[r].c();Z(e,"class","scroll svelte-1kipxq3")},m(r,x){Gt(r,e,x);for(let v=0;v<t.length;v+=1)t[v].m(e,null);c=!0},p(r,[x]){x&7&&(h=r[2],mo(),t=d1(t,x,p,1,r,h,s,e,h1,KC,null,XC),go())},i(r){if(!c){for(let x=0;x<h.length;x+=1)ri(t[x]);c=!0}},o(r){for(let x=0;x<t.length;x+=1)mi(t[x]);c=!1},d(r){r&&Bt(e);for(let x=0;x<t.length;x+=1)t[x].d()}}}function y8(i,e,t){let s,c,h;It(i,ni,A=>t(3,s=A)),It(i,Vr,A=>t(4,c=A)),It(i,_i,A=>t(5,h=A));let p,r,x;function v(){t(2,x=s.filter(A=>A!=null).sort((A,I)=>A.date-I.date))}function w(A){p=A,t(0,p)}function S(A){r=A,t(1,r)}return i.$$.update=()=>{if(i.$$.dirty&32){e:rr.setStates()}if(i.$$.dirty&16){e:rr.setSites()}if(i.$$.dirty&8){e:v()}},[p,r,x,s,c,h,w,S]}var YC=class extends gi{constructor(e){super();Ti(this,e,y8,_8,ai,{})}},JC=YC;function $C(i,e,t){let s=i.slice();return s[11]=e[t],s}function QC(i,e,t){let s=i.slice();return s[14]=e[t],s}function nL(i){let e,t,s,c=i[11]+"",h,p,r,x,v,w,S=i[3]===i[4]&&eL(i),A=i[0].elevations[i[11]],I=[];for(let R=0;R<A.length;R+=1)I[R]=tL(QC(i,A,R));return{c(){e=Ie("div"),t=Ie("div"),s=Ie("p"),h=On(c),p=On(" elevations"),r=ot(),S&&S.c(),x=ot(),v=Ie("div");for(let R=0;R<I.length;R+=1)I[R].c();w=ot(),Z(s,"class","buttonlabel svelte-49i1g3"),Z(t,"class","site-header svelte-49i1g3"),Z(v,"class","buttoncontainer svelte-49i1g3"),Z(e,"class","stationContainer svelte-49i1g3")},m(R,k){Gt(R,e,k),Q(e,t),Q(t,s),Q(s,h),Q(s,p),Q(t,r),S&&S.m(t,null),Q(e,x),Q(e,v);for(let L=0;L<I.length;L+=1)I[L].m(v,null);Q(e,w)},p(R,k){if(k&1&&c!==(c=R[11]+"")&&si(h,c),R[3]===R[4]?S?S.p(R,k):(S=eL(R),S.c(),S.m(t,null)):S&&(S.d(1),S=null),k&7){A=R[0].elevations[R[11]];let L;for(L=0;L<A.length;L+=1){let z=QC(R,A,L);I[L]?I[L].p(z,k):(I[L]=tL(z),I[L].c(),I[L].m(v,null))}for(;L<I.length;L+=1)I[L].d(1);I.length=A.length}},d(R){R&&Bt(e),S&&S.d(),Is(I,R)}}}function eL(i){let e,t,s;return{c(){e=Ie("button"),e.textContent="Load Loop",Z(e,"class","loadButton svelte-49i1g3")},m(c,h){Gt(c,e,h),t||(s=mn(e,"click",rr.handleLoadClick),t=!0)},p:Vn,d(c){c&&Bt(e),t=!1,s()}}}function iL(i){let e,t=i[0].scans[i[11]][i[14]].length+"",s;return{c(){e=Ie("span"),s=On(t),Z(e,"class","text-content svelte-49i1g3")},m(c,h){Gt(c,e,h),Q(e,s)},p(c,h){h&1&&t!==(t=c[0].scans[c[11]][c[14]].length+"")&&si(s,t)},d(c){c&&Bt(e)}}}function tL(i){let e,t=i[14]+"",s,c,h,p=i[0].scans[i[11]][i[14]].length,r,x,v,w=iL(i);return{c(){e=Ie("button"),s=On(t),c=On(`°
                            
                            `),h=Ie("div"),w.c(),r=ot(),Z(h,"class","num-scans svelte-49i1g3"),Rn(h,"active",i[2]===i[11]),Z(e,"class","ebutton svelte-49i1g3"),Rn(e,"activebutton",i[14]===i[1]&&i[2]===i[11])},m(S,A){Gt(S,e,A),Q(e,s),Q(e,c),Q(e,h),w.m(h,null),Q(e,r),x||(v=mn(e,"click",function(){Jr(rr.handleClick({elevation:i[14],station:i[11]}))&&rr.handleClick({elevation:i[14],station:i[11]}).apply(this,arguments)}),x=!0)},p(S,A){i=S,A&1&&t!==(t=i[14]+"")&&si(s,t),A&1&&ai(p,p=i[0].scans[i[11]][i[14]].length)?(w.d(1),w=iL(i),w.c(),w.m(h,null)):w.p(i,A),A&5&&Rn(h,"active",i[2]===i[11]),A&7&&Rn(e,"activebutton",i[14]===i[1]&&i[2]===i[11])},d(S){S&&Bt(e),w.d(S),x=!1,v()}}}function rL(i){let e,t=i[11]&&nL(i);return{c(){t&&t.c(),e=Gs()},m(s,c){t&&t.m(s,c),Gt(s,e,c)},p(s,c){s[11]?t?t.p(s,c):(t=nL(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(s){t&&t.d(s),s&&Bt(e)}}}function v8(i){let e,t=i[0].stations,s=[];for(let c=0;c<t.length;c+=1)s[c]=rL($C(i,t,c));return{c(){e=Ie("div");for(let c=0;c<s.length;c+=1)s[c].c();Z(e,"class","scroll svelte-49i1g3")},m(c,h){Gt(c,e,h);for(let p=0;p<s.length;p+=1)s[p].m(e,null)},p(c,[h]){if(h&31){t=c[0].stations;let p;for(p=0;p<t.length;p+=1){let r=$C(c,t,p);s[p]?s[p].p(r,h):(s[p]=rL(r),s[p].c(),s[p].m(e,null))}for(;p<s.length;p+=1)s[p].d(1);s.length=t.length}},i:Vn,o:Vn,d(c){c&&Bt(e),Is(s,c)}}}function x8(i,e,t){let s,c,h;It(i,Vr,R=>t(0,s=R)),It(i,_i,R=>t(5,c=R)),It(i,Ds,R=>t(3,h=R));let{LIVE:p}=vo,r,x,v,w,S,A;function I(){let R=rr.setValues();r=R.fileIdx,w=R.max,S=R.idx,t(1,x=R.elevation_state),t(2,v=R.station_state),A=R.currentIdx}return i.$$.update=()=>{if(i.$$.dirty&32){e:rr.setStates(),I()}if(i.$$.dirty&1){e:rr.setSites(),I()}},[s,x,v,h,p,c]}var sL=class extends gi{constructor(e){super();Ti(this,e,x8,v8,ai,{})}},oL=sL;function du(i,{callback:e,state:t}={}){let s=!0,c=p=>{if(t==="CLOSED"||s){s=!1;return}i.contains(p.target)||e(p)},h=p=>{t=p.state,t==="OPEN"?document.addEventListener("click",c):document.removeEventListener("click",c)};return h({state:t}),{update:h,destroy(){document.removeEventListener("click",c)}}}function b8(i){let e,t,s;return{c(){e=ii("svg"),t=ii("path"),s=ii("path"),Z(t,"d","M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"),Z(s,"d","M2 10h20"),Z(e,"xmlns","http://www.w3.org/2000/svg"),Z(e,"width","18"),Z(e,"height","18"),Z(e,"viewBox","0 0 24 24"),Z(e,"fill","none"),Z(e,"stroke","currentColor"),Z(e,"stroke-width","2"),Z(e,"stroke-linecap","round"),Z(e,"stroke-linejoin","round"),Z(e,"class","lucide lucide-folder-closed button-svg svelte-16w3zye")},m(c,h){Gt(c,e,h),Q(e,t),Q(e,s)},d(c){c&&Bt(e)}}}function w8(i){let e,t,s,c,h,p,r,x,v;return{c(){e=ii("svg"),t=ii("path"),s=ii("path"),c=ii("path"),h=ii("path"),p=ii("path"),r=ii("path"),x=ii("circle"),v=ii("path"),Z(t,"d","M19.07 4.93A10 10 0 0 0 6.99 3.34"),Z(s,"d","M4 6h.01"),Z(c,"d","M2.29 9.62A10 10 0 1 0 21.31 8.35"),Z(h,"d","M16.24 7.76A6 6 0 1 0 8.23 16.67"),Z(p,"d","M12 18h.01"),Z(r,"d","M17.99 11.66A6 6 0 0 1 15.77 16.67"),Z(x,"cx","12"),Z(x,"cy","12"),Z(x,"r","2"),Z(v,"d","m13.41 10.59 5.66-5.66"),Z(e,"xmlns","http://www.w3.org/2000/svg"),Z(e,"width","18"),Z(e,"height","18"),Z(e,"viewBox","0 0 24 24"),Z(e,"fill","none"),Z(e,"stroke","currentColor"),Z(e,"stroke-width","2"),Z(e,"stroke-linecap","round"),Z(e,"stroke-linejoin","round"),Z(e,"class","lucide lucide-radar button-svg svelte-16w3zye")},m(w,S){Gt(w,e,S),Q(e,t),Q(e,s),Q(e,c),Q(e,h),Q(e,p),Q(e,r),Q(e,x),Q(e,v)},d(w){w&&Bt(e)}}}function T8(i){let e;return{c(){e=Ie("span"),e.textContent="File View",Z(e,"class","button-span svelte-16w3zye")},m(t,s){Gt(t,e,s)},d(t){t&&Bt(e)}}}function E8(i){let e;return{c(){e=Ie("span"),e.textContent="Site View",Z(e,"class","button-span svelte-16w3zye")},m(t,s){Gt(t,e,s)},d(t){t&&Bt(e)}}}function aL(i){let e;return{c(){e=Ie("div"),e.innerHTML=`<div class="lds-dual-ring svelte-16w3zye"></div> 
                <div class="of svelte-16w3zye">Loading live</div>`,Z(e,"class","loading-parent svelte-16w3zye")},m(t,s){Gt(t,e,s)},d(t){t&&Bt(e)}}}function S8(i){let e,t;return e=new JC({}),{c(){mr(e.$$.fragment)},m(s,c){dr(e,s,c),t=!0},p:Vn,i(s){t||(ri(e.$$.fragment,s),t=!0)},o(s){mi(e.$$.fragment,s),t=!1},d(s){fr(e,s)}}}function A8(i){let e,t,s={};return e=new oL({props:s}),i[19](e),{c(){mr(e.$$.fragment)},m(c,h){dr(e,c,h),t=!0},p(c,h){let p={};e.$set(p)},i(c){t||(ri(e.$$.fragment,c),t=!0)},o(c){mi(e.$$.fragment,c),t=!1},d(c){i[19](null),fr(e,c)}}}function lL(i){let e;return{c(){e=Ie("div"),e.innerHTML="<i>Load a Level II file or choose a site in Live mode.</i>",Z(e,"class","prompt svelte-16w3zye")},m(t,s){Gt(t,e,s)},d(t){t&&Bt(e)}}}function M8(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L,z,B,$,H,G,le,te,ue,me,se,Y,ye,Xe,ge,re,ve,ae,de,xe,De,Ce,pe;function xt(ut,Ot){if(ut[4]===ut[12])return w8;if(ut[4]===ut[11])return b8}let Ct=xt(i,-1),ct=Ct&&Ct(i);function Qe(ut,Ot){return ut[4]===ut[12]?E8:T8}let zt=Qe(i,-1),Zt=zt(i),Lt=i[6]&&aL(i);se=new _M({}),ye=new bM({});let Re=[A8,S8],qt=[];function nt(ut,Ot){return ut[4]===ut[12]?0:ut[4]===ut[11]?1:-1}~(ge=nt(i,-1))&&(re=qt[ge]=Re[ge](i));let at=i[8]===0&&lL(i),St={};return xe=new FC({props:St}),i[20](xe),{c(){e=Ie("div"),t=Ie("div"),s=Ie("div"),c=Ie("button"),h=Ie("div"),ct&&ct.c(),p=ot(),Zt.c(),r=ot(),x=ii("svg"),v=ii("path"),w=ot(),S=Ie("div"),A=Ie("div"),I=Ie("input"),R=ot(),k=Ie("label"),k.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radar button-svg svelte-16w3zye"><path d="M19.07 4.93A10 10 0 0 0 6.99 3.34"></path><path d="M4 6h.01"></path><path d="M2.29 9.62A10 10 0 1 0 21.31 8.35"></path><path d="M16.24 7.76A6 6 0 1 0 8.23 16.67"></path><path d="M12 18h.01"></path><path d="M17.99 11.66A6 6 0 0 1 15.77 16.67"></path><circle cx="12" cy="12" r="2"></circle><path d="m13.41 10.59 5.66-5.66"></path></svg> 
                                <span class="button-span svelte-16w3zye">Site View</span>`,L=ot(),z=Ie("div"),B=Ie("input"),$=ot(),H=Ie("label"),H.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-folder-closed button-svg svelte-16w3zye"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"></path><path d="M2 10h20"></path></svg> 
                                <span class="button-span svelte-16w3zye">File View</span>`,le=ot(),te=Ie("div"),Lt&&Lt.c(),ue=ot(),me=Ie("div"),mr(se.$$.fragment),Y=ot(),mr(ye.$$.fragment),Xe=ot(),re&&re.c(),ve=ot(),at&&at.c(),ae=ot(),de=Ie("div"),mr(xe.$$.fragment),Z(v,"d","m6 9 6 6 6-6"),Z(x,"xmlns","http://www.w3.org/2000/svg"),Z(x,"width","18"),Z(x,"height","18"),Z(x,"viewBox","0 0 24 24"),Z(x,"fill","none"),Z(x,"stroke","currentColor"),Z(x,"stroke-width","2"),Z(x,"stroke-linecap","round"),Z(x,"stroke-linejoin","round"),Z(x,"class","lucide lucide-chevron-down button-svg down svelte-16w3zye"),Z(c,"class","main sub svelte-16w3zye"),Z(I,"type","radio"),Z(I,"id","site-radio"),Z(I,"name","file-modes"),I.__value="one",I.value=I.__value,Z(I,"class","svelte-16w3zye"),i[17][0].push(I),Z(k,"for","site-radio"),Z(k,"class","radio-button svelte-16w3zye"),Z(B,"type","radio"),Z(B,"id","file-radio"),Z(B,"name","file-modes"),B.__value="two",B.value=B.__value,Z(B,"class","svelte-16w3zye"),i[17][0].push(B),Z(H,"for","file-radio"),Z(H,"class","radio-button svelte-16w3zye"),Z(S,"class","submenu svelte-16w3zye"),Rn(S,"flex",i[3]==="OPEN"),Z(s,"class","sub-parent svelte-16w3zye"),Z(me,"class","fddiv svelte-16w3zye"),Rn(me,"hidden",i[7]===i[13]),Z(te,"class","right-nested svelte-16w3zye"),Z(t,"class","radios svelte-16w3zye"),Z(de,"class","menu-canvas-parent svelte-16w3zye"),Rn(de,"hidden-3d",!(i[5]===i[9]||i[5]===i[10])),Z(e,"class","menu svelte-16w3zye"),Rn(e,"expanded",i[5]===i[9]||i[5]===i[10])},m(ut,Ot){Gt(ut,e,Ot),Q(e,t),Q(t,s),Q(s,c),Q(c,h),ct&&ct.m(h,null),Q(h,p),Zt.m(h,null),Q(c,r),Q(c,x),Q(x,v),Q(s,w),Q(s,S),Q(S,A),Q(A,I),I.checked=I.__value===i[2],Q(A,R),Q(A,k),Q(S,L),Q(S,z),Q(z,B),B.checked=B.__value===i[2],Q(z,$),Q(z,H),Q(t,le),Q(t,te),Lt&&Lt.m(te,null),Q(te,ue),Q(te,me),dr(se,me,null),Q(e,Y),dr(ye,e,null),Q(e,Xe),~ge&&qt[ge].m(e,null),Q(e,ve),at&&at.m(e,null),Q(e,ae),Q(e,de),dr(xe,de,null),De=!0,Ce||(pe=[mn(c,"click",i[14]),mn(I,"change",i[16]),mn(B,"change",i[18]),Cl(G=du.call(null,s,{callback:i[15],state:i[3]}))],Ce=!0)},p(ut,[Ot]){Ct!==(Ct=xt(ut,Ot))&&(ct&&ct.d(1),ct=Ct&&Ct(ut),ct&&(ct.c(),ct.m(h,p))),zt!==(zt=Qe(ut,Ot))&&(Zt.d(1),Zt=zt(ut),Zt&&(Zt.c(),Zt.m(h,null))),Ot&4&&(I.checked=I.__value===ut[2]),Ot&4&&(B.checked=B.__value===ut[2]),Ot&8&&Rn(S,"flex",ut[3]==="OPEN"),G&&Jr(G.update)&&Ot&8&&G.update.call(null,{callback:ut[15],state:ut[3]}),ut[6]?Lt||(Lt=aL(ut),Lt.c(),Lt.m(te,ue)):Lt&&(Lt.d(1),Lt=null),Ot&8320&&Rn(me,"hidden",ut[7]===ut[13]);let Pn=ge;ge=nt(ut,Ot),ge===Pn?~ge&&qt[ge].p(ut,Ot):(re&&(mo(),mi(qt[Pn],1,1,()=>{qt[Pn]=null}),go()),~ge?(re=qt[ge],re?re.p(ut,Ot):(re=qt[ge]=Re[ge](ut),re.c()),ri(re,1),re.m(e,ve)):re=null),ut[8]===0?at||(at=lL(ut),at.c(),at.m(e,ae)):at&&(at.d(1),at=null);let bn={};xe.$set(bn),Ot&1568&&Rn(de,"hidden-3d",!(ut[5]===ut[9]||ut[5]===ut[10])),Ot&1568&&Rn(e,"expanded",ut[5]===ut[9]||ut[5]===ut[10])},i(ut){De||(ri(se.$$.fragment,ut),ri(ye.$$.fragment,ut),ri(re),ri(xe.$$.fragment,ut),De=!0)},o(ut){mi(se.$$.fragment,ut),mi(ye.$$.fragment,ut),mi(re),mi(xe.$$.fragment,ut),De=!1},d(ut){ut&&Bt(e),ct&&ct.d(),Zt.d(),i[17][0].splice(i[17][0].indexOf(I),1),i[17][0].splice(i[17][0].indexOf(B),1),Lt&&Lt.d(),fr(se),fr(ye),~ge&&qt[ge].d(),at&&at.d(),i[20](null),fr(xe),Ce=!1,cr(pe)}}}function I8(i,e,t){let s,c,h,p,r;It(i,Jm,se=>t(4,s=se)),It(i,Xr,se=>t(5,c=se)),It(i,Sr,se=>t(6,h=se)),It(i,Ds,se=>t(7,p=se)),It(i,uM,se=>t(8,r=se));let{MODE3D:x,CROSS:v}=vs,{FILE:w,ELEVATION:S}=Qd,{HISTORICAL:A,LIVE:I}=vo,R="one",{canvas:k=void 0}=e,{elevationFunctions:L=void 0}=e,z="CLOSED",B={one:S,two:w};function $(){z==="CLOSED"?t(3,z="OPEN"):t(3,z="CLOSED")}function H(){t(3,z="CLOSED")}let G=[[]];function le(){R=this.__value,t(2,R)}function te(){R=this.__value,t(2,R)}function ue(se){wi[se?"unshift":"push"](()=>{L=se,t(1,L)})}function me(se){wi[se?"unshift":"push"](()=>{k=se,t(0,k)})}return i.$$set=se=>{"canvas"in se&&t(0,k=se.canvas),"elevationFunctions"in se&&t(1,L=se.elevationFunctions)},i.$$.update=()=>{if(i.$$.dirty&4){e:H()}if(i.$$.dirty&4){e:on(Jm,s=B[R],s)}},[k,L,R,z,s,c,h,p,r,x,v,w,S,I,$,H,le,G,te,ue,me]}var cL=class extends gi{constructor(e){super();Ti(this,e,I8,M8,ai,{canvas:0,elevationFunctions:1})}},uL=cL;function hL(){throw new Error("setTimeout has not been defined")}function dL(){throw new Error("clearTimeout has not been defined")}var fu=hL,pu=dL,np;typeof window!="undefined"?np=window:typeof self!="undefined"?np=self:np={};typeof np.setTimeout=="function"&&(fu=setTimeout);typeof np.clearTimeout=="function"&&(pu=clearTimeout);function fL(i){if(fu===setTimeout)return setTimeout(i,0);if((fu===hL||!fu)&&setTimeout)return fu=setTimeout,setTimeout(i,0);try{return fu(i,0)}catch(e){try{return fu.call(null,i,0)}catch(t){return fu.call(this,i,0)}}}function C8(i){if(pu===clearTimeout)return clearTimeout(i);if((pu===dL||!pu)&&clearTimeout)return pu=clearTimeout,clearTimeout(i);try{return pu(i)}catch(e){try{return pu.call(null,i)}catch(t){return pu.call(this,i)}}}var ec=[],ip=!1,Kh,zv=-1;function L8(){!ip||!Kh||(ip=!1,Kh.length?ec=Kh.concat(ec):zv=-1,ec.length&&pL())}function pL(){if(!ip){var i=fL(L8);ip=!0;for(var e=ec.length;e;){for(Kh=ec,ec=[];++zv<e;)Kh&&Kh[zv].run();zv=-1,e=ec.length}Kh=null,ip=!1,C8(i)}}function D8(i){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];ec.push(new mL(i,e)),ec.length===1&&!ip&&fL(pL)}function mL(i,e){this.fun=i,this.array=e}mL.prototype.run=function(){this.fun.apply(null,this.array)};var R8="browser",P8="browser",k8=!0,z8=[],O8="",N8={},F8={},B8={};function Yh(){}var U8=Yh,V8=Yh,G8=Yh,H8=Yh,j8=Yh,W8=Yh,q8=Yh;function X8(i){throw new Error("process.binding is not supported")}function Z8(){return"/"}function K8(i){throw new Error("process.chdir is not supported")}function Y8(){return 0}var rp=np.performance||{},J8=rp.now||rp.mozNow||rp.msNow||rp.oNow||rp.webkitNow||function(){return new Date().getTime()};function $8(i){var e=J8.call(rp)*.001,t=Math.floor(e),s=Math.floor(e%1*1e9);return i&&(t=t-i[0],s=s-i[1],s<0&&(t--,s+=1e9)),[t,s]}var Q8=new Date;function eG(){var i=new Date,e=i-Q8;return e/1e3}var gL={nextTick:D8,title:R8,browser:k8,env:{NODE_ENV:"production"},argv:z8,version:O8,versions:N8,on:U8,addListener:V8,once:G8,off:H8,removeListener:j8,removeAllListeners:W8,emit:q8,binding:X8,cwd:Z8,chdir:K8,umask:Y8,hrtime:$8,platform:P8,release:F8,config:B8,uptime:eG},tG=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function iG(i,e,t){return t={path:e,exports:{},require:function(s,c){return nG(s,c??t.path)}},i(t,t.exports),t.exports}function nG(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var rG=iG(function(i,e){(function(t,s){i.exports=s()})(tG,function(){var t,s,c;function h(r,x){if(!t)t=x;else if(!s)s=x;else{var v="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",w={};t(w),c=x(w),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([v],{type:"text/javascript"})))}}h(["exports"],function(r){var x=typeof self!="undefined"?self:{},v="2.13.0";let w,S={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(w==null){let o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{w=gL.env.API_URL_REGEX!=null?new RegExp(gL.env.API_URL_REGEX):o}catch(n){w=o}}return w},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},A={supported:!1,testSupport:function(o){!k&&R&&(L?z(o):I=o)}},I,R,k=!1,L=!1;function z(o){let n=o.createTexture();o.bindTexture(o.TEXTURE_2D,n);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,R),o.isContextLost())return;A.supported=!0}catch(a){}o.deleteTexture(n),k=!0}x.document&&(R=x.document.createElement("img"),R.onload=function(){I&&z(I),I=null,L=!0},R.onerror=function(){k=!0,I=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let B="01";var $=H;function H(o,n,a,u){this.cx=3*o,this.bx=3*(a-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=n,this.p2x=a,this.p2y=u}H.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,n){if(n===void 0&&(n=1e-6),o<0)return 0;if(o>1)return 1;for(var a=o,u=0;u<8;u++){var f=this.sampleCurveX(a)-o;if(Math.abs(f)<n)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=f/g}var y=0,T=1;for(a=o,u=0;u<20&&(f=this.sampleCurveX(a),!(Math.abs(f-o)<n));u++)o>f?y=a:T=a,a=.5*(T-y)+y;return a},solve:function(o,n){return this.sampleCurveY(this.solveCurveX(o,n))}};var G=le;function le(o,n){this.x=o,this.y=n}le.prototype={clone:function(){return new le(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,n){return this.clone()._rotateAround(o,n)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var n=o.x-this.x,a=o.y-this.y;return n*n+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,n){return Math.atan2(this.x*n-this.y*o,this.x*o+this.y*n)},_matMult:function(o){var n=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=n,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var n=Math.cos(o),a=Math.sin(o),u=a*this.x+n*this.y;return this.x=n*this.x-a*this.y,this.y=u,this},_rotateAround:function(o,n){var a=Math.cos(o),u=Math.sin(o),f=n.y+u*(this.x-n.x)+a*(this.y-n.y);return this.x=n.x+a*(this.x-n.x)-u*(this.y-n.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},le.convert=function(o){return o instanceof le?o:Array.isArray(o)?new le(o[0],o[1]):o};let te=Math.PI/180,ue=180/Math.PI;function me(o){return o*te}function se(o){return o*ue}let Y=[[0,0],[1,0],[1,1],[0,1]];function ye(o){if(o<=0)return 0;if(o>=1)return 1;let n=o*o,a=n*o;return 4*(o<.5?a:3*(o-n)+a-.75)}function Xe(o,n,a,u){let f=new $(o,n,a,u);return function(g){return f.solve(g)}}let ge=Xe(.25,.1,.25,1);function re(o,n,a){return Math.min(a,Math.max(n,o))}function ve(o,n,a){return(a=re((a-o)/(n-o),0,1))*a*(3-2*a)}function ae(o,n,a){let u=a-n,f=((o-n)%u+u)%u+n;return f===n?a:f}function de(o,n,a){if(!o.length)return a(null,[]);let u=o.length,f=new Array(o.length),g=null;o.forEach((y,T)=>{n(y,(M,C)=>{M&&(g=M),f[T]=C,--u==0&&a(g,f)})})}function xe(o){let n=[];for(let a in o)n.push(o[a]);return n}function De(o,...n){for(let a of n)for(let u in a)o[u]=a[u];return o}let Ce=1;function pe(){return Ce++}function xt(){return function o(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Ct(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function ct(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Qe(o,n){o.forEach(a=>{n[a]&&(n[a]=n[a].bind(n))})}function zt(o,n){return o.indexOf(n,o.length-n.length)!==-1}function Zt(o,n,a){let u={};for(let f in o)u[f]=n.call(a||this,o[f],f,o);return u}function Lt(o,n,a){let u={};for(let f in o)n.call(a||this,o[f],f,o)&&(u[f]=o[f]);return u}function Re(o){return Array.isArray(o)?o.map(Re):typeof o=="object"&&o?Zt(o,Re):o}let qt={};function nt(o){qt[o]||(typeof console!="undefined"&&console.warn(o),qt[o]=!0)}function at(o,n,a){return(a.y-o.y)*(n.x-o.x)>(n.y-o.y)*(a.x-o.x)}function St(o){let n=0;for(let a,u,f=0,g=o.length,y=g-1;f<g;y=f++)a=o[f],u=o[y],n+=(u.x-a.x)*(a.y+u.y);return n}function ut(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ot(o){let n={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,f,g)=>{let y=f||g;return n[u]=!y||y.toLowerCase(),""}),n["max-age"]){let a=parseInt(n["max-age"],10);isNaN(a)?delete n["max-age"]:n["max-age"]=a}return n}let Pn=null;function bn(o){if(Pn==null){let n=o.navigator?o.navigator.userAgent:null;Pn=!!o.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return Pn}function wn(o){try{let n=x[o];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch(n){return!1}}function xn(o,n){return[o[4*n],o[4*n+1],o[4*n+2],o[4*n+3]]}let ei="mapbox-tiles",ze,Ae,gt=500,Rt=50;function Xt(){try{return x.caches}catch(o){}}function gn(){Xt()&&!ze&&(ze=x.caches.open(ei))}function Tn(o){let n=o.indexOf("?");if(n<0)return o;let a=function(f){let g=f.indexOf("?");return g>0?f.slice(g+1).split("&"):[]}(o),u=a.filter(f=>{let g=f.split("=");return g[0]==="language"||g[0]==="worldview"});return u.length?`${o.slice(0,n)}?${u.join("&")}`:o.slice(0,n)}let Ee=1/0,et={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(et);class rn extends Error{constructor(n,a,u){a===401&&Gn(u)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let tn=ut()?()=>self.worker&&self.worker.referrer:()=>(x.location.protocol==="blob:"?x.parent:x).location.href,Je=function(o,n){if(!(/^file:/.test(a=o.url)||/^file:/.test(tn())&&!/^\w+:/.test(a))){if(x.fetch&&x.Request&&x.AbortController&&x.Request.prototype.hasOwnProperty("signal"))return function(u,f){let g=new x.AbortController,y=new x.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:tn(),signal:g.signal}),T=!1,M=!1,C=(O=y.url).indexOf("sku=")>0&&Gn(O);var O;u.type==="json"&&y.headers.set("Accept","application/json");let U=(q,J,ie)=>{if(M)return;if(q&&q.message!=="SecurityError"&&nt(q),J&&ie)return V(J);let _e=Date.now();x.fetch(y).then(ke=>{if(ke.ok){let Ge=C?ke.clone():null;return V(ke,Ge,_e)}return f(new rn(ke.statusText,ke.status,u.url))}).catch(ke=>{ke.name!=="AbortError"&&f(new Error(`${ke.message} ${u.url}`))})},V=(q,J,ie)=>{(u.type==="arrayBuffer"?q.arrayBuffer():u.type==="json"?q.json():q.text()).then(_e=>{M||(J&&ie&&function(ke,Ge,Le){if(gn(),!ze)return;let Ve={status:Ge.status,statusText:Ge.statusText,headers:new x.Headers};Ge.headers.forEach((pt,ht)=>Ve.headers.set(ht,pt));let We=Ot(Ge.headers.get("Cache-Control")||"");if(We["no-store"])return;We["max-age"]&&Ve.headers.set("Expires",new Date(Le+1e3*We["max-age"]).toUTCString());let He=Ve.headers.get("Expires");He&&(new Date(He).getTime()-Le<42e4||function(pt,ht){if(Ae===void 0)try{new Response(new ReadableStream),Ae=!0}catch(At){Ae=!1}Ae?ht(pt.body):pt.blob().then(ht)}(Ge,pt=>{let ht=new x.Response(pt,Ve);gn(),ze&&ze.then(At=>At.put(Tn(ke.url),ht)).catch(At=>nt(At.message))}))}(y,J,ie),T=!0,f(null,_e,q.headers.get("Cache-Control"),q.headers.get("Expires")))}).catch(_e=>{M||f(new Error(_e.message))})};return C?function(q,J){if(gn(),!ze)return J(null);let ie=Tn(q.url);ze.then(_e=>{_e.match(ie).then(ke=>{let Ge=function(Le){if(!Le)return!1;let Ve=new Date(Le.headers.get("Expires")||0),We=Ot(Le.headers.get("Cache-Control")||"");return Ve>Date.now()&&!We["no-cache"]}(ke);_e.delete(ie),Ge&&_e.put(ie,ke.clone()),J(null,ke,Ge)}).catch(J)}).catch(J)}(y,U):U(null,null),{cancel:()=>{M=!0,T||g.abort()}}}(o,n);if(ut()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,n,void 0,!0)}var a;return function(u,f){let g=new x.XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(let y in u.headers)g.setRequestHeader(y,u.headers[y]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{f(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(u.type==="json")try{y=JSON.parse(g.response)}catch(T){return f(T)}f(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else f(new rn(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(o,n)},sn=function(o,n){return Je(De(o,{type:"arrayBuffer"}),n)};function nn(o){let n=x.document.createElement("a");return n.href=o,n.protocol===x.document.location.protocol&&n.host===x.document.location.host}let An="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Et,Dn;Et=[],Dn=0;let un=function(o,n){if(A.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Dn>=S.MAX_PARALLEL_IMAGE_REQUESTS){let g={requestParameters:o,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return Et.push(g),g}Dn++;let a=!1,u=()=>{if(!a)for(a=!0,Dn--;Et.length&&Dn<S.MAX_PARALLEL_IMAGE_REQUESTS;){let g=Et.shift(),{requestParameters:y,callback:T,cancelled:M}=g;M||(g.cancel=un(y,T).cancel)}},f=sn(o,(g,y,T,M)=>{u(),g?n(g):y&&(x.createImageBitmap?function(C,O){let U=new x.Blob([new Uint8Array(C)],{type:"image/png"});x.createImageBitmap(U).then(V=>{O(null,V)}).catch(V=>{O(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(C,O)=>n(C,O,T,M)):function(C,O){let U=new x.Image,V=x.URL;U.onload=()=>{O(null,U),V.revokeObjectURL(U.src),U.onload=null,x.requestAnimationFrame(()=>{U.src=An})},U.onerror=()=>O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let q=new x.Blob([new Uint8Array(C)],{type:"image/png"});U.src=C.byteLength?V.createObjectURL(q):An}(y,(C,O)=>n(C,O,T,M)))});return{cancel:()=>{f.cancel(),u()}}},Nn="NO_ACCESS_TOKEN";function Kn(o){return o.indexOf("mapbox:")===0}function Gn(o){return S.API_URL_REGEX.test(o)}function Ei(o){return S.API_CDN_URL_REGEX.test(o)}function ln(o){return S.API_STYLE_REGEX.test(o)&&!li(o)}function li(o){return S.API_SPRITE_REGEX.test(o)}let $t=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function kn(o){let n=o.match($t);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Un(o){let n=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${n}`}function Yn(o){if(!o)return null;let n=o.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(x.atob(n[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(a){return null}}class Ft{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){let a=Yn(S.ACCESS_TOKEN),u="";return u=a&&a.u?x.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(f,g)=>String.fromCharCode(Number("0x"+g)))):S.ACCESS_TOKEN||"",n?`mapbox.eventData.${n}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){let n=wn("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(n)try{let f=x.localStorage.getItem(a);f&&(this.eventData=JSON.parse(f));let g=x.localStorage.getItem(u);g&&(this.anonId=g)}catch(f){nt("Unable to read from LocalStorage")}}saveEventData(){let n=wn("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(n)try{x.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&x.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(f){nt("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,a,u,f){if(!S.EVENTS_URL)return;let g=kn(S.EVENTS_URL);g.params.push(`access_token=${f||S.ACCESS_TOKEN||""}`);let y={event:this.type,created:new Date(n).toISOString()},T=a?De(y,a):y,M={url:Un(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=function(C,O){return Je(De(C,{method:"POST"}),O)}(M,C=>{this.pendingRequest=null,u(C),this.saveEventData(),this.processRequests(f)})}queueRequest(n,a){this.queue.push(n),this.processRequests(a)}}let he=new class extends Ft{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,n){S.EVENTS_URL&&S.ACCESS_TOKEN&&Array.isArray(o)&&o.some(a=>Kn(a)||Gn(a))&&this.queueRequest(Date.now(),n)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let n=Yn(S.ACCESS_TOKEN),a=n?n.u:S.ACCESS_TOKEN,u=a!==this.eventData.tokenU;ct(this.anonId)||(this.anonId=xt(),u=!0);let f=this.queue.shift();if(this.eventData.lastSuccess){let g=new Date(this.eventData.lastSuccess),y=new Date(f),T=(f-this.eventData.lastSuccess)/864e5;u=u||T>=1||T<-1||g.getDate()!==y.getDate()}else u=!0;u?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:B,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=f,this.eventData.tokenU=a)},o):this.processRequests()}},X=he.postTurnstileEvent.bind(he),N=new class extends Ft{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,n,a,u){this.skuToken=n,this.errorCb=u,S.EVENTS_URL&&(a||S.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Nn)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;let{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),ct(this.anonId)||(this.anonId=xt()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:B,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},o))}},K=N.postMapLoadEvent.bind(N),ne=new class extends Ft{constructor(){super("gljs.performance")}postPerformanceEvent(o,n){S.EVENTS_URL&&(o||S.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:n,performanceData:a}=this.queue.shift(),u=function(f){let g=x.performance.getEntriesByType("resource"),y=x.performance.getEntriesByType("mark"),T=function(V){let q={};if(V){for(let J in V)if(J!=="other")for(let ie of V[J]){let _e=`${J}ResolveRangeMin`,ke=`${J}ResolveRangeMax`,Ge=`${J}RequestCount`,Le=`${J}RequestCachedCount`;q[_e]=Math.min(q[_e]||1/0,ie.startTime),q[ke]=Math.max(q[ke]||-1/0,ie.responseEnd);let Ve=We=>{q[We]===void 0&&(q[We]=0),++q[We]};ie.transferSize!==void 0&&ie.transferSize===0&&Ve(Le),Ve(Ge)}}return q}(function(V,q){let J={};if(V)for(let ie of V){let _e=q(ie);J[_e]===void 0&&(J[_e]=[]),J[_e].push(ie)}return J}(g,Pt)),M=x.devicePixelRatio,C=x.navigator.connection||x.navigator.mozConnection||x.navigator.webkitConnection,O={counters:[],metadata:[],attributes:[]},U=(V,q,J)=>{J!=null&&V.push({name:q,value:J.toString()})};for(let V in T)U(O.counters,V,T[V]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(U(O.counters,"interactionRangeMin",f.interactionRange[0]),U(O.counters,"interactionRangeMax",f.interactionRange[1])),y)for(let V of Object.keys(Ke)){let q=Ke[V],J=y.find(ie=>ie.name===q);J&&U(O.counters,q,J.startTime)}return U(O.counters,"visibilityHidden",f.visibilityHidden),U(O.attributes,"style",function(V){if(V)for(let q of V){let J=q.name.split("?")[0];if(ln(J)){let ie=J.split("/").slice(-2);if(ie.length===2)return`mapbox://styles/${ie[0]}/${ie[1]}`}}}(g)),U(O.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),U(O.attributes,"fogEnabled",f.fogEnabled?"true":"false"),U(O.attributes,"projection",f.projection),U(O.attributes,"zoom",f.zoom),U(O.metadata,"devicePixelRatio",M),U(O.metadata,"connectionEffectiveType",C?C.effectiveType:void 0),U(O.metadata,"navigatorUserAgent",x.navigator.userAgent),U(O.metadata,"screenWidth",x.screen.width),U(O.metadata,"screenHeight",x.screen.height),U(O.metadata,"windowWidth",x.innerWidth),U(O.metadata,"windowHeight",x.innerHeight),U(O.metadata,"mapWidth",f.width/M),U(O.metadata,"mapHeight",f.height/M),U(O.metadata,"webglRenderer",f.renderer),U(O.metadata,"webglVendor",f.vendor),U(O.metadata,"sdkVersion",v),U(O.metadata,"sdkIdentifier","mapbox-gl-js"),O}(a);for(let f of u.metadata);for(let f of u.counters);for(let f of u.attributes);this.postEvent(n,u,()=>{},o)}},oe=ne.postPerformanceEvent.bind(ne),be=new class extends Ft{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,n,a,u){if(!S.API_URL||!S.SESSION_PATH)return;let f=kn(S.API_URL+S.SESSION_PATH);f.params.push(`sku=${n||""}`),f.params.push(`access_token=${u||S.ACCESS_TOKEN||""}`);let g={url:Un(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(y,T){return Je(De(y,{method:"GET"}),T)}(g,y=>{this.pendingRequest=null,a(y),this.saveEventData(),this.processRequests(u)})}getSessionAPI(o,n,a,u){this.skuToken=n,this.errorCb=u,S.SESSION_PATH&&S.API_URL&&(a||S.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Nn)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;let{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||this.getSession(a,this.skuToken,u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},o)}},Fe=be.getSessionAPI.bind(be),Ne=new Set,Ke={create:"create",load:"load",fullLoad:"fullLoad"},rt={mark(o){x.performance.mark(o)},measure(o,n,a){x.performance.measure(o,n,a)}};function Pt(o){let n=o.name.split("?")[0];return Ei(n)&&n.includes("mapbox-gl.js")?"javascript":Ei(n)&&n.includes("mapbox-gl.css")?"css":function(a){return S.API_FONTS_REGEX.test(a)}(n)?"fontRange":li(n)?"sprite":ln(n)?"style":function(a){return S.API_TILEJSON_REGEX.test(a)}(n)?"tilejson":"other"}let _t=x.performance;function Jt(o){let n=o?o.url.toString():void 0;return _t.getEntriesByName(n)}let Ht,cn,In,Wn,$n={now:()=>In!==void 0?In:x.performance.now(),setNow(o){In=o},restoreNow(){In=void 0},frame(o){let n=x.requestAnimationFrame(o);return{cancel:()=>x.cancelAnimationFrame(n)}},getImageData(o,n=0){let{width:a,height:u}=o;Wn||(Wn=x.document.createElement("canvas"));let f=Wn.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(a>Wn.width||u>Wn.height)&&(Wn.width=a,Wn.height=u),f.clearRect(-n,-n,a+2*n,u+2*n),f.drawImage(o,0,0,a,u),f.getImageData(-n,-n,a+2*n,u+2*n)},resolveURL:o=>(Ht||(Ht=x.document.createElement("a")),Ht.href=o,Ht.href),get devicePixelRatio(){return x.devicePixelRatio},get prefersReducedMotion(){return!!x.matchMedia&&(cn==null&&(cn=x.matchMedia("(prefers-reduced-motion: reduce)")),cn.matches)}};function hn(o,n,a){a[o]&&a[o].indexOf(n)!==-1||(a[o]=a[o]||[],a[o].push(n))}function yi(o,n,a){if(a&&a[o]){let u=a[o].indexOf(n);u!==-1&&a[o].splice(u,1)}}class Qn{constructor(n,a={}){De(this,a),this.type=n}}class Rr extends Qn{constructor(n,a={}){super("error",De({error:n},a))}}class Fr{on(n,a){return this._listeners=this._listeners||{},hn(n,a,this._listeners),this}off(n,a){return yi(n,a,this._listeners),yi(n,a,this._oneTimeListeners),this}once(n,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},hn(n,a,this._oneTimeListeners),this):new Promise(u=>this.once(n,u))}fire(n,a){typeof n=="string"&&(n=new Qn(n,a||{}));let u=n.type;if(this.listens(u)){n.target=this;let f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(let T of f)T.call(this,n);let g=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(let T of g)yi(u,T,this._oneTimeListeners),T.call(this,n);let y=this._eventedParent;y&&(De(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(n))}else n instanceof Rr&&console.error(n.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,a){return this._eventedParent=n,this._eventedParentData=a,this}}var Tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function hs(o,...n){for(let a of n)for(let u in a)o[u]=a[u];return o}function Si(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function As(o){if(Array.isArray(o))return o.map(As);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){let n={};for(let a in o)n[a]=As(o[a]);return n}return Si(o)}class ia extends Error{constructor(n,a){super(a),this.message=a,this.key=n}}var yr=ia;class Po{constructor(n,a=[]){this.parent=n,this.bindings={};for(let[u,f]of a)this.bindings[u]=f}concat(n){return new Po(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}var ko=Po;let La={kind:"null"},an={kind:"number"},di={kind:"string"},ci={kind:"boolean"},qe={kind:"color"},pn={kind:"object"},st={kind:"value"},Ye={kind:"collator"},ui={kind:"formatted"},Cn={kind:"resolvedImage"};function Mi(o,n){return{kind:"array",itemType:o,N:n}}function fi(o){if(o.kind==="array"){let n=fi(o.itemType);return typeof o.N=="number"?`array<${n}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${n}>`}return o.kind}let ra=[La,an,di,ci,qe,ui,pn,Mi(st),Cn];function Ir(o,n){if(n.kind==="error")return null;if(o.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Ir(o.itemType,n.itemType))&&(typeof o.N!="number"||o.N===n.N))return null}else{if(o.kind===n.kind)return null;if(o.kind==="value"){for(let a of ra)if(!Ir(a,n))return null}}return`Expected ${fi(o)} but found ${fi(n)} instead.`}function nc(o,n){return n.some(a=>a.kind===o.kind)}function zo(o,n){return n.some(a=>a==="null"?o===null:a==="array"?Array.isArray(o):a==="object"?o&&!Array.isArray(o)&&typeof o=="object":a===typeof o)}var mu,pl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ml(o){return(o=Math.round(o))<0?0:o>255?255:o}function sa(o){return ml(o[o.length-1]==="%"?parseFloat(o)/100*255:parseInt(o))}function Da(o){return(n=o[o.length-1]==="%"?parseFloat(o)/100:parseFloat(o))<0?0:n>1?1:n;var n}function Oi(o,n,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?o+(n-o)*a*6:2*a<1?n:3*a<2?o+(n-o)*(2/3-a)*6:o}try{mu={}.parseCSSColor=function(o){var n,a=o.replace(/ /g,"").toLowerCase();if(a in pl)return pl[a].slice();if(a[0]==="#")return a.length===4?(n=parseInt(a.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:a.length===7&&(n=parseInt(a.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var u=a.indexOf("("),f=a.indexOf(")");if(u!==-1&&f+1===a.length){var g=a.substr(0,u),y=a.substr(u+1,f-(u+1)).split(","),T=1;switch(g){case"rgba":if(y.length!==4)return null;T=Da(y.pop());case"rgb":return y.length!==3?null:[sa(y[0]),sa(y[1]),sa(y[2]),T];case"hsla":if(y.length!==4)return null;T=Da(y.pop());case"hsl":if(y.length!==3)return null;var M=(parseFloat(y[0])%360+360)%360/360,C=Da(y[1]),O=Da(y[2]),U=O<=.5?O*(C+1):O+C-O*C,V=2*O-U;return[ml(255*Oi(V,U,M+1/3)),ml(255*Oi(V,U,M)),ml(255*Oi(V,U,M-1/3)),T];default:return null}}return null}}catch(o){}class pr{constructor(n,a,u,f=1){this.r=n,this.g=a,this.b=u,this.a=f}static parse(n){if(!n)return;if(n instanceof pr)return n;if(typeof n!="string")return;let a=mu(n);return a?new pr(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){let[n,a,u,f]=this.toArray();return`rgba(${Math.round(n)},${Math.round(a)},${Math.round(u)},${f})`}toArray(){let{r:n,g:a,b:u,a:f}=this;return f===0?[0,0,0,0]:[255*n/f,255*a/f,255*u/f,f]}toArray01(){let{r:n,g:a,b:u,a:f}=this;return f===0?[0,0,0,0]:[n/f,a/f,u/f,f]}toArray01PremultipliedAlpha(){let{r:n,g:a,b:u,a:f}=this;return[n,a,u,f]}}pr.black=new pr(0,0,0,1),pr.white=new pr(1,1,1,1),pr.transparent=new pr(0,0,0,0),pr.red=new pr(1,0,0,1),pr.blue=new pr(0,0,1,1);var Vi=pr;class So{constructor(n,a,u){this.sensitivity=n?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,a){return this.collator.compare(n,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oo{constructor(n,a,u,f,g){this.text=n.normalize?n.normalize():n,this.image=a,this.scale=u,this.fontStack=f,this.textColor=g}}class Kr{constructor(n){this.sections=n}static fromString(n){return new Kr([new Oo(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Kr?n:Kr.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){let n=["format"];for(let a of this.sections){if(a.image){n.push(["image",a.image.name]);continue}n.push(a.text);let u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toArray())),n.push(u)}return n}}class jr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new jr({name:n,available:!1}):null}serialize(){return["image",this.name]}}function ic(o,n,a,u){return typeof o=="number"&&o>=0&&o<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof a=="number"&&a>=0&&a<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[o,n,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[o,n,a,u]:[o,n,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ra(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Vi||o instanceof So||o instanceof Kr||o instanceof jr)return!0;if(Array.isArray(o)){for(let n of o)if(!Ra(n))return!1;return!0}if(typeof o=="object"){for(let n in o)if(!Ra(o[n]))return!1;return!0}return!1}function vr(o){if(o===null)return La;if(typeof o=="string")return di;if(typeof o=="boolean")return ci;if(typeof o=="number")return an;if(o instanceof Vi)return qe;if(o instanceof So)return Ye;if(o instanceof Kr)return ui;if(o instanceof jr)return Cn;if(Array.isArray(o)){let n=o.length,a;for(let u of o){let f=vr(u);if(a){if(a===f)continue;a=st;break}a=f}return Mi(a||st,n)}return pn}function gu(o){let n=typeof o;return o===null?"":n==="string"||n==="number"||n==="boolean"?String(o):o instanceof Vi||o instanceof Kr||o instanceof jr?o.toString():JSON.stringify(o)}class sp{constructor(n,a){this.type=n,this.value=a}static parse(n,a){if(n.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Ra(n[1]))return a.error("invalid value");let u=n[1],f=vr(u),g=a.expectedType;return f.kind!=="array"||f.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(f=g),new sp(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vi?["rgba"].concat(this.value.toArray()):this.value instanceof Kr?this.value.serialize():this.value}}var _u=sp,ts=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};let Jh={string:di,number:an,boolean:ci,object:pn};class rc{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let u,f=1,g=n[0];if(g==="array"){let T,M;if(n.length>2){let C=n[1];if(typeof C!="string"||!(C in Jh)||C==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);T=Jh[C],f++}else T=st;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return a.error('The length argument to "array" must be a positive integer literal',2);M=n[2],f++}u=Mi(T,M)}else u=Jh[g];let y=[];for(;f<n.length;f++){let T=a.parse(n[f],f,st);if(!T)return null;y.push(T)}return new rc(u,y)}evaluate(n){for(let a=0;a<this.args.length;a++){let u=this.args[a].evaluate(n);if(!Ir(this.type,vr(u)))return u;if(a===this.args.length-1)throw new ts(`Expected value to be of type ${fi(this.type)}, but found ${fi(vr(u))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){let n=this.type,a=[n.kind];if(n.kind==="array"){let u=n.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);let f=n.N;(typeof f=="number"||this.args.length>1)&&a.push(f)}}return a.concat(this.args.map(u=>u.serialize()))}}var oa=rc;class yu{constructor(n){this.type=ui,this.sections=n}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let u=n[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");let f=[],g=!1;for(let y=1;y<=n.length-1;++y){let T=n[y];if(g&&typeof T=="object"&&!Array.isArray(T)){g=!1;let M=null;if(T["font-scale"]&&(M=a.parse(T["font-scale"],1,an),!M))return null;let C=null;if(T["text-font"]&&(C=a.parse(T["text-font"],1,Mi(di)),!C))return null;let O=null;if(T["text-color"]&&(O=a.parse(T["text-color"],1,qe),!O))return null;let U=f[f.length-1];U.scale=M,U.font=C,U.textColor=O}else{let M=a.parse(n[y],1,st);if(!M)return null;let C=M.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:M,scale:null,font:null,textColor:null})}}return new yu(f)}evaluate(n){return new Kr(this.sections.map(a=>{let u=a.content.evaluate(n);return vr(u)===Cn?new Oo("",u,null,null,null):new Oo(gu(u),null,a.scale?a.scale.evaluate(n):null,a.font?a.font.evaluate(n).join(","):null,a.textColor?a.textColor.evaluate(n):null)}))}eachChild(n){for(let a of this.sections)n(a.content),a.scale&&n(a.scale),a.font&&n(a.font),a.textColor&&n(a.textColor)}outputDefined(){return!1}serialize(){let n=["format"];for(let a of this.sections){n.push(a.content.serialize());let u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),n.push(u)}return n}}class $h{constructor(n){this.type=Cn,this.input=n}static parse(n,a){if(n.length!==2)return a.error("Expected two arguments.");let u=a.parse(n[1],1,di);return u?new $h(u):a.error("No image name provided.")}evaluate(n){let a=this.input.evaluate(n),u=jr.fromString(a);return u&&n.availableImages&&(u.available=n.availableImages.indexOf(a)>-1),u}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}let Ov={"to-boolean":ci,"to-color":qe,"to-number":an,"to-string":di};class op{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let u=n[0];if((u==="to-boolean"||u==="to-string")&&n.length!==2)return a.error("Expected one argument.");let f=Ov[u],g=[];for(let y=1;y<n.length;y++){let T=a.parse(n[y],y,st);if(!T)return null;g.push(T)}return new op(f,g)}evaluate(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){let a,u;for(let f of this.args){if(a=f.evaluate(n),u=null,a instanceof Vi)return a;if(typeof a=="string"){let g=n.parseColor(a);if(g)return g}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:ic(a[0],a[1],a[2],a[3]),!u))return new Vi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new ts(u||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(let u of this.args){if(a=u.evaluate(n),a===null)return 0;let f=Number(a);if(!isNaN(f))return f}throw new ts(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Kr.fromString(gu(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?jr.fromString(gu(this.args[0].evaluate(n))):gu(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new yu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $h(this.args[0]).serialize();let n=[`to-${this.type.kind}`];return this.eachChild(a=>{n.push(a.serialize())}),n}}var sc=op;let Yg=["Unknown","Point","LineString","Polygon"];var vu=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Yg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let o=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-o[0])+this.featureDistanceData.bearing[1]*(u*n-o[1])}return 0}parseColor(o){let n=this._parseColorCache[o];return n||(n=this._parseColorCache[o]=Vi.parse(o)),n}};class oc{constructor(n,a,u,f){this.name=n,this.type=a,this._evaluate=u,this.args=f}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,a){let u=n[0],f=oc.definitions[u];if(!f)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);let g=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,T=y.filter(([C])=>!Array.isArray(C)||C.length===n.length-1),M=null;for(let[C,O]of T){M=new dp(a.registry,a.path,null,a.scope);let U=[],V=!1;for(let q=1;q<n.length;q++){let J=n[q],ie=Array.isArray(C)?C[q-1]:C.type,_e=M.parse(J,1+U.length,ie);if(!_e){V=!0;break}U.push(_e)}if(!V)if(Array.isArray(C)&&C.length!==U.length)M.error(`Expected ${C.length} arguments, but found ${U.length} instead.`);else{for(let q=0;q<U.length;q++){let J=Array.isArray(C)?C[q]:C.type,ie=U[q];M.concat(q+1).checkSubtype(J,ie.type)}if(M.errors.length===0)return new oc(u,g,O,U)}}if(T.length===1)a.errors.push(...M.errors);else{let C=(T.length?T:y).map(([U])=>{return V=U,Array.isArray(V)?`(${V.map(fi).join(", ")})`:`(${fi(V.type)}...)`;var V}).join(" | "),O=[];for(let U=1;U<n.length;U++){let V=a.parse(n[U],1+O.length);if(!V)return null;O.push(fi(V.type))}a.error(`Expected arguments of type ${C}, but found (${O.join(", ")}) instead.`)}return null}static register(n,a){oc.definitions=a;for(let u in a)n[u]=oc}}var Pa=oc;class Qh{constructor(n,a,u){this.type=Ye,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=a}static parse(n,a){if(n.length!==2)return a.error("Expected one argument.");let u=n[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");let f=a.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,ci);if(!f)return null;let g=a.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,ci);if(!g)return null;let y=null;return u.locale&&(y=a.parse(u.locale,1,di),!y)?null:new Qh(f,g,y)}evaluate(n){return new So(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){let n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}let ka=8192;function so(o,n){o[0]=Math.min(o[0],n[0]),o[1]=Math.min(o[1],n[1]),o[2]=Math.max(o[2],n[0]),o[3]=Math.max(o[3],n[1])}function xu(o,n){return!(o[0]<=n[0]||o[2]>=n[2]||o[1]<=n[1]||o[3]>=n[3])}function Jg(o,n){let a=(180+o[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,f=Math.pow(2,n.z);return[Math.round(a*f*ka),Math.round(u*f*ka)]}function $g(o,n,a){let u=o[0]-n[0],f=o[1]-n[1],g=o[0]-a[0],y=o[1]-a[1];return u*y-g*f==0&&u*g<=0&&f*y<=0}function ed(o,n){let a=!1;for(let y=0,T=n.length;y<T;y++){let M=n[y];for(let C=0,O=M.length;C<O-1;C++){if($g(o,M[C],M[C+1]))return!1;(f=M[C])[1]>(u=o)[1]!=(g=M[C+1])[1]>u[1]&&u[0]<(g[0]-f[0])*(u[1]-f[1])/(g[1]-f[1])+f[0]&&(a=!a)}}var u,f,g;return a}function Qg(o,n){for(let a=0;a<n.length;a++)if(ed(o,n[a]))return!0;return!1}function ap(o,n,a,u){let f=u[0]-a[0],g=u[1]-a[1],y=(o[0]-a[0])*g-f*(o[1]-a[1]),T=(n[0]-a[0])*g-f*(n[1]-a[1]);return y>0&&T<0||y<0&&T>0}function lp(o,n,a){for(let C of a)for(let O=0;O<C.length-1;++O)if((T=[(y=C[O+1])[0]-(g=C[O])[0],y[1]-g[1]])[0]*(M=[(f=n)[0]-(u=o)[0],f[1]-u[1]])[1]-T[1]*M[0]!=0&&ap(u,f,g,y)&&ap(g,y,u,f))return!0;var u,f,g,y,T,M;return!1}function ac(o,n){for(let a=0;a<o.length;++a)if(!ed(o[a],n))return!1;for(let a=0;a<o.length-1;++a)if(lp(o[a],o[a+1],n))return!1;return!0}function e_(o,n){for(let a=0;a<n.length;a++)if(ac(o,n[a]))return!0;return!1}function td(o,n,a){let u=[];for(let f=0;f<o.length;f++){let g=[];for(let y=0;y<o[f].length;y++){let T=Jg(o[f][y],a);so(n,T),g.push(T)}u.push(g)}return u}function nd(o,n,a){let u=[];for(let f=0;f<o.length;f++){let g=td(o[f],n,a);u.push(g)}return u}function cp(o,n,a,u){if(o[0]<a[0]||o[0]>a[2]){let f=.5*u,g=o[0]-a[0]>f?-u:a[0]-o[0]>f?u:0;g===0&&(g=o[0]-a[2]>f?-u:a[2]-o[0]>f?u:0),o[0]+=g}so(n,o)}function gl(o,n,a,u){let f=Math.pow(2,u.z)*ka,g=[u.x*ka,u.y*ka],y=[];if(!o)return y;for(let T of o)for(let M of T){let C=[M.x+g[0],M.y+g[1]];cp(C,n,a,f),y.push(C)}return y}function Ni(o,n,a,u){let f=Math.pow(2,u.z)*ka,g=[u.x*ka,u.y*ka],y=[];if(!o)return y;for(let M of o){let C=[];for(let O of M){let U=[O.x+g[0],O.y+g[1]];so(n,U),C.push(U)}y.push(C)}if(n[2]-n[0]<=f/2){(T=n)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(let M of y)for(let C of M)cp(C,n,a,f)}var T;return y}class bu{constructor(n,a){this.type=ci,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ra(n[1])){let u=n[1];if(u.type==="FeatureCollection")for(let f=0;f<u.features.length;++f){let g=u.features[f].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new bu(u,u.features[f].geometry)}else if(u.type==="Feature"){let f=u.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new bu(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new bu(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(a,u){let f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(u.type==="Polygon"){let T=td(u.coordinates,g,y),M=gl(a.geometry(),f,g,y);if(!xu(f,g))return!1;for(let C of M)if(!ed(C,T))return!1}if(u.type==="MultiPolygon"){let T=nd(u.coordinates,g,y),M=gl(a.geometry(),f,g,y);if(!xu(f,g))return!1;for(let C of M)if(!Qg(C,T))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(a,u){let f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(u.type==="Polygon"){let T=td(u.coordinates,g,y),M=Ni(a.geometry(),f,g,y);if(!xu(f,g))return!1;for(let C of M)if(!ac(C,T))return!1}if(u.type==="MultiPolygon"){let T=nd(u.coordinates,g,y),M=Ni(a.geometry(),f,g,y);if(!xu(f,g))return!1;for(let C of M)if(!e_(C,T))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var up=bu;function wu(o){if(o instanceof Pa&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof up)return!1;let n=!0;return o.eachChild(a=>{n&&!wu(a)&&(n=!1)}),n}function Tu(o){if(o instanceof Pa&&o.name==="feature-state")return!1;let n=!0;return o.eachChild(a=>{n&&!Tu(a)&&(n=!1)}),n}function id(o,n){if(o instanceof Pa&&n.indexOf(o.name)>=0)return!1;let a=!0;return o.eachChild(u=>{a&&!id(u,n)&&(a=!1)}),a}class rd{constructor(n,a){this.type=a.type,this.name=n,this.boundExpression=a}static parse(n,a){if(n.length!==2||typeof n[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");let u=n[1];return a.scope.has(u)?new rd(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var hp=rd;class sd{constructor(n,a=[],u,f=new ko,g=[]){this.registry=n,this.path=a,this.key=a.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=g,this.expectedType=u}parse(n,a,u,f,g={}){return a?this.concat(a,u,f)._parse(n,g):this._parse(n,g)}_parse(n,a){function u(f,g,y){return y==="assert"?new oa(g,[f]):y==="coerce"?new sc(g,[f]):f}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let f=n[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let g=this.registry[f];if(g){let y=g.parse(n,this);if(!y)return null;if(this.expectedType){let T=this.expectedType,M=y.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||M.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(T,M))return null}else y=u(y,T,a.typeAnnotation||"coerce");else y=u(y,T,a.typeAnnotation||"assert")}if(!(y instanceof _u)&&y.type.kind!=="resolvedImage"&&za(y)){let T=new vu;try{y=new _u(y.type,y.evaluate(T))}catch(M){return this.error(M.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,a,u){let f=typeof n=="number"?this.path.concat(n):this.path,g=u?this.scope.concat(u):this.scope;return new sd(this.registry,f,a||null,g,this.errors)}error(n,...a){let u=`${this.key}${a.map(f=>`[${f}]`).join("")}`;this.errors.push(new yr(u,n))}checkSubtype(n,a){let u=Ir(n,a);return u&&this.error(u),u}}var dp=sd;function za(o){if(o instanceof hp)return za(o.boundExpression);if(o instanceof Pa&&o.name==="error"||o instanceof Qh||o instanceof up)return!1;let n=o instanceof sc||o instanceof oa,a=!0;return o.eachChild(u=>{a=n?a&&za(u):a&&u instanceof _u}),!!a&&wu(o)&&id(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function _l(o,n){let a=o.length-1,u,f,g=0,y=a,T=0;for(;g<=y;)if(T=Math.floor((g+y)/2),u=o[T],f=o[T+1],u<=n){if(T===a||n<f)return T;g=T+1}else{if(!(u>n))throw new ts("Input is not a number.");y=T-1}return 0}class od{constructor(n,a,u){this.type=n,this.input=a,this.labels=[],this.outputs=[];for(let[f,g]of u)this.labels.push(f),this.outputs.push(g)}static parse(n,a){if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");let u=a.parse(n[1],1,an);if(!u)return null;let f=[],g=null;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);for(let y=1;y<n.length;y+=2){let T=y===1?-1/0:n[y],M=n[y+1],C=y,O=y+1;if(typeof T!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(f.length&&f[f.length-1][0]>=T)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);let U=a.parse(M,O,g);if(!U)return null;g=g||U.type,f.push([T,U])}return new od(g,u,f)}evaluate(n){let a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(n);let f=this.input.evaluate(n);if(f<=a[0])return u[0].evaluate(n);let g=a.length;return f>=a[g-1]?u[g-1].evaluate(n):u[_l(a,f)].evaluate(n)}eachChild(n){n(this.input);for(let a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&n.push(this.labels[a]),n.push(this.outputs[a].serialize());return n}}var fp=od;function Li(o,n,a){return o*(1-a)+n*a}var Eu=Object.freeze({__proto__:null,number:Li,color:function(o,n,a){return new Vi(Li(o.r,n.r,a),Li(o.g,n.g,a),Li(o.b,n.b,a),Li(o.a,n.a,a))},array:function(o,n,a){return o.map((u,f)=>Li(u,n[f],a))}});let t_=.95047,n_=1.08883,pp=4/29,mp=6/29,gp=3*mp*mp,i_=Math.PI/180,Nv=180/Math.PI;function ad(o){return o>.008856451679035631?Math.pow(o,1/3):o/gp+pp}function _p(o){return o>mp?o*o*o:gp*(o-pp)}function ld(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function cd(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function r_(o){let n=cd(o.r),a=cd(o.g),u=cd(o.b),f=ad((.4124564*n+.3575761*a+.1804375*u)/t_),g=ad((.2126729*n+.7151522*a+.072175*u)/1);return{l:116*g-16,a:500*(f-g),b:200*(g-ad((.0193339*n+.119192*a+.9503041*u)/n_)),alpha:o.a}}function s_(o){let n=(o.l+16)/116,a=isNaN(o.a)?n:n+o.a/500,u=isNaN(o.b)?n:n-o.b/200;return n=1*_p(n),a=t_*_p(a),u=n_*_p(u),new Vi(ld(3.2404542*a-1.5371385*n-.4985314*u),ld(-.969266*a+1.8760108*n+.041556*u),ld(.0556434*a-.2040259*n+1.0572252*u),o.alpha)}function Fv(o,n,a){let u=n-o;return o+a*(u>180||u<-180?u-360*Math.round(u/360):u)}let Su={forward:r_,reverse:s_,interpolate:function(o,n,a){return{l:Li(o.l,n.l,a),a:Li(o.a,n.a,a),b:Li(o.b,n.b,a),alpha:Li(o.alpha,n.alpha,a)}}},Au={forward:function(o){let{l:n,a,b:u}=r_(o),f=Math.atan2(u,a)*Nv;return{h:f<0?f+360:f,c:Math.sqrt(a*a+u*u),l:n,alpha:o.a}},reverse:function(o){let n=o.h*i_,a=o.c;return s_({l:o.l,a:Math.cos(n)*a,b:Math.sin(n)*a,alpha:o.alpha})},interpolate:function(o,n,a){return{h:Fv(o.h,n.h,a),c:Li(o.c,n.c,a),l:Li(o.l,n.l,a),alpha:Li(o.alpha,n.alpha,a)}}};var o_=Object.freeze({__proto__:null,lab:Su,hcl:Au});class Mu{constructor(n,a,u,f,g){this.type=n,this.operator=a,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(let[y,T]of g)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(n,a,u,f){let g=0;if(n.name==="exponential")g=yp(a,n.base,u,f);else if(n.name==="linear")g=yp(a,1,u,f);else if(n.name==="cubic-bezier"){let y=n.controlPoints;g=new $(y[0],y[1],y[2],y[3]).solve(yp(a,1,u,f))}return g}static parse(n,a){let[u,f,g,...y]=n;if(!Array.isArray(f)||f.length===0)return a.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){let C=f[1];if(typeof C!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:C}}else{if(f[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(f[0])}`,1,0);{let C=f.slice(1);if(C.length!==4||C.some(O=>typeof O!="number"||O<0||O>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:C}}}if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(g=a.parse(g,2,an),!g)return null;let T=[],M=null;u==="interpolate-hcl"||u==="interpolate-lab"?M=qe:a.expectedType&&a.expectedType.kind!=="value"&&(M=a.expectedType);for(let C=0;C<y.length;C+=2){let O=y[C],U=y[C+1],V=C+3,q=C+4;if(typeof O!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(T.length&&T[T.length-1][0]>=O)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);let J=a.parse(U,q,M);if(!J)return null;M=M||J.type,T.push([O,J])}return M.kind==="number"||M.kind==="color"||M.kind==="array"&&M.itemType.kind==="number"&&typeof M.N=="number"?new Mu(M,u,f,g,T):a.error(`Type ${fi(M)} is not interpolatable.`)}evaluate(n){let a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(n);let f=this.input.evaluate(n);if(f<=a[0])return u[0].evaluate(n);let g=a.length;if(f>=a[g-1])return u[g-1].evaluate(n);let y=_l(a,f),T=Mu.interpolationFactor(this.interpolation,f,a[y],a[y+1]),M=u[y].evaluate(n),C=u[y+1].evaluate(n);return this.operator==="interpolate"?Eu[this.type.kind.toLowerCase()](M,C,T):this.operator==="interpolate-hcl"?Au.reverse(Au.interpolate(Au.forward(M),Au.forward(C),T)):Su.reverse(Su.interpolate(Su.forward(M),Su.forward(C),T))}eachChild(n){n(this.input);for(let a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let a=[this.operator,n,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function yp(o,n,a,u){let f=u-a,g=o-a;return f===0?0:n===1?g/f:(Math.pow(n,g)-1)/(Math.pow(n,f)-1)}var No=Mu;class vp{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expectected at least one argument.");let u=null,f=a.expectedType;f&&f.kind!=="value"&&(u=f);let g=[];for(let T of n.slice(1)){let M=a.parse(T,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,g.push(M)}let y=f&&g.some(T=>Ir(f,T.type));return new vp(y?st:u,g)}evaluate(n){let a,u=null,f=0;for(let g of this.args){if(f++,u=g.evaluate(n),u&&u instanceof jr&&!u.available&&(a||(a=u),u=null,f===this.args.length))return a;if(u!==null)break}return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){let n=["coalesce"];return this.eachChild(a=>{n.push(a.serialize())}),n}}var a_=vp;class ud{constructor(n,a){this.type=a.type,this.bindings=[].concat(n),this.result=a}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(let a of this.bindings)n(a[1]);n(this.result)}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);let u=[];for(let g=1;g<n.length-1;g+=2){let y=n[g];if(typeof y!="string")return a.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",g);let T=a.parse(n[g+1],g+1);if(!T)return null;u.push([y,T])}let f=a.parse(n[n.length-1],n.length-1,a.expectedType,u);return f?new ud(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){let n=["let"];for(let[a,u]of this.bindings)n.push(a,u.serialize());return n.push(this.result.serialize()),n}}var xp=ud;class hd{constructor(n,a,u){this.type=n,this.index=a,this.input=u}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);let u=a.parse(n[1],1,an),f=a.parse(n[2],2,Mi(a.expectedType||st));return u&&f?new hd(f.type.itemType,u,f):null}evaluate(n){let a=this.index.evaluate(n),u=this.input.evaluate(n);if(a<0)throw new ts(`Array index out of bounds: ${a} < 0.`);if(a>=u.length)throw new ts(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a!==Math.floor(a))throw new ts(`Array index must be an integer, but found ${a} instead.`);return u[a]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Bv=hd;class bp{constructor(n,a){this.type=ci,this.needle=n,this.haystack=a}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);let u=a.parse(n[1],1,st),f=a.parse(n[2],2,st);return u&&f?nc(u.type,[ci,di,an,La,st])?new bp(u,f):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${fi(u.type)} instead`):null}evaluate(n){let a=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(u==null)return!1;if(!zo(a,["boolean","string","number","null"]))throw new ts(`Expected first argument to be of type boolean, string, number or null, but found ${fi(vr(a))} instead.`);if(!zo(u,["string","array"]))throw new ts(`Expected second argument to be of type array or string, but found ${fi(vr(u))} instead.`);return u.indexOf(a)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var l_=bp;class Iu{constructor(n,a,u){this.type=an,this.needle=n,this.haystack=a,this.fromIndex=u}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);let u=a.parse(n[1],1,st),f=a.parse(n[2],2,st);if(!u||!f)return null;if(!nc(u.type,[ci,di,an,La,st]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${fi(u.type)} instead`);if(n.length===4){let g=a.parse(n[3],3,an);return g?new Iu(u,f,g):null}return new Iu(u,f)}evaluate(n){let a=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!zo(a,["boolean","string","number","null"]))throw new ts(`Expected first argument to be of type boolean, string, number or null, but found ${fi(vr(a))} instead.`);if(!zo(u,["string","array"]))throw new ts(`Expected second argument to be of type array or string, but found ${fi(vr(u))} instead.`);if(this.fromIndex){let f=this.fromIndex.evaluate(n);return u.indexOf(a,f)}return u.indexOf(a)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var c_=Iu;class wp{constructor(n,a,u,f,g,y){this.inputType=n,this.type=a,this.input=u,this.cases=f,this.outputs=g,this.otherwise=y}static parse(n,a){if(n.length<5)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return a.error("Expected an even number of arguments.");let u,f;a.expectedType&&a.expectedType.kind!=="value"&&(f=a.expectedType);let g={},y=[];for(let C=2;C<n.length-1;C+=2){let O=n[C],U=n[C+1];Array.isArray(O)||(O=[O]);let V=a.concat(C);if(O.length===0)return V.error("Expected at least one branch label.");for(let J of O){if(typeof J!="number"&&typeof J!="string")return V.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return V.error("Numeric branch labels must be integer values.");if(u){if(V.checkSubtype(u,vr(J)))return null}else u=vr(J);if(g[String(J)]!==void 0)return V.error("Branch labels must be unique.");g[String(J)]=y.length}let q=a.parse(U,C,f);if(!q)return null;f=f||q.type,y.push(q)}let T=a.parse(n[1],1,st);if(!T)return null;let M=a.parse(n[n.length-1],n.length-1,f);return M?T.type.kind!=="value"&&a.concat(1).checkSubtype(u,T.type)?null:new wp(u,f,T,g,y,M):null}evaluate(n){let a=this.input.evaluate(n);return(vr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let n=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],f={};for(let y of a){let T=f[this.cases[y]];T===void 0?(f[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[T][1].push(y)}let g=y=>this.inputType.kind==="number"?Number(y):y;for(let[y,T]of u)n.push(T.length===1?g(T[0]):T.map(g)),n.push(this.outputs[y].serialize());return n.push(this.otherwise.serialize()),n}}var Uv=wp;class Tp{constructor(n,a,u){this.type=n,this.branches=a,this.otherwise=u}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);let f=[];for(let y=1;y<n.length-1;y+=2){let T=a.parse(n[y],y,ci);if(!T)return null;let M=a.parse(n[y+1],y+1,u);if(!M)return null;f.push([T,M]),u=u||M.type}let g=a.parse(n[n.length-1],n.length-1,u);return g?new Tp(u,f,g):null}evaluate(n){for(let[a,u]of this.branches)if(a.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(let[a,u]of this.branches)n(a),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){let n=["case"];return this.eachChild(a=>{n.push(a.serialize())}),n}}var Vv=Tp;class yl{constructor(n,a,u,f){this.type=n,this.input=a,this.beginIndex=u,this.endIndex=f}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);let u=a.parse(n[1],1,st),f=a.parse(n[2],2,an);if(!u||!f)return null;if(!nc(u.type,[Mi(st),di,st]))return a.error(`Expected first argument to be of type array or string, but found ${fi(u.type)} instead`);if(n.length===4){let g=a.parse(n[3],3,an);return g?new yl(u.type,u,f,g):null}return new yl(u.type,u,f)}evaluate(n){let a=this.input.evaluate(n),u=this.beginIndex.evaluate(n);if(!zo(a,["string","array"]))throw new ts(`Expected first argument to be of type array or string, but found ${fi(vr(a))} instead.`);if(this.endIndex){let f=this.endIndex.evaluate(n);return a.slice(u,f)}return a.slice(u)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var u_=yl;function Ep(o,n){return o==="=="||o==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function h_(o,n,a,u){return u.compare(n,a)===0}function lc(o,n,a){let u=o!=="=="&&o!=="!=";return class _L{constructor(g,y,T){this.type=ci,this.lhs=g,this.rhs=y,this.collator=T,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");let T=g[0],M=y.parse(g[1],1,st);if(!M)return null;if(!Ep(T,M.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${fi(M.type)}'.`);let C=y.parse(g[2],2,st);if(!C)return null;if(!Ep(T,C.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${fi(C.type)}'.`);if(M.type.kind!==C.type.kind&&M.type.kind!=="value"&&C.type.kind!=="value")return y.error(`Cannot compare types '${fi(M.type)}' and '${fi(C.type)}'.`);u&&(M.type.kind==="value"&&C.type.kind!=="value"?M=new oa(C.type,[M]):M.type.kind!=="value"&&C.type.kind==="value"&&(C=new oa(M.type,[C])));let O=null;if(g.length===4){if(M.type.kind!=="string"&&C.type.kind!=="string"&&M.type.kind!=="value"&&C.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(O=y.parse(g[3],3,Ye),!O)return null}return new _L(M,C,O)}evaluate(g){let y=this.lhs.evaluate(g),T=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){let M=vr(y),C=vr(T);if(M.kind!==C.kind||M.kind!=="string"&&M.kind!=="number")throw new ts(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${M.kind}, ${C.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){let M=vr(y),C=vr(T);if(M.kind!=="string"||C.kind!=="string")return n(g,y,T)}return this.collator?a(g,y,T,this.collator.evaluate(g)):n(g,y,T)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){let g=[o];return this.eachChild(y=>{g.push(y.serialize())}),g}}}let Gv=lc("==",function(o,n,a){return n===a},h_),d_=lc("!=",function(o,n,a){return n!==a},function(o,n,a,u){return!h_(0,n,a,u)}),f_=lc("<",function(o,n,a){return n<a},function(o,n,a,u){return u.compare(n,a)<0}),p_=lc(">",function(o,n,a){return n>a},function(o,n,a,u){return u.compare(n,a)>0}),Sp=lc("<=",function(o,n,a){return n<=a},function(o,n,a,u){return u.compare(n,a)<=0}),Hv=lc(">=",function(o,n,a){return n>=a},function(o,n,a,u){return u.compare(n,a)>=0});class Ap{constructor(n,a,u,f,g,y){this.type=di,this.number=n,this.locale=a,this.currency=u,this.unit=f,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(n,a){if(n.length!==3)return a.error("Expected two arguments.");let u=a.parse(n[1],1,an);if(!u)return null;let f=n[2];if(typeof f!="object"||Array.isArray(f))return a.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=a.parse(f.locale,1,di),!g))return null;let y=null;if(f.currency&&(y=a.parse(f.currency,1,di),!y))return null;let T=null;if(f.unit&&(T=a.parse(f.unit,1,di),!T))return null;let M=null;if(f["min-fraction-digits"]&&(M=a.parse(f["min-fraction-digits"],1,an),!M))return null;let C=null;return f["max-fraction-digits"]&&(C=a.parse(f["max-fraction-digits"],1,an),!C)?null:new Ap(u,g,y,T,M,C)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Mp{constructor(n){this.type=an,this.input=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);let u=a.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${fi(u.type)} instead.`):new Mp(u):null}evaluate(n){let a=this.input.evaluate(n);if(typeof a=="string"||Array.isArray(a))return a.length;throw new ts(`Expected value to be of type string or array, but found ${fi(vr(a))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){let n=["length"];return this.eachChild(a=>{n.push(a.serialize())}),n}}let m_={"==":Gv,"!=":d_,">":p_,"<":f_,">=":Hv,"<=":Sp,array:oa,at:Bv,boolean:oa,case:Vv,coalesce:a_,collator:Qh,format:yu,image:$h,in:l_,"index-of":c_,interpolate:No,"interpolate-hcl":No,"interpolate-lab":No,length:Mp,let:xp,literal:_u,match:Uv,number:oa,"number-format":Ap,object:oa,slice:u_,step:fp,string:oa,"to-boolean":sc,"to-color":sc,"to-number":sc,"to-string":sc,var:hp,within:up};function g_(o,[n,a,u,f]){n=n.evaluate(o),a=a.evaluate(o),u=u.evaluate(o);let g=f?f.evaluate(o):1,y=ic(n,a,u,g);if(y)throw new ts(y);return new Vi(n/255*g,a/255*g,u/255*g,g)}function __(o,n){return o in n}function Ip(o,n){let a=n[o];return a===void 0?null:a}function Oa(o){return{type:o}}Pa.register(m_,{error:[{kind:"error"},[di],(o,[n])=>{throw new ts(n.evaluate(o))}],typeof:[di,[st],(o,[n])=>fi(vr(n.evaluate(o)))],"to-rgba":[Mi(an,4),[qe],(o,[n])=>n.evaluate(o).toArray()],rgb:[qe,[an,an,an],g_],rgba:[qe,[an,an,an,an],g_],has:{type:ci,overloads:[[[di],(o,[n])=>__(n.evaluate(o),o.properties())],[[di,pn],(o,[n,a])=>__(n.evaluate(o),a.evaluate(o))]]},get:{type:st,overloads:[[[di],(o,[n])=>Ip(n.evaluate(o),o.properties())],[[di,pn],(o,[n,a])=>Ip(n.evaluate(o),a.evaluate(o))]]},"feature-state":[st,[di],(o,[n])=>Ip(n.evaluate(o),o.featureState||{})],properties:[pn,[],o=>o.properties()],"geometry-type":[di,[],o=>o.geometryType()],id:[st,[],o=>o.id()],zoom:[an,[],o=>o.globals.zoom],pitch:[an,[],o=>o.globals.pitch||0],"distance-from-center":[an,[],o=>o.distanceFromCenter()],"heatmap-density":[an,[],o=>o.globals.heatmapDensity||0],"line-progress":[an,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[an,[],o=>o.globals.skyRadialProgress||0],accumulated:[st,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[an,Oa(an),(o,n)=>{let a=0;for(let u of n)a+=u.evaluate(o);return a}],"*":[an,Oa(an),(o,n)=>{let a=1;for(let u of n)a*=u.evaluate(o);return a}],"-":{type:an,overloads:[[[an,an],(o,[n,a])=>n.evaluate(o)-a.evaluate(o)],[[an],(o,[n])=>-n.evaluate(o)]]},"/":[an,[an,an],(o,[n,a])=>n.evaluate(o)/a.evaluate(o)],"%":[an,[an,an],(o,[n,a])=>n.evaluate(o)%a.evaluate(o)],ln2:[an,[],()=>Math.LN2],pi:[an,[],()=>Math.PI],e:[an,[],()=>Math.E],"^":[an,[an,an],(o,[n,a])=>Math.pow(n.evaluate(o),a.evaluate(o))],sqrt:[an,[an],(o,[n])=>Math.sqrt(n.evaluate(o))],log10:[an,[an],(o,[n])=>Math.log(n.evaluate(o))/Math.LN10],ln:[an,[an],(o,[n])=>Math.log(n.evaluate(o))],log2:[an,[an],(o,[n])=>Math.log(n.evaluate(o))/Math.LN2],sin:[an,[an],(o,[n])=>Math.sin(n.evaluate(o))],cos:[an,[an],(o,[n])=>Math.cos(n.evaluate(o))],tan:[an,[an],(o,[n])=>Math.tan(n.evaluate(o))],asin:[an,[an],(o,[n])=>Math.asin(n.evaluate(o))],acos:[an,[an],(o,[n])=>Math.acos(n.evaluate(o))],atan:[an,[an],(o,[n])=>Math.atan(n.evaluate(o))],min:[an,Oa(an),(o,n)=>Math.min(...n.map(a=>a.evaluate(o)))],max:[an,Oa(an),(o,n)=>Math.max(...n.map(a=>a.evaluate(o)))],abs:[an,[an],(o,[n])=>Math.abs(n.evaluate(o))],round:[an,[an],(o,[n])=>{let a=n.evaluate(o);return a<0?-Math.round(-a):Math.round(a)}],floor:[an,[an],(o,[n])=>Math.floor(n.evaluate(o))],ceil:[an,[an],(o,[n])=>Math.ceil(n.evaluate(o))],"filter-==":[ci,[di,st],(o,[n,a])=>o.properties()[n.value]===a.value],"filter-id-==":[ci,[st],(o,[n])=>o.id()===n.value],"filter-type-==":[ci,[di],(o,[n])=>o.geometryType()===n.value],"filter-<":[ci,[di,st],(o,[n,a])=>{let u=o.properties()[n.value],f=a.value;return typeof u==typeof f&&u<f}],"filter-id-<":[ci,[st],(o,[n])=>{let a=o.id(),u=n.value;return typeof a==typeof u&&a<u}],"filter->":[ci,[di,st],(o,[n,a])=>{let u=o.properties()[n.value],f=a.value;return typeof u==typeof f&&u>f}],"filter-id->":[ci,[st],(o,[n])=>{let a=o.id(),u=n.value;return typeof a==typeof u&&a>u}],"filter-<=":[ci,[di,st],(o,[n,a])=>{let u=o.properties()[n.value],f=a.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[ci,[st],(o,[n])=>{let a=o.id(),u=n.value;return typeof a==typeof u&&a<=u}],"filter->=":[ci,[di,st],(o,[n,a])=>{let u=o.properties()[n.value],f=a.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[ci,[st],(o,[n])=>{let a=o.id(),u=n.value;return typeof a==typeof u&&a>=u}],"filter-has":[ci,[st],(o,[n])=>n.value in o.properties()],"filter-has-id":[ci,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[ci,[Mi(di)],(o,[n])=>n.value.indexOf(o.geometryType())>=0],"filter-id-in":[ci,[Mi(st)],(o,[n])=>n.value.indexOf(o.id())>=0],"filter-in-small":[ci,[di,Mi(st)],(o,[n,a])=>a.value.indexOf(o.properties()[n.value])>=0],"filter-in-large":[ci,[di,Mi(st)],(o,[n,a])=>function(u,f,g,y){for(;g<=y;){let T=g+y>>1;if(f[T]===u)return!0;f[T]>u?y=T-1:g=T+1}return!1}(o.properties()[n.value],a.value,0,a.value.length-1)],all:{type:ci,overloads:[[[ci,ci],(o,[n,a])=>n.evaluate(o)&&a.evaluate(o)],[Oa(ci),(o,n)=>{for(let a of n)if(!a.evaluate(o))return!1;return!0}]]},any:{type:ci,overloads:[[[ci,ci],(o,[n,a])=>n.evaluate(o)||a.evaluate(o)],[Oa(ci),(o,n)=>{for(let a of n)if(a.evaluate(o))return!0;return!1}]]},"!":[ci,[ci],(o,[n])=>!n.evaluate(o)],"is-supported-script":[ci,[di],(o,[n])=>{let a=o.globals&&o.globals.isSupportedScript;return!a||a(n.evaluate(o))}],upcase:[di,[di],(o,[n])=>n.evaluate(o).toUpperCase()],downcase:[di,[di],(o,[n])=>n.evaluate(o).toLowerCase()],concat:[di,Oa(st),(o,n)=>n.map(a=>gu(a.evaluate(o))).join("")],"resolved-locale":[di,[Ye],(o,[n])=>n.evaluate(o).resolvedLocale()]});var cc=m_;function Cu(o){return{result:"success",value:o}}function uc(o){return{result:"error",value:o}}function hc(o){return o["property-type"]==="data-driven"}function aa(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function dd(o){return!!o.expression&&o.expression.interpolated}function Ci(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function fd(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function jv(o){return o}function Cp(o,n){let a=n.type==="color",u=o.stops&&typeof o.stops[0][0]=="object",f=u||!(u||o.property!==void 0),g=o.type||(dd(n)?"exponential":"interval");if(a&&((o=hs({},o)).stops&&(o.stops=o.stops.map(C=>[C[0],Vi.parse(C[1])])),o.default=Vi.parse(o.default?o.default:n.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!o_[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let y,T,M;if(g==="exponential")y=pd;else if(g==="interval")y=y_;else if(g==="categorical"){y=Lp,T=Object.create(null);for(let C of o.stops)T[C[0]]=C[1];M=typeof o.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=v_}if(u){let C={},O=[];for(let q=0;q<o.stops.length;q++){let J=o.stops[q],ie=J[0].zoom;C[ie]===void 0&&(C[ie]={zoom:ie,type:o.type,property:o.property,default:o.default,stops:[]},O.push(ie)),C[ie].stops.push([J[0].value,J[1]])}let U=[];for(let q of O)U.push([C[q].zoom,Cp(C[q],n)]);let V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:No.interpolationFactor.bind(void 0,V),zoomStops:U.map(q=>q[0]),evaluate:({zoom:q},J)=>pd({stops:U,base:o.base},n,q).evaluate(q,J)}}if(f){let C=g==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:No.interpolationFactor.bind(void 0,C),zoomStops:o.stops.map(O=>O[0]),evaluate:({zoom:O})=>y(o,n,O,T,M)}}return{kind:"source",evaluate(C,O){let U=O&&O.properties?O.properties[o.property]:void 0;return U===void 0?Lu(o.default,n.default):y(o,n,U,T,M)}}}function Lu(o,n,a){return o!==void 0?o:n!==void 0?n:a!==void 0?a:void 0}function Lp(o,n,a,u,f){return Lu(typeof a===f?u[a]:void 0,o.default,n.default)}function y_(o,n,a){if(Ci(a)!=="number")return Lu(o.default,n.default);let u=o.stops.length;if(u===1||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[u-1][0])return o.stops[u-1][1];let f=_l(o.stops.map(g=>g[0]),a);return o.stops[f][1]}function pd(o,n,a){let u=o.base!==void 0?o.base:1;if(Ci(a)!=="number")return Lu(o.default,n.default);let f=o.stops.length;if(f===1||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[f-1][0])return o.stops[f-1][1];let g=_l(o.stops.map(O=>O[0]),a),y=function(O,U,V,q){let J=q-V,ie=O-V;return J===0?0:U===1?ie/J:(Math.pow(U,ie)-1)/(Math.pow(U,J)-1)}(a,u,o.stops[g][0],o.stops[g+1][0]),T=o.stops[g][1],M=o.stops[g+1][1],C=Eu[n.type]||jv;if(o.colorSpace&&o.colorSpace!=="rgb"){let O=o_[o.colorSpace];C=(U,V)=>O.reverse(O.interpolate(O.forward(U),O.forward(V),y))}return typeof T.evaluate=="function"?{evaluate(...O){let U=T.evaluate.apply(void 0,O),V=M.evaluate.apply(void 0,O);if(U!==void 0&&V!==void 0)return C(U,V,y)}}:C(T,M,y)}function v_(o,n,a){return n.type==="color"?a=Vi.parse(a):n.type==="formatted"?a=Kr.fromString(a.toString()):n.type==="resolvedImage"?a=jr.fromString(a.toString()):Ci(a)===n.type||n.type==="enum"&&n.values[a]||(a=void 0),Lu(a,o.default,n.default)}class md{constructor(n,a){this.expression=n,this._warningHistory={},this._evaluator=new vu,this._defaultValue=a?function(u){return u.type==="color"&&(fd(u.default)||Array.isArray(u.default))?new Vi(0,0,0,0):u.type==="color"?Vi.parse(u.default)||null:u.default===void 0?null:u.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(n,a,u,f,g,y,T,M){return this._evaluator.globals=n,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=M||null,this.expression.evaluate(this._evaluator)}evaluate(n,a,u,f,g,y,T,M){this._evaluator.globals=n,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=M||null;try{let C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new ts(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console!="undefined"&&console.warn(C.message)),this._defaultValue}}}function dc(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in cc}function fc(o,n){let a=new dp(cc,[],n?function(f){let g={color:qe,string:di,number:an,enum:di,boolean:ci,formatted:ui,resolvedImage:Cn};return f.type==="array"?Mi(g[f.value]||st,f.length):g[f.type]}(n):void 0),u=a.parse(o,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Cu(new md(u,n)):uc(a.errors)}class gd{constructor(n,a){this.kind=n,this._styleExpression=a,this.isStateDependent=n!=="constant"&&!Tu(a.expression)}evaluateWithoutErrorHandling(n,a,u,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(n,a,u,f,g,y)}evaluate(n,a,u,f,g,y){return this._styleExpression.evaluate(n,a,u,f,g,y)}}class vl{constructor(n,a,u,f){this.kind=n,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=n!=="camera"&&!Tu(a.expression),this.interpolationType=f}evaluateWithoutErrorHandling(n,a,u,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(n,a,u,f,g,y)}evaluate(n,a,u,f,g,y){return this._styleExpression.evaluate(n,a,u,f,g,y)}interpolationFactor(n,a,u){return this.interpolationType?No.interpolationFactor(this.interpolationType,n,a,u):0}}function xl(o,n){if((o=fc(o,n)).result==="error")return o;let a=o.value.expression,u=wu(a);if(!u&&!hc(n))return uc([new yr("","data expressions not supported")]);let f=id(a,["zoom","pitch","distance-from-center"]);if(!f&&!aa(n))return uc([new yr("","zoom expressions not supported")]);let g=Ru(a);return g||f?g instanceof yr?uc([g]):g instanceof No&&!dd(n)?uc([new yr("",'"interpolate" expressions cannot be used with this property')]):Cu(g?new vl(u?"camera":"composite",o.value,g.labels,g instanceof No?g.interpolation:void 0):new gd(u?"constant":"source",o.value)):uc([new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Du{constructor(n,a){this._parameters=n,this._specification=a,hs(this,Cp(this._parameters,this._specification))}static deserialize(n){return new Du(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Ru(o){let n=null;if(o instanceof xp)n=Ru(o.result);else if(o instanceof a_){for(let a of o.args)if(n=Ru(a),n)break}else(o instanceof fp||o instanceof No)&&o.input instanceof Pa&&o.input.name==="zoom"&&(n=o);return n instanceof yr||o.eachChild(a=>{let u=Ru(a);u instanceof yr?n=u:!n&&u?n=new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&u&&n!==u&&(n=new yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}class yn{constructor(n,a,u,f){this.message=(n?`${n}: `:"")+u,f&&(this.identifier=f),a!=null&&a.__line__&&(this.line=a.__line__)}}function oo(o){let n=o.key,a=o.value,u=o.valueSpec||{},f=o.objectElementValidators||{},g=o.style,y=o.styleSpec,T=[],M=Ci(a);if(M!=="object")return[new yn(n,a,`object expected, ${M} found`)];for(let C in a){let O=C.split(".")[0],U=u[O]||u["*"],V;f[O]?V=f[O]:u[O]?V=ds:f["*"]?V=f["*"]:u["*"]&&(V=ds),V?T=T.concat(V({key:(n&&`${n}.`)+C,value:a[C],valueSpec:U,style:g,styleSpec:y,object:a,objectKey:C},a)):T.push(new yn(n,a[C],`unknown property "${C}"`))}for(let C in u)f[C]||u[C].required&&u[C].default===void 0&&a[C]===void 0&&T.push(new yn(n,a,`missing required property "${C}"`));return T}function x_(o){let n=o.value,a=o.valueSpec,u=o.style,f=o.styleSpec,g=o.key,y=o.arrayElementValidator||ds;if(Ci(n)!=="array")return[new yn(g,n,`array expected, ${Ci(n)} found`)];if(a.length&&n.length!==a.length)return[new yn(g,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new yn(g,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let T={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};f.$version<7&&(T.function=a.function),Ci(a.value)==="object"&&(T=a.value);let M=[];for(let C=0;C<n.length;C++)M=M.concat(y({array:n,arrayIndex:C,value:n[C],valueSpec:T,style:u,styleSpec:f,key:`${g}[${C}]`}));return M}function Dp(o){let n=o.key,a=o.value,u=o.valueSpec,f=Ci(a);if(f==="number"&&a!=a&&(f="NaN"),f!=="number")return[new yn(n,a,`number expected, ${f} found`)];if("minimum"in u){let g=u.minimum;if(Ci(u.minimum)==="array"&&(g=u.minimum[o.arrayIndex]),a<g)return[new yn(n,a,`${a} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if(Ci(u.maximum)==="array"&&(g=u.maximum[o.arrayIndex]),a>g)return[new yn(n,a,`${a} is greater than the maximum value ${g}`)]}return[]}function Pu(o){let n=o.valueSpec,a=Si(o.value.type),u,f,g,y={},T=a!=="categorical"&&o.value.property===void 0,M=!T,C=Ci(o.value.stops)==="array"&&Ci(o.value.stops[0])==="array"&&Ci(o.value.stops[0][0])==="object",O=oo({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(q){if(a==="identity")return[new yn(q.key,q.value,'identity function may not have a "stops" property')];let J=[],ie=q.value;return J=J.concat(x_({key:q.key,value:ie,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:U})),Ci(ie)==="array"&&ie.length===0&&J.push(new yn(q.key,ie,"array must have at least one stop")),J},default:function(q){return ds({key:q.key,value:q.value,valueSpec:n,style:q.style,styleSpec:q.styleSpec})}}});return a==="identity"&&T&&O.push(new yn(o.key,o.value,'missing required property "property"')),a==="identity"||o.value.stops||O.push(new yn(o.key,o.value,'missing required property "stops"')),a==="exponential"&&o.valueSpec.expression&&!dd(o.valueSpec)&&O.push(new yn(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(M&&!hc(o.valueSpec)?O.push(new yn(o.key,o.value,"property functions not supported")):T&&!aa(o.valueSpec)&&O.push(new yn(o.key,o.value,"zoom functions not supported"))),a!=="categorical"&&!C||o.value.property!==void 0||O.push(new yn(o.key,o.value,'"property" property is required')),O;function U(q){let J=[],ie=q.value,_e=q.key;if(Ci(ie)!=="array")return[new yn(_e,ie,`array expected, ${Ci(ie)} found`)];if(ie.length!==2)return[new yn(_e,ie,`array length 2 expected, length ${ie.length} found`)];if(C){if(Ci(ie[0])!=="object")return[new yn(_e,ie,`object expected, ${Ci(ie[0])} found`)];if(ie[0].zoom===void 0)return[new yn(_e,ie,"object stop key must have zoom")];if(ie[0].value===void 0)return[new yn(_e,ie,"object stop key must have value")];let ke=Si(ie[0].zoom);if(typeof ke!="number")return[new yn(_e,ie[0].zoom,"stop zoom values must be numbers")];if(g&&g>ke)return[new yn(_e,ie[0].zoom,"stop zoom values must appear in ascending order")];ke!==g&&(g=ke,f=void 0,y={}),J=J.concat(oo({key:`${_e}[0]`,value:ie[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Dp,value:V}}))}else J=J.concat(V({key:`${_e}[0]`,value:ie[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},ie));return dc(As(ie[1]))?J.concat([new yn(`${_e}[1]`,ie[1],"expressions are not allowed in function stops.")]):J.concat(ds({key:`${_e}[1]`,value:ie[1],valueSpec:n,style:q.style,styleSpec:q.styleSpec}))}function V(q,J){let ie=Ci(q.value),_e=Si(q.value),ke=q.value!==null?q.value:J;if(u){if(ie!==u)return[new yn(q.key,ke,`${ie} stop domain type must match previous stop domain type ${u}`)]}else u=ie;if(ie!=="number"&&ie!=="string"&&ie!=="boolean"&&typeof _e!="number"&&typeof _e!="string"&&typeof _e!="boolean")return[new yn(q.key,ke,"stop domain value must be a number, string, or boolean")];if(ie!=="number"&&a!=="categorical"){let Ge=`number expected, ${ie} found`;return hc(n)&&a===void 0&&(Ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yn(q.key,ke,Ge)]}return a!=="categorical"||ie!=="number"||typeof _e=="number"&&isFinite(_e)&&Math.floor(_e)===_e?a!=="categorical"&&ie==="number"&&typeof _e=="number"&&typeof f=="number"&&f!==void 0&&_e<f?[new yn(q.key,ke,"stop domain values must appear in ascending order")]:(f=_e,a==="categorical"&&_e in y?[new yn(q.key,ke,"stop domain values must be unique")]:(y[_e]=!0,[])):[new yn(q.key,ke,`integer expected, found ${String(_e)}`)]}}function pc(o){let n=(o.expressionContext==="property"?xl:fc)(As(o.value),o.valueSpec);if(n.result==="error")return n.value.map(u=>new yn(`${o.key}${u.key}`,o.value,u.message));let a=n.value.expression||n.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!a.outputDefined())return[new yn(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Tu(a))return[new yn(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter")return b_(a,o);if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!id(a,["zoom","feature-state"]))return[new yn(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!wu(a))return[new yn(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function b_(o,n){let a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(let f of n.valueSpec.expression.parameters)a.delete(f);if(a.size===0)return[];let u=[];return o instanceof Pa&&a.has(o.name)?[new yn(n.key,n.value,`["${o.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(o.eachChild(f=>{u.push(...b_(f,n))}),u)}function _d(o){let n=o.key,a=o.value,u=o.valueSpec,f=[];return Array.isArray(u.values)?u.values.indexOf(Si(a))===-1&&f.push(new yn(n,a,`expected one of [${u.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(u.values).indexOf(Si(a))===-1&&f.push(new yn(n,a,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(a)} found`)),f}function Rp(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(let n of o.slice(1))if(!Rp(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function yd(o,n="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Rp(o)||(o=xd(o));let a=o,u=!0;try{u=function(C){if(!Yr(C))return C;let O=As(C);return zu(O),O=ku(O),O}(a)}catch(C){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}let f=Tt[`filter_${n}`],g=fc(u,f),y=null;if(g.result==="error")throw new Error(g.value.map(C=>`${C.key}: ${C.message}`).join(", "));y=(C,O,U)=>g.value.evaluate(C,O,{},U);let T=null,M=null;if(u!==a){let C=fc(a,f);if(C.result==="error")throw new Error(C.value.map(O=>`${O.key}: ${O.message}`).join(", "));T=(O,U,V,q,J)=>C.value.evaluate(O,U,{},V,void 0,void 0,q,J),M=!wu(C.value.expression)}return{filter:y,dynamicFilter:T||void 0,needGeometry:w_(u),needFeature:!!M}}function ku(o){if(!Array.isArray(o))return o;let n=function(a){if(vd.has(a[0])){for(let u=1;u<a.length;u++)if(Yr(a[u]))return!0}return a}(o);return n===!0?n:n.map(a=>ku(a))}function zu(o){let n=!1,a=[];if(o[0]==="case"){for(let u=1;u<o.length-1;u+=2)n=n||Yr(o[u]),a.push(o[u+1]);a.push(o[o.length-1])}else if(o[0]==="match"){n=n||Yr(o[1]);for(let u=2;u<o.length-1;u+=2)a.push(o[u+1]);a.push(o[o.length-1])}else if(o[0]==="step"){n=n||Yr(o[1]);for(let u=1;u<o.length-1;u+=2)a.push(o[u+1])}n&&(o.length=0,o.push("any",...a));for(let u=1;u<o.length;u++)zu(o[u])}function Yr(o){if(!Array.isArray(o))return!1;if((n=o[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let a=1;a<o.length;a++)if(Yr(o[a]))return!0;return!1}let vd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Wv(o,n){return o<n?-1:o>n?1:0}function w_(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let n=1;n<o.length;n++)if(w_(o[n]))return!0;return!1}function xd(o){if(!o)return!0;let n=o[0];return o.length<=1?n!=="any":n==="=="?Pp(o[1],o[2],"=="):n==="!="?mc(Pp(o[1],o[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Pp(o[1],o[2],n):n==="any"?(a=o.slice(1),["any"].concat(a.map(xd))):n==="all"?["all"].concat(o.slice(1).map(xd)):n==="none"?["all"].concat(o.slice(1).map(xd).map(mc)):n==="in"?bd(o[1],o.slice(2)):n==="!in"?mc(bd(o[1],o.slice(2))):n==="has"?T_(o[1]):n==="!has"?mc(T_(o[1])):n!=="within"||o;var a}function Pp(o,n,a){switch(o){case"$type":return[`filter-type-${a}`,n];case"$id":return[`filter-id-${a}`,n];default:return[`filter-${a}`,o,n]}}function bd(o,n){if(n.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(a=>typeof a!=typeof n[0])?["filter-in-large",o,["literal",n.sort(Wv)]]:["filter-in-small",o,["literal",n]]}}function T_(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function mc(o){return["!",o]}function kp(o){return Rp(As(o.value))?pc(hs({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):E_(o)}function E_(o){let n=o.value,a=o.key;if(Ci(n)!=="array")return[new yn(a,n,`array expected, ${Ci(n)} found`)];let u=o.styleSpec,f,g=[];if(n.length<1)return[new yn(a,n,"filter array must have at least 1 element")];switch(g=g.concat(_d({key:`${a}[0]`,value:n[0],valueSpec:u.filter_operator,style:o.style,styleSpec:o.styleSpec})),Si(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Si(n[1])==="$type"&&g.push(new yn(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&g.push(new yn(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(f=Ci(n[1]),f!=="string"&&g.push(new yn(`${a}[1]`,n[1],`string expected, ${f} found`)));for(let y=2;y<n.length;y++)f=Ci(n[y]),Si(n[1])==="$type"?g=g.concat(_d({key:`${a}[${y}]`,value:n[y],valueSpec:u.geometry_type,style:o.style,styleSpec:o.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&g.push(new yn(`${a}[${y}]`,n[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<n.length;y++)g=g.concat(E_({key:`${a}[${y}]`,value:n[y],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":f=Ci(n[1]),n.length!==2?g.push(new yn(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):f!=="string"&&g.push(new yn(`${a}[1]`,n[1],`string expected, ${f} found`));break;case"within":f=Ci(n[1]),n.length!==2?g.push(new yn(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):f!=="object"&&g.push(new yn(`${a}[1]`,n[1],`object expected, ${f} found`))}return g}function wd(o,n){let a=o.key,u=o.style,f=o.styleSpec,g=o.value,y=o.objectKey,T=f[`${n}_${o.layerType}`];if(!T)return[];let M=y.match(/^(.*)-transition$/);if(n==="paint"&&M&&T[M[1]]&&T[M[1]].transition)return ds({key:a,value:g,valueSpec:f.transition,style:u,styleSpec:f});let C=o.valueSpec||T[y];if(!C)return[new yn(a,g,`unknown property "${y}"`)];let O;if(Ci(g)==="string"&&hc(C)&&!C.tokens&&(O=/^{([^}]+)}$/.exec(g)))return[new yn(a,g,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];let U=[];return o.layerType==="symbol"&&(y==="text-field"&&u&&!u.glyphs&&U.push(new yn(a,g,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&fd(As(g))&&Si(g.type)==="identity"&&U.push(new yn(a,g,'"text-font" does not support identity functions'))),U.concat(ds({key:o.key,value:g,valueSpec:C,style:u,styleSpec:f,expressionContext:"property",propertyType:n,propertyKey:y}))}function S_(o){return wd(o,"paint")}function zp(o){return wd(o,"layout")}function Op(o){let n=[],a=o.value,u=o.key,f=o.style,g=o.styleSpec;a.type||a.ref||n.push(new yn(u,a,'either "type" or "ref" is required'));let y=Si(a.type),T=Si(a.ref);if(a.id){let M=Si(a.id);for(let C=0;C<o.arrayIndex;C++){let O=f.layers[C];Si(O.id)===M&&n.push(new yn(u,a.id,`duplicate layer id "${a.id}", previously used at line ${O.id.__line__}`))}}if("ref"in a){let M;["type","source","source-layer","filter","layout"].forEach(C=>{C in a&&n.push(new yn(u,a[C],`"${C}" is prohibited for ref layers`))}),f.layers.forEach(C=>{Si(C.id)===T&&(M=C)}),M?M.ref?n.push(new yn(u,a.ref,"ref cannot reference another ref layer")):y=Si(M.type):typeof T=="string"&&n.push(new yn(u,a.ref,`ref layer "${T}" not found`))}else if(y!=="background"&&y!=="sky")if(a.source){let M=f.sources&&f.sources[a.source],C=M&&Si(M.type);M?C==="vector"&&y==="raster"?n.push(new yn(u,a.source,`layer "${a.id}" requires a raster source`)):C==="raster"&&y!=="raster"?n.push(new yn(u,a.source,`layer "${a.id}" requires a vector source`)):C!=="vector"||a["source-layer"]?C==="raster-dem"&&y!=="hillshade"?n.push(new yn(u,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||C==="geojson"&&M.lineMetrics||n.push(new yn(u,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new yn(u,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new yn(u,a.source,`source "${a.source}" not found`))}else n.push(new yn(u,a,'missing required property "source"'));return n=n.concat(oo({key:u,value:a,valueSpec:g.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ds({key:`${u}.type`,value:a.type,valueSpec:g.layer.type,style:o.style,styleSpec:o.styleSpec,object:a,objectKey:"type"}),filter:M=>kp(hs({layerType:y},M)),layout:M=>oo({layer:a,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":C=>zp(hs({layerType:y},C))}}),paint:M=>oo({layer:a,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":C=>S_(hs({layerType:y},C))}})}})),n}function gc(o){let n=o.value,a=o.key,u=Ci(n);return u!=="string"?[new yn(a,n,`string expected, ${u} found`)]:[]}let Td={promoteId:function({key:o,value:n}){if(Ci(n)==="string")return gc({key:o,value:n});{let a=[];for(let u in n)a.push(...gc({key:`${o}.${u}`,value:n[u]}));return a}}};function Ou(o){let n=o.value,a=o.key,u=o.styleSpec,f=o.style;if(!n.type)return[new yn(a,n,'"type" is required')];let g=Si(n.type),y;switch(g){case"vector":case"raster":case"raster-dem":return y=oo({key:a,value:n,valueSpec:u[`source_${g.replace("-","_")}`],style:o.style,styleSpec:u,objectElementValidators:Td}),y;case"geojson":if(y=oo({key:a,value:n,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:Td}),n.cluster)for(let T in n.clusterProperties){let[M,C]=n.clusterProperties[T],O=typeof M=="string"?[M,["accumulated"],["get",T]]:M;y.push(...pc({key:`${a}.${T}.map`,value:C,expressionContext:"cluster-map"})),y.push(...pc({key:`${a}.${T}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return y;case"video":return oo({key:a,value:n,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return oo({key:a,value:n,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new yn(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _d({key:`${a}.type`,value:n.type,valueSpec:{values:A_(u)},style:f,styleSpec:u})}}function A_(o){return o.source.reduce((n,a)=>{let u=o[a];return u.type.type==="enum"&&(n=n.concat(Object.keys(u.type.values))),n},[])}function M_(o){let n=o.value,a=o.styleSpec,u=a.light,f=o.style,g=[],y=Ci(n);if(n===void 0)return g;if(y!=="object")return g=g.concat([new yn("light",n,`object expected, ${y} found`)]),g;for(let T in n){let M=T.match(/^(.*)-transition$/);g=g.concat(M&&u[M[1]]&&u[M[1]].transition?ds({key:T,value:n[T],valueSpec:a.transition,style:f,styleSpec:a}):u[T]?ds({key:T,value:n[T],valueSpec:u[T],style:f,styleSpec:a}):[new yn(T,n[T],`unknown property "${T}"`)])}return g}function Np(o){let n=o.value,a=o.key,u=o.style,f=o.styleSpec,g=f.terrain,y=[],T=Ci(n);if(n===void 0)return y;if(T!=="object")return y=y.concat([new yn("terrain",n,`object expected, ${T} found`)]),y;for(let M in n){let C=M.match(/^(.*)-transition$/);y=y.concat(C&&g[C[1]]&&g[C[1]].transition?ds({key:M,value:n[M],valueSpec:f.transition,style:u,styleSpec:f}):g[M]?ds({key:M,value:n[M],valueSpec:g[M],style:u,styleSpec:f}):[new yn(M,n[M],`unknown property "${M}"`)])}if(n.source){let M=u.sources&&u.sources[n.source],C=M&&Si(M.type);M?C!=="raster-dem"&&y.push(new yn(a,n.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):y.push(new yn(a,n.source,`source "${n.source}" not found`))}else y.push(new yn(a,n,'terrain is missing required property "source"'));return y}function I_(o){let n=o.value,a=o.style,u=o.styleSpec,f=u.fog,g=[],y=Ci(n);if(n===void 0)return g;if(y!=="object")return g=g.concat([new yn("fog",n,`object expected, ${y} found`)]),g;for(let T in n){let M=T.match(/^(.*)-transition$/);g=g.concat(M&&f[M[1]]&&f[M[1]].transition?ds({key:T,value:n[T],valueSpec:u.transition,style:a,styleSpec:u}):f[T]?ds({key:T,value:n[T],valueSpec:f[T],style:a,styleSpec:u}):[new yn(T,n[T],`unknown property "${T}"`)])}return g}let Ed={"*":()=>[],array:x_,boolean:function(o){let n=o.value,a=o.key,u=Ci(n);return u!=="boolean"?[new yn(a,n,`boolean expected, ${u} found`)]:[]},number:Dp,color:function(o){let n=o.key,a=o.value,u=Ci(a);return u!=="string"?[new yn(n,a,`color expected, ${u} found`)]:mu(a)===null?[new yn(n,a,`color expected, "${a}" found`)]:[]},enum:_d,filter:kp,function:Pu,layer:Op,object:oo,source:Ou,light:M_,terrain:Np,fog:I_,string:gc,formatted:function(o){return gc(o).length===0?[]:pc(o)},resolvedImage:function(o){return gc(o).length===0?[]:pc(o)},projection:function(o){let n=o.value,a=o.styleSpec,u=a.projection,f=o.style,g=[],y=Ci(n);if(y==="object")for(let T in n)g=g.concat(ds({key:T,value:n[T],valueSpec:u[T],style:f,styleSpec:a}));else y!=="string"&&(g=g.concat([new yn("projection",n,`object or string expected, ${y} found`)]));return g}};function ds(o){let n=o.value,a=o.valueSpec,u=o.styleSpec;return a.expression&&fd(Si(n))?Pu(o):a.expression&&dc(As(n))?pc(o):a.type&&Ed[a.type]?Ed[a.type](o):oo(hs({},o,{valueSpec:a.type?u[a.type]:a}))}function qv(o){let n=o.value,a=o.key,u=gc(o);return u.length||(n.indexOf("{fontstack}")===-1&&u.push(new yn(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&u.push(new yn(a,n,'"glyphs" url must include a "{range}" token'))),u}function C_(o,n=Tt){return la(ds({key:"",value:o,valueSpec:n.$root,styleSpec:n,style:o,objectElementValidators:{glyphs:qv,"*":()=>[]}}))}let Xv=o=>la(S_(o)),L_=o=>la(zp(o));function la(o){return o.slice().sort((n,a)=>n.line&&a.line?n.line-a.line:0)}function D_(o,n){let a=!1;if(n&&n.length)for(let u of n)o.fire(new Rr(new Error(u.message))),a=!0;return a}var _c=Fo;function Fo(o,n,a){var u=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var f=new Int32Array(this.arrayBuffer);o=f[0],this.d=(n=f[1])+2*(a=f[2]);for(var g=0;g<this.d*this.d;g++){var y=f[3+g],T=f[3+g+1];u.push(y===T?null:f.subarray(y,T))}var M=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],M),this.bboxes=f.subarray(M),this.insert=this._insertReadonly}else{this.d=n+2*a;for(var C=0;C<this.d*this.d;C++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=o,this.padding=a,this.scale=n/o,this.uid=0;var O=a/n*o;this.min=-O,this.max=o+O}Fo.prototype.insert=function(o,n,a,u,f){this._forEachCell(n,a,u,f,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(f)},Fo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Fo.prototype._insertCell=function(o,n,a,u,f,g){this.cells[f].push(g)},Fo.prototype.query=function(o,n,a,u,f){var g=this.min,y=this.max;if(o<=g&&n<=g&&y<=a&&y<=u&&!f)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(o,n,a,u,this._queryCell,T,{},f),T},Fo.prototype._queryCell=function(o,n,a,u,f,g,y,T){var M=this.cells[f];if(M!==null)for(var C=this.keys,O=this.bboxes,U=0;U<M.length;U++){var V=M[U];if(y[V]===void 0){var q=4*V;(T?T(O[q+0],O[q+1],O[q+2],O[q+3]):o<=O[q+2]&&n<=O[q+3]&&a>=O[q+0]&&u>=O[q+1])?(y[V]=!0,g.push(C[V])):y[V]=!1}}},Fo.prototype._forEachCell=function(o,n,a,u,f,g,y,T){for(var M=this._convertToCellCoord(o),C=this._convertToCellCoord(n),O=this._convertToCellCoord(a),U=this._convertToCellCoord(u),V=M;V<=O;V++)for(var q=C;q<=U;q++){var J=this.d*q+V;if((!T||T(this._convertFromCellCoord(V),this._convertFromCellCoord(q),this._convertFromCellCoord(V+1),this._convertFromCellCoord(q+1)))&&f.call(this,o,n,a,u,J,g,y,T))return}},Fo.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Fo.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Fo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,n=3+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var f=new Int32Array(n+a+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=n,y=0;y<o.length;y++){var T=o[y];f[3+y]=g,f.set(T,g),g+=T.length}return f[3+o.length]=g,f.set(this.keys,g),f[3+o.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer};let Sd={};function Sn(o,n,a={}){Object.defineProperty(o,"_classRegistryKey",{value:n,writeable:!1}),Sd[n]={klass:o,omit:a.omit||[]}}Sn(Object,"Object"),_c.serialize=function(o,n){let a=o.toArrayBuffer();return n&&n.push(a),{buffer:a}},_c.deserialize=function(o){return new _c(o.buffer)},Object.defineProperty(_c,"name",{value:"Grid"}),Sn(_c,"Grid"),Sn(Vi,"Color"),Sn(Error,"Error"),Sn(rn,"AJAXError"),Sn(jr,"ResolvedImage"),Sn(Du,"StylePropertyFunction"),Sn(md,"StyleExpression",{omit:["_evaluator"]}),Sn(vl,"ZoomDependentExpression"),Sn(gd,"ZoomConstantExpression"),Sn(Pa,"CompoundExpression",{omit:["_evaluate"]});for(let o in cc)Sd[cc[o]._classRegistryKey]||Sn(cc[o],`Expression${o}`);function R_(o){return o&&typeof ArrayBuffer!="undefined"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Nu(o){return x.ImageBitmap&&o instanceof x.ImageBitmap}function Fu(o,n){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(R_(o)||Nu(o))return n&&n.push(o),o;if(ArrayBuffer.isView(o)){let a=o;return n&&n.push(a.buffer),a}if(o instanceof x.ImageData)return n&&n.push(o.data.buffer),o;if(Array.isArray(o)){let a=[];for(let u of o)a.push(Fu(u,n));return a}if(typeof o=="object"){let a=o.constructor,u=a._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);let f=a.serialize?a.serialize(o,n):{};if(!a.serialize){for(let g in o)o.hasOwnProperty(g)&&(Sd[u].omit.indexOf(g)>=0||(f[g]=Fu(o[g],n)));o instanceof Error&&(f.message=o.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof o)}function Bu(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||R_(o)||Nu(o)||ArrayBuffer.isView(o)||o instanceof x.ImageData)return o;if(Array.isArray(o))return o.map(Bu);if(typeof o=="object"){let n=o.$name||"Object",{klass:a}=Sd[n];if(!a)throw new Error(`can't deserialize unregistered class ${n}`);if(a.deserialize)return a.deserialize(o);let u=Object.create(a.prototype);for(let f of Object.keys(o))f!=="$name"&&(u[f]=Bu(o[f]));return u}throw new Error("can't deserialize object of type "+typeof o)}let Uu=o=>o>=1536&&o<=1791,P_=o=>o>=1872&&o<=1919,Fp=o=>o>=2208&&o<=2303,k_=o=>o>=11904&&o<=12031,Bp=o=>o>=12032&&o<=12255,Up=o=>o>=12272&&o<=12287,Vu=o=>o>=12288&&o<=12351,Ad=o=>o>=12352&&o<=12447,yc=o=>o>=12448&&o<=12543,Md=o=>o>=12544&&o<=12591,z_=o=>o>=12704&&o<=12735,O_=o=>o>=12736&&o<=12783,Vp=o=>o>=12784&&o<=12799,N_=o=>o>=12800&&o<=13055,F_=o=>o>=13056&&o<=13311,B_=o=>o>=13312&&o<=19903,Gp=o=>o>=19968&&o<=40959,U_=o=>o>=40960&&o<=42127,V_=o=>o>=42128&&o<=42191,G_=o=>o>=44032&&o<=55215,H_=o=>o>=63744&&o<=64255,Id=o=>o>=64336&&o<=65023,Gu=o=>o>=65040&&o<=65055,m=o=>o>=65072&&o<=65103,l=o=>o>=65104&&o<=65135,d=o=>o>=65136&&o<=65279,_=o=>o>=65280&&o<=65519;function b(o){for(let n of o)if(P(n.charCodeAt(0)))return!0;return!1}function E(o){for(let n of o)if(!D(n.charCodeAt(0)))return!1;return!0}function D(o){return!(Uu(o)||P_(o)||Fp(o)||Id(o)||d(o))}function P(o){return!(o!==746&&o!==747&&(o<4352||!(z_(o)||Md(o)||m(o)&&!(o>=65097&&o<=65103)||H_(o)||F_(o)||k_(o)||O_(o)||!(!Vu(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||B_(o)||Gp(o)||N_(o)||(n=>n>=12592&&n<=12687)(o)||(n=>n>=43360&&n<=43391)(o)||(n=>n>=55216&&n<=55295)(o)||(n=>n>=4352&&n<=4607)(o)||G_(o)||Ad(o)||Up(o)||(n=>n>=12688&&n<=12703)(o)||Bp(o)||Vp(o)||yc(o)&&o!==12540||!(!_(o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!l(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(n=>n>=5120&&n<=5759)(o)||(n=>n>=6320&&n<=6399)(o)||Gu(o)||(n=>n>=19904&&n<=19967)(o)||U_(o)||V_(o))))}function F(o){return!(P(o)||function(n){return!!((a=>a>=128&&a<=255)(n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||(a=>a>=8192&&a<=8303)(n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||(a=>a>=8448&&a<=8527)(n)||(a=>a>=8528&&a<=8591)(n)||(a=>a>=8960&&a<=9215)(n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||(a=>a>=9216&&a<=9279)(n)&&n!==9251||(a=>a>=9280&&a<=9311)(n)||(a=>a>=9312&&a<=9471)(n)||(a=>a>=9632&&a<=9727)(n)||(a=>a>=9728&&a<=9983)(n)&&!(n>=9754&&n<=9759)||(a=>a>=11008&&a<=11263)(n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Vu(n)||yc(n)||(a=>a>=57344&&a<=63743)(n)||m(n)||l(n)||_(n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(o))}function j(o){return o>=1424&&o<=2303||Id(o)||d(o)}function W(o,n){return!(!n&&j(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(a=>a>=6016&&a<=6143)(o))}function ee(o){for(let n of o)if(j(n.charCodeAt(0)))return!0;return!1}let fe="deferred",Te="loading",we="loaded",Se=null,Me="unavailable",ce=null,Oe=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(Me="error"),Se&&Se(o)};function Pe(){Ue.fire(new Qn("pluginStateChange",{pluginStatus:Me,pluginURL:ce}))}let Ue=new Fr,Ze=function(){return Me},je=function(){if(Me!==fe||!ce)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Me=Te,Pe(),ce&&sn({url:ce},o=>{o?Oe(o):(Me=we,Pe())})},$e={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Me===we||$e.applyArabicShaping!=null,isLoading:()=>Me===Te,setState(o){Me=o.pluginStatus,ce=o.pluginURL},isParsed:()=>$e.applyArabicShaping!=null&&$e.processBidirectionalText!=null&&$e.processStyledBidirectionalText!=null,getPluginURL:()=>ce};class it{constructor(n,a){this.zoom=n,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(n){return function(a,u){for(let f of a)if(!W(f.charCodeAt(0),u))return!1;return!0}(n,$e.isLoaded())}}class dt{constructor(n,a){this.property=n,this.value=a,this.expression=function(u,f){if(fd(u))return new Du(u,f);if(dc(u)){let g=xl(u,f);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=u;return typeof u=="string"&&f.type==="color"&&(g=Vi.parse(u)),{kind:"constant",evaluate:()=>g}}}(a===void 0?n.specification.default:a,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,a,u){return this.property.possiblyEvaluate(this,n,a,u)}}class mt{constructor(n){this.property=n,this.value=new dt(n,void 0)}transitioned(n,a){return new lt(this.property,this.value,a,De({},n.transition,this.transition),n.now)}untransitioned(){return new lt(this.property,this.value,null,{},0)}}class Qt{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Re(this._values[n].value.value)}setValue(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new mt(this._values[n].property)),this._values[n].value=new dt(this._values[n].property,a===null?void 0:Re(a))}getTransition(n){return Re(this._values[n].transition)}setTransition(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new mt(this._values[n].property)),this._values[n].transition=Re(a)||void 0}serialize(){let n={};for(let a of Object.keys(this._values)){let u=this.getValue(a);u!==void 0&&(n[a]=u);let f=this.getTransition(a);f!==void 0&&(n[`${a}-transition`]=f)}return n}transitioned(n,a){let u=new Dt(this._properties);for(let f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(n,a._values[f]);return u}untransitioned(){let n=new Dt(this._properties);for(let a of Object.keys(this._values))n._values[a]=this._values[a].untransitioned();return n}}class lt{constructor(n,a,u,f,g){let y=f.delay||0,T=f.duration||0;g=g||0,this.property=n,this.value=a,this.begin=g+y,this.end=this.begin+T,n.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(n,a,u){let f=n.now||0,g=this.value.possiblyEvaluate(n,a,u),y=this.prior;if(y){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return y.possiblyEvaluate(n,a,u);{let T=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(n,a,u),g,ye(T))}}return g}}class Dt{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,a,u){let f=new ft(this._properties);for(let g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(n,a,u);return f}hasTransition(){for(let n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class bt{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return Re(this._values[n].value)}setValue(n,a){this._values[n]=new dt(this._values[n].property,a===null?void 0:Re(a))}serialize(){let n={};for(let a of Object.keys(this._values)){let u=this.getValue(a);u!==void 0&&(n[a]=u)}return n}possiblyEvaluate(n,a,u){let f=new ft(this._properties);for(let g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(n,a,u);return f}}class Ut{constructor(n,a,u){this.property=n,this.value=a,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,a,u,f){return this.property.evaluate(this.value,this.parameters,n,a,u,f)}}class ft{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class tt{constructor(n){this.specification=n}possiblyEvaluate(n,a){return n.expression.evaluate(a)}interpolate(n,a,u){let f=Eu[this.specification.type];return f?f(n,a,u):n}}class yt{constructor(n,a){this.specification=n,this.overrides=a}possiblyEvaluate(n,a,u,f){return new Ut(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(a,null,{},u,f)}:n.expression,a)}interpolate(n,a,u){if(n.value.kind!=="constant"||a.value.kind!=="constant")return n;if(n.value.value===void 0||a.value.value===void 0)return new Ut(this,{kind:"constant",value:void 0},n.parameters);let f=Eu[this.specification.type];return f?new Ut(this,{kind:"constant",value:f(n.value.value,a.value.value,u)},n.parameters):n}evaluate(n,a,u,f,g,y){return n.kind==="constant"?n.value:n.evaluate(a,u,f,g,y)}}class Nt{constructor(n){this.specification=n}possiblyEvaluate(n,a,u,f){return!!n.expression.evaluate(a,null,{},u,f)}interpolate(){return!1}}class jt{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let a=new it(0,{});for(let u in n){let f=n[u];f.specification.overridable&&this.overridableProperties.push(u);let g=this.defaultPropertyValues[u]=new dt(f,void 0),y=this.defaultTransitionablePropertyValues[u]=new mt(f);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(a)}}}function zn(o,n){return 256*(o=re(Math.floor(o),0,255))+re(Math.floor(n),0,255)}Sn(yt,"DataDrivenProperty"),Sn(tt,"DataConstantProperty"),Sn(Nt,"ColorRampProperty");let oi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Mn{constructor(n,a){this._structArray=n,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class vn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,a){return n._trim(),a&&(n.isTransferred=!0,a.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){let a=Object.create(this.prototype);return a.arrayBuffer=n.arrayBuffer,a.length=n.length,a.capacity=n.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Fn(o,n=1){let a=0,u=0;return{members:o.map(f=>{let g=oi[f.type].BYTES_PER_ELEMENT,y=a=vi(a,Math.max(n,g)),T=f.components||1;return u=Math.max(u,g),a+=g*T,{name:f.name,type:f.type,components:T,offset:y}}),size:vi(a,Math.max(u,n)),alignment:n}}function vi(o,n){return Math.ceil(o/n)*n}class Bn extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a){let u=this.length;return this.resize(u+1),this.emplace(u,n,a)}emplace(n,a,u){let f=2*n;return this.int16[f+0]=a,this.int16[f+1]=u,n}}Bn.prototype.bytesPerElement=4,Sn(Bn,"StructArrayLayout2i4");class Fi extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,u){let f=this.length;return this.resize(f+1),this.emplace(f,n,a,u)}emplace(n,a,u,f){let g=3*n;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=f,n}}Fi.prototype.bytesPerElement=6,Sn(Fi,"StructArrayLayout3i6");class Wi extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,u,f){let g=this.length;return this.resize(g+1),this.emplace(g,n,a,u,f)}emplace(n,a,u,f,g){let y=4*n;return this.int16[y+0]=a,this.int16[y+1]=u,this.int16[y+2]=f,this.int16[y+3]=g,n}}Wi.prototype.bytesPerElement=8,Sn(Wi,"StructArrayLayout4i8");class tr extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g,y,T){let M=this.length;return this.resize(M+1),this.emplace(M,n,a,u,f,g,y,T)}emplace(n,a,u,f,g,y,T,M){let C=6*n,O=12*n,U=3*n;return this.int16[C+0]=a,this.int16[C+1]=u,this.uint8[O+4]=f,this.uint8[O+5]=g,this.uint8[O+6]=y,this.uint8[O+7]=T,this.float32[U+2]=M,n}}tr.prototype.bytesPerElement=12,Sn(tr,"StructArrayLayout2i4ub1f12");class Yi extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,f){let g=this.length;return this.resize(g+1),this.emplace(g,n,a,u,f)}emplace(n,a,u,f,g){let y=4*n;return this.float32[y+0]=a,this.float32[y+1]=u,this.float32[y+2]=f,this.float32[y+3]=g,n}}Yi.prototype.bytesPerElement=16,Sn(Yi,"StructArrayLayout4f16");class Pr extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g){let y=this.length;return this.resize(y+1),this.emplace(y,n,a,u,f,g)}emplace(n,a,u,f,g,y){let T=6*n,M=3*n;return this.uint16[T+0]=a,this.uint16[T+1]=u,this.uint16[T+2]=f,this.uint16[T+3]=g,this.float32[M+2]=y,n}}Pr.prototype.bytesPerElement=12,Sn(Pr,"StructArrayLayout4ui1f12");class Ns extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u,f){let g=this.length;return this.resize(g+1),this.emplace(g,n,a,u,f)}emplace(n,a,u,f,g){let y=4*n;return this.uint16[y+0]=a,this.uint16[y+1]=u,this.uint16[y+2]=f,this.uint16[y+3]=g,n}}Ns.prototype.bytesPerElement=8,Sn(Ns,"StructArrayLayout4ui8");class Ao extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g,y){let T=this.length;return this.resize(T+1),this.emplace(T,n,a,u,f,g,y)}emplace(n,a,u,f,g,y,T){let M=6*n;return this.int16[M+0]=a,this.int16[M+1]=u,this.int16[M+2]=f,this.int16[M+3]=g,this.int16[M+4]=y,this.int16[M+5]=T,n}}Ao.prototype.bytesPerElement=12,Sn(Ao,"StructArrayLayout6i12");class ca extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g,y,T,M,C,O,U,V){let q=this.length;return this.resize(q+1),this.emplace(q,n,a,u,f,g,y,T,M,C,O,U,V)}emplace(n,a,u,f,g,y,T,M,C,O,U,V,q){let J=12*n;return this.int16[J+0]=a,this.int16[J+1]=u,this.int16[J+2]=f,this.int16[J+3]=g,this.uint16[J+4]=y,this.uint16[J+5]=T,this.uint16[J+6]=M,this.uint16[J+7]=C,this.int16[J+8]=O,this.int16[J+9]=U,this.int16[J+10]=V,this.int16[J+11]=q,n}}ca.prototype.bytesPerElement=24,Sn(ca,"StructArrayLayout4i4ui4i24");class ur extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g,y){let T=this.length;return this.resize(T+1),this.emplace(T,n,a,u,f,g,y)}emplace(n,a,u,f,g,y,T){let M=10*n,C=5*n;return this.int16[M+0]=a,this.int16[M+1]=u,this.int16[M+2]=f,this.float32[C+2]=g,this.float32[C+3]=y,this.float32[C+4]=T,n}}ur.prototype.bytesPerElement=20,Sn(ur,"StructArrayLayout3i3f20");class Ji extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){let a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint32[1*n+0]=a,n}}Ji.prototype.bytesPerElement=4,Sn(Ji,"StructArrayLayout1ul4");class Ri extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g,y,T,M,C,O,U,V,q){let J=this.length;return this.resize(J+1),this.emplace(J,n,a,u,f,g,y,T,M,C,O,U,V,q)}emplace(n,a,u,f,g,y,T,M,C,O,U,V,q,J){let ie=20*n,_e=10*n;return this.int16[ie+0]=a,this.int16[ie+1]=u,this.int16[ie+2]=f,this.int16[ie+3]=g,this.int16[ie+4]=y,this.float32[_e+3]=T,this.float32[_e+4]=M,this.float32[_e+5]=C,this.float32[_e+6]=O,this.int16[ie+14]=U,this.uint32[_e+8]=V,this.uint16[ie+18]=q,this.uint16[ie+19]=J,n}}Ri.prototype.bytesPerElement=40,Sn(Ri,"StructArrayLayout5i4f1i1ul2ui40");class wr extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g,y,T){let M=this.length;return this.resize(M+1),this.emplace(M,n,a,u,f,g,y,T)}emplace(n,a,u,f,g,y,T,M){let C=8*n;return this.int16[C+0]=a,this.int16[C+1]=u,this.int16[C+2]=f,this.int16[C+4]=g,this.int16[C+5]=y,this.int16[C+6]=T,this.int16[C+7]=M,n}}wr.prototype.bytesPerElement=16,Sn(wr,"StructArrayLayout3i2i2i16");class fs extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g){let y=this.length;return this.resize(y+1),this.emplace(y,n,a,u,f,g)}emplace(n,a,u,f,g,y){let T=4*n,M=8*n;return this.float32[T+0]=a,this.float32[T+1]=u,this.float32[T+2]=f,this.int16[M+6]=g,this.int16[M+7]=y,n}}fs.prototype.bytesPerElement=16,Sn(fs,"StructArrayLayout2f1f2i16");class or extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,f){let g=this.length;return this.resize(g+1),this.emplace(g,n,a,u,f)}emplace(n,a,u,f,g){let y=12*n,T=3*n;return this.uint8[y+0]=a,this.uint8[y+1]=u,this.float32[T+1]=f,this.float32[T+2]=g,n}}or.prototype.bytesPerElement=12,Sn(or,"StructArrayLayout2ub2f12");class ps extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u){let f=this.length;return this.resize(f+1),this.emplace(f,n,a,u)}emplace(n,a,u,f){let g=3*n;return this.float32[g+0]=a,this.float32[g+1]=u,this.float32[g+2]=f,n}}ps.prototype.bytesPerElement=12,Sn(ps,"StructArrayLayout3f12");class ms extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u){let f=this.length;return this.resize(f+1),this.emplace(f,n,a,u)}emplace(n,a,u,f){let g=3*n;return this.uint16[g+0]=a,this.uint16[g+1]=u,this.uint16[g+2]=f,n}}ms.prototype.bytesPerElement=6,Sn(ms,"StructArrayLayout3ui6");class Na extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g,y,T,M,C,O,U,V,q,J,ie,_e,ke,Ge,Le,Ve,We){let He=this.length;return this.resize(He+1),this.emplace(He,n,a,u,f,g,y,T,M,C,O,U,V,q,J,ie,_e,ke,Ge,Le,Ve,We)}emplace(n,a,u,f,g,y,T,M,C,O,U,V,q,J,ie,_e,ke,Ge,Le,Ve,We,He){let pt=30*n,ht=15*n,At=60*n;return this.int16[pt+0]=a,this.int16[pt+1]=u,this.int16[pt+2]=f,this.float32[ht+2]=g,this.float32[ht+3]=y,this.uint16[pt+8]=T,this.uint16[pt+9]=M,this.uint32[ht+5]=C,this.uint32[ht+6]=O,this.uint32[ht+7]=U,this.uint16[pt+16]=V,this.uint16[pt+17]=q,this.uint16[pt+18]=J,this.float32[ht+10]=ie,this.float32[ht+11]=_e,this.uint8[At+48]=ke,this.uint8[At+49]=Ge,this.uint8[At+50]=Le,this.uint32[ht+13]=Ve,this.int16[pt+28]=We,this.uint8[At+58]=He,n}}Na.prototype.bytesPerElement=60,Sn(Na,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class vc extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g,y,T,M,C,O,U,V,q,J,ie,_e,ke,Ge,Le,Ve,We,He,pt,ht,At,Kt,vt,Mt,kt,Vt){let Yt=this.length;return this.resize(Yt+1),this.emplace(Yt,n,a,u,f,g,y,T,M,C,O,U,V,q,J,ie,_e,ke,Ge,Le,Ve,We,He,pt,ht,At,Kt,vt,Mt,kt,Vt)}emplace(n,a,u,f,g,y,T,M,C,O,U,V,q,J,ie,_e,ke,Ge,Le,Ve,We,He,pt,ht,At,Kt,vt,Mt,kt,Vt,Yt){let wt=38*n,dn=19*n;return this.int16[wt+0]=a,this.int16[wt+1]=u,this.int16[wt+2]=f,this.float32[dn+2]=g,this.float32[dn+3]=y,this.int16[wt+8]=T,this.int16[wt+9]=M,this.int16[wt+10]=C,this.int16[wt+11]=O,this.int16[wt+12]=U,this.int16[wt+13]=V,this.uint16[wt+14]=q,this.uint16[wt+15]=J,this.uint16[wt+16]=ie,this.uint16[wt+17]=_e,this.uint16[wt+18]=ke,this.uint16[wt+19]=Ge,this.uint16[wt+20]=Le,this.uint16[wt+21]=Ve,this.uint16[wt+22]=We,this.uint16[wt+23]=He,this.uint16[wt+24]=pt,this.uint16[wt+25]=ht,this.uint16[wt+26]=At,this.uint16[wt+27]=Kt,this.uint16[wt+28]=vt,this.uint32[dn+15]=Mt,this.float32[dn+16]=kt,this.float32[dn+17]=Vt,this.float32[dn+18]=Yt,n}}vc.prototype.bytesPerElement=76,Sn(vc,"StructArrayLayout3i2f6i15ui1ul3f76");class Xs extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){let a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.float32[1*n+0]=a,n}}Xs.prototype.bytesPerElement=4,Sn(Xs,"StructArrayLayout1f4");class ao extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,f,g){let y=this.length;return this.resize(y+1),this.emplace(y,n,a,u,f,g)}emplace(n,a,u,f,g,y){let T=5*n;return this.float32[T+0]=a,this.float32[T+1]=u,this.float32[T+2]=f,this.float32[T+3]=g,this.float32[T+4]=y,n}}ao.prototype.bytesPerElement=20,Sn(ao,"StructArrayLayout5f20");class ua extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u,f){let g=this.length;return this.resize(g+1),this.emplace(g,n,a,u,f)}emplace(n,a,u,f,g){let y=6*n;return this.uint32[3*n+0]=a,this.uint16[y+2]=u,this.uint16[y+3]=f,this.uint16[y+4]=g,n}}ua.prototype.bytesPerElement=12,Sn(ua,"StructArrayLayout1ul3ui12");class Fa extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a){let u=this.length;return this.resize(u+1),this.emplace(u,n,a)}emplace(n,a,u){let f=2*n;return this.uint16[f+0]=a,this.uint16[f+1]=u,n}}Fa.prototype.bytesPerElement=4,Sn(Fa,"StructArrayLayout2ui4");class Ba extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){let a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint16[1*n+0]=a,n}}Ba.prototype.bytesPerElement=2,Sn(Ba,"StructArrayLayout1ui2");class xc extends vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a){let u=this.length;return this.resize(u+1),this.emplace(u,n,a)}emplace(n,a,u){let f=2*n;return this.float32[f+0]=a,this.float32[f+1]=u,n}}xc.prototype.bytesPerElement=8,Sn(xc,"StructArrayLayout2f8");class RT extends Mn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}RT.prototype.size=40;class Zv extends Ri{get(n){return new RT(this,n)}}Sn(Zv,"CollisionBoxArray");class PT extends Mn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}PT.prototype.size=60;class kT extends Na{get(n){return new PT(this,n)}}Sn(kT,"PlacedSymbolArray");class zT extends Mn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(n){this._structArray.uint32[this._pos4+15]=n}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}zT.prototype.size=76;class OT extends vc{get(n){return new zT(this,n)}}Sn(OT,"SymbolInstanceArray");class NT extends Xs{getoffsetX(n){return this.float32[1*n+0]}}Sn(NT,"GlyphOffsetArray");class FT extends Bn{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Sn(FT,"SymbolLineVertexArray");class BT extends Mn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}BT.prototype.size=12;class UT extends ua{get(n){return new BT(this,n)}}Sn(UT,"FeatureIndexArray");class VT extends Fa{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Sn(VT,"FillExtrusionCentroidArray");let TD=Fn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ED=Fn([{name:"a_dash",components:4,type:"Uint16"}]);var Hu={},SD={get exports(){return Hu},set exports(o){Hu=o}},Kv={};({get exports(){return Kv},set exports(o){Kv=o}}).exports=function(o,n){var a,u,f,g,y,T,M,C;for(u=o.length-(a=3&o.length),f=n,y=3432918353,T=461845907,C=0;C<u;)M=255&o.charCodeAt(C)|(255&o.charCodeAt(++C))<<8|(255&o.charCodeAt(++C))<<16|(255&o.charCodeAt(++C))<<24,++C,f=27492+(65535&(g=5*(65535&(f=(f^=M=(65535&(M=(M=(65535&M)*y+(((M>>>16)*y&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(M=0,a){case 3:M^=(255&o.charCodeAt(C+2))<<16;case 2:M^=(255&o.charCodeAt(C+1))<<8;case 1:f^=M=(65535&(M=(M=(65535&(M^=255&o.charCodeAt(C)))*y+(((M>>>16)*y&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295}return f^=o.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var Yv={};({get exports(){return Yv},set exports(o){Yv=o}}).exports=function(o,n){for(var a,u=o.length,f=n^u,g=0;u>=4;)a=1540483477*(65535&(a=255&o.charCodeAt(g)|(255&o.charCodeAt(++g))<<8|(255&o.charCodeAt(++g))<<16|(255&o.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:f^=(255&o.charCodeAt(g+2))<<16;case 2:f^=(255&o.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&o.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var GT=Kv,AD=Yv;SD.exports=GT,Hu.murmur3=GT,Hu.murmur2=AD;class j_{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,a,u,f){this.ids.push(HT(n)),this.positions.push(a,u,f)}getPositions(n){let a=HT(n),u=0,f=this.ids.length-1;for(;u<f;){let y=u+f>>1;this.ids[y]>=a?f=y:u=y+1}let g=[];for(;this.ids[u]===a;)g.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return g}static serialize(n,a){let u=new Float64Array(n.ids),f=new Uint32Array(n.positions);return Jv(u,f,0,u.length-1),a&&a.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(n){let a=new j_;return a.ids=n.ids,a.positions=n.positions,a.indexed=!0,a}}function HT(o){let n=+o;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:Hu(String(o))}function Jv(o,n,a,u){for(;a<u;){let f=o[a+u>>1],g=a-1,y=u+1;for(;;){do g++;while(o[g]<f);do y--;while(o[y]>f);if(g>=y)break;W_(o,g,y),W_(n,3*g,3*y),W_(n,3*g+1,3*y+1),W_(n,3*g+2,3*y+2)}y-a<u-y?(Jv(o,n,a,y),a=y+1):(Jv(o,n,y+1,u),u=y)}}function W_(o,n,a){let u=o[n];o[n]=o[a],o[a]=u}Sn(j_,"FeaturePositionMap");class bl{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,a),this.initialized=!0),!!this.location}}class q_ extends bl{constructor(n){super(n),this.current=0}set(n,a,u){this.fetchUniformLocation(n,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class jT extends bl{constructor(n){super(n),this.current=[0,0,0,0]}set(n,a,u){this.fetchUniformLocation(n,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class WT extends bl{constructor(n){super(n),this.current=Vi.transparent}set(n,a,u){this.fetchUniformLocation(n,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}let MD=new Float32Array(16),ID=new Float32Array(9),CD=new Float32Array(4);function $v(o){return[zn(255*o.r,255*o.g),zn(255*o.b,255*o.a)]}class Hp{constructor(n,a,u){this.value=n,this.uniformNames=a.map(f=>`u_${f}`),this.type=u}setUniform(n,a,u,f,g){a.set(n,g,f.constantOr(this.value))}getBinding(n,a){return this.type==="color"?new WT(n):new q_(n)}}class Cd{constructor(n,a){this.uniformNames=a.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,a,u,f,g){let y=g==="u_pattern"||g==="u_dash"?this.pattern:g==="u_pixel_ratio"?this.pixelRatio:null;y&&a.set(n,g,y)}getBinding(n,a){return a==="u_pattern"||a==="u_dash"?new jT(n):new q_(n)}}class wl{constructor(n,a,u,f){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(n,a,u,f,g,y){let T=this.paintVertexArray.length,M=this.expression.evaluate(new it(0),a,{},g,f,y);this.paintVertexArray.resize(n),this._setPaintValue(T,n,M)}updatePaintArray(n,a,u,f,g){let y=this.expression.evaluate({zoom:0},u,f,void 0,g);this._setPaintValue(n,a,y)}_setPaintValue(n,a,u){if(this.type==="color"){let f=$v(u);for(let g=n;g<a;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=n;f<a;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ha{constructor(n,a,u,f,g,y){this.expression=n,this.uniformNames=a.map(T=>`u_${T}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=a.map(T=>({name:`a_${T}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(n,a,u,f,g,y){let T=this.expression.evaluate(new it(this.zoom),a,{},g,f,y),M=this.expression.evaluate(new it(this.zoom+1),a,{},g,f,y),C=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(C,n,T,M)}updatePaintArray(n,a,u,f,g){let y=this.expression.evaluate({zoom:this.zoom},u,f,void 0,g),T=this.expression.evaluate({zoom:this.zoom+1},u,f,void 0,g);this._setPaintValue(n,a,y,T)}_setPaintValue(n,a,u,f){if(this.type==="color"){let g=$v(u),y=$v(f);for(let T=n;T<a;T++)this.paintVertexArray.emplace(T,g[0],g[1],y[0],y[1])}else{for(let g=n;g<a;g++)this.paintVertexArray.emplace(g,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,a,u,f,g){let y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,T=re(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);a.set(n,g,T)}getBinding(n,a){return new q_(n)}}class bc{constructor(n,a,u,f,g){this.expression=n,this.layerId=g,this.paintVertexAttributes=(u==="array"?ED:TD).members;for(let y=0;y<a.length;++y);this.paintVertexArray=new f}populatePaintArray(n,a,u){let f=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(f,n,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(n,a,u,f,g,y){this._setPaintValues(n,a,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(n,a,u,f){if(!f||!u)return;let g=f[u];if(!g)return;let{tl:y,br:T,pixelRatio:M}=g;for(let C=n;C<a;C++)this.paintVertexArray.emplace(C,y[0],y[1],T[0],T[1],M)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wc{constructor(n,a,u=()=>!0){this.binders={},this._buffers=[];let f=[];for(let g in n.paint._values){if(!u(g))continue;let y=n.paint.get(g);if(!(y instanceof Ut&&hc(y.property.specification)))continue;let T=DD(g,n.type),M=y.value,C=y.property.specification.type,O=y.property.useIntegerZoom,U=g==="line-dasharray"||g.endsWith("pattern"),V=g==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(M.kind!=="constant"||V)if(M.kind==="source"||V||U){let q=qT(g,C,"source");this.binders[g]=U?new bc(M,T,C,q,n.id):new wl(M,T,C,q),f.push(`/a_${g}`)}else{let q=qT(g,C,"composite");this.binders[g]=new ha(M,T,C,O,a,q),f.push(`/z_${g}`)}else this.binders[g]=U?new Cd(M.value,T):new Hp(M.value,T,C),f.push(`/u_${g}`)}this.cacheKey=f.sort().join("")}getMaxValue(n){let a=this.binders[n];return a instanceof wl||a instanceof ha?a.maxValue:0}populatePaintArrays(n,a,u,f,g,y){for(let T in this.binders){let M=this.binders[T];(M instanceof wl||M instanceof ha||M instanceof bc)&&M.populatePaintArray(n,a,u,f,g,y)}}setConstantPatternPositions(n){for(let a in this.binders){let u=this.binders[a];u instanceof Cd&&u.setConstantPatternPositions(n)}}updatePaintArrays(n,a,u,f,g,y){let T=!1;for(let M in n){let C=a.getPositions(M);for(let O of C){let U=u.feature(O.index);for(let V in this.binders){let q=this.binders[V];if((q instanceof wl||q instanceof ha||q instanceof bc)&&q.expression.isStateDependent===!0){let J=f.paint.get(V);q.expression=J.value,q.updatePaintArray(O.start,O.end,U,n[M],g,y),T=!0}}}}return T}defines(){let n=[];for(let a in this.binders){let u=this.binders[a];(u instanceof Hp||u instanceof Cd)&&n.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return n}getBinderAttributes(){let n=[];for(let a in this.binders){let u=this.binders[a];if(u instanceof wl||u instanceof ha||u instanceof bc)for(let f=0;f<u.paintVertexAttributes.length;f++)n.push(u.paintVertexAttributes[f].name)}return n}getBinderUniforms(){let n=[];for(let a in this.binders){let u=this.binders[a];if(u instanceof Hp||u instanceof Cd||u instanceof ha)for(let f of u.uniformNames)n.push(f)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){let a=[];for(let u in this.binders){let f=this.binders[u];if(f instanceof Hp||f instanceof Cd||f instanceof ha)for(let g of f.uniformNames)a.push({name:g,property:u,binding:f.getBinding(n,g)})}return a}setUniforms(n,a,u,f,g){for(let{name:y,property:T,binding:M}of u)this.binders[T].setUniform(n,M,g,f.get(T),y)}updatePaintBuffers(){this._buffers=[];for(let n in this.binders){let a=this.binders[n];(a instanceof wl||a instanceof ha||a instanceof bc)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(n){for(let a in this.binders){let u=this.binders[a];(u instanceof wl||u instanceof ha||u instanceof bc)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(let n in this.binders){let a=this.binders[n];(a instanceof wl||a instanceof ha||a instanceof bc)&&a.destroy()}}}class ju{constructor(n,a,u=()=>!0){this.programConfigurations={};for(let f of n)this.programConfigurations[f.id]=new wc(f,a,u);this.needsUpload=!1,this._featureMap=new j_,this._bufferOffset=0}populatePaintArrays(n,a,u,f,g,y,T){for(let M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(n,a,f,g,y,T);a.id!==void 0&&this._featureMap.add(a.id,u,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,a,u,f,g){for(let y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(n,this._featureMap,a,y,f,g)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(let a in this.programConfigurations)this.programConfigurations[a].upload(n);this.needsUpload=!1}}destroy(){for(let n in this.programConfigurations)this.programConfigurations[n].destroy()}}let LD={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function DD(o,n){return LD[o]||[o.replace(`${n}-`,"").replace(/-/g,"_")]}let RD={"line-pattern":{source:Pr,composite:Pr},"fill-pattern":{source:Pr,composite:Pr},"fill-extrusion-pattern":{source:Pr,composite:Pr},"line-dasharray":{source:Ns,composite:Ns}},PD={color:{source:xc,composite:Yi},number:{source:Xs,composite:xc}};function qT(o,n,a){let u=RD[o];return u&&u[a]||PD[n][a]}Sn(Hp,"ConstantBinder"),Sn(Cd,"PatternConstantBinder"),Sn(wl,"SourceExpressionBinder"),Sn(bc,"PatternCompositeBinder"),Sn(ha,"CompositeExpressionBinder"),Sn(wc,"ProgramConfiguration",{omit:["_buffers"]}),Sn(ju,"ProgramConfigurationSet");let X_="-transition";class da extends Fr{constructor(n,a){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),a.layout&&(this._unevaluatedLayout=new bt(a.layout)),a.paint)){this._transitionablePaint=new Qt(a.paint);for(let u in n.paint)this.setPaintProperty(u,n.paint[u],{validate:!1});for(let u in n.layout)this.setLayoutProperty(u,n.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ft(a.paint)}}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,a,u={}){a!=null&&this._validate(L_,`layers.${this.id}.layout.${n}`,n,a,u)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,a):this.visibility=a)}getPaintProperty(n){return zt(n,X_)?this._transitionablePaint.getTransition(n.slice(0,-X_.length)):this._transitionablePaint.getValue(n)}setPaintProperty(n,a,u={}){if(a!=null&&this._validate(Xv,`layers.${this.id}.paint.${n}`,n,a,u))return!1;if(zt(n,X_))return this._transitionablePaint.setTransition(n.slice(0,-X_.length),a||void 0),!1;{let f=this._transitionablePaint._values[n],g=f.value.isDataDriven(),y=f.value;this._transitionablePaint.setValue(n,a),this._handleSpecialPaintPropertyUpdate(n);let T=this._transitionablePaint._values[n].value,M=T.isDataDriven(),C=zt(n,"pattern")||n==="line-dasharray";return M||g||C||this._handleOverridablePaintPropertyUpdate(n,y,T)}}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getProgramConfiguration(n){return null}_handleOverridablePaintPropertyUpdate(n,a,u){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,a)}serialize(){let n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Lt(n,(a,u)=>!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length))}_validate(n,a,u,f,g={}){return(!g||g.validate!==!1)&&D_(this,n.call(C_,{key:a,layerType:this.type,objectKey:u,value:f,styleSpec:Tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let n in this.paint._values){let a=this.paint.get(n);if(a instanceof Ut&&hc(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=yd(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}let kD=Fn([{name:"a_pos",components:2,type:"Int16"}],4),zD=Fn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class kr{constructor(n=[]){this.segments=n}prepareSegment(n,a,u,f){let g=this.segments[this.segments.length-1];return n>kr.MAX_VERTEX_ARRAY_LENGTH&&nt(`Max vertices per segment is ${kr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!g||g.vertexLength+n>kr.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f)&&(g={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},f!==void 0&&(g.sortKey=f),this.segments.push(g)),g}get(){return this.segments}destroy(){for(let n of this.segments)for(let a in n.vaos)n.vaos[a].destroy()}static simpleSegment(n,a,u,f){return new kr([{vertexOffset:n,primitiveOffset:a,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}kr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Sn(kr,"SegmentVector");var Zn=8192;class Tc{constructor(n,a){n&&(a?this.setSouthWest(n).setNorthEast(a):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof Di?new Di(n.lng,n.lat):Di.convert(n),this}setSouthWest(n){return this._sw=n instanceof Di?new Di(n.lng,n.lat):Di.convert(n),this}extend(n){let a=this._sw,u=this._ne,f,g;if(n instanceof Di)f=n,g=n;else{if(!(n instanceof Tc))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Tc.convert(n)):this.extend(Di.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&n.hasOwnProperty("lon")?this.extend(Di.convert(n)):this;if(f=n._sw,g=n._ne,!f||!g)return this}return a||u?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new Di(f.lng,f.lat),this._ne=new Di(g.lng,g.lat)),this}getCenter(){return new Di((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Di(this.getWest(),this.getNorth())}getSouthEast(){return new Di(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){let{lng:a,lat:u}=Di.convert(n),f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(n){return!n||n instanceof Tc?n:new Tc(n)}}var Z_=1e-6,lo=typeof Float32Array!="undefined"?Float32Array:Array;function XT(){var o=new lo(9);return lo!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function ZT(o,n,a){var u=n[0],f=n[1],g=n[2],y=n[3],T=n[4],M=n[5],C=n[6],O=n[7],U=n[8],V=a[0],q=a[1],J=a[2],ie=a[3],_e=a[4],ke=a[5],Ge=a[6],Le=a[7],Ve=a[8];return o[0]=V*u+q*y+J*C,o[1]=V*f+q*T+J*O,o[2]=V*g+q*M+J*U,o[3]=ie*u+_e*y+ke*C,o[4]=ie*f+_e*T+ke*O,o[5]=ie*g+_e*M+ke*U,o[6]=Ge*u+Le*y+Ve*C,o[7]=Ge*f+Le*T+Ve*O,o[8]=Ge*g+Le*M+Ve*U,o}function fa(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Qv(o,n){var a=n[0],u=n[1],f=n[2],g=n[3],y=n[4],T=n[5],M=n[6],C=n[7],O=n[8],U=n[9],V=n[10],q=n[11],J=n[12],ie=n[13],_e=n[14],ke=n[15],Ge=a*T-u*y,Le=a*M-f*y,Ve=a*C-g*y,We=u*M-f*T,He=u*C-g*T,pt=f*C-g*M,ht=O*ie-U*J,At=O*_e-V*J,Kt=O*ke-q*J,vt=U*_e-V*ie,Mt=U*ke-q*ie,kt=V*ke-q*_e,Vt=Ge*kt-Le*Mt+Ve*vt+We*Kt-He*At+pt*ht;return Vt?(o[0]=(T*kt-M*Mt+C*vt)*(Vt=1/Vt),o[1]=(f*Mt-u*kt-g*vt)*Vt,o[2]=(ie*pt-_e*He+ke*We)*Vt,o[3]=(V*He-U*pt-q*We)*Vt,o[4]=(M*Kt-y*kt-C*At)*Vt,o[5]=(a*kt-f*Kt+g*At)*Vt,o[6]=(_e*Ve-J*pt-ke*Le)*Vt,o[7]=(O*pt-V*Ve+q*Le)*Vt,o[8]=(y*Mt-T*Kt+C*ht)*Vt,o[9]=(u*Kt-a*Mt-g*ht)*Vt,o[10]=(J*He-ie*Ve+ke*Ge)*Vt,o[11]=(U*Ve-O*He-q*Ge)*Vt,o[12]=(T*At-y*vt-M*ht)*Vt,o[13]=(a*vt-u*At+f*ht)*Vt,o[14]=(ie*Le-J*We-_e*Ge)*Vt,o[15]=(O*We-U*Le+V*Ge)*Vt,o):null}function Wu(o,n,a){var u=n[0],f=n[1],g=n[2],y=n[3],T=n[4],M=n[5],C=n[6],O=n[7],U=n[8],V=n[9],q=n[10],J=n[11],ie=n[12],_e=n[13],ke=n[14],Ge=n[15],Le=a[0],Ve=a[1],We=a[2],He=a[3];return o[0]=Le*u+Ve*T+We*U+He*ie,o[1]=Le*f+Ve*M+We*V+He*_e,o[2]=Le*g+Ve*C+We*q+He*ke,o[3]=Le*y+Ve*O+We*J+He*Ge,o[4]=(Le=a[4])*u+(Ve=a[5])*T+(We=a[6])*U+(He=a[7])*ie,o[5]=Le*f+Ve*M+We*V+He*_e,o[6]=Le*g+Ve*C+We*q+He*ke,o[7]=Le*y+Ve*O+We*J+He*Ge,o[8]=(Le=a[8])*u+(Ve=a[9])*T+(We=a[10])*U+(He=a[11])*ie,o[9]=Le*f+Ve*M+We*V+He*_e,o[10]=Le*g+Ve*C+We*q+He*ke,o[11]=Le*y+Ve*O+We*J+He*Ge,o[12]=(Le=a[12])*u+(Ve=a[13])*T+(We=a[14])*U+(He=a[15])*ie,o[13]=Le*f+Ve*M+We*V+He*_e,o[14]=Le*g+Ve*C+We*q+He*ke,o[15]=Le*y+Ve*O+We*J+He*Ge,o}function jp(o,n,a){var u,f,g,y,T,M,C,O,U,V,q,J,ie=a[0],_e=a[1],ke=a[2];return n===o?(o[12]=n[0]*ie+n[4]*_e+n[8]*ke+n[12],o[13]=n[1]*ie+n[5]*_e+n[9]*ke+n[13],o[14]=n[2]*ie+n[6]*_e+n[10]*ke+n[14],o[15]=n[3]*ie+n[7]*_e+n[11]*ke+n[15]):(f=n[1],g=n[2],y=n[3],T=n[4],M=n[5],C=n[6],O=n[7],U=n[8],V=n[9],q=n[10],J=n[11],o[0]=u=n[0],o[1]=f,o[2]=g,o[3]=y,o[4]=T,o[5]=M,o[6]=C,o[7]=O,o[8]=U,o[9]=V,o[10]=q,o[11]=J,o[12]=u*ie+T*_e+U*ke+n[12],o[13]=f*ie+M*_e+V*ke+n[13],o[14]=g*ie+C*_e+q*ke+n[14],o[15]=y*ie+O*_e+J*ke+n[15]),o}function qu(o,n,a){var u=a[0],f=a[1],g=a[2];return o[0]=n[0]*u,o[1]=n[1]*u,o[2]=n[2]*u,o[3]=n[3]*u,o[4]=n[4]*f,o[5]=n[5]*f,o[6]=n[6]*f,o[7]=n[7]*f,o[8]=n[8]*g,o[9]=n[9]*g,o[10]=n[10]*g,o[11]=n[11]*g,o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o}function ex(o,n,a){var u=Math.sin(a),f=Math.cos(a),g=n[4],y=n[5],T=n[6],M=n[7],C=n[8],O=n[9],U=n[10],V=n[11];return n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[4]=g*f+C*u,o[5]=y*f+O*u,o[6]=T*f+U*u,o[7]=M*f+V*u,o[8]=C*f-g*u,o[9]=O*f-y*u,o[10]=U*f-T*u,o[11]=V*f-M*u,o}function K_(o,n,a){var u=Math.sin(a),f=Math.cos(a),g=n[0],y=n[1],T=n[2],M=n[3],C=n[8],O=n[9],U=n[10],V=n[11];return n!==o&&(o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=g*f-C*u,o[1]=y*f-O*u,o[2]=T*f-U*u,o[3]=M*f-V*u,o[8]=g*u+C*f,o[9]=y*u+O*f,o[10]=T*u+U*f,o[11]=M*u+V*f,o}function KT(o,n){return o[0]=n[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function YT(o,n,a){var u,f,g,y=a[0],T=a[1],M=a[2],C=Math.hypot(y,T,M);return C<Z_?null:(y*=C=1/C,T*=C,M*=C,u=Math.sin(n),f=Math.cos(n),o[0]=y*y*(g=1-f)+f,o[1]=T*y*g+M*u,o[2]=M*y*g-T*u,o[3]=0,o[4]=y*T*g-M*u,o[5]=T*T*g+f,o[6]=M*T*g+y*u,o[7]=0,o[8]=y*M*g+T*u,o[9]=T*M*g-y*u,o[10]=M*M*g+f,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,n=arguments.length;n--;)o+=arguments[n]*arguments[n];return Math.sqrt(o)});var OD=Wu;function tx(){var o=new lo(3);return lo!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function JT(o){var n=new lo(3);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n}function Wp(o){return Math.hypot(o[0],o[1],o[2])}function Ld(o,n,a){var u=new lo(3);return u[0]=o,u[1]=n,u[2]=a,u}function Tl(o,n,a){return o[0]=n[0]+a[0],o[1]=n[1]+a[1],o[2]=n[2]+a[2],o}function nx(o,n,a){return o[0]=n[0]-a[0],o[1]=n[1]-a[1],o[2]=n[2]-a[2],o}function $T(o,n,a){return o[0]=n[0]*a[0],o[1]=n[1]*a[1],o[2]=n[2]*a[2],o}function qp(o,n,a){return o[0]=Math.min(n[0],a[0]),o[1]=Math.min(n[1],a[1]),o[2]=Math.min(n[2],a[2]),o}function Xp(o,n,a){return o[0]=Math.max(n[0],a[0]),o[1]=Math.max(n[1],a[1]),o[2]=Math.max(n[2],a[2]),o}function Mo(o,n,a){return o[0]=n[0]*a,o[1]=n[1]*a,o[2]=n[2]*a,o}function Zp(o,n,a,u){return o[0]=n[0]+a[0]*u,o[1]=n[1]+a[1]*u,o[2]=n[2]+a[2]*u,o}function Fs(o,n){var a=n[0],u=n[1],f=n[2],g=a*a+u*u+f*f;return g>0&&(g=1/Math.sqrt(g)),o[0]=n[0]*g,o[1]=n[1]*g,o[2]=n[2]*g,o}function Bo(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]}function ix(o,n,a){var u=n[0],f=n[1],g=n[2],y=a[0],T=a[1],M=a[2];return o[0]=f*M-g*T,o[1]=g*y-u*M,o[2]=u*T-f*y,o}function Cr(o,n,a){var u=n[0],f=n[1],g=n[2],y=a[3]*u+a[7]*f+a[11]*g+a[15];return o[0]=(a[0]*u+a[4]*f+a[8]*g+a[12])/(y=y||1),o[1]=(a[1]*u+a[5]*f+a[9]*g+a[13])/y,o[2]=(a[2]*u+a[6]*f+a[10]*g+a[14])/y,o}function QT(o,n,a){var u=a[0],f=a[1],g=a[2],y=n[0],T=n[1],M=n[2],C=f*M-g*T,O=g*y-u*M,U=u*T-f*y,V=f*U-g*O,q=g*C-u*U,J=u*O-f*C,ie=2*a[3];return O*=ie,U*=ie,q*=2,J*=2,o[0]=y+(C*=ie)+(V*=2),o[1]=T+O+q,o[2]=M+U+J,o}var Kp,pa=nx,ND=$T,FD=Wp;function eE(o,n,a){return o[0]=n[0]*a,o[1]=n[1]*a,o[2]=n[2]*a,o[3]=n[3]*a,o}function tE(o,n){var a=n[0],u=n[1],f=n[2],g=n[3],y=a*a+u*u+f*f+g*g;return y>0&&(y=1/Math.sqrt(y)),o[0]=a*y,o[1]=u*y,o[2]=f*y,o[3]=g*y,o}function Xu(o,n,a){var u=n[0],f=n[1],g=n[2],y=n[3];return o[0]=a[0]*u+a[4]*f+a[8]*g+a[12]*y,o[1]=a[1]*u+a[5]*f+a[9]*g+a[13]*y,o[2]=a[2]*u+a[6]*f+a[10]*g+a[14]*y,o[3]=a[3]*u+a[7]*f+a[11]*g+a[15]*y,o}function nE(){var o=new lo(4);return lo!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function iE(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function rE(o,n,a){a*=.5;var u=n[0],f=n[1],g=n[2],y=n[3],T=Math.sin(a),M=Math.cos(a);return o[0]=u*M+y*T,o[1]=f*M+g*T,o[2]=g*M-f*T,o[3]=y*M-u*T,o}function sE(o,n,a){a*=.5;var u=n[0],f=n[1],g=n[2],y=n[3],T=Math.sin(a),M=Math.cos(a);return o[0]=u*M-g*T,o[1]=f*M+y*T,o[2]=g*M+u*T,o[3]=y*M-f*T,o}tx(),Kp=new lo(4),lo!=Float32Array&&(Kp[0]=0,Kp[1]=0,Kp[2]=0,Kp[3]=0);var BD=tE;tx(),Ld(1,0,0),Ld(0,1,0),nE(),nE(),XT();let UD=Fn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:oE}=UD,aE=Fn([{name:"a_pos_3",components:3,type:"Int16"}]);var Yp=Fn([{name:"a_pos",type:"Int16",components:2}]);class rx{constructor(n,a){this.pos=n,this.dir=a}intersectsPlane(n,a,u){let f=Bo(a,this.dir);if(Math.abs(f)<1e-6)return!1;let g=((n[0]-this.pos[0])*a[0]+(n[1]-this.pos[1])*a[1]+(n[2]-this.pos[2])*a[2])/f;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(n,a,u){if(function(q,J){var ie=q[0],_e=q[1],ke=q[2],Ge=J[0],Le=J[1],Ve=J[2];return Math.abs(ie-Ge)<=Z_*Math.max(1,Math.abs(ie),Math.abs(Ge))&&Math.abs(_e-Le)<=Z_*Math.max(1,Math.abs(_e),Math.abs(Le))&&Math.abs(ke-Ve)<=Z_*Math.max(1,Math.abs(ke),Math.abs(Ve))}(this.pos,n)||a===0)return u[0]=u[1]=u[2]=0,!1;let[f,g,y]=this.dir,T=this.pos[0]-n[0],M=this.pos[1]-n[1],C=this.pos[2]-n[2],O=f*f+g*g+y*y,U=2*(T*f+M*g+C*y),V=U*U-4*O*(T*T+M*M+C*C-a*a);if(V<0){let q=Math.max(-U/2,0),J=T+f*q,ie=M+g*q,_e=C+y*q,ke=Math.hypot(J,ie,_e);return u[0]=J*a/ke,u[1]=ie*a/ke,u[2]=_e*a/ke,!1}{let q=(-U-Math.sqrt(V))/(2*O);if(q<0){let J=Math.hypot(T,M,C);return u[0]=T*a/J,u[1]=M*a/J,u[2]=C*a/J,!1}return u[0]=T+f*q,u[1]=M+g*q,u[2]=C+y*q,!0}}}class sx{constructor(n,a,u,f,g){this.TL=n,this.TR=a,this.BR=u,this.BL=f,this.horizon=g}static fromInvProjectionMatrix(n,a,u){let f=[-1,1,1],g=[1,1,1],y=[1,-1,1],T=[-1,-1,1],M=Cr(f,f,n),C=Cr(g,g,n),O=Cr(y,y,n),U=Cr(T,T,n);return new sx(M,C,O,U,a/u)}}class ox{constructor(n,a){this.points=n,this.planes=a}static fromInvProjectionMatrix(n,a,u,f){let g=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{let C=Xu([],M,n),O=1/C[3]/a*g;return function(U,V,q){return U[0]=V[0]*q[0],U[1]=V[1]*q[1],U[2]=V[2]*q[2],U[3]=V[3]*q[3],U}(C,C,[O,O,f?1/C[3]:O,O])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{let C=Fs([],ix([],pa([],y[M[0]],y[M[1]]),pa([],y[M[2]],y[M[1]]))),O=-Bo(C,y[M[1]]);return C.concat(O)});return new ox(y,T)}}class Bs{static fromPoints(n){let a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(let f of n)qp(a,a,f),Xp(u,u,f);return new Bs(a,u)}static applyTransform(n,a){let u=n.getCorners();for(let f=0;f<u.length;++f)Cr(u[f],u[f],a);return Bs.fromPoints(u)}constructor(n,a){this.min=n,this.max=a,this.center=Mo([],Tl([],this.min,this.max),.5)}quadrant(n){let a=[n%2==0,n<2],u=JT(this.min),f=JT(this.max);for(let g=0;g<a.length;g++)u[g]=a[g]?this.min[g]:this.center[g],f[g]=a[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new Bs(u,f)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){let n=this.min,a=this.max;return[[n[0],n[1],n[2]],[a[0],n[1],n[2]],[a[0],a[1],n[2]],[n[0],a[1],n[2]],[n[0],n[1],a[2]],[a[0],n[1],a[2]],[a[0],a[1],a[2]],[n[0],a[1],a[2]]]}intersects(n){let a=this.getCorners(),u=!0;for(let f=0;f<n.planes.length;f++){let g=n.planes[f],y=0;for(let T=0;T<a.length;T++)y+=Bo(g,a[T])+g[3]>=0;if(y===0)return 0;y!==a.length&&(u=!1)}if(u)return 2;for(let f=0;f<3;f++){let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let T=0;T<n.points.length;T++){let M=n.points[T][f]-this.min[f];g=Math.min(g,M),y=Math.max(y,M)}if(y<0||g>this.max[f]-this.min[f])return 0}return 1}}let Ua=Zn/Math.PI/2,Zu=64,Jp=[Zu,32,16],Uo=-Ua,Vo=Ua,VD=[new Bs([Uo,Uo,Uo],[Vo,Vo,Vo]),new Bs([Uo,Uo,Uo],[0,0,Vo]),new Bs([0,Uo,Uo],[Vo,0,Vo]),new Bs([Uo,0,Uo],[0,Vo,Vo]),new Bs([0,0,Uo],[Vo,Vo,Vo])];function Y_(o){return o*Ua/em}function lE(o,n,a,u=!0){let f=Mo([],o._camera.position,o.worldSize),g=[n,a,1,1];Xu(g,g,o.pixelMatrixInverse),eE(g,g,1/g[3]);let y=Fs([],pa([],g,f)),T=o.globeMatrix,M=[T[12],T[13],T[14]],C=pa([],M,f),O=Wp(C),U=Fs([],C),V=o.worldSize/(2*Math.PI),q=Bo(U,y),J=Math.asin(V/O);if(J<Math.acos(q)){if(!u)return null;let Kt=[],vt=[];Mo(Kt,y,O/q),Fs(vt,pa(vt,Kt,C)),Fs(y,Tl(y,C,Mo(y,vt,Math.tan(J)*O)))}let ie=[];new rx(f,y).closestPointOnSphere(M,V,ie);let _e=Fs([],xn(T,0)),ke=Fs([],xn(T,1)),Ge=Fs([],xn(T,2)),Le=Bo(_e,ie),Ve=Bo(ke,ie),We=Bo(Ge,ie),He=se(Math.asin(-Ve/V)),pt=se(Math.atan2(Le,We));pt=o.center.lng+function(Kt,vt){let Mt=(vt-Kt+180)%360-180;return Mt<-180?Mt+360:Mt}(o.center.lng,pt);let ht=Ga(pt),At=re(Ha(He),0,1);return new kd(ht,At)}class GD{constructor(n,a,u){this.a=pa([],n,u),this.b=pa([],a,u),this.center=u;let f=Fs([],this.a),g=Fs([],this.b);this.angle=Math.acos(Bo(f,g))}}function ax(o,n){if(o.angle===0)return null;let a;return a=o.a[n]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[n]/o.a[n]/Math.sin(o.angle)-1/Math.tan(o.angle)),a<0||a>1?null:function(u,f,g,y){let T=Math.sin(g);return u*(Math.sin((1-y)*g)/T)+f*(Math.sin(y*g)/T)}(o.a[n],o.b[n],o.angle,re(a,0,1))+o.center[n]}function Va(o){if(o.z<=1)return VD[o.z+2*o.y+o.x];let n=lx(J_(o));return Bs.fromPoints(n)}function Ku(o,n,a){return Mo(o,o,1-a),Zp(o,o,n,a)}function cE(o,n){let a=Pd(n.zoom);if(a===0)return Va(o);let u=J_(o),f=lx(u),g=Ga(u.getWest())*n.worldSize,y=Ga(u.getEast())*n.worldSize,T=Ha(u.getNorth())*n.worldSize,M=Ha(u.getSouth())*n.worldSize,C=[g,T,0],O=[y,T,0],U=[g,M,0],V=[y,M,0],q=Qv([],n.globeMatrix);return Cr(C,C,q),Cr(O,O,q),Cr(U,U,q),Cr(V,V,q),f[0]=Ku(f[0],U,a),f[1]=Ku(f[1],V,a),f[2]=Ku(f[2],O,a),f[3]=Ku(f[3],C,a),Bs.fromPoints(f)}function uE(o,n,a){for(let u of o)Cr(u,u,n),Mo(u,u,a)}function HD(o,n,a){let u=n/o.worldSize,f=o.globeMatrix;if(a.z<=1){let ht=Va(a).getCorners();return uE(ht,f,u),Bs.fromPoints(ht)}let g=J_(a),y=lx(g);uE(y,f,u);let T=Number.MAX_VALUE,M=[-T,-T,-T],C=[T,T,T];if(g.contains(o.center)){for(let Kt of y)qp(C,C,Kt),Xp(M,M,Kt);M[2]=0;let ht=o.point,At=[ht.x*u,ht.y*u,0];return qp(C,C,At),Xp(M,M,At),new Bs(C,M)}let O=[f[12]*u,f[13]*u,f[14]*u],U=g.getCenter(),V=re(o.center.lat,-_s,_s),q=re(U.lat,-_s,_s),J=Ga(o.center.lng),ie=Ha(V),_e=J-Ga(U.lng),ke=ie-Ha(q);_e>.5?_e-=1:_e<-.5&&(_e+=1);let Ge=0;Math.abs(_e)>Math.abs(ke)?Ge=_e>=0?1:3:(Ge=ke>=0?0:2,Zp(O,O,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(me(ke>=0?g.getSouth():g.getNorth()))*Ua));let Le=y[Ge],Ve=y[(Ge+1)%4],We=new GD(Le,Ve,O),He=[ax(We,0)||Le[0],ax(We,1)||Le[1],ax(We,2)||Le[2]],pt=Pd(o.zoom);if(pt>0){let ht=function({x:Kt,y:vt,z:Mt},kt,Vt,Yt,wt){let dn=1/(1<<Mt),Hn=Kt*dn,_n=Hn+dn,Ln=vt*dn,fn=Ln+dn,qn=0,xi=(Hn+_n)/2-Yt;return xi>.5?qn=-1:xi<-.5&&(qn=1),Hn=((Hn+qn)*kt-(Yt*=kt))*Vt+Yt,_n=((_n+qn)*kt-Yt)*Vt+Yt,Ln=(Ln*kt-(wt*=kt))*Vt+wt,fn=(fn*kt-wt)*Vt+wt,[[Hn,fn,0],[_n,fn,0],[_n,Ln,0],[Hn,Ln,0]]}(a,n,o._pixelsPerMercatorPixel,J,ie);for(let Kt=0;Kt<y.length;Kt++)Ku(y[Kt],ht[Kt],pt);let At=Tl([],ht[Ge],ht[(Ge+1)%4]);Mo(At,At,.5),Ku(He,At,pt)}for(let ht of y)qp(C,C,ht),Xp(M,M,ht);return C[2]=Math.min(Le[2],Ve[2]),qp(C,C,He),Xp(M,M,He),new Bs(C,M)}function J_({x:o,y:n,z:a}){let u=1/(1<<a),f=new Di(Io(o*u),gs((n+1)*u)),g=new Di(Io((o+1)*u),gs(n*u));return new Tc(f,g)}function lx(o){let n=me(o.getNorth()),a=me(o.getSouth()),u=Math.cos(n),f=Math.cos(a),g=Math.sin(n),y=Math.sin(a),T=o.getWest(),M=o.getEast();return[Dd(f,y,T),Dd(f,y,M),Dd(u,g,M),Dd(u,g,T)]}function Dd(o,n,a,u=Ua){return a=me(a),[o*Math.sin(a)*u,-n*u,o*Math.cos(a)*u]}function Rd(o,n,a){return Dd(Math.cos(me(o)),Math.sin(me(o)),n,a)}function $p(o,n,a,u){let f=1<<a.z,g=(o/Zn+a.x)/f;return Rd(gs((n/Zn+a.y)/f),Io(g),u)}function $_({min:o,max:n}){return 16383/Math.max(n[0]-o[0],n[1]-o[1],n[2]-o[2])}let hE=new Float64Array(16);function Qp(o){let n=$_(o),a=KT(hE,[n,n,n]);return jp(a,a,((u=[])[0]=-(f=o.min)[0],u[1]=-f[1],u[2]=-f[2],u));var u,f}function cx(o){let n=(u=o.min,(a=hE)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=u[0],a[13]=u[1],a[14]=u[2],a[15]=1,a);var a,u;let f=1/$_(o);return qu(n,n,[f,f,f])}function dE(o,n,a,u,f){let g=function(M){let C=Zn/(2*Math.PI);return M/(2*Math.PI)/C}(a),y=[o,n,-a/(2*Math.PI)],T=fa(new Float64Array(16));return jp(T,T,y),qu(T,T,[g,g,g]),ex(T,T,me(-f)),K_(T,T,me(-u)),T}function Pd(o){return ve(5,6,o)}function fE(o,n){let a=Rd(n.lat,n.lng),u=function(J){let ie=Rd(J._center.lat,J._center.lng),_e=ix([],Ld(0,1,0),ie),ke=YT([],-J.angle,ie);_e=Cr(_e,_e,ke),YT(ke,-J._pitch,_e);let Ge=Fs([],ie);return Mo(Ge,Ge,Y_(J.cameraToCenterDistance/J.pixelsPerMeter)),Cr(Ge,Ge,ke),Tl([],ie,Ge)}(o);return y=(f=nx([],u,a))[0],T=f[1],M=f[2],C=(g=a)[0],O=g[1],U=g[2],q=(V=Math.sqrt(y*y+T*T+M*M)*Math.sqrt(C*C+O*O+U*U))&&Bo(f,g)/V,Math.acos(Math.min(Math.max(q,-1),1));var f,g,y,T,M,C,O,U,V,q}function ux(o,n){return fE(o,n)>Math.PI/2*1.01}let pE=me(85),jD=Math.cos(pE),WD=Math.sin(pE),em=63710088e-1,mE=2*Math.PI*em;class Di{constructor(n,a){if(isNaN(n)||isNaN(a))throw new Error(`Invalid LngLat object: (${n}, ${a})`);if(this.lng=+n,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Di(ae(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){let a=Math.PI/180,u=this.lat*a,f=n.lat*a,g=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((n.lng-this.lng)*a);return em*Math.acos(Math.min(g,1))}toBounds(n=0){let a=360*n/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new Tc(new Di(this.lng-u,this.lat-a),new Di(this.lng+u,this.lat+a))}toEcef(n){let a=Y_(n);return Rd(this.lat,this.lng,Ua+a)}static convert(n){if(n instanceof Di)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Di(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Di(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function hx(o){return mE*Math.cos(o*Math.PI/180)}function Ga(o){return(180+o)/360}function Ha(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function ma(o,n){return o/hx(n)}function Io(o){return 360*o-180}function gs(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function gE(o,n){return o*hx(gs(n))}let _s=85.051129;function _E(o){return 1/Math.cos(o*Math.PI/180)}class kd{constructor(n,a,u=0){this.x=+n,this.y=+a,this.z=+u}static fromLngLat(n,a=0){let u=Di.convert(n);return new kd(Ga(u.lng),Ha(u.lat),ma(a,u.lat))}toLngLat(){return new Di(Io(this.x),gs(this.y))}toAltitude(){return gE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/mE*_E(gs(this.y))}}function dx(o,n,a,u,f,g,y,T,M){let C=(n+u)/2,O=(a+f)/2,U=new G(C,O);T(U),function(V,q,J,ie,_e,ke){let Ge=J-_e,Le=ie-ke;return Math.abs((ie-q)*Ge-(J-V)*Le)/Math.hypot(Ge,Le)}(U.x,U.y,g.x,g.y,y.x,y.y)>=M?(dx(o,n,a,C,O,g,U,T,M),dx(o,C,O,u,f,U,y,T,M)):o.push(y)}function yE(o,n,a){let u=o[0],f=u.x,g=u.y;n(u);let y=[u];for(let T=1;T<o.length;T++){let M=o[T],{x:C,y:O}=M;n(M),dx(y,f,g,C,O,u,M,n,a),f=C,g=O,u=M}return y}function fx(o,n,a,u){if(u(n,a)){let f=n.add(a)._mult(.5);fx(o,n,f,u),fx(o,f,a,u)}else o.push(a)}function qD(o,n){let a=o[0],u=[a];for(let f=1;f<o.length;f++){let g=o[f];fx(u,a,g,n),a=g}return u}let px=Math.pow(2,14)-1,vE=-px-1;function XD(o,n){let a=Math.round(o.x*n),u=Math.round(o.y*n);return o.x=re(a,vE,px),o.y=re(u,vE,px),(a<o.x||a>o.x+1||u<o.y||u>o.y+1)&&nt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function El(o,n,a){let u=o.loadGeometry(),f=o.extent,g=Zn/f;if(n&&a&&a.projection.isReprojectedInTileSpace){let y=1<<n.z,{scale:T,x:M,y:C,projection:O}=a,U=V=>{let q=Io((n.x+V.x/f)/y),J=gs((n.y+V.y/f)/y),ie=O.project(q,J);V.x=(ie.x*T-M)*f,V.y=(ie.y*T-C)*f};for(let V=0;V<u.length;V++)if(o.type!==1)u[V]=yE(u[V],U,1);else{let q=[];for(let J of u[V])J.x<0||J.x>=f||J.y<0||J.y>=f||(U(J),q.push(J));u[V]=q}}for(let y of u)for(let T of y)XD(T,g);return u}function Yu(o,n){return{type:o.type,id:o.id,properties:o.properties,geometry:n?El(o):[]}}function Q_(o,n,a,u,f){o.emplaceBack(2*n+(u+1)/2,2*a+(f+1)/2)}function ey(o,n,a){let u=16384;o.emplaceBack(n.x,n.y,n.z,a[0]*u,a[1]*u,a[2]*u)}class mx{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new Bn,this.indexArray=new ms,this.segments=new kr,this.programConfigurations=new ju(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,u,f){let g=this.layers[0],y=[],T=null;g.type==="circle"&&(T=g.layout.get("circle-sort-key"));for(let{feature:C,id:O,index:U,sourceLayerIndex:V}of n){let q=this.layers[0]._featureFilter.needGeometry,J=Yu(C,q);if(!this.layers[0]._featureFilter.filter(new it(this.zoom),J,u))continue;let ie=T?T.evaluate(J,{},u):void 0,_e={id:O,properties:C.properties,type:C.type,sourceLayerIndex:V,index:U,geometry:q?J.geometry:El(C,u,f),patterns:{},sortKey:ie};y.push(_e)}T&&y.sort((C,O)=>C.sortKey-O.sortKey);let M=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new Ao,M=f.projection);for(let C of y){let{geometry:O,index:U,sourceLayerIndex:V}=C,q=n[U].feature;this.addFeature(C,O,U,a.availableImages,u,M),a.featureIndex.insert(q,O,U,V,this.index)}}update(n,a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,kD.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,zD.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,a,u,f,g,y){for(let T of a)for(let M of T){let C=M.x,O=M.y;if(C<0||C>=Zn||O<0||O>=Zn)continue;if(y){let q=y.projectTilePoint(C,O,g),J=y.upVector(g,C,O),ie=this.globeExtVertexArray;ey(ie,q,J),ey(ie,q,J),ey(ie,q,J),ey(ie,q,J)}let U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),V=U.vertexLength;Q_(this.layoutVertexArray,C,O,-1,-1),Q_(this.layoutVertexArray,C,O,1,-1),Q_(this.layoutVertexArray,C,O,1,1),Q_(this.layoutVertexArray,C,O,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+2,V+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},f,g)}}function xE(o,n){for(let a=0;a<o.length;a++)if(Ju(n,o[a]))return!0;for(let a=0;a<n.length;a++)if(Ju(o,n[a]))return!0;return!!gx(o,n)}function ZD(o,n,a){return!!Ju(o,n)||!!_x(n,o,a)}function bE(o,n){if(o.length===1)return TE(n,o[0]);for(let a=0;a<n.length;a++){let u=n[a];for(let f=0;f<u.length;f++)if(Ju(o,u[f]))return!0}for(let a=0;a<o.length;a++)if(TE(n,o[a]))return!0;for(let a=0;a<n.length;a++)if(gx(o,n[a]))return!0;return!1}function KD(o,n,a){if(o.length>1){if(gx(o,n))return!0;for(let u=0;u<n.length;u++)if(_x(n[u],o,a))return!0}for(let u=0;u<o.length;u++)if(_x(o[u],n,a))return!0;return!1}function gx(o,n){if(o.length===0||n.length===0)return!1;for(let a=0;a<o.length-1;a++){let u=o[a],f=o[a+1];for(let g=0;g<n.length-1;g++)if(YD(u,f,n[g],n[g+1]))return!0}return!1}function YD(o,n,a,u){return at(o,a,u)!==at(n,a,u)&&at(o,n,a)!==at(o,n,u)}function _x(o,n,a){let u=a*a;if(n.length===1)return o.distSqr(n[0])<u;for(let f=1;f<n.length;f++)if(wE(o,n[f-1],n[f])<u)return!0;return!1}function wE(o,n,a){let u=n.distSqr(a);if(u===0)return o.distSqr(n);let f=((o.x-n.x)*(a.x-n.x)+(o.y-n.y)*(a.y-n.y))/u;return o.distSqr(f<0?n:f>1?a:a.sub(n)._mult(f)._add(n))}function TE(o,n){let a,u,f,g=!1;for(let y=0;y<o.length;y++){a=o[y];for(let T=0,M=a.length-1;T<a.length;M=T++)u=a[T],f=a[M],u.y>n.y!=f.y>n.y&&n.x<(f.x-u.x)*(n.y-u.y)/(f.y-u.y)+u.x&&(g=!g)}return g}function Ju(o,n){let a=!1;for(let u=0,f=o.length-1;u<o.length;f=u++){let g=o[u],y=o[f];g.y>n.y!=y.y>n.y&&n.x<(y.x-g.x)*(n.y-g.y)/(y.y-g.y)+g.x&&(a=!a)}return a}function EE(o,n,a,u,f){for(let y of o)if(n<=y.x&&a<=y.y&&u>=y.x&&f>=y.y)return!0;let g=[new G(n,a),new G(n,f),new G(u,f),new G(u,a)];if(o.length>2){for(let y of g)if(Ju(o,y))return!0}for(let y=0;y<o.length-1;y++)if(JD(o[y],o[y+1],g))return!0;return!1}function JD(o,n,a){let u=a[0],f=a[2];if(o.x<u.x&&n.x<u.x||o.x>f.x&&n.x>f.x||o.y<u.y&&n.y<u.y||o.y>f.y&&n.y>f.y)return!1;let g=at(o,n,a[0]);return g!==at(o,n,a[1])||g!==at(o,n,a[2])||g!==at(o,n,a[3])}function zd(o,n,a){let u=n.paint.get(o).value;return u.kind==="constant"?u.value:a.programConfigurations.get(n.id).getMaxValue(o)}function ty(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function SE(o,n,a,u,f){if(!n[0]&&!n[1])return o;let g=G.convert(n)._mult(f);a==="viewport"&&g._rotate(-u);let y=[];for(let T=0;T<o.length;T++)y.push(o[T].sub(g));return y}function AE(o,n,a,u){let f=G.convert(o)._mult(u);return n==="viewport"&&f._rotate(-a),f}Sn(mx,"CircleBucket",{omit:["layers"]});let $D=new jt({"circle-sort-key":new yt(Tt.layout_circle["circle-sort-key"])});var QD={paint:new jt({"circle-radius":new yt(Tt.paint_circle["circle-radius"]),"circle-color":new yt(Tt.paint_circle["circle-color"]),"circle-blur":new yt(Tt.paint_circle["circle-blur"]),"circle-opacity":new yt(Tt.paint_circle["circle-opacity"]),"circle-translate":new tt(Tt.paint_circle["circle-translate"]),"circle-translate-anchor":new tt(Tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tt(Tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tt(Tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yt(Tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yt(Tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yt(Tt.paint_circle["circle-stroke-opacity"])}),layout:$D};function ME(o,n,a,u,f,g,y,T,M){if(g&&o.queryGeometry.isAboveHorizon)return!1;g&&(M*=o.pixelToTileUnitsFactor);let C=o.tileID.canonical,O=a.projection.upVectorScale(C,a.center.lat,a.worldSize).metersToTile;for(let U of n)for(let V of U){let q=V.add(T),J=f&&a.elevation?a.elevation.exaggeration()*f.getElevationAt(q.x,q.y,!0):0,ie=a.projection.projectTilePoint(q.x,q.y,C);if(J>0){let Le=a.projection.upVector(C,q.x,q.y);ie.x+=Le[0]*O*J,ie.y+=Le[1]*O*J,ie.z+=Le[2]*O*J}let _e=g?q:eR(ie.x,ie.y,ie.z,u),ke=g?o.tilespaceRays.map(Le=>nR(Le,J)):o.queryGeometry.screenGeometry,Ge=Xu([],[ie.x,ie.y,ie.z,1],u);if(!y&&g?M*=Ge[3]/a.cameraToCenterDistance:y&&!g&&(M*=a.cameraToCenterDistance/Ge[3]),g){let Le=gs((V.y/Zn+C.y)/(1<<C.z));M/=a.projection.pixelsPerMeter(Le,1)/ma(1,Le)}if(ZD(ke,_e,M))return!0}return!1}function eR(o,n,a,u){let f=Xu([],[o,n,a,1],u);return new G(f[0]/f[3],f[1]/f[3])}let IE=Ld(0,0,0),tR=Ld(0,0,1);function nR(o,n){let a=tx();return IE[2]=n,o.intersectsPlane(IE,tR,a),new G(a[0],a[1])}class CE extends mx{}function LE(o,{width:n,height:a},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==n*a*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(n*a*u);return o.width=n,o.height=a,o.data=f,o}function DE(o,n,a){let{width:u,height:f}=n;u===o.width&&f===o.height||(yx(o,n,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,u),height:Math.min(o.height,f)},a),o.width=u,o.height=f,o.data=n.data)}function yx(o,n,a,u,f,g){if(f.width===0||f.height===0)return n;if(f.width>o.width||f.height>o.height||a.x>o.width-f.width||a.y>o.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>n.width||f.height>n.height||u.x>n.width-f.width||u.y>n.height-f.height)throw new RangeError("out of range destination coordinates for image copy");let y=o.data,T=n.data;for(let M=0;M<f.height;M++){let C=((a.y+M)*o.width+a.x)*g,O=((u.y+M)*n.width+u.x)*g;for(let U=0;U<f.width*g;U++)T[O+U]=y[C+U]}return n}Sn(CE,"HeatmapBucket",{omit:["layers"]});class Sl{constructor(n,a){LE(this,n,1,a)}resize(n){DE(this,new Sl(n),1)}clone(){return new Sl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,u,f,g){yx(n,a,u,f,g,1)}}class co{constructor(n,a){LE(this,n,4,a)}resize(n){DE(this,new co(n),4)}replace(n,a){a?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new co({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,u,f,g){yx(n,a,u,f,g,4)}}Sn(Sl,"AlphaImage"),Sn(co,"RGBAImage");var iR={paint:new jt({"heatmap-radius":new yt(Tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yt(Tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tt(Tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Nt(Tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tt(Tt.paint_heatmap["heatmap-opacity"])})};function vx(o){let n={},a=o.resolution||256,u=o.clips?o.clips.length:1,f=o.image||new co({width:a,height:u}),g=(y,T,M)=>{n[o.evaluationKey]=M;let C=o.expression.evaluate(n);f.data[y+T+0]=Math.floor(255*C.r/C.a),f.data[y+T+1]=Math.floor(255*C.g/C.a),f.data[y+T+2]=Math.floor(255*C.b/C.a),f.data[y+T+3]=Math.floor(255*C.a)};if(o.clips)for(let y=0,T=0;y<u;++y,T+=4*a)for(let M=0,C=0;M<a;M++,C+=4){let O=M/(a-1),{start:U,end:V}=o.clips[y];g(T,C,U*(1-O)+V*O)}else for(let y=0,T=0;y<a;y++,T+=4)g(0,T,y/(a-1));return f}var rR={paint:new jt({"hillshade-illumination-direction":new tt(Tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tt(Tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tt(Tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tt(Tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tt(Tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tt(Tt.paint_hillshade["hillshade-accent-color"])})};let sR=Fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:oR}=sR;var Od={};function ny(o,n,a){a=a||2;var u,f,g,y,T,M,C,O=n&&n.length,U=O?n[0]*a:o.length,V=RE(o,0,U,a,!0),q=[];if(!V||V.next===V.prev)return q;if(O&&(V=function(ie,_e,ke,Ge){var Le,Ve,We,He=[];for(Le=0,Ve=_e.length;Le<Ve;Le++)(We=RE(ie,_e[Le]*Ge,Le<Ve-1?_e[Le+1]*Ge:ie.length,Ge,!1))===We.next&&(We.steiner=!0),He.push(pR(We));for(He.sort(hR),Le=0;Le<He.length;Le++)ke=dR(He[Le],ke);return ke}(o,n,V,a)),o.length>80*a){u=g=o[0],f=y=o[1];for(var J=a;J<U;J+=a)(T=o[J])<u&&(u=T),(M=o[J+1])<f&&(f=M),T>g&&(g=T),M>y&&(y=M);C=(C=Math.max(g-u,y-f))!==0?32767/C:0}return tm(V,q,a,u,f,C,0),q}function RE(o,n,a,u,f){var g,y;if(f===wx(o,n,a,u)>0)for(g=n;g<a;g+=u)y=zE(g,o[g],o[g+1],y);else for(g=a-u;g>=n;g-=u)y=zE(g,o[g],o[g+1],y);return y&&iy(y,y.next)&&(im(y),y=y.next),y}function $u(o,n){if(!o)return o;n||(n=o);var a,u=o;do if(a=!1,u.steiner||!iy(u,u.next)&&zr(u.prev,u,u.next)!==0)u=u.next;else{if(im(u),(u=n=u.prev)===u.next)break;a=!0}while(a||u!==n);return n}function tm(o,n,a,u,f,g,y){if(o){!y&&g&&function(O,U,V,q){var J=O;do J.z===0&&(J.z=xx(J.x,J.y,U,V,q)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==O);J.prevZ.nextZ=null,J.prevZ=null,function(ie){var _e,ke,Ge,Le,Ve,We,He,pt,ht=1;do{for(ke=ie,ie=null,Ve=null,We=0;ke;){for(We++,Ge=ke,He=0,_e=0;_e<ht&&(He++,Ge=Ge.nextZ);_e++);for(pt=ht;He>0||pt>0&&Ge;)He!==0&&(pt===0||!Ge||ke.z<=Ge.z)?(Le=ke,ke=ke.nextZ,He--):(Le=Ge,Ge=Ge.nextZ,pt--),Ve?Ve.nextZ=Le:ie=Le,Le.prevZ=Ve,Ve=Le;ke=Ge}Ve.nextZ=null,ht*=2}while(We>1)}(J)}(o,u,f,g);for(var T,M,C=o;o.prev!==o.next;)if(T=o.prev,M=o.next,g?lR(o,u,f,g):aR(o))n.push(T.i/a|0),n.push(o.i/a|0),n.push(M.i/a|0),im(o),o=M.next,C=M.next;else if((o=M)===C){y?y===1?tm(o=cR($u(o),n,a),n,a,u,f,g,2):y===2&&uR(o,n,a,u,f,g):tm($u(o),n,a,u,f,g,1);break}}}function aR(o){var n=o.prev,a=o,u=o.next;if(zr(n,a,u)>=0)return!1;for(var f=n.x,g=a.x,y=u.x,T=n.y,M=a.y,C=u.y,O=f<g?f<y?f:y:g<y?g:y,U=T<M?T<C?T:C:M<C?M:C,V=f>g?f>y?f:y:g>y?g:y,q=T>M?T>C?T:C:M>C?M:C,J=u.next;J!==n;){if(J.x>=O&&J.x<=V&&J.y>=U&&J.y<=q&&Nd(f,T,g,M,y,C,J.x,J.y)&&zr(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function lR(o,n,a,u){var f=o.prev,g=o,y=o.next;if(zr(f,g,y)>=0)return!1;for(var T=f.x,M=g.x,C=y.x,O=f.y,U=g.y,V=y.y,q=T<M?T<C?T:C:M<C?M:C,J=O<U?O<V?O:V:U<V?U:V,ie=T>M?T>C?T:C:M>C?M:C,_e=O>U?O>V?O:V:U>V?U:V,ke=xx(q,J,n,a,u),Ge=xx(ie,_e,n,a,u),Le=o.prevZ,Ve=o.nextZ;Le&&Le.z>=ke&&Ve&&Ve.z<=Ge;){if(Le.x>=q&&Le.x<=ie&&Le.y>=J&&Le.y<=_e&&Le!==f&&Le!==y&&Nd(T,O,M,U,C,V,Le.x,Le.y)&&zr(Le.prev,Le,Le.next)>=0||(Le=Le.prevZ,Ve.x>=q&&Ve.x<=ie&&Ve.y>=J&&Ve.y<=_e&&Ve!==f&&Ve!==y&&Nd(T,O,M,U,C,V,Ve.x,Ve.y)&&zr(Ve.prev,Ve,Ve.next)>=0))return!1;Ve=Ve.nextZ}for(;Le&&Le.z>=ke;){if(Le.x>=q&&Le.x<=ie&&Le.y>=J&&Le.y<=_e&&Le!==f&&Le!==y&&Nd(T,O,M,U,C,V,Le.x,Le.y)&&zr(Le.prev,Le,Le.next)>=0)return!1;Le=Le.prevZ}for(;Ve&&Ve.z<=Ge;){if(Ve.x>=q&&Ve.x<=ie&&Ve.y>=J&&Ve.y<=_e&&Ve!==f&&Ve!==y&&Nd(T,O,M,U,C,V,Ve.x,Ve.y)&&zr(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.nextZ}return!0}function cR(o,n,a){var u=o;do{var f=u.prev,g=u.next.next;!iy(f,g)&&PE(f,u,u.next,g)&&nm(f,g)&&nm(g,f)&&(n.push(f.i/a|0),n.push(u.i/a|0),n.push(g.i/a|0),im(u),im(u.next),u=o=g),u=u.next}while(u!==o);return $u(u)}function uR(o,n,a,u,f,g){var y=o;do{for(var T=y.next.next;T!==y.prev;){if(y.i!==T.i&&mR(y,T)){var M=kE(y,T);return y=$u(y,y.next),M=$u(M,M.next),tm(y,n,a,u,f,g,0),void tm(M,n,a,u,f,g,0)}T=T.next}y=y.next}while(y!==o)}function hR(o,n){return o.x-n.x}function dR(o,n){var a=function(f,g){var y,T=g,M=f.x,C=f.y,O=-1/0;do{if(C<=T.y&&C>=T.next.y&&T.next.y!==T.y){var U=T.x+(C-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(U<=M&&U>O&&(O=U,y=T.x<T.next.x?T:T.next,U===M))return y}T=T.next}while(T!==g);if(!y)return null;var V,q=y,J=y.x,ie=y.y,_e=1/0;T=y;do M>=T.x&&T.x>=J&&M!==T.x&&Nd(C<ie?M:O,C,J,ie,C<ie?O:M,C,T.x,T.y)&&(V=Math.abs(C-T.y)/(M-T.x),nm(T,f)&&(V<_e||V===_e&&(T.x>y.x||T.x===y.x&&fR(y,T)))&&(y=T,_e=V)),T=T.next;while(T!==q);return y}(o,n);if(!a)return n;var u=kE(a,o);return $u(u,u.next),$u(a,a.next)}function fR(o,n){return zr(o.prev,o,n.prev)<0&&zr(n.next,o,o.next)<0}function xx(o,n,a,u,f){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-a)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-u)*f|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function pR(o){var n=o,a=o;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==o);return a}function Nd(o,n,a,u,f,g,y,T){return(f-y)*(n-T)>=(o-y)*(g-T)&&(o-y)*(u-T)>=(a-y)*(n-T)&&(a-y)*(g-T)>=(f-y)*(u-T)}function mR(o,n){return o.next.i!==n.i&&o.prev.i!==n.i&&!function(a,u){var f=a;do{if(f.i!==a.i&&f.next.i!==a.i&&f.i!==u.i&&f.next.i!==u.i&&PE(f,f.next,a,u))return!0;f=f.next}while(f!==a);return!1}(o,n)&&(nm(o,n)&&nm(n,o)&&function(a,u){var f=a,g=!1,y=(a.x+u.x)/2,T=(a.y+u.y)/2;do f.y>T!=f.next.y>T&&f.next.y!==f.y&&y<(f.next.x-f.x)*(T-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next;while(f!==a);return g}(o,n)&&(zr(o.prev,o,n.prev)||zr(o,n.prev,n))||iy(o,n)&&zr(o.prev,o,o.next)>0&&zr(n.prev,n,n.next)>0)}function zr(o,n,a){return(n.y-o.y)*(a.x-n.x)-(n.x-o.x)*(a.y-n.y)}function iy(o,n){return o.x===n.x&&o.y===n.y}function PE(o,n,a,u){var f=sy(zr(o,n,a)),g=sy(zr(o,n,u)),y=sy(zr(a,u,o)),T=sy(zr(a,u,n));return f!==g&&y!==T||!(f!==0||!ry(o,a,n))||!(g!==0||!ry(o,u,n))||!(y!==0||!ry(a,o,u))||!(T!==0||!ry(a,n,u))}function ry(o,n,a){return n.x<=Math.max(o.x,a.x)&&n.x>=Math.min(o.x,a.x)&&n.y<=Math.max(o.y,a.y)&&n.y>=Math.min(o.y,a.y)}function sy(o){return o>0?1:o<0?-1:0}function nm(o,n){return zr(o.prev,o,o.next)<0?zr(o,n,o.next)>=0&&zr(o,o.prev,n)>=0:zr(o,n,o.prev)<0||zr(o,o.next,n)<0}function kE(o,n){var a=new bx(o.i,o.x,o.y),u=new bx(n.i,n.x,n.y),f=o.next,g=n.prev;return o.next=n,n.prev=o,a.next=f,f.prev=a,u.next=a,a.prev=u,g.next=u,u.prev=g,u}function zE(o,n,a,u){var f=new bx(o,n,a);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function im(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function bx(o,n,a){this.i=o,this.x=n,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wx(o,n,a,u){for(var f=0,g=n,y=a-u;g<a;g+=u)f+=(o[y]-o[g])*(o[g+1]+o[y+1]),y=g;return f}function gR(o,n,a,u,f){OE(o,n,a||0,u||o.length-1,f||_R)}function OE(o,n,a,u,f){for(;u>a;){if(u-a>600){var g=u-a+1,y=n-a+1,T=Math.log(g),M=.5*Math.exp(2*T/3),C=.5*Math.sqrt(T*M*(g-M)/g)*(y-g/2<0?-1:1);OE(o,n,Math.max(a,Math.floor(n-y*M/g+C)),Math.min(u,Math.floor(n+(g-y)*M/g+C)),f)}var O=o[n],U=a,V=u;for(rm(o,a,n),f(o[u],O)>0&&rm(o,a,u);U<V;){for(rm(o,U,V),U++,V--;f(o[U],O)<0;)U++;for(;f(o[V],O)>0;)V--}f(o[a],O)===0?rm(o,a,V):rm(o,++V,u),V<=n&&(a=V+1),n<=V&&(u=V-1)}}function rm(o,n,a){var u=o[n];o[n]=o[a],o[a]=u}function _R(o,n){return o<n?-1:o>n?1:0}function Tx(o,n){let a=o.length;if(a<=1)return[o];let u=[],f,g;for(let y=0;y<a;y++){let T=St(o[y]);T!==0&&(o[y].area=Math.abs(T),g===void 0&&(g=T<0),g===T<0?(f&&u.push(f),f=[o[y]]):f.push(o[y]))}if(f&&u.push(f),n>1)for(let y=0;y<u.length;y++)u[y].length<=n||(gR(u[y],n,1,u[y].length-1,yR),u[y]=u[y].slice(0,n));return u}function yR(o,n){return n.area-o.area}function Ex(o,n,a){let u=a.patternDependencies,f=!1;for(let g of n){let y=g.paint.get(`${o}-pattern`);y.isConstant()||(f=!0);let T=y.constantOr(null);T&&(f=!0,u[T]=!0)}return f}function Sx(o,n,a,u,f){let g=f.patternDependencies;for(let y of n){let T=y.paint.get(`${o}-pattern`).value;if(T.kind!=="constant"){let M=T.evaluate({zoom:u},a,{},f.availableImages);M=M&&M.name?M.name:M,g[M]=!0,a.patterns[y.id]=M}}return a}({get exports(){return Od},set exports(o){Od=o}}).exports=ny,Od.default=ny,ny.deviation=function(o,n,a,u){var f=n&&n.length,g=Math.abs(wx(o,0,f?n[0]*a:o.length,a));if(f)for(var y=0,T=n.length;y<T;y++)g-=Math.abs(wx(o,n[y]*a,y<T-1?n[y+1]*a:o.length,a));var M=0;for(y=0;y<u.length;y+=3){var C=u[y]*a,O=u[y+1]*a,U=u[y+2]*a;M+=Math.abs((o[C]-o[U])*(o[O+1]-o[C+1])-(o[C]-o[O])*(o[U+1]-o[C+1]))}return g===0&&M===0?0:Math.abs((M-g)/g)},ny.flatten=function(o){for(var n=o[0][0].length,a={vertices:[],holes:[],dimensions:n},u=0,f=0;f<o.length;f++){for(var g=0;g<o[f].length;g++)for(var y=0;y<n;y++)a.vertices.push(o[f][g][y]);f>0&&a.holes.push(u+=o[f-1].length)}return a};class oy{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bn,this.indexArray=new ms,this.indexArray2=new Fa,this.programConfigurations=new ju(n.layers,n.zoom),this.segments=new kr,this.segments2=new kr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=n.projection}populate(n,a,u,f){this.hasPattern=Ex("fill",this.layers,a);let g=this.layers[0].layout.get("fill-sort-key"),y=[];for(let{feature:T,id:M,index:C,sourceLayerIndex:O}of n){let U=this.layers[0]._featureFilter.needGeometry,V=Yu(T,U);if(!this.layers[0]._featureFilter.filter(new it(this.zoom),V,u))continue;let q=g?g.evaluate(V,{},u,a.availableImages):void 0,J={id:M,properties:T.properties,type:T.type,sourceLayerIndex:O,index:C,geometry:U?V.geometry:El(T,u,f),patterns:{},sortKey:q};y.push(J)}g&&y.sort((T,M)=>T.sortKey-M.sortKey);for(let T of y){let{geometry:M,index:C,sourceLayerIndex:O}=T;if(this.hasPattern){let U=Sx("fill",this.layers,T,this.zoom,a);this.patternFeatures.push(U)}else this.addFeature(T,M,C,u,{},a.availableImages);a.featureIndex.insert(n[C].feature,M,C,O,this.index)}}update(n,a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,u,f)}addFeatures(n,a,u,f,g){for(let y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,oR),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,a,u,f,g,y=[]){for(let T of Tx(a,500)){let M=0;for(let J of T)M+=J.length;let C=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),O=C.vertexLength,U=[],V=[];for(let J of T){if(J.length===0)continue;J!==T[0]&&V.push(U.length/2);let ie=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),_e=ie.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(_e+J.length-1,_e),U.push(J[0].x),U.push(J[0].y);for(let ke=1;ke<J.length;ke++)this.layoutVertexArray.emplaceBack(J[ke].x,J[ke].y),this.indexArray2.emplaceBack(_e+ke-1,_e+ke),U.push(J[ke].x),U.push(J[ke].y);ie.vertexLength+=J.length,ie.primitiveLength+=J.length}let q=Od(U,V);for(let J=0;J<q.length;J+=3)this.indexArray.emplaceBack(O+q[J],O+q[J+1],O+q[J+2]);C.vertexLength+=M,C.primitiveLength+=q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,g,y,f)}}Sn(oy,"FillBucket",{omit:["layers","patternFeatures"]});let vR=new jt({"fill-sort-key":new yt(Tt.layout_fill["fill-sort-key"])});var xR={paint:new jt({"fill-antialias":new tt(Tt.paint_fill["fill-antialias"]),"fill-opacity":new yt(Tt.paint_fill["fill-opacity"]),"fill-color":new yt(Tt.paint_fill["fill-color"]),"fill-outline-color":new yt(Tt.paint_fill["fill-outline-color"]),"fill-translate":new tt(Tt.paint_fill["fill-translate"]),"fill-translate-anchor":new tt(Tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new yt(Tt.paint_fill["fill-pattern"])}),layout:vR};let bR=Fn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),wR=Fn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),TR=Fn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ER}=bR;var ay={},SR=G,NE=Fd;function Fd(o,n,a,u,f){this.properties={},this.extent=a,this.type=0,this._pbf=o,this._geometry=-1,this._keys=u,this._values=f,o.readFields(AR,this,n)}function AR(o,n,a){o==1?n.id=a.readVarint():o==2?function(u,f){for(var g=u.readVarint()+u.pos;u.pos<g;){var y=f._keys[u.readVarint()],T=f._values[u.readVarint()];f.properties[y]=T}}(a,n):o==3?n.type=a.readVarint():o==4&&(n._geometry=a.pos)}function MR(o){for(var n,a,u=0,f=0,g=o.length,y=g-1;f<g;y=f++)u+=((a=o[y]).x-(n=o[f]).x)*(n.y+a.y);return u}Fd.types=["Unknown","Point","LineString","Polygon"],Fd.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var n,a=o.readVarint()+o.pos,u=1,f=0,g=0,y=0,T=[];o.pos<a;){if(f<=0){var M=o.readVarint();u=7&M,f=M>>3}if(f--,u===1||u===2)g+=o.readSVarint(),y+=o.readSVarint(),u===1&&(n&&T.push(n),n=[]),n.push(new SR(g,y));else{if(u!==7)throw new Error("unknown command "+u);n&&n.push(n[0].clone())}}return n&&T.push(n),T},Fd.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var n=o.readVarint()+o.pos,a=1,u=0,f=0,g=0,y=1/0,T=-1/0,M=1/0,C=-1/0;o.pos<n;){if(u<=0){var O=o.readVarint();a=7&O,u=O>>3}if(u--,a===1||a===2)(f+=o.readSVarint())<y&&(y=f),f>T&&(T=f),(g+=o.readSVarint())<M&&(M=g),g>C&&(C=g);else if(a!==7)throw new Error("unknown command "+a)}return[y,M,T,C]},Fd.prototype.toGeoJSON=function(o,n,a){var u,f,g=this.extent*Math.pow(2,a),y=this.extent*o,T=this.extent*n,M=this.loadGeometry(),C=Fd.types[this.type];function O(q){for(var J=0;J<q.length;J++){var ie=q[J];q[J]=[360*(ie.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(ie.y+T)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(u=0;u<M.length;u++)U[u]=M[u][0];O(M=U);break;case 2:for(u=0;u<M.length;u++)O(M[u]);break;case 3:for(M=function(q){var J=q.length;if(J<=1)return[q];for(var ie,_e,ke=[],Ge=0;Ge<J;Ge++){var Le=MR(q[Ge]);Le!==0&&(_e===void 0&&(_e=Le<0),_e===Le<0?(ie&&ke.push(ie),ie=[q[Ge]]):ie.push(q[Ge]))}return ie&&ke.push(ie),ke}(M),u=0;u<M.length;u++)for(f=0;f<M[u].length;f++)O(M[u][f])}M.length===1?M=M[0]:C="Multi"+C;var V={type:"Feature",geometry:{type:C,coordinates:M},properties:this.properties};return"id"in this&&(V.id=this.id),V};var IR=NE,FE=BE;function BE(o,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(CR,this,n),this.length=this._features.length}function CR(o,n,a){o===15?n.version=a.readVarint():o===1?n.name=a.readString():o===5?n.extent=a.readVarint():o===2?n._features.push(a.pos):o===3?n._keys.push(a.readString()):o===4&&n._values.push(function(u){for(var f=null,g=u.readVarint()+u.pos;u.pos<g;){var y=u.readVarint()>>3;f=y===1?u.readString():y===2?u.readFloat():y===3?u.readDouble():y===4?u.readVarint64():y===5?u.readVarint():y===6?u.readSVarint():y===7?u.readBoolean():null}return f}(a))}BE.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var n=this._pbf.readVarint()+this._pbf.pos;return new IR(this._pbf,n,this.extent,this._keys,this._values)};var LR=FE;function DR(o,n,a){if(o===3){var u=new LR(a,a.readVarint()+a.pos);u.length&&(n[u.name]=u)}}var Ax=ay.VectorTile=function(o,n){this.layers=o.readFields(DR,{},n)},ly=ay.VectorTileFeature=NE;function cy(o,n,a,u){let f=[],g=u===0?(y,T,M,C,O,U)=>{y.push(new G(U,M+(U-T)/(C-T)*(O-M)))}:(y,T,M,C,O,U)=>{y.push(new G(T+(U-M)/(O-M)*(C-T),U))};for(let y of o){let T=[];for(let M of y){if(M.length<=2)continue;let C=[];for(let V=0;V<M.length-1;V++){let q=M[V].x,J=M[V].y,ie=M[V+1].x,_e=M[V+1].y,ke=u===0?q:J,Ge=u===0?ie:_e;ke<n?Ge>n&&g(C,q,J,ie,_e,n):ke>a?Ge<a&&g(C,q,J,ie,_e,a):C.push(M[V]),Ge<n&&ke>=n&&g(C,q,J,ie,_e,n),Ge>a&&ke<=a&&g(C,q,J,ie,_e,a)}let O=M[M.length-1],U=u===0?O.x:O.y;U>=n&&U<=a&&C.push(O),C.length&&(O=C[C.length-1],C[0].x===O.x&&C[0].y===O.y||C.push(C[0]),T.push(C))}T.length&&f.push(T)}return f}ay.VectorTileLayer=FE;let RR=ly.types,PR=Math.pow(2,13);function sm(o,n,a,u,f,g,y,T){o.emplaceBack((n<<1)+y,(a<<1)+g,(Math.floor(u*PR)<<1)+f,Math.round(T))}function om(o,n,a){let u=16384;o.emplaceBack(n.x,n.y,n.z,a[0]*u,a[1]*u,a[2]*u)}class UE{constructor(){this.acc=new G(0,0),this.polyCount=[]}startRing(n){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new G(n.x,n.y),this.max=new G(n.x,n.y))}append(n,a){this.currentPolyCount.edges++,this.acc._add(n);let u=this.min,f=this.max;n.x<u.x?u.x=n.x:n.x>f.x&&(f.x=n.x),n.y<u.y?u.y=n.y:n.y>f.y&&(f.y=n.y),((n.x===0||n.x===Zn)&&n.x===a.x)!=((n.y===0||n.y===Zn)&&n.y===a.y)&&this.processBorderOverlap(n,a),a.x<0!=n.x<0&&this.addBorderIntersection(0,Li(a.y,n.y,(0-a.x)/(n.x-a.x))),a.x>Zn!=n.x>Zn&&this.addBorderIntersection(1,Li(a.y,n.y,(Zn-a.x)/(n.x-a.x))),a.y<0!=n.y<0&&this.addBorderIntersection(2,Li(a.x,n.x,(0-a.y)/(n.y-a.y))),a.y>Zn!=n.y>Zn&&this.addBorderIntersection(3,Li(a.x,n.x,(Zn-a.y)/(n.y-a.y)))}addBorderIntersection(n,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let u=this.borders[n];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(n,a){if(n.x===a.x){if(n.y===a.y)return;let u=n.x===0?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,n.y)}else{let u=n.y===0?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,n.x)}}centroid(){let n=this.polyCount.reduce((a,u)=>a+u.edges,0);return n!==0?this.acc.div(n)._round():new G(0,0)}span(){return new G(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((n,a)=>n+ +(a[0]!==Number.MAX_VALUE),0)}}class am{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.layoutVertexArray=new Wi,this.centroidVertexArray=new VT,this.indexArray=new ms,this.programConfigurations=new ju(n.layers,n.zoom),this.segments=new kr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=n.enableTerrain}populate(n,a,u,f){this.features=[],this.hasPattern=Ex("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){let y=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*y/(y*y+1)/Zn/(1<<g.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:g,id:y,index:T,sourceLayerIndex:M}of n){let C=this.layers[0]._featureFilter.needGeometry,O=Yu(g,C);if(!this.layers[0]._featureFilter.filter(new it(this.zoom),O,u))continue;let U={id:y,sourceLayerIndex:M,index:T,geometry:C?O.geometry:El(g,u,f),properties:g.properties,type:g.type,patterns:{}},V=this.layoutVertexArray.length;this.hasPattern?this.features.push(Sx("fill-extrusion",this.layers,U,this.zoom,a)):this.addFeature(U,U.geometry,T,u,{},a.availableImages,f),a.featureIndex.insert(g,U.geometry,T,M,this.index,V)}this.sortBorders()}addFeatures(n,a,u,f,g){for(let y of this.features){let{geometry:T}=y;this.addFeature(y,T,y.index,a,u,f,g)}this.sortBorders()}update(n,a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ER),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,TR.members,!0))),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,wR.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,a,u,f,g,y,T){let M=[new G(0,0),new G(Zn,Zn)],C=T.projection,O=C.name==="globe",U=this.enableTerrain&&!O?new UE:null,V=RR[n.type]==="Polygon";O&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ao);let q=Tx(a,500);for(let ke=q.length-1;ke>=0;ke--){let Ge=q[ke];(Ge.length===0||(J=Ge[0]).every(Le=>Le.x<=0)||J.every(Le=>Le.x>=Zn)||J.every(Le=>Le.y<=0)||J.every(Le=>Le.y>=Zn))&&q.splice(ke,1)}var J;let ie;if(O)ie=XE(q,M,f);else{ie=[];for(let ke of q)ie.push({polygon:ke,bounds:M})}let _e=V?this.edgeRadius:0;for(let{polygon:ke,bounds:Ge}of ie){let Le=0,Ve=0;for(let He of ke)V&&!He[0].equals(He[He.length-1])&&He.push(He[0]),Ve+=V?He.length-1:He.length;let We=this.segments.prepareSegment((V?5:4)*Ve,this.layoutVertexArray,this.indexArray);if(V){let He=[],pt=[];Le=We.vertexLength;for(let At of ke){let Kt,vt;At.length&&At!==ke[0]&&pt.push(He.length/2),Kt=At[1].sub(At[0])._perp()._unit();for(let Mt=1;Mt<At.length;Mt++){let kt=At[Mt],Vt=At[Mt===At.length-1?1:Mt+1],{x:Yt,y:wt}=kt;if(_e){vt=Vt.sub(kt)._perp()._unit();let dn=Kt.add(vt)._unit(),Hn=_e*Math.min(4,1/(Kt.x*dn.x+Kt.y*dn.y));Yt+=Hn*dn.x,wt+=Hn*dn.y,Kt=vt}sm(this.layoutVertexArray,Yt,wt,0,0,1,1,0),We.vertexLength++,He.push(kt.x,kt.y),O&&om(this.layoutVertexExtArray,C.projectTilePoint(Yt,wt,f),C.upVector(f,Yt,wt))}}let ht=Od(He,pt);for(let At=0;At<ht.length;At+=3)this.indexArray.emplaceBack(Le+ht[At],Le+ht[At+2],Le+ht[At+1]),We.primitiveLength++}for(let He of ke){U&&He.length&&U.startRing(He[0]);let pt,ht,At,Kt=He.length>4&&jE(He[He.length-2],He[0],He[1]),vt=_e?kR(He[He.length-2],He[0],He[1],_e):0;ht=He[1].sub(He[0])._perp()._unit();let Mt=!0;for(let kt=1,Vt=0;kt<He.length;kt++){let Yt=He[kt-1],wt=He[kt],dn=He[kt===He.length-1?1:kt+1];if(U&&V&&U.currentPolyCount.top++,HE(wt,Yt,Ge)){_e&&(ht=dn.sub(wt)._perp()._unit(),Mt=!Mt);continue}U&&U.append(wt,Yt);let Hn=wt.sub(Yt)._perp(),_n=Hn.x/(Math.abs(Hn.x)+Math.abs(Hn.y)),Ln=Hn.y>0?1:0,fn=Yt.dist(wt);if(Vt+fn>32768&&(Vt=0),_e){At=dn.sub(wt)._perp()._unit();let hi=GE(Yt,wt,dn,VE(ht,At),_e);isNaN(hi)&&(hi=0);let Xn=wt.sub(Yt)._unit();Yt=Yt.add(Xn.mult(vt))._round(),wt=wt.add(Xn.mult(-hi))._round(),vt=hi,ht=At}let qn=We.vertexLength,xi=He.length>4&&jE(Yt,wt,dn),pi=WE(Vt,Kt,Mt);if(sm(this.layoutVertexArray,Yt.x,Yt.y,_n,Ln,0,0,pi),sm(this.layoutVertexArray,Yt.x,Yt.y,_n,Ln,0,1,pi),Vt+=fn,pi=WE(Vt,xi,!Mt),Kt=xi,sm(this.layoutVertexArray,wt.x,wt.y,_n,Ln,0,0,pi),sm(this.layoutVertexArray,wt.x,wt.y,_n,Ln,0,1,pi),We.vertexLength+=4,this.indexArray.emplaceBack(qn+0,qn+1,qn+2),this.indexArray.emplaceBack(qn+1,qn+3,qn+2),We.primitiveLength+=2,_e){let hi=Le+(kt===1?He.length-2:kt-2),Xn=kt===1?Le:hi+1;if(this.indexArray.emplaceBack(qn+1,hi,qn+3),this.indexArray.emplaceBack(hi,Xn,qn+3),We.primitiveLength+=2,pt===void 0&&(pt=qn),!HE(dn,He[kt],Ge)){let Gi=kt===He.length-1?pt:We.vertexLength;this.indexArray.emplaceBack(qn+2,qn+3,Gi),this.indexArray.emplaceBack(qn+3,Gi+1,Gi),this.indexArray.emplaceBack(qn+3,Xn,Gi+1),We.primitiveLength+=3}Mt=!Mt}if(O){let hi=this.layoutVertexExtArray,Xn=C.projectTilePoint(Yt.x,Yt.y,f),Gi=C.projectTilePoint(wt.x,wt.y,f),ti=C.upVector(f,Yt.x,Yt.y),bi=C.upVector(f,wt.x,wt.y);om(hi,Xn,ti),om(hi,Xn,ti),om(hi,Gi,bi),om(hi,Gi,bi)}}V&&(Le+=He.length-1)}}if(U&&U.polyCount.length>0){if(U.borders){U.vertexArrayOffset=this.centroidVertexArray.length;let ke=U.borders,Ge=this.featuresOnBorder.push(U)-1;for(let Le=0;Le<4;Le++)ke[Le][0]!==Number.MAX_VALUE&&this.borders[Le].push(Ge)}this.encodeCentroid(U.borders?void 0:U.centroid(),U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,g,y,f)}sortBorders(){for(let n=0;n<4;n++)this.borders[n].sort((a,u)=>this.featuresOnBorder[a].borders[n][0]-this.featuresOnBorder[u].borders[n][0])}encodeCentroid(n,a,u=!0){let f,g;if(n)if(n.y!==0){let T=a.span()._mult(this.tileToMeter);f=(Math.max(n.x,1)<<3)+Math.min(7,Math.round(T.x/10)),g=(Math.max(n.y,1)<<3)+Math.min(7,Math.round(T.y/10))}else f=Math.ceil(7*(n.x+450)),g=0;else f=0,g=+u;let y=u?this.centroidVertexArray.length:a.vertexArrayOffset;for(let T of a.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*T.edges+T.top);for(let M=0;M<T.top;M++)this.centroidVertexArray.emplace(y++,f,g);for(let M=0;M<2*T.edges;M++)this.centroidVertexArray.emplace(y++,0,g),this.centroidVertexArray.emplace(y++,f,g)}}}function VE(o,n){let a=o.add(n)._unit();return o.x*a.x+o.y*a.y}function kR(o,n,a,u){let f=n.sub(o)._perp()._unit(),g=a.sub(n)._perp()._unit();return GE(o,n,a,VE(f,g),u)}function GE(o,n,a,u,f){let g=Math.sqrt(1-u*u);return Math.min(o.dist(n)/3,n.dist(a)/3,f*g/u)}function HE(o,n,a){return o.x<a[0].x&&n.x<a[0].x||o.x>a[1].x&&n.x>a[1].x||o.y<a[0].y&&n.y<a[0].y||o.y>a[1].y&&n.y>a[1].y}function jE(o,n,a){if(o.x<0||o.x>=Zn||n.x<0||n.x>=Zn||a.x<0||a.x>=Zn)return!1;let u=a.sub(n),f=u.perp(),g=o.sub(n);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&f.x*g.x+f.y*g.y<0}function WE(o,n,a){let u=n?2|o:-3&o;return a?1|u:-2&u}function qE(){let o=Math.PI/32,n=Math.tan(o),a=em;return a*Math.sqrt(1+2*n*n)-a}function XE(o,n,a){let u=1<<a.z,f=Io(a.x/u),g=Io((a.x+1)/u),y=gs(a.y/u),T=gs((a.y+1)/u);return function(M,C,O,U,V=0,q){let J=[];if(!M.length||!O||!U)return J;let ie=(He,pt)=>{for(let ht of He)J.push({polygon:ht,bounds:pt})},_e=Math.ceil(Math.log2(O)),ke=Math.ceil(Math.log2(U)),Ge=_e-ke,Le=[];for(let He=0;He<Math.abs(Ge);He++)Le.push(Ge>0?0:1);for(let He=0;He<Math.min(_e,ke);He++)Le.push(0),Le.push(1);let Ve=M;if(Ve=cy(Ve,C[0].y-V,C[1].y+V,1),Ve=cy(Ve,C[0].x-V,C[1].x+V,0),!Ve.length)return J;let We=[];for(Le.length?We.push({polygons:Ve,bounds:C,depth:0}):ie(Ve,C);We.length;){let He=We.pop(),pt=He.depth,ht=Le[pt],At=He.bounds[0],Kt=He.bounds[1],vt=ht===0?At.x:At.y,Mt=ht===0?Kt.x:Kt.y,kt=q?q(ht,vt,Mt):.5*(vt+Mt),Vt=cy(He.polygons,vt-V,kt+V,ht),Yt=cy(He.polygons,kt-V,Mt+V,ht);if(Vt.length){let wt=[At,new G(ht===0?kt:Kt.x,ht===1?kt:Kt.y)];Le.length>pt+1?We.push({polygons:Vt,bounds:wt,depth:pt+1}):ie(Vt,wt)}if(Yt.length){let wt=[new G(ht===0?kt:At.x,ht===1?kt:At.y),Kt];Le.length>pt+1?We.push({polygons:Yt,bounds:wt,depth:pt+1}):ie(Yt,wt)}}return J}(o,n,Math.ceil((g-f)/11.25),Math.ceil((y-T)/11.25),1,(M,C,O)=>{if(M===0)return .5*(C+O);{let U=gs((a.y+C/Zn)/u);return(Ha(.5*(gs((a.y+O/Zn)/u)+U))*u-a.y)*Zn}})}Sn(am,"FillExtrusionBucket",{omit:["layers","features"]}),Sn(UE,"PartMetadata");let zR=new jt({"fill-extrusion-edge-radius":new tt(Tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var OR={paint:new jt({"fill-extrusion-opacity":new tt(Tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yt(Tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tt(Tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tt(Tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yt(Tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yt(Tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yt(Tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tt(Tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new tt(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new tt(Tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:zR};function ZE(o,n,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[o*u-2*Math.PI*6378137/2,n*u-2*Math.PI*6378137/2]}class uy{constructor(n,a,u){this.z=n,this.x=a,this.y=u,this.key=lm(0,n,n,a,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,a){let u=function(g,y,T){var M=ZE(256*g,256*(y=Math.pow(2,T)-y-1),T),C=ZE(256*(g+1),256*(y+1),T);return M[0]+","+M[1]+","+C[0]+","+C[1]}(this.x,this.y,this.z),f=function(g,y,T){let M,C="";for(let O=g;O>0;O--)M=1<<O-1,C+=(y&M?1:0)+(T&M?2:0);return C}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class KE{constructor(n,a){this.wrap=n,this.canonical=a,this.key=lm(n,a.z,a.z,a.x,a.y)}}class Us{constructor(n,a,u,f,g){this.overscaledZ=n,this.wrap=a,this.canonical=new uy(u,+f,+g),this.key=a===0&&n===u?this.canonical.key:lm(a,n,u,f,g)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){let a=this.canonical.z-n;return n>this.canonical.z?new Us(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Us(n,this.wrap,n,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(n,a=!0){if(this.overscaledZ===n&&a)return this.key;if(n>this.canonical.z)return lm(this.wrap*+a,n,this.canonical.z,this.canonical.x,this.canonical.y);{let u=this.canonical.z-n;return lm(this.wrap*+a,n,n,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;let a=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>a&&n.canonical.y===this.canonical.y>>a}children(n){if(this.overscaledZ>=n)return[new Us(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let a=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new Us(a,this.wrap,a,u,f),new Us(a,this.wrap,a,u+1,f),new Us(a,this.wrap,a,u,f+1),new Us(a,this.wrap,a,u+1,f+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Us(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Us(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new KE(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function lm(o,n,a,u,f){let g=1<<Math.min(a,22),y=g*(f%g)+u%g;return o&&a<22&&(y+=g*g*((o<0?-2*o-1:2*o)%(1<<2*(22-a)))),16*(32*y+a)+(n-a)}Sn(uy,"CanonicalTileID"),Sn(Us,"OverscaledTileID",{omit:["projMatrix"]});class Bd extends G{constructor(n,a,u){super(n,a),this.z=u}}function cm(o,n){return o.x*n.x+o.y*n.y}function YE(o,n){if(o.length===1){let a=0,u=n[a++],f;for(;!f||u.equals(f);)if(f=n[a++],!f)return 1/0;for(;a<n.length;a++){let g=n[a],y=o[0],T=f.sub(u),M=g.sub(u),C=y.sub(u),O=cm(T,T),U=cm(T,M),V=cm(M,M),q=cm(C,T),J=cm(C,M),ie=O*V-U*U,_e=(V*q-U*J)/ie,ke=(O*J-U*q)/ie,Ge=u.z*(1-_e-ke)+f.z*_e+g.z*ke;if(isFinite(Ge))return Ge}return 1/0}{let a=1/0;for(let u of n)a=Math.min(a,u.z);return a}}function JE(o,n,a,u,f,g,y,T){let M=y*f.getElevationAt(o,n,!0,!0),C=g[0]!==0,O=C?g[1]===0?y*(g[0]/7-450):y*function(U,V,q){let J=Math.floor(V[0]/8),ie=Math.floor(V[1]/8),_e=10*(V[0]-8*J),ke=10*(V[1]-8*ie),Ge=U.getElevationAt(J,ie,!0,!0),Le=U.getMeterToDEM(q),Ve=Math.floor(.5*(_e*Le-1)),We=Math.floor(.5*(ke*Le-1)),He=U.tileCoordToPixel(J,ie),pt=2*Ve+1,ht=2*We+1,At=function(Yt,wt,dn,Hn,_n){return[Yt.getElevationAtPixel(wt,dn,!0),Yt.getElevationAtPixel(wt+_n,dn,!0),Yt.getElevationAtPixel(wt,dn+_n,!0),Yt.getElevationAtPixel(wt+Hn,dn+_n,!0)]}(U,He.x-Ve,He.y-We,pt,ht),Kt=Math.abs(At[0]-At[1]),vt=Math.abs(At[2]-At[3]),Mt=Math.abs(At[0]-At[2])+Math.abs(At[1]-At[3]),kt=Math.min(.25,.5*Le*(Kt+vt)/pt),Vt=Math.min(.25,.5*Le*Mt/ht);return Ge+Math.max(kt*_e,Vt*ke)}(f,g,T):M;return{base:M+(a===0)?-1:a,top:C?Math.max(O+u,M+a+2):M+u}}let NR=Fn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:FR}=NR,BR=Fn([{name:"a_packed",components:4,type:"Float32"}]),{members:UR}=BR,VR=ly.types,GR=Math.cos(Math.PI/180*37.5);class hy{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new tr,this.layoutVertexArray2=new Yi,this.indexArray=new ms,this.programConfigurations=new ju(n.layers,n.zoom),this.segments=new kr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,u,f){this.hasPattern=Ex("line",this.layers,a);let g=this.layers[0].layout.get("line-sort-key"),y=[];for(let{feature:O,id:U,index:V,sourceLayerIndex:q}of n){let J=this.layers[0]._featureFilter.needGeometry,ie=Yu(O,J);if(!this.layers[0]._featureFilter.filter(new it(this.zoom),ie,u))continue;let _e=g?g.evaluate(ie,{},u):void 0,ke={id:U,properties:O.properties,type:O.type,sourceLayerIndex:q,index:V,geometry:J?ie.geometry:El(O,u,f),patterns:{},sortKey:_e};y.push(ke)}g&&y.sort((O,U)=>O.sortKey-U.sortKey);let{lineAtlas:T,featureIndex:M}=a,C=this.addConstantDashes(T);for(let O of y){let{geometry:U,index:V,sourceLayerIndex:q}=O;if(C&&this.addFeatureDashes(O,T),this.hasPattern){let J=Sx("line",this.layers,O,this.zoom,a);this.patternFeatures.push(J)}else this.addFeature(O,U,V,u,T.positions,a.availableImages);M.insert(n[V].feature,U,V,q,this.index)}}addConstantDashes(n){let a=!1;for(let u of this.layers){let f=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(f.kind!=="constant"||g.kind!=="constant")a=!0;else{let y=g.value,T=f.value;if(!T)continue;n.addDash(T,y)}}return a}addFeatureDashes(n,a){let u=this.zoom;for(let f of this.layers){let g=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if(g.kind==="constant"&&y.kind==="constant")continue;let T,M;if(g.kind==="constant"){if(T=g.value,!T)continue}else T=g.evaluate({zoom:u},n);M=y.kind==="constant"?y.value:y.evaluate({zoom:u},n),a.addDash(T,M),n.patterns[f.id]=a.getKey(T,M)}}update(n,a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,u,f)}addFeatures(n,a,u,f,g){for(let y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,UR)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,FR),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,a,u,f,g,y){let T=this.layers[0].layout,M=T.get("line-join").evaluate(n,{}),C=T.get("line-cap").evaluate(n,{}),O=T.get("line-miter-limit"),U=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(let V of a)this.addLine(V,n,M,C,O,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,g,y,f)}addLine(n,a,u,f,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ke=0;ke<n.length-1;ke++)this.totalDistance+=n[ke].dist(n[ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let T=VR[a.type]==="Polygon",M=n.length;for(;M>=2&&n[M-1].equals(n[M-2]);)M--;let C=0;for(;C<M-1&&n[C].equals(n[C+1]);)C++;if(M<(T?3:2))return;u==="bevel"&&(g=1.05);let O=this.overscaling<=16?122880/(512*this.overscaling):0,U=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray),V,q,J,ie,_e;this.e1=this.e2=-1,T&&(V=n[M-2],_e=n[C].sub(V)._unit()._perp());for(let ke=C;ke<M;ke++){if(J=ke===M-1?T?n[C+1]:void 0:n[ke+1],J&&n[ke].equals(J))continue;_e&&(ie=_e),V&&(q=V),V=n[ke],_e=J?J.sub(V)._unit()._perp():ie,ie=ie||_e;let Ge=ie.add(_e);Ge.x===0&&Ge.y===0||Ge._unit();let Le=ie.x*_e.x+ie.y*_e.y,Ve=Ge.x*_e.x+Ge.y*_e.y,We=Ve!==0?1/Ve:1/0,He=2*Math.sqrt(2-2*Ve),pt=Ve<GR&&q&&J,ht=ie.x*_e.y-ie.y*_e.x>0;if(pt&&ke>C){let vt=V.dist(q);if(vt>2*O){let Mt=V.sub(V.sub(q)._mult(O/vt)._round());this.updateDistance(q,Mt),this.addCurrentVertex(Mt,ie,0,0,U),q=Mt}}let At=q&&J,Kt=At?u:T?"butt":f;if(At&&Kt==="round"&&(We<y?Kt="miter":We<=2&&(Kt="fakeround")),Kt==="miter"&&We>g&&(Kt="bevel"),Kt==="bevel"&&(We>2&&(Kt="flipbevel"),We<g&&(Kt="miter")),q&&this.updateDistance(q,V),Kt==="miter")Ge._mult(We),this.addCurrentVertex(V,Ge,0,0,U);else if(Kt==="flipbevel"){if(We>100)Ge=_e.mult(-1);else{let vt=We*ie.add(_e).mag()/ie.sub(_e).mag();Ge._perp()._mult(vt*(ht?-1:1))}this.addCurrentVertex(V,Ge,0,0,U),this.addCurrentVertex(V,Ge.mult(-1),0,0,U)}else if(Kt==="bevel"||Kt==="fakeround"){let vt=-Math.sqrt(We*We-1),Mt=ht?vt:0,kt=ht?0:vt;if(q&&this.addCurrentVertex(V,ie,Mt,kt,U),Kt==="fakeround"){let Vt=Math.round(180*He/Math.PI/20);for(let Yt=1;Yt<Vt;Yt++){let wt=Yt/Vt;if(wt!==.5){let Hn=wt-.5;wt+=wt*Hn*(wt-1)*((1.0904+Le*(Le*(3.55645-1.43519*Le)-3.2452))*Hn*Hn+(.848013+Le*(.215638*Le-1.06021)))}let dn=_e.sub(ie)._mult(wt)._add(ie)._unit()._mult(ht?-1:1);this.addHalfVertex(V,dn.x,dn.y,!1,ht,0,U)}}J&&this.addCurrentVertex(V,_e,-Mt,-kt,U)}else if(Kt==="butt")this.addCurrentVertex(V,Ge,0,0,U);else if(Kt==="square"){let vt=q?1:-1;q||this.addCurrentVertex(V,Ge,vt,vt,U),this.addCurrentVertex(V,Ge,0,0,U),q&&this.addCurrentVertex(V,Ge,vt,vt,U)}else Kt==="round"&&(q&&(this.addCurrentVertex(V,ie,0,0,U),this.addCurrentVertex(V,ie,1,1,U,!0)),J&&(this.addCurrentVertex(V,_e,-1,-1,U,!0),this.addCurrentVertex(V,_e,0,0,U)));if(pt&&ke<M-1){let vt=V.dist(J);if(vt>2*O){let Mt=V.add(J.sub(V)._mult(O/vt)._round());this.updateDistance(V,Mt),this.addCurrentVertex(Mt,_e,0,0,U),V=Mt}}}}addCurrentVertex(n,a,u,f,g,y=!1){let T=a.y*f-a.x,M=-a.y-a.x*f;this.addHalfVertex(n,a.x+a.y*u,a.y-a.x*u,y,!1,u,g),this.addHalfVertex(n,T,M,y,!0,-f,g)}addHalfVertex({x:n,y:a},u,f,g,y,T,M){this.layoutVertexArray.emplaceBack((n<<1)+(g?1:0),(a<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let C=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),M.primitiveLength++),y?this.e2=C:this.e1=C}updateScaledDistance(){if(this.lineClips){let n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,a){this.distance+=n.dist(a),this.updateScaledDistance()}}Sn(hy,"LineBucket",{omit:["layers","patternFeatures"]});let HR=new jt({"line-cap":new yt(Tt.layout_line["line-cap"]),"line-join":new yt(Tt.layout_line["line-join"]),"line-miter-limit":new tt(Tt.layout_line["line-miter-limit"]),"line-round-limit":new tt(Tt.layout_line["line-round-limit"]),"line-sort-key":new yt(Tt.layout_line["line-sort-key"])});var $E={paint:new jt({"line-opacity":new yt(Tt.paint_line["line-opacity"]),"line-color":new yt(Tt.paint_line["line-color"]),"line-translate":new tt(Tt.paint_line["line-translate"]),"line-translate-anchor":new tt(Tt.paint_line["line-translate-anchor"]),"line-width":new yt(Tt.paint_line["line-width"]),"line-gap-width":new yt(Tt.paint_line["line-gap-width"]),"line-offset":new yt(Tt.paint_line["line-offset"]),"line-blur":new yt(Tt.paint_line["line-blur"]),"line-dasharray":new yt(Tt.paint_line["line-dasharray"]),"line-pattern":new yt(Tt.paint_line["line-pattern"]),"line-gradient":new Nt(Tt.paint_line["line-gradient"]),"line-trim-offset":new tt(Tt.paint_line["line-trim-offset"])}),layout:HR};let QE=new class extends yt{possiblyEvaluate(o,n){return n=new it(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition}),super.possiblyEvaluate(o,n)}evaluate(o,n,a,u){return n=De({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(o,n,a,u)}}($E.paint.properties["line-width"].specification);function eS(o,n){return n>0?n+2*o:o}QE.useIntegerZoom=!0;let jR=Fn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),WR=Fn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),qR=Fn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Fn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let XR=Fn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ZR=Fn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Fn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let tS=Fn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),KR=Fn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Fn([{name:"triangle",components:3,type:"Uint16"}]),Fn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Fn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Fn([{type:"Float32",name:"offsetX"}]),Fn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ys=24;let ja=128;function Mx(o,n){let{expression:a}=n;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new it(o+1))};if(a.kind==="source")return{kind:"source"};{let{zoomStops:u,interpolationType:f}=a,g=0;for(;g<u.length&&u[g]<=o;)g++;g=Math.max(0,g-1);let y=g;for(;y<u.length&&u[y]<o+1;)y++;y=Math.min(u.length-1,y);let T=u[g],M=u[y];return a.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:M,interpolationType:f}:{kind:"camera",minZoom:T,maxZoom:M,minSize:a.evaluate(new it(T)),maxSize:a.evaluate(new it(M)),interpolationType:f}}}function dy(o,{uSize:n,uSizeT:a},{lowerSize:u,upperSize:f}){return o.kind==="source"?u/ja:o.kind==="composite"?Li(u/ja,f/ja,a):n}function Ud(o,n){let a=0,u=0;if(o.kind==="constant")u=o.layoutSize;else if(o.kind!=="source"){let{interpolationType:f,minZoom:g,maxZoom:y}=o,T=f?re(No.interpolationFactor(f,n,g,y),0,1):0;o.kind==="camera"?u=Li(o.minSize,o.maxSize,T):a=T}return{uSizeT:a,uSize:u}}var YR=Object.freeze({__proto__:null,getSizeData:Mx,evaluateSizeForFeature:dy,evaluateSizeForZoom:Ud,SIZE_PACK_FACTOR:ja});function JR(o,n,a){return o.sections.forEach(u=>{u.text=function(f,g,y){let T=g.layout.get("text-transform").evaluate(y,{});return T==="uppercase"?f=f.toLocaleUpperCase():T==="lowercase"&&(f=f.toLocaleLowerCase()),$e.applyArabicShaping&&(f=$e.applyArabicShaping(f)),f}(u.text,n,a)}),o}let um={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function $R(o){return o==="︶"||o==="﹈"||o==="︸"||o==="﹄"||o==="﹂"||o==="︾"||o==="︼"||o==="︺"||o==="︘"||o==="﹀"||o==="︐"||o==="︓"||o==="︔"||o==="｀"||o==="￣"||o==="︑"||o==="︒"}function QR(o){return o==="︵"||o==="﹇"||o==="︷"||o==="﹃"||o==="﹁"||o==="︽"||o==="︻"||o==="︹"||o==="︗"||o==="︿"}var hm=nr,nS=function(o,n,a,u,f){var g,y,T=8*f-u-1,M=(1<<T)-1,C=M>>1,O=-7,U=a?f-1:0,V=a?-1:1,q=o[n+U];for(U+=V,g=q&(1<<-O)-1,q>>=-O,O+=T;O>0;g=256*g+o[n+U],U+=V,O-=8);for(y=g&(1<<-O)-1,g>>=-O,O+=u;O>0;y=256*y+o[n+U],U+=V,O-=8);if(g===0)g=1-C;else{if(g===M)return y?NaN:1/0*(q?-1:1);y+=Math.pow(2,u),g-=C}return(q?-1:1)*y*Math.pow(2,g-u)},iS=function(o,n,a,u,f,g){var y,T,M,C=8*g-f-1,O=(1<<C)-1,U=O>>1,V=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=u?0:g-1,J=u?1:-1,ie=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(T=isNaN(n)?1:0,y=O):(y=Math.floor(Math.log(n)/Math.LN2),n*(M=Math.pow(2,-y))<1&&(y--,M*=2),(n+=y+U>=1?V/M:V*Math.pow(2,1-U))*M>=2&&(y++,M/=2),y+U>=O?(T=0,y=O):y+U>=1?(T=(n*M-1)*Math.pow(2,f),y+=U):(T=n*Math.pow(2,U-1)*Math.pow(2,f),y=0));f>=8;o[a+q]=255&T,q+=J,T/=256,f-=8);for(y=y<<f|T,C+=f;C>0;o[a+q]=255&y,q+=J,y/=256,C-=8);o[a+q-J]|=128*ie};function nr(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}nr.Varint=0,nr.Fixed64=1,nr.Bytes=2,nr.Fixed32=5;var Ix=4294967296,rS=1/Ix,sS=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Al(o){return o.type===nr.Bytes?o.readVarint()+o.pos:o.pos+1}function Vd(o,n,a){return a?4294967296*n+(o>>>0):4294967296*(n>>>0)+(o>>>0)}function oS(o,n,a){var u=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));a.realloc(u);for(var f=a.pos-1;f>=o;f--)a.buf[f+u]=a.buf[f]}function eP(o,n){for(var a=0;a<o.length;a++)n.writeVarint(o[a])}function tP(o,n){for(var a=0;a<o.length;a++)n.writeSVarint(o[a])}function nP(o,n){for(var a=0;a<o.length;a++)n.writeFloat(o[a])}function iP(o,n){for(var a=0;a<o.length;a++)n.writeDouble(o[a])}function rP(o,n){for(var a=0;a<o.length;a++)n.writeBoolean(o[a])}function sP(o,n){for(var a=0;a<o.length;a++)n.writeFixed32(o[a])}function oP(o,n){for(var a=0;a<o.length;a++)n.writeSFixed32(o[a])}function aP(o,n){for(var a=0;a<o.length;a++)n.writeFixed64(o[a])}function lP(o,n){for(var a=0;a<o.length;a++)n.writeSFixed64(o[a])}function fy(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+16777216*o[n+3]}function Gd(o,n,a){o[a]=n,o[a+1]=n>>>8,o[a+2]=n>>>16,o[a+3]=n>>>24}function aS(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+(o[n+3]<<24)}function cP(o,n,a){n.glyphs=[],o===1&&a.readMessage(uP,n)}function uP(o,n,a){if(o===3){let{id:u,bitmap:f,width:g,height:y,left:T,top:M,advance:C}=a.readMessage(hP,{});n.glyphs.push({id:u,bitmap:new Sl({width:g+6,height:y+6},f),metrics:{width:g,height:y,left:T,top:M,advance:C}})}else o===4?n.ascender=a.readSVarint():o===5&&(n.descender=a.readSVarint())}function hP(o,n,a){o===1?n.id=a.readVarint():o===2?n.bitmap=a.readBytes():o===3?n.width=a.readVarint():o===4?n.height=a.readVarint():o===5?n.left=a.readSVarint():o===6?n.top=a.readSVarint():o===7&&(n.advance=a.readVarint())}function Cx(o){let n=0,a=0;for(let y of o)n+=y.w*y.h,a=Math.max(a,y.w);o.sort((y,T)=>T.h-y.h);let u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}],f=0,g=0;for(let y of o)for(let T=u.length-1;T>=0;T--){let M=u[T];if(!(y.w>M.w||y.h>M.h)){if(y.x=M.x,y.y=M.y,g=Math.max(g,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===M.w&&y.h===M.h){let C=u.pop();T<u.length&&(u[T]=C)}else y.h===M.h?(M.x+=y.w,M.w-=y.w):y.w===M.w?(M.y+=y.h,M.h-=y.h):(u.push({x:M.x+y.w,y:M.y,w:M.w-y.w,h:y.h}),M.y+=y.h,M.h-=y.h);break}}return{w:f,h:g,fill:n/(f*g)||0}}nr.prototype={destroy:function(){this.buf=null},readFields:function(o,n,a){for(a=a||this.length;this.pos<a;){var u=this.readVarint(),f=u>>3,g=this.pos;this.type=7&u,o(f,n,this),this.pos===g&&this.skip(u)}return n},readMessage:function(o,n){return this.readFields(o,n,this.readVarint()+this.pos)},readFixed32:function(){var o=fy(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=aS(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=fy(this.buf,this.pos)+fy(this.buf,this.pos+4)*Ix;return this.pos+=8,o},readSFixed64:function(){var o=fy(this.buf,this.pos)+aS(this.buf,this.pos+4)*Ix;return this.pos+=8,o},readFloat:function(){var o=nS(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=nS(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var n,a,u=this.buf;return n=127&(a=u[this.pos++]),a<128?n:(n|=(127&(a=u[this.pos++]))<<7,a<128?n:(n|=(127&(a=u[this.pos++]))<<14,a<128?n:(n|=(127&(a=u[this.pos++]))<<21,a<128?n:function(f,g,y){var T,M,C=y.buf;if(T=(112&(M=C[y.pos++]))>>4,M<128||(T|=(127&(M=C[y.pos++]))<<3,M<128)||(T|=(127&(M=C[y.pos++]))<<10,M<128)||(T|=(127&(M=C[y.pos++]))<<17,M<128)||(T|=(127&(M=C[y.pos++]))<<24,M<128)||(T|=(1&(M=C[y.pos++]))<<31,M<128))return Vd(f,T,g);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(a=u[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,n=this.pos;return this.pos=o,o-n>=12&&sS?function(a,u,f){return sS.decode(a.subarray(u,f))}(this.buf,n,o):function(a,u,f){for(var g="",y=u;y<f;){var T,M,C,O=a[y],U=null,V=O>239?4:O>223?3:O>191?2:1;if(y+V>f)break;V===1?O<128&&(U=O):V===2?(192&(T=a[y+1]))==128&&(U=(31&O)<<6|63&T)<=127&&(U=null):V===3?(M=a[y+2],(192&(T=a[y+1]))==128&&(192&M)==128&&((U=(15&O)<<12|(63&T)<<6|63&M)<=2047||U>=55296&&U<=57343)&&(U=null)):V===4&&(M=a[y+2],C=a[y+3],(192&(T=a[y+1]))==128&&(192&M)==128&&(192&C)==128&&((U=(15&O)<<18|(63&T)<<12|(63&M)<<6|63&C)<=65535||U>=1114112)&&(U=null)),U===null?(U=65533,V=1):U>65535&&(U-=65536,g+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),g+=String.fromCharCode(U),y+=V}return g}(this.buf,n,o)},readBytes:function(){var o=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,o);return this.pos=o,n},readPackedVarint:function(o,n){if(this.type!==nr.Bytes)return o.push(this.readVarint(n));var a=Al(this);for(o=o||[];this.pos<a;)o.push(this.readVarint(n));return o},readPackedSVarint:function(o){if(this.type!==nr.Bytes)return o.push(this.readSVarint());var n=Al(this);for(o=o||[];this.pos<n;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==nr.Bytes)return o.push(this.readBoolean());var n=Al(this);for(o=o||[];this.pos<n;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==nr.Bytes)return o.push(this.readFloat());var n=Al(this);for(o=o||[];this.pos<n;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==nr.Bytes)return o.push(this.readDouble());var n=Al(this);for(o=o||[];this.pos<n;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==nr.Bytes)return o.push(this.readFixed32());var n=Al(this);for(o=o||[];this.pos<n;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==nr.Bytes)return o.push(this.readSFixed32());var n=Al(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==nr.Bytes)return o.push(this.readFixed64());var n=Al(this);for(o=o||[];this.pos<n;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==nr.Bytes)return o.push(this.readSFixed64());var n=Al(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed64());return o},skip:function(o){var n=7&o;if(n===nr.Varint)for(;this.buf[this.pos++]>127;);else if(n===nr.Bytes)this.pos=this.readVarint()+this.pos;else if(n===nr.Fixed32)this.pos+=4;else{if(n!==nr.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(o,n){this.writeVarint(o<<3|n)},realloc:function(o){for(var n=this.length||16;n<this.pos+o;)n*=2;if(n!==this.length){var a=new Uint8Array(n);a.set(this.buf),this.buf=a,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Gd(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Gd(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Gd(this.buf,-1&o,this.pos),Gd(this.buf,Math.floor(o*rS),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Gd(this.buf,-1&o,this.pos),Gd(this.buf,Math.floor(o*rS),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(n,a){var u,f;if(n>=0?(u=n%4294967296|0,f=n/4294967296|0):(f=~(-n/4294967296),4294967295^(u=~(-n%4294967296))?u=u+1|0:(u=0,f=f+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(g,y,T){T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,T.buf[T.pos]=127&(g>>>=7)}(u,0,a),function(g,y){var T=(7&g)<<4;y.buf[y.pos++]|=T|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(f,a)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var n=this.pos;this.pos=function(u,f,g){for(var y,T,M=0;M<f.length;M++){if((y=f.charCodeAt(M))>55295&&y<57344){if(!T){y>56319||M+1===f.length?(u[g++]=239,u[g++]=191,u[g++]=189):T=y;continue}if(y<56320){u[g++]=239,u[g++]=191,u[g++]=189,T=y;continue}y=T-55296<<10|y-56320|65536,T=null}else T&&(u[g++]=239,u[g++]=191,u[g++]=189,T=null);y<128?u[g++]=y:(y<2048?u[g++]=y>>6|192:(y<65536?u[g++]=y>>12|224:(u[g++]=y>>18|240,u[g++]=y>>12&63|128),u[g++]=y>>6&63|128),u[g++]=63&y|128)}return g}(this.buf,o,this.pos);var a=this.pos-n;a>=128&&oS(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeFloat:function(o){this.realloc(4),iS(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),iS(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var n=o.length;this.writeVarint(n),this.realloc(n);for(var a=0;a<n;a++)this.buf[this.pos++]=o[a]},writeRawMessage:function(o,n){this.pos++;var a=this.pos;o(n,this);var u=this.pos-a;u>=128&&oS(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeMessage:function(o,n,a){this.writeTag(o,nr.Bytes),this.writeRawMessage(n,a)},writePackedVarint:function(o,n){n.length&&this.writeMessage(o,eP,n)},writePackedSVarint:function(o,n){n.length&&this.writeMessage(o,tP,n)},writePackedBoolean:function(o,n){n.length&&this.writeMessage(o,rP,n)},writePackedFloat:function(o,n){n.length&&this.writeMessage(o,nP,n)},writePackedDouble:function(o,n){n.length&&this.writeMessage(o,iP,n)},writePackedFixed32:function(o,n){n.length&&this.writeMessage(o,sP,n)},writePackedSFixed32:function(o,n){n.length&&this.writeMessage(o,oP,n)},writePackedFixed64:function(o,n){n.length&&this.writeMessage(o,aP,n)},writePackedSFixed64:function(o,n){n.length&&this.writeMessage(o,lP,n)},writeBytesField:function(o,n){this.writeTag(o,nr.Bytes),this.writeBytes(n)},writeFixed32Field:function(o,n){this.writeTag(o,nr.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(o,n){this.writeTag(o,nr.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(o,n){this.writeTag(o,nr.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(o,n){this.writeTag(o,nr.Fixed64),this.writeSFixed64(n)},writeVarintField:function(o,n){this.writeTag(o,nr.Varint),this.writeVarint(n)},writeSVarintField:function(o,n){this.writeTag(o,nr.Varint),this.writeSVarint(n)},writeStringField:function(o,n){this.writeTag(o,nr.Bytes),this.writeString(n)},writeFloatField:function(o,n){this.writeTag(o,nr.Fixed32),this.writeFloat(n)},writeDoubleField:function(o,n){this.writeTag(o,nr.Fixed64),this.writeDouble(n)},writeBooleanField:function(o,n){this.writeVarintField(o,Boolean(n))}};class Lx{constructor(n,{pixelRatio:a,version:u,stretchX:f,stretchY:g,content:y}){this.paddedRect=n,this.pixelRatio=a,this.stretchX=f,this.stretchY=g,this.content=y,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class lS{constructor(n,a){let u={},f={};this.haveRenderCallbacks=[];let g=[];this.addImages(n,u,g),this.addImages(a,f,g);let{w:y,h:T}=Cx(g),M=new co({width:y||1,height:T||1});for(let C in n){let O=n[C],U=u[C].paddedRect;co.copy(O.data,M,{x:0,y:0},{x:U.x+1,y:U.y+1},O.data)}for(let C in a){let O=a[C],U=f[C].paddedRect,V=U.x+1,q=U.y+1,J=O.data.width,ie=O.data.height;co.copy(O.data,M,{x:0,y:0},{x:V,y:q},O.data),co.copy(O.data,M,{x:0,y:ie-1},{x:V,y:q-1},{width:J,height:1}),co.copy(O.data,M,{x:0,y:0},{x:V,y:q+ie},{width:J,height:1}),co.copy(O.data,M,{x:J-1,y:0},{x:V-1,y:q},{width:1,height:ie}),co.copy(O.data,M,{x:0,y:0},{x:V+J,y:q},{width:1,height:ie})}this.image=M,this.iconPositions=u,this.patternPositions=f}addImages(n,a,u){for(let f in n){let g=n[f],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};u.push(y),a[f]=new Lx(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>n.hasImage(u)),n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let u in n.updatedImages)this.patchUpdatedImage(this.iconPositions[u],n.getImage(u),a),this.patchUpdatedImage(this.patternPositions[u],n.getImage(u),a)}patchUpdatedImage(n,a,u){if(!n||!a||n.version===a.version)return;n.version=a.version;let[f,g]=n.tl;u.update(a.data,void 0,{x:f,y:g})}}Sn(Lx,"ImagePosition"),Sn(lS,"ImageAtlas");let Co={horizontal:1,vertical:2,horizontalOnly:3};class dm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,a){let u=new dm;return u.scale=n||1,u.fontStack=a,u}static forImage(n){let a=new dm;return a.imageName=n,a}}class Hd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,a){let u=new Hd;for(let f=0;f<n.sections.length;f++){let g=n.sections[f];g.image?u.addImageSection(g):u.addTextSection(g,a)}return u}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(n){this.text=function(a,u){let f="";for(let g=0;g<a.length;g++){let y=a.charCodeAt(g+1)||null,T=a.charCodeAt(g-1)||null;f+=!u&&(y&&F(y)&&!um[a[g+1]]||T&&F(T)&&!um[a[g-1]])||!um[a[g]]?a[g]:um[a[g]]}return f}(this.text,n)}trim(){let n=0;for(let u=0;u<this.text.length&&py[this.text.charCodeAt(u)];u++)n++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=n&&py[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(n,a),this.sectionIndex=this.sectionIndex.slice(n,a)}substring(n,a){let u=new Hd;return u.text=this.text.substring(n,a),u.sectionIndex=this.sectionIndex.slice(n,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,a)=>Math.max(n,this.sections[a].scale),0)}addTextSection(n,a){this.text+=n.text,this.sections.push(dm.forText(n.scale,n.fontStack||a));let u=this.sections.length-1;for(let f=0;f<n.text.length;++f)this.sectionIndex.push(u)}addImageSection(n){let a=n.image?n.image.name:"";if(a.length===0)return void nt("Can't add FormattedSection with an empty image.");let u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(dm.forImage(a)),this.sectionIndex.push(this.sections.length-1)):nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Dx(o,n,a,u,f,g,y,T,M,C,O,U,V,q,J){let ie=Hd.fromFeature(o,f);U===Co.vertical&&ie.verticalizePunctuation(V);let _e=[],ke=function(He,pt,ht,At,Kt,vt){if(!He)return[];let Mt=[],kt=function(dn,Hn,_n,Ln,fn,qn){let xi=0;for(let pi=0;pi<dn.length();pi++){let hi=dn.getSection(pi);xi+=cS(dn.getCharCode(pi),hi,Ln,fn,Hn,qn)}return xi/Math.max(1,Math.ceil(xi/_n))}(He,pt,ht,At,Kt,vt),Vt=He.text.indexOf("​")>=0,Yt=0;for(let dn=0;dn<He.length();dn++){let Hn=He.getSection(dn),_n=He.getCharCode(dn);if(py[_n]||(Yt+=cS(_n,Hn,At,Kt,pt,vt)),dn<He.length()-1){let Ln=!((wt=_n)<11904||!(z_(wt)||Md(wt)||m(wt)||H_(wt)||F_(wt)||k_(wt)||O_(wt)||Vu(wt)||B_(wt)||Gp(wt)||N_(wt)||_(wt)||Ad(wt)||Up(wt)||Bp(wt)||Vp(wt)||yc(wt)||Gu(wt)||V_(wt)||U_(wt)));(dP[_n]||Ln||Hn.imageName)&&Mt.push(hS(dn+1,Yt,kt,Mt,fP(_n,He.getCharCode(dn+1),Ln&&Vt),!1))}}var wt;return dS(hS(He.length(),Yt,kt,Mt,0,!0))}(ie,C,g,n,u,q),{processBidirectionalText:Ge,processStyledBidirectionalText:Le}=$e;if(Ge&&ie.sections.length===1){let He=Ge(ie.toString(),ke);for(let pt of He){let ht=new Hd;ht.text=pt,ht.sections=ie.sections;for(let At=0;At<pt.length;At++)ht.sectionIndex.push(0);_e.push(ht)}}else if(Le){let He=Le(ie.text,ie.sectionIndex,ke);for(let pt of He){let ht=new Hd;ht.text=pt[0],ht.sectionIndex=pt[1],ht.sections=ie.sections,_e.push(ht)}}else _e=function(He,pt){let ht=[],At=He.text,Kt=0;for(let vt of pt)ht.push(He.substring(Kt,vt)),Kt=vt;return Kt<At.length&&ht.push(He.substring(Kt,At.length)),ht}(ie,ke);let Ve=[],We={positionedLines:Ve,text:ie.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:U,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(He,pt,ht,At,Kt,vt,Mt,kt,Vt,Yt,wt,dn){let Hn=0,_n=0,Ln=0,fn=kt==="right"?1:kt==="left"?0:.5,qn=!1;for(let ti of Kt){let bi=ti.getSections();for(let qi of bi){if(qi.imageName)continue;let ar=pt[qi.fontStack];if(ar&&(qn=ar.ascender!==void 0&&ar.descender!==void 0,!qn))break}if(!qn)break}let xi=0;for(let ti of Kt){ti.trim();let bi=ti.getMaxScale(),qi=(bi-1)*ys,ar={positionedGlyphs:[],lineOffset:0};He.positionedLines[xi]=ar;let ir=ar.positionedGlyphs,lr=0;if(!ti.length()){_n+=vt,++xi;continue}let hr=0,Tr=0;for(let Hi=0;Hi<ti.length();Hi++){let Br=ti.getSection(Hi),Or=ti.getSectionIndex(Hi),Pi=ti.getCharCode(Hi),_r=Br.scale,Wr=null,Xi=null,Lr=null,Ms=ys,is=0,rs=!(Vt===Co.horizontal||!wt&&!P(Pi)||wt&&(py[Pi]||(pi=Pi,Uu(pi)||P_(pi)||Fp(pi)||Id(pi)||d(pi))));if(Br.imageName){let Vs=At[Br.imageName];if(!Vs)continue;Lr=Br.imageName,He.iconsInText=He.iconsInText||!0,Xi=Vs.paddedRect;let ss=Vs.displaySize;_r=_r*ys/dn,Wr={width:ss[0],height:ss[1],left:1,top:-3,advance:rs?ss[1]:ss[0],localGlyph:!1},is=qn?-Wr.height*_r:bi*ys-17-ss[1]*_r,Ms=Wr.advance;let Il=(rs?ss[0]:ss[1])*_r-ys*bi;Il>0&&Il>lr&&(lr=Il)}else{let Vs=ht[Br.fontStack];if(!Vs)continue;Vs[Pi]&&(Xi=Vs[Pi]);let ss=pt[Br.fontStack];if(!ss)continue;let Il=ss.glyphs[Pi];if(!Il)continue;if(Wr=Il.metrics,Ms=Pi!==8203?ys:0,qn){let Zd=ss.ascender!==void 0?Math.abs(ss.ascender):0,xm=ss.descender!==void 0?Math.abs(ss.descender):0,bm=(Zd+xm)*_r;hr<bm&&(hr=bm,Tr=(Zd-xm)/2*_r),is=-Zd*_r}else is=(bi-_r)*ys-17}rs?(He.verticalizable=!0,ir.push({glyph:Pi,imageName:Lr,x:Hn,y:_n+is,vertical:rs,scale:_r,localGlyph:Wr.localGlyph,fontStack:Br.fontStack,sectionIndex:Or,metrics:Wr,rect:Xi}),Hn+=Ms*_r+Yt):(ir.push({glyph:Pi,imageName:Lr,x:Hn,y:_n+is,vertical:rs,scale:_r,localGlyph:Wr.localGlyph,fontStack:Br.fontStack,sectionIndex:Or,metrics:Wr,rect:Xi}),Hn+=Wr.advance*_r+Yt)}ir.length!==0&&(Ln=Math.max(Hn-Yt,Ln),qn?fS(ir,fn,lr,Tr,vt*bi/2):fS(ir,fn,lr,0,vt/2)),Hn=0;let ns=vt*bi+lr;ar.lineOffset=Math.max(lr,qi),_n+=ns,++xi}var pi;let hi=_n,{horizontalAlign:Xn,verticalAlign:Gi}=Rx(Mt);(function(ti,bi,qi,ar,ir,lr){let hr=(bi-qi)*ir,Tr=-lr*ar;for(let ns of ti)for(let Hi of ns.positionedGlyphs)Hi.x+=hr,Hi.y+=Tr})(He.positionedLines,fn,Xn,Gi,Ln,hi),He.top+=-Gi*hi,He.bottom=He.top+hi,He.left+=-Xn*Ln,He.right=He.left+Ln,He.hasBaseline=qn}(We,n,a,u,_e,y,T,M,U,C,V,J),!function(He){for(let pt of He)if(pt.positionedGlyphs.length!==0)return!1;return!0}(Ve)&&We}let py={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function cS(o,n,a,u,f,g){if(n.imageName){let y=u[n.imageName];return y?y.displaySize[0]*n.scale*ys/g+f:0}{let y=a[n.fontStack],T=y&&y.glyphs[o];return T?T.metrics.advance*n.scale+f:0}}function uS(o,n,a,u){let f=Math.pow(o-n,2);return u?o<n?f/2:2*f:f+Math.abs(a)*a}function fP(o,n,a){let u=0;return o===10&&(u-=1e4),a&&(u+=150),o!==40&&o!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function hS(o,n,a,u,f,g){let y=null,T=uS(n,a,f,g);for(let M of u){let C=uS(n-M.x,a,f,g)+M.badness;C<=T&&(y=M,T=C)}return{index:o,x:n,priorBreak:y,badness:T}}function dS(o){return o?dS(o.priorBreak).concat(o.index):[]}function Rx(o){let n=.5,a=.5;switch(o){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:n,verticalAlign:a}}function fS(o,n,a,u,f){if(!(n||a||u||f))return;let g=o.length-1,y=o[g],T=(y.x+y.metrics.advance*y.scale)*n;for(let M=0;M<=g;M++)o[M].x-=T,o[M].y+=a+u+f}function pP(o,n,a){let{horizontalAlign:u,verticalAlign:f}=Rx(a),g=n[0]-o.displaySize[0]*u,y=n[1]-o.displaySize[1]*f;return{image:o,top:y,bottom:y+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function pS(o,n,a,u,f,g){let y=o.image,T;if(y.content){let _e=y.content,ke=y.pixelRatio||1;T=[_e[0]/ke,_e[1]/ke,y.displaySize[0]-_e[2]/ke,y.displaySize[1]-_e[3]/ke]}let M=n.left*g,C=n.right*g,O,U,V,q;a==="width"||a==="both"?(q=f[0]+M-u[3],U=f[0]+C+u[1]):(q=f[0]+(M+C-y.displaySize[0])/2,U=q+y.displaySize[0]);let J=n.top*g,ie=n.bottom*g;return a==="height"||a==="both"?(O=f[1]+J-u[0],V=f[1]+ie+u[2]):(O=f[1]+(J+ie-y.displaySize[1])/2,V=O+y.displaySize[1]),{image:y,top:O,right:U,bottom:V,left:q,collisionPadding:T}}class Ml extends G{constructor(n,a,u,f,g){super(n,a),this.angle=f,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new Ml(this.x,this.y,this.z,this.angle,this.segment)}}function mS(o,n,a,u,f){if(n.segment===void 0)return!0;let g=n,y=n.segment+1,T=0;for(;T>-a/2;){if(y--,y<0)return!1;T-=o[y].dist(g),g=o[y]}T+=o[y].dist(o[y+1]),y++;let M=[],C=0;for(;T<a/2;){let O=o[y],U=o[y+1];if(!U)return!1;let V=o[y-1].angleTo(O)-O.angleTo(U);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:T,angleDelta:V}),C+=V;T-M[0].distance>u;)C-=M.shift().angleDelta;if(C>f)return!1;y++,T+=O.dist(U)}return!0}function gS(o){let n=0;for(let a=0;a<o.length-1;a++)n+=o[a].dist(o[a+1]);return n}function _S(o,n,a){return o?.6*n*a:0}function yS(o,n){return Math.max(o?o.right-o.left:0,n?n.right-n.left:0)}function mP(o,n,a,u,f,g){let y=_S(a,f,g),T=yS(a,u)*g,M=0,C=gS(o)/2;for(let O=0;O<o.length-1;O++){let U=o[O],V=o[O+1],q=U.dist(V);if(M+q>C){let J=(C-M)/q,ie=Li(U.x,V.x,J),_e=Li(U.y,V.y,J),ke=new Ml(ie,_e,0,V.angleTo(U),O);return!y||mS(o,ke,T,y,n)?ke:void 0}M+=q}}function gP(o,n,a,u,f,g,y,T,M){let C=_S(u,g,y),O=yS(u,f),U=O*y,V=o[0].x===0||o[0].x===M||o[0].y===0||o[0].y===M;return n-U<n/4&&(n=U+n/4),vS(o,V?n/2*T%n:(O/2+2*g)*y*T%n,n,C,a,U,V,!1,M)}function vS(o,n,a,u,f,g,y,T,M){let C=g/2,O=gS(o),U=0,V=n-a,q=[];for(let J=0;J<o.length-1;J++){let ie=o[J],_e=o[J+1],ke=ie.dist(_e),Ge=_e.angleTo(ie);for(;V+a<U+ke;){V+=a;let Le=(V-U)/ke,Ve=Li(ie.x,_e.x,Le),We=Li(ie.y,_e.y,Le);if(Ve>=0&&Ve<M&&We>=0&&We<M&&V-C>=0&&V+C<=O){let He=new Ml(Ve,We,0,Ge,J);He._round(),u&&!mS(o,He,g,u,f)||q.push(He)}}U+=ke}return T||q.length||y||(q=vS(o,U/2,a,u,f,g,y,!0,M)),q}function xS(o,n,a,u,f){let g=[];for(let y=0;y<o.length;y++){let T=o[y],M;for(let C=0;C<T.length-1;C++){let O=T[C],U=T[C+1];O.x<n&&U.x<n||(O.x<n?O=new G(n,O.y+(n-O.x)/(U.x-O.x)*(U.y-O.y))._round():U.x<n&&(U=new G(n,O.y+(n-O.x)/(U.x-O.x)*(U.y-O.y))._round()),O.y<a&&U.y<a||(O.y<a?O=new G(O.x+(a-O.y)/(U.y-O.y)*(U.x-O.x),a)._round():U.y<a&&(U=new G(O.x+(a-O.y)/(U.y-O.y)*(U.x-O.x),a)._round()),O.x>=u&&U.x>=u||(O.x>=u?O=new G(u,O.y+(u-O.x)/(U.x-O.x)*(U.y-O.y))._round():U.x>=u&&(U=new G(u,O.y+(u-O.x)/(U.x-O.x)*(U.y-O.y))._round()),O.y>=f&&U.y>=f||(O.y>=f?O=new G(O.x+(f-O.y)/(U.y-O.y)*(U.x-O.x),f)._round():U.y>=f&&(U=new G(O.x+(f-O.y)/(U.y-O.y)*(U.x-O.x),f)._round()),M&&O.equals(M[M.length-1])||(M=[O],g.push(M)),M.push(U)))))}}return g}Sn(Ml,"Anchor");let fm=1e20;function bS(o,n,a,u,f,g,y,T,M){for(let C=n;C<n+u;C++)wS(o,a*g+C,g,f,y,T,M);for(let C=a;C<a+f;C++)wS(o,C*g+n,1,u,y,T,M)}function wS(o,n,a,u,f,g,y){g[0]=0,y[0]=-fm,y[1]=fm,f[0]=o[n];for(let T=1,M=0,C=0;T<u;T++){f[T]=o[n+T*a];let O=T*T;do{let U=g[M];C=(f[T]-f[U]+O-U*U)/(T-U)/2}while(C<=y[M]&&--M>-1);M++,g[M]=T,y[M]=C,y[M+1]=fm}for(let T=0,M=0;T<u;T++){for(;y[M+1]<T;)M++;let C=g[M],O=T-C;o[n+T*a]=f[C]+O*O}}let Px={none:0,ideographs:1,all:2};class jd{constructor(n,a,u){this.requestManager=n,this.localGlyphMode=a,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,a){let u=[];for(let f in n)for(let g of n[f])u.push({stack:f,id:g});de(u,({stack:f,id:g},y)=>{let T=this.entries[f];T||(T=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=T.glyphs[g];if(M!==void 0)return void y(null,{stack:f,id:g,glyph:M});if(M=this._tinySDF(T,f,g),M)return T.glyphs[g]=M,void y(null,{stack:f,id:g,glyph:M});let C=Math.floor(g/256);if(256*C>65535)return void y(new Error("glyphs > 65535 not supported"));if(T.ranges[C])return void y(null,{stack:f,id:g,glyph:M});let O=T.requests[C];O||(O=T.requests[C]=[],jd.loadGlyphRange(f,C,this.url,this.requestManager,(U,V)=>{if(V){T.ascender=V.ascender,T.descender=V.descender;for(let q in V.glyphs)this._doesCharSupportLocalGlyph(+q)||(T.glyphs[+q]=V.glyphs[+q]);T.ranges[C]=!0}for(let q of O)q(U,V);delete T.requests[C]})),O.push((U,V)=>{U?y(U):V&&y(null,{stack:f,id:g,glyph:V.glyphs[g]||null})})},(f,g)=>{if(f)a(f);else if(g){let y={};for(let{stack:T,id:M,glyph:C}of g)y[T]===void 0&&(y[T]={}),y[T].glyphs===void 0&&(y[T].glyphs={}),y[T].glyphs[M]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},y[T].ascender=this.entries[T].ascender,y[T].descender=this.entries[T].descender;a(null,y)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==Px.none&&(this.localGlyphMode===Px.all?!!this.localFontFamily:!!this.localFontFamily&&(Gp(n)||G_(n)||Ad(n)||yc(n)||Vu(n)))}_tinySDF(n,a,u){let f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let g=n.tinySDF;if(!g){let ie="400";/bold/i.test(a)?ie="900":/medium/i.test(a)?ie="500":/light/i.test(a)&&(ie="200"),g=n.tinySDF=new jd.TinySDF({fontFamily:f,fontWeight:ie,fontSize:48,buffer:6,radius:16}),g.fontWeight=ie}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];let y=String.fromCharCode(u),{data:T,width:M,height:C,glyphWidth:O,glyphHeight:U,glyphLeft:V,glyphTop:q,glyphAdvance:J}=g.draw(y);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Sl({width:M,height:C},T),metrics:{width:O/2,height:U/2,left:V/2,top:q/2-27,advance:J/2,localGlyph:!0}}}}function TS(o,n,a,u){let f=[],g=o.image,y=g.pixelRatio,T=g.paddedRect.w-2,M=g.paddedRect.h-2,C=o.right-o.left,O=o.bottom-o.top,U=g.stretchX||[[0,T]],V=g.stretchY||[[0,M]],q=(vt,Mt)=>vt+Mt[1]-Mt[0],J=U.reduce(q,0),ie=V.reduce(q,0),_e=T-J,ke=M-ie,Ge=0,Le=J,Ve=0,We=ie,He=0,pt=_e,ht=0,At=ke;if(g.content&&u){let vt=g.content;Ge=my(U,0,vt[0]),Ve=my(V,0,vt[1]),Le=my(U,vt[0],vt[2]),We=my(V,vt[1],vt[3]),He=vt[0]-Ge,ht=vt[1]-Ve,pt=vt[2]-vt[0]-Le,At=vt[3]-vt[1]-We}let Kt=(vt,Mt,kt,Vt)=>{let Yt=gy(vt.stretch-Ge,Le,C,o.left),wt=_y(vt.fixed-He,pt,vt.stretch,J),dn=gy(Mt.stretch-Ve,We,O,o.top),Hn=_y(Mt.fixed-ht,At,Mt.stretch,ie),_n=gy(kt.stretch-Ge,Le,C,o.left),Ln=_y(kt.fixed-He,pt,kt.stretch,J),fn=gy(Vt.stretch-Ve,We,O,o.top),qn=_y(Vt.fixed-ht,At,Vt.stretch,ie),xi=new G(Yt,dn),pi=new G(_n,dn),hi=new G(_n,fn),Xn=new G(Yt,fn),Gi=new G(wt/y,Hn/y),ti=new G(Ln/y,qn/y),bi=n*Math.PI/180;if(bi){let ir=Math.sin(bi),lr=Math.cos(bi),hr=[lr,-ir,ir,lr];xi._matMult(hr),pi._matMult(hr),Xn._matMult(hr),hi._matMult(hr)}let qi=vt.stretch+vt.fixed,ar=Mt.stretch+Mt.fixed;return{tl:xi,tr:pi,bl:Xn,br:hi,tex:{x:g.paddedRect.x+1+qi,y:g.paddedRect.y+1+ar,w:kt.stretch+kt.fixed-qi,h:Vt.stretch+Vt.fixed-ar},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gi,pixelOffsetBR:ti,minFontScaleX:pt/y/C,minFontScaleY:At/y/O,isSDF:a}};if(u&&(g.stretchX||g.stretchY)){let vt=ES(U,_e,J),Mt=ES(V,ke,ie);for(let kt=0;kt<vt.length-1;kt++){let Vt=vt[kt],Yt=vt[kt+1];for(let wt=0;wt<Mt.length-1;wt++)f.push(Kt(Vt,Mt[wt],Yt,Mt[wt+1]))}}else f.push(Kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:M+1}));return f}function my(o,n,a){let u=0;for(let f of o)u+=Math.max(n,Math.min(a,f[1]))-Math.max(n,Math.min(a,f[0]));return u}function ES(o,n,a){let u=[{fixed:-1,stretch:0}];for(let[f,g]of o){let y=u[u.length-1];u.push({fixed:f-y.stretch,stretch:y.stretch}),u.push({fixed:f-y.stretch,stretch:y.stretch+(g-f)})}return u.push({fixed:n+1,stretch:a}),u}function gy(o,n,a,u){return o/n*a+u}function _y(o,n,a,u){return o-n*a/u}function _P(o,n,a,u){let f=n+o.positionedLines[u].lineOffset;return u===0?a+f/2:a+(f+(n+o.positionedLines[u-1].lineOffset))/2}jd.loadGlyphRange=function(o,n,a,u,f){let g=256*n,y=g+255,T=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",o).replace("{range}",`${g}-${y}`),et.Glyphs);sn(T,(M,C)=>{if(M)f(M);else if(C){let O={},U=function(V){return new hm(V).readFields(cP,{})}(C);for(let V of U.glyphs)O[V.id]=V;f(null,{glyphs:O,ascender:U.ascender,descender:U.descender})}})},jd.TinySDF=class{constructor({fontSize:o=24,buffer:n=3,radius:a=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}={}){this.buffer=n,this.cutoff=u,this.radius=a;let T=this.size=o+4*n,M=this._createCanvas(T),C=this.ctx=M.getContext("2d",{willReadFrequently:!0});C.font=`${y} ${g} ${o}px ${f}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(o){let n=document.createElement("canvas");return n.width=n.height=o,n}draw(o){let{width:n,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(o),y=Math.ceil(a),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-f))),M=Math.min(this.size-this.buffer,y+Math.ceil(u)),C=T+2*this.buffer,O=M+2*this.buffer,U=Math.max(C*O,0),V=new Uint8ClampedArray(U),q={data:V,width:C,height:O,glyphWidth:T,glyphHeight:M,glyphTop:y,glyphLeft:0,glyphAdvance:n};if(T===0||M===0)return q;let{ctx:J,buffer:ie,gridInner:_e,gridOuter:ke}=this;J.clearRect(ie,ie,T,M),J.fillText(o,ie,ie+y);let Ge=J.getImageData(ie,ie,T,M);ke.fill(fm,0,U),_e.fill(0,0,U);for(let Le=0;Le<M;Le++)for(let Ve=0;Ve<T;Ve++){let We=Ge.data[4*(Le*T+Ve)+3]/255;if(We===0)continue;let He=(Le+ie)*C+Ve+ie;if(We===1)ke[He]=0,_e[He]=fm;else{let pt=.5-We;ke[He]=pt>0?pt*pt:0,_e[He]=pt<0?pt*pt:0}}bS(ke,0,0,C,O,C,this.f,this.v,this.z),bS(_e,ie,ie,T,M,C,this.f,this.v,this.z);for(let Le=0;Le<U;Le++){let Ve=Math.sqrt(ke[Le])-Math.sqrt(_e[Le]);V[Le]=Math.round(255-255*(Ve/this.radius+this.cutoff))}return q}};class yP{constructor(n=[],a=vP){if(this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let n=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),n}peek(){return this.data[0]}_up(n){let{data:a,compare:u}=this,f=a[n];for(;n>0;){let g=n-1>>1,y=a[g];if(u(f,y)>=0)break;a[n]=y,n=g}a[n]=f}_down(n){let{data:a,compare:u}=this,f=this.length>>1,g=a[n];for(;n<f;){let y=1+(n<<1),T=a[y],M=y+1;if(M<this.length&&u(a[M],T)<0&&(y=M,T=a[M]),u(T,g)>=0)break;a[n]=T,n=y}a[n]=g}}function vP(o,n){return o<n?-1:o>n?1:0}function xP(o,n=1,a=!1){let u=1/0,f=1/0,g=-1/0,y=-1/0,T=o[0];for(let q=0;q<T.length;q++){let J=T[q];(!q||J.x<u)&&(u=J.x),(!q||J.y<f)&&(f=J.y),(!q||J.x>g)&&(g=J.x),(!q||J.y>y)&&(y=J.y)}let M=Math.min(g-u,y-f),C=M/2,O=new yP([],bP);if(M===0)return new G(u,f);for(let q=u;q<g;q+=M)for(let J=f;J<y;J+=M)O.push(new Wd(q+C,J+C,C,o));let U=function(q){let J=0,ie=0,_e=0,ke=q[0];for(let Ge=0,Le=ke.length,Ve=Le-1;Ge<Le;Ve=Ge++){let We=ke[Ge],He=ke[Ve],pt=We.x*He.y-He.x*We.y;ie+=(We.x+He.x)*pt,_e+=(We.y+He.y)*pt,J+=3*pt}return new Wd(ie/J,_e/J,0,q)}(o),V=O.length;for(;O.length;){let q=O.pop();(q.d>U.d||!U.d)&&(U=q,a&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,V)),q.max-U.d<=n||(C=q.h/2,O.push(new Wd(q.p.x-C,q.p.y-C,C,o)),O.push(new Wd(q.p.x+C,q.p.y-C,C,o)),O.push(new Wd(q.p.x-C,q.p.y+C,C,o)),O.push(new Wd(q.p.x+C,q.p.y+C,C,o)),V+=4)}return a&&(console.log(`num probes: ${V}`),console.log(`best distance: ${U.d}`)),U.p}function bP(o,n){return n.max-o.max}function Wd(o,n,a,u){this.p=new G(o,n),this.h=a,this.d=function(f,g){let y=!1,T=1/0;for(let M=0;M<g.length;M++){let C=g[M];for(let O=0,U=C.length,V=U-1;O<U;V=O++){let q=C[O],J=C[V];q.y>f.y!=J.y>f.y&&f.x<(J.x-q.x)*(f.y-q.y)/(J.y-q.y)+q.x&&(y=!y),T=Math.min(T,wE(f,q,J))}}return(y?1:-1)*Math.sqrt(T)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}let kx=Number.POSITIVE_INFINITY,wP=Math.sqrt(2);function SS(o,[n,a]){let u=0,f=0;if(a===kx){n<0&&(n=0);let g=n/wP;switch(o){case"top-right":case"top-left":f=g-7;break;case"bottom-right":case"bottom-left":f=7-g;break;case"bottom":f=7-n;break;case"top":f=n-7}switch(o){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=n;break;case"right":u=-n}}else{switch(n=Math.abs(n),a=Math.abs(a),o){case"top-right":case"top-left":case"top":f=a-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-a}switch(o){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}}return[u,f]}function TP(o,n,a,u,f,g,y,T,M,C){o.createArrays(),o.tilePixelRatio=Zn/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;let O=o.layers[0].layout,U=o.layers[0]._unevaluatedLayout._values,V={};if(o.textSizeData.kind==="composite"){let{minZoom:ie,maxZoom:_e}=o.textSizeData;V.compositeTextSizes=[U["text-size"].possiblyEvaluate(new it(ie),T),U["text-size"].possiblyEvaluate(new it(_e),T)]}if(o.iconSizeData.kind==="composite"){let{minZoom:ie,maxZoom:_e}=o.iconSizeData;V.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new it(ie),T),U["icon-size"].possiblyEvaluate(new it(_e),T)]}V.layoutTextSize=U["text-size"].possiblyEvaluate(new it(M+1),T),V.layoutIconSize=U["icon-size"].possiblyEvaluate(new it(M+1),T),V.textMaxSize=U["text-size"].possiblyEvaluate(new it(18),T);let q=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",J=O.get("text-size");for(let ie of o.features){let _e=O.get("text-font").evaluate(ie,{},T).join(","),ke=J.evaluate(ie,{},T),Ge=V.layoutTextSize.evaluate(ie,{},T),Le=(V.layoutIconSize.evaluate(ie,{},T),{horizontal:{},vertical:void 0}),Ve=ie.text,We,He=[0,0];if(Ve){let At=Ve.toString(),Kt=O.get("text-letter-spacing").evaluate(ie,{},T)*ys,vt=O.get("text-line-height").evaluate(ie,{},T)*ys,Mt=E(At)?Kt:0,kt=O.get("text-anchor").evaluate(ie,{},T),Vt=O.get("text-variable-anchor");if(!Vt){let _n=O.get("text-radial-offset").evaluate(ie,{},T);He=_n?SS(kt,[_n*ys,kx]):O.get("text-offset").evaluate(ie,{},T).map(Ln=>Ln*ys)}let Yt=q?"center":O.get("text-justify").evaluate(ie,{},T),wt=O.get("symbol-placement")==="point",dn=wt?O.get("text-max-width").evaluate(ie,{},T)*ys:1/0,Hn=_n=>{o.allowVerticalPlacement&&b(At)&&(Le.vertical=Dx(Ve,n,a,f,_e,dn,vt,kt,_n,Mt,He,Co.vertical,!0,Ge,ke))};if(!q&&Vt){let _n=Yt==="auto"?Vt.map(fn=>zx(fn)):[Yt],Ln=!1;for(let fn=0;fn<_n.length;fn++){let qn=_n[fn];if(!Le.horizontal[qn])if(Ln)Le.horizontal[qn]=Le.horizontal[0];else{let xi=Dx(Ve,n,a,f,_e,dn,vt,"center",qn,Mt,He,Co.horizontal,!1,Ge,ke);xi&&(Le.horizontal[qn]=xi,Ln=xi.positionedLines.length===1)}}Hn("left")}else{if(Yt==="auto"&&(Yt=zx(kt)),wt||O.get("text-writing-mode").indexOf("horizontal")>=0||!b(At)){let _n=Dx(Ve,n,a,f,_e,dn,vt,kt,Yt,Mt,He,Co.horizontal,!1,Ge,ke);_n&&(Le.horizontal[Yt]=_n)}Hn(wt?"left":Yt)}}let pt=!1;if(ie.icon&&ie.icon.name){let At=u[ie.icon.name];At&&(We=pP(f[ie.icon.name],O.get("icon-offset").evaluate(ie,{},T),O.get("icon-anchor").evaluate(ie,{},T)),pt=At.sdf,o.sdfIcons===void 0?o.sdfIcons=At.sdf:o.sdfIcons!==At.sdf&&nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(At.pixelRatio!==o.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}let ht=MS(Le.horizontal)||Le.vertical;o.iconsInText||(o.iconsInText=!!ht&&ht.iconsInText),(ht||We)&&EP(o,ie,Le,We,u,V,Ge,0,He,pt,y,T,C)}g&&o.generateCollisionDebugBuffers(M,o.collisionBoxArray)}function zx(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function EP(o,n,a,u,f,g,y,T,M,C,O,U,V){let q=g.textMaxSize.evaluate(n,{},U);q===void 0&&(q=y);let J=o.layers[0].layout,ie=J.get("icon-offset").evaluate(n,{},U),_e=MS(a.horizontal)||a.vertical,ke=V.name==="globe",Ge=y/24,Le=o.tilePixelRatio*q/24,Ve=(Mt=o.overscaling,o.zoom>18&&Mt>2&&(Mt>>=1),Math.max(Zn/(512*Mt),1)*J.get("symbol-spacing")),We=J.get("text-padding")*o.tilePixelRatio,He=J.get("icon-padding")*o.tilePixelRatio,pt=me(J.get("text-max-angle")),ht=J.get("text-rotation-alignment")==="map"&&J.get("symbol-placement")!=="point",At=J.get("icon-rotation-alignment")==="map"&&J.get("symbol-placement")!=="point",Kt=J.get("symbol-placement"),vt=Ve/2;var Mt;let kt=J.get("icon-text-fit"),Vt;u&&kt!=="none"&&(o.allowVerticalPlacement&&a.vertical&&(Vt=pS(u,a.vertical,kt,J.get("icon-text-fit-padding"),ie,Ge)),_e&&(u=pS(u,_e,kt,J.get("icon-text-fit-padding"),ie,Ge)));let Yt=(wt,dn,Hn)=>{if(dn.x<0||dn.x>=Zn||dn.y<0||dn.y>=Zn)return;let _n=null;if(ke){let{x:Ln,y:fn,z:qn}=V.projectTilePoint(dn.x,dn.y,Hn);_n={anchor:new Ml(Ln,fn,qn,0,void 0),up:V.upVector(Hn,dn.x,dn.y)}}(function(Ln,fn,qn,xi,pi,hi,Xn,Gi,ti,bi,qi,ar,ir,lr,hr,Tr,ns,Hi,Br,Or,Pi,_r,Wr,Xi,Lr){let Ms=Ln.addToLineVertexArray(fn,xi),is,rs,Vs,ss,Il,Zd,xm,bm=0,n2=0,i2=0,r2=0,Xx=-1,Zx=-1,Za={},s2=Hu(""),th=qn?qn.anchor:fn,Kx=0,Yx=0;if(ti._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Kx,Yx]=ti.layout.get("text-offset").evaluate(Pi,{},Lr).map(uo=>uo*ys):(Kx=ti.layout.get("text-radial-offset").evaluate(Pi,{},Lr)*ys,Yx=kx),Ln.allowVerticalPlacement&&pi.vertical){let uo=pi.vertical;if(hr)Zd=Ox(uo),Gi&&(xm=Ox(Gi));else{let ho=ti.layout.get("text-rotate").evaluate(Pi,{},Lr)+90;Vs=yy(bi,th,fn,qi,ar,ir,uo,lr,ho,Tr),Gi&&(ss=yy(bi,th,fn,qi,ar,ir,Gi,Hi,ho))}}if(hi){let uo=ti.layout.get("icon-rotate").evaluate(Pi,{},Lr),ho=ti.layout.get("icon-text-fit")!=="none",wm=TS(hi,uo,Wr,ho),$x=Gi?TS(Gi,uo,Wr,ho):void 0;rs=yy(bi,th,fn,qi,ar,ir,hi,Hi,uo),bm=4*wm.length;let o2=Ln.iconSizeData,nh=null;o2.kind==="source"?(nh=[ja*ti.layout.get("icon-size").evaluate(Pi,{},Lr)],nh[0]>Ec&&nt(`${Ln.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):o2.kind==="composite"&&(nh=[ja*_r.compositeIconSizes[0].evaluate(Pi,{},Lr),ja*_r.compositeIconSizes[1].evaluate(Pi,{},Lr)],(nh[0]>Ec||nh[1]>Ec)&&nt(`${Ln.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ln.addSymbols(Ln.icon,wm,nh,Or,Br,Pi,!1,qn,fn,Ms.lineStartIndex,Ms.lineLength,-1,Xi,Lr),Xx=Ln.icon.placedSymbolArray.length-1,$x&&(n2=4*$x.length,Ln.addSymbols(Ln.icon,$x,nh,Or,Br,Pi,Co.vertical,qn,fn,Ms.lineStartIndex,Ms.lineLength,-1,Xi,Lr),Zx=Ln.icon.placedSymbolArray.length-1)}for(let uo in pi.horizontal){let ho=pi.horizontal[uo];is||(s2=Hu(ho.text),hr?Il=Ox(ho):is=yy(bi,th,fn,qi,ar,ir,ho,lr,ti.layout.get("text-rotate").evaluate(Pi,{},Lr),Tr));let wm=ho.positionedLines.length===1;if(i2+=AS(Ln,qn,fn,ho,Xn,ti,hr,Pi,Tr,Ms,pi.vertical?Co.horizontal:Co.horizontalOnly,wm?Object.keys(pi.horizontal):[uo],Za,Xx,_r,Xi,Lr),wm)break}pi.vertical&&(r2+=AS(Ln,qn,fn,pi.vertical,Xn,ti,hr,Pi,Tr,Ms,Co.vertical,["vertical"],Za,Zx,_r,Xi,Lr));let Lc=-1,Jx=(uo,ho)=>uo?Math.max(uo,ho):ho;Lc=Jx(Il,Lc),Lc=Jx(Zd,Lc),Lc=Jx(xm,Lc);let YP=Lc>-1?1:0;Ln.glyphOffsetArray.length>=Ac.MAX_GLYPHS&&nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pi.sortKey!==void 0&&Ln.addToSortKeyRanges(Ln.symbolInstances.length,Pi.sortKey),Ln.symbolInstances.emplaceBack(th.x,th.y,th.z,fn.x,fn.y,Za.right>=0?Za.right:-1,Za.center>=0?Za.center:-1,Za.left>=0?Za.left:-1,Za.vertical>=0?Za.vertical:-1,Xx,Zx,s2,is!==void 0?is:Ln.collisionBoxArray.length,is!==void 0?is+1:Ln.collisionBoxArray.length,Vs!==void 0?Vs:Ln.collisionBoxArray.length,Vs!==void 0?Vs+1:Ln.collisionBoxArray.length,rs!==void 0?rs:Ln.collisionBoxArray.length,rs!==void 0?rs+1:Ln.collisionBoxArray.length,ss||Ln.collisionBoxArray.length,ss?ss+1:Ln.collisionBoxArray.length,qi,i2,r2,bm,n2,YP,0,Kx,Yx,Lc)})(o,dn,_n,wt,a,u,f,Vt,o.layers[0],o.collisionBoxArray,n.index,n.sourceLayerIndex,o.index,We,ht,M,0,He,At,ie,n,g,C,O,U)};if(Kt==="line")for(let wt of xS(n.geometry,0,0,Zn,Zn)){let dn=gP(wt,Ve,pt,a.vertical||_e,u,24,Le,o.overscaling,Zn);for(let Hn of dn){let _n=_e;_n&&SP(o,_n.text,vt,Hn)||Yt(wt,Hn,U)}}else if(Kt==="line-center"){for(let wt of n.geometry)if(wt.length>1){let dn=mP(wt,pt,a.vertical||_e,u,24,Le);dn&&Yt(wt,dn,U)}}else if(n.type==="Polygon")for(let wt of Tx(n.geometry,0)){let dn=xP(wt,16);Yt(wt[0],new Ml(dn.x,dn.y,0,0,void 0),U)}else if(n.type==="LineString")for(let wt of n.geometry)Yt(wt,new Ml(wt[0].x,wt[0].y,0,0,void 0),U);else if(n.type==="Point")for(let wt of n.geometry)for(let dn of wt)Yt([dn],new Ml(dn.x,dn.y,0,0,void 0),U)}let Ec=32640;function AS(o,n,a,u,f,g,y,T,M,C,O,U,V,q,J,ie,_e){let ke=function(Ve,We,He,pt,ht,At,Kt,vt){let Mt=[];if(We.positionedLines.length===0)return Mt;let kt=pt.layout.get("text-rotate").evaluate(At,{})*Math.PI/180,Vt=function(_n){let Ln=_n[0],fn=_n[1],qn=Ln*fn;return qn>0?[Ln,-fn]:qn<0?[-Ln,fn]:Ln===0?[fn,Ln]:[fn,-Ln]}(He),Yt=Math.abs(We.top-We.bottom);for(let _n of We.positionedLines)Yt-=_n.lineOffset;let wt=We.positionedLines.length,dn=Yt/wt,Hn=We.top-He[1];for(let _n=0;_n<wt;++_n){let Ln=We.positionedLines[_n];Hn=_P(We,dn,Hn,_n);for(let fn of Ln.positionedGlyphs){if(!fn.rect)continue;let qn=fn.rect||{},xi=4,pi=!0,hi=1,Xn=0;if(fn.imageName){let Xi=Kt[fn.imageName];if(!Xi)continue;if(Xi.sdf){nt("SDF images are not supported in formatted text and will be ignored.");continue}pi=!1,hi=Xi.pixelRatio,xi=1/hi}let Gi=(ht||vt)&&fn.vertical,ti=fn.metrics.advance*fn.scale/2,bi=fn.metrics,qi=fn.rect;if(qi===null)continue;vt&&We.verticalizable&&(Xn=fn.imageName?ti-fn.metrics.width*fn.scale/2:0);let ar=ht?[fn.x+ti,fn.y]:[0,0],ir=[0,0],lr=[0,0],hr=!1;ht||(Gi?(lr=[fn.x+ti+Vt[0],fn.y+Vt[1]-Xn],hr=!0):ir=[fn.x+ti+He[0],fn.y+He[1]-Xn]);let Tr=qi.w*fn.scale/(hi*(fn.localGlyph?2:1)),ns=qi.h*fn.scale/(hi*(fn.localGlyph?2:1)),Hi,Br,Or,Pi;if(Gi){let Xi=fn.y-Hn,Lr=new G(-ti,ti-Xi),Ms=-Math.PI/2,is=new G(...lr);Hi=new G(-ti+ir[0],ir[1]),Hi._rotateAround(Ms,Lr)._add(is),Hi.x+=-Xi+ti,Hi.y-=(bi.left-xi)*fn.scale;let rs=fn.imageName?bi.advance*fn.scale:ys*fn.scale,Vs=String.fromCharCode(fn.glyph);$R(Vs)?Hi.x+=(1-xi)*fn.scale:QR(Vs)?Hi.x+=rs-bi.height*fn.scale+(-xi-1)*fn.scale:Hi.x+=fn.imageName||bi.width+2*xi===qi.w&&bi.height+2*xi===qi.h?(rs-ns)/2:(rs-(bi.height+2*xi)*fn.scale)/2,Br=new G(Hi.x,Hi.y-Tr),Or=new G(Hi.x+ns,Hi.y),Pi=new G(Hi.x+ns,Hi.y-Tr)}else{let Xi=(bi.left-xi)*fn.scale-ti+ir[0],Lr=(-bi.top-xi)*fn.scale+ir[1],Ms=Xi+Tr,is=Lr+ns;Hi=new G(Xi,Lr),Br=new G(Ms,Lr),Or=new G(Xi,is),Pi=new G(Ms,is)}if(kt){let Xi;Xi=ht?new G(0,0):hr?new G(Vt[0],Vt[1]):new G(He[0],He[1]),Hi._rotateAround(kt,Xi),Br._rotateAround(kt,Xi),Or._rotateAround(kt,Xi),Pi._rotateAround(kt,Xi)}let _r=new G(0,0),Wr=new G(0,0);Mt.push({tl:Hi,tr:Br,bl:Or,br:Pi,tex:qn,writingMode:We.writingMode,glyphOffset:ar,sectionIndex:fn.sectionIndex,isSDF:pi,pixelOffsetTL:_r,pixelOffsetBR:Wr,minFontScaleX:0,minFontScaleY:0})}}return Mt}(0,u,M,g,y,T,f,o.allowVerticalPlacement),Ge=o.textSizeData,Le=null;Ge.kind==="source"?(Le=[ja*g.layout.get("text-size").evaluate(T,{},_e)],Le[0]>Ec&&nt(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Ge.kind==="composite"&&(Le=[ja*J.compositeTextSizes[0].evaluate(T,{},_e),ja*J.compositeTextSizes[1].evaluate(T,{},_e)],(Le[0]>Ec||Le[1]>Ec)&&nt(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,ke,Le,M,y,T,O,n,a,C.lineStartIndex,C.lineLength,q,ie,_e);for(let Ve of U)V[Ve]=o.text.placedSymbolArray.length-1;return 4*ke.length}function MS(o){for(let n in o)return o[n];return null}function yy(o,n,a,u,f,g,y,T,M,C){let O=y.top,U=y.bottom,V=y.left,q=y.right,J=y.collisionPadding;if(J&&(V-=J[0],O-=J[1],q+=J[2],U+=J[3]),M){let ie=new G(V,O),_e=new G(q,O),ke=new G(V,U),Ge=new G(q,U),Le=me(M),Ve=new G(0,0);C&&(Ve=new G(C[0],C[1])),ie._rotateAround(Le,Ve),_e._rotateAround(Le,Ve),ke._rotateAround(Le,Ve),Ge._rotateAround(Le,Ve),V=Math.min(ie.x,_e.x,ke.x,Ge.x),q=Math.max(ie.x,_e.x,ke.x,Ge.x),O=Math.min(ie.y,_e.y,ke.y,Ge.y),U=Math.max(ie.y,_e.y,ke.y,Ge.y)}return o.emplaceBack(n.x,n.y,n.z,a.x,a.y,V,O,q,U,T,u,f,g),o.length-1}function Ox(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);let n=o.bottom-o.top;return n>0?Math.max(10,n):null}function SP(o,n,a,u){let f=o.compareText;if(n in f){let g=f[n];for(let y=g.length-1;y>=0;y--)if(u.dist(g[y])<a)return!0}else f[n]=[];return f[n].push(u),!1}function IS(o,n){let a=o.fovAboveCenter,u=o.elevation?o.elevation.getMinElevationBelowMSL()*n:0,f=(o._camera.position[2]*o.worldSize-u)/Math.cos(o._pitch),g=Math.sin(a)*f/Math.sin(Math.max(Math.PI/2-o._pitch-a,.01)),y=Math.sin(o._pitch)*g+f;return Math.min(1.01*y,f*(1/o._horizonShift))}function Qu(o,n){if(!n.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:n};let a=Math.pow(2,-o.z),u=o.x*a,f=(o.x+1)*a,g=o.y*a,y=(o.y+1)*a,T=Io(u),M=Io(f),C=gs(g),O=gs(y),U=n.project(T,C),V=n.project(M,C),q=n.project(M,O),J=n.project(T,O),ie=Math.min(U.x,V.x,q.x,J.x),_e=Math.min(U.y,V.y,q.y,J.y),ke=Math.max(U.x,V.x,q.x,J.x),Ge=Math.max(U.y,V.y,q.y,J.y),Le=a/16;function Ve(He,pt,ht,At,Kt,vt){let Mt=(ht+Kt)/2,kt=(At+vt)/2,Vt=n.project(Io(Mt),gs(kt)),Yt=Math.max(0,ie-Vt.x,_e-Vt.y,Vt.x-ke,Vt.y-Ge);ie=Math.min(ie,Vt.x),ke=Math.max(ke,Vt.x),_e=Math.min(_e,Vt.y),Ge=Math.max(Ge,Vt.y),Yt>Le&&(Ve(He,Vt,ht,At,Mt,kt),Ve(Vt,pt,Mt,kt,Kt,vt))}Ve(U,V,u,g,f,g),Ve(V,q,f,g,f,y),Ve(q,J,f,y,u,y),Ve(J,U,u,y,u,g),ie-=Le,_e-=Le,ke+=Le,Ge+=Le;let We=1/Math.max(ke-ie,Ge-_e);return{scale:We,x:ie*We,y:_e*We,x2:ke*We,y2:Ge*We,projection:n}}let AP=fa(new Float32Array(16));class Sc{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,a){return{x:0,y:0,z:0}}unproject(n,a){return new Di(0,0)}projectTilePoint(n,a,u){return{x:n,y:a,z:0}}locationPoint(n,a,u=!0){return n._coordinatePoint(n.locationCoordinate(a),u)}pixelsPerMeter(n,a){return ma(1,n)*a}pixelSpaceConversion(n,a,u){return 1}farthestPixelDistance(n){return IS(n,n.pixelsPerMeter)}pointCoordinate(n,a,u,f){let g=n.horizonLineFromTop(!1),y=new G(a,Math.max(g,u));return n.rayIntersectionCoordinate(n.pointRayIntersection(y,f))}pointCoordinate3D(n,a,u){let f=new G(a,u);if(n.elevation)return n.elevation.pointCoordinate(f);{let g=this.pointCoordinate(n,f.x,f.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(n,a){if(n.elevation)return!this.pointCoordinate3D(n,a.x,a.y);let u=n.horizonLineFromTop();return a.y<u}createInversionMatrix(n,a){return AP}createTileMatrix(n,a,u){let f,g,y,T=u.canonical,M=fa(new Float64Array(16));if(this.isReprojectedInTileSpace){let C=Qu(T,this);f=1,g=C.x+u.wrap*C.scale,y=C.y,qu(M,M,[f/C.scale,f/C.scale,n.pixelsPerMeter/a])}else f=a/n.zoomScale(T.z),g=(T.x+Math.pow(2,T.z)*u.wrap)*f,y=T.y*f;return jp(M,M,[g,y,0]),qu(M,M,[f/Zn,f/Zn,1]),M}upVector(n,a,u){return[0,0,1]}upVectorScale(n,a,u){return{metersToTile:1}}}class MP extends Sc{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];let[a,u]=this.parallels=n.parallels||[29.5,45.5],f=Math.sin(me(a));this.n=(f+Math.sin(me(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(n,a){let{n:u,c:f,r0:g}=this,y=me(n-this.center[0]),T=me(a),M=Math.sqrt(f-2*u*Math.sin(T))/u;return{x:M*Math.sin(y*u),y:M*Math.cos(y*u)-g,z:0}}unproject(n,a){let{n:u,c:f,r0:g}=this,y=g+a,T=Math.atan2(n,Math.abs(y))*Math.sign(y);y*u<0&&(T-=Math.PI*Math.sign(n)*Math.sign(y));let M=me(this.center[0])*u;T=ae(T,-Math.PI-M,Math.PI-M);let C=re(se(T/u)+this.center[0],-180,180),O=Math.asin(re((f-(n*n+y*y)*u*u)/(2*u),-1,1)),U=re(se(O),-_s,_s);return new Di(C,U)}}let pm=1.340264,mm=-.081106,gm=893e-6,_m=.003796,vy=Math.sqrt(3)/2;class IP extends Sc{project(n,a){a=a/180*Math.PI,n=n/180*Math.PI;let u=Math.asin(vy*Math.sin(a)),f=u*u,g=f*f*f;return{x:.5*(n*Math.cos(u)/(vy*(pm+3*mm*f+g*(7*gm+9*_m*f)))/Math.PI+.5),y:1-.5*(u*(pm+mm*f+g*(gm+_m*f))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,f=u*u,g=f*f*f;for(let O,U,V,q=0;q<12&&(U=u*(pm+mm*f+g*(gm+_m*f))-a,V=pm+3*mm*f+g*(7*gm+9*_m*f),O=U/V,u=re(u-O,-Math.PI/3,Math.PI/3),f=u*u,g=f*f*f,!(Math.abs(O)<1e-12));++q);let y=vy*n*(pm+3*mm*f+g*(7*gm+9*_m*f))/Math.cos(u),T=Math.asin(Math.sin(u)/vy),M=re(180*y/Math.PI,-180,180),C=re(180*T/Math.PI,-_s,_s);return new Di(M,C)}}class CP extends Sc{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){return{x:.5+n/360,y:.5-a/360,z:0}}unproject(n,a){let u=360*(n-.5),f=re(360*(.5-a),-_s,_s);return new Di(u,f)}}let qd=Math.PI/2;function xy(o){return Math.tan((qd+o)/2)}class LP extends Sc{constructor(n){super(n),this.center=n.center||[0,30];let[a,u]=this.parallels=n.parallels||[30,30],f=me(a),g=me(u);this.southernCenter=f+g<0,this.southernCenter&&(f=-f,g=-g);let y=Math.cos(f),T=xy(f);this.n=f===g?Math.sin(f):Math.log(y/Math.cos(g))/Math.log(xy(g)/T),this.f=y*Math.pow(xy(f),this.n)/this.n}project(n,a){a=me(a),this.southernCenter&&(a=-a),n=me(n-this.center[0]);let u=1e-6,{n:f,f:g}=this;g>0?a<-qd+u&&(a=-qd+u):a>qd-u&&(a=qd-u);let y=g/Math.pow(xy(a),f),T=y*Math.sin(f*n),M=g-y*Math.cos(f*n);return T=.5*(T/Math.PI+.5),M=.5*(M/Math.PI+.5),{x:T,y:this.southernCenter?M:1-M,z:0}}unproject(n,a){n=(2*n-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;let{n:u,f}=this,g=f-a,y=Math.sign(g),T=Math.sign(u)*Math.sqrt(n*n+g*g),M=Math.atan2(n,Math.abs(g))*y;g*u<0&&(M-=Math.PI*Math.sign(n)*y);let C=re(se(M/u)+this.center[0],-180,180),O=re(se(2*Math.atan(Math.pow(f/T,1/u))-qd),-_s,_s);return new Di(C,this.southernCenter?-O:O)}}class CS extends Sc{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,a){return{x:Ga(n),y:Ha(a),z:0}}unproject(n,a){let u=Io(n),f=gs(a);return new Di(u,f)}}let LS=me(_s);class DP extends Sc{project(n,a){let u=(a=me(a))*a,f=u*u;return{x:.5*((n=me(n))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,f=25,g=0,y=u*u;do{y=u*u;let C=y*y;g=(u*(1.007226+y*(.015085+C*(.028874*y-.044475-.005916*C)))-a)/(1.007226+y*(.045255+C*(.259866*y-.311325-.005916*11*C))),u=re(u-g,-LS,LS)}while(Math.abs(g)>1e-6&&--f>0);y=u*u;let T=re(se(n/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),M=se(u);return new Di(T,M)}}let DS=me(_s);class RP extends Sc{project(n,a){a=me(a),n=me(n);let u=Math.cos(a),f=2/Math.PI,g=Math.acos(u*Math.cos(n/2)),y=Math.sin(g)/g,T=.5*(n*f+2*u*Math.sin(n/2)/y)||0,M=.5*(a+Math.sin(a)/y)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(M/Math.PI+1),z:0}}unproject(n,a){let u=n=(2*n-.5)*Math.PI,f=a=(2*(1-a)-1)*Math.PI,g=25,y=1e-6,T=0,M=0;do{let C=Math.cos(f),O=Math.sin(f),U=2*O*C,V=O*O,q=C*C,J=Math.cos(u/2),ie=Math.sin(u/2),_e=2*J*ie,ke=ie*ie,Ge=1-q*J*J,Le=Ge?1/Ge:0,Ve=Ge?Math.acos(C*J)*Math.sqrt(1/Ge):0,We=.5*(2*Ve*C*ie+2*u/Math.PI)-n,He=.5*(Ve*O+f)-a,pt=.5*Le*(q*ke+Ve*C*J*V)+1/Math.PI,ht=Le*(_e*U/4-Ve*O*ie),At=.125*Le*(U*ie-Ve*O*q*_e),Kt=.5*Le*(V*J+Ve*ke*C)+.5,vt=ht*At-Kt*pt;T=(He*ht-We*Kt)/vt,M=(We*At-He*pt)/vt,u=re(u-T,-Math.PI,Math.PI),f=re(f-M,-DS,DS)}while((Math.abs(T)>y||Math.abs(M)>y)&&--g>0);return new Di(se(u),se(f))}}class RS extends Sc{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(me(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){let{scale:u,cosPhi:f}=this;return{x:me(n)*f*u+.5,y:-Math.sin(me(a))/f*u+.5,z:0}}unproject(n,a){let{scale:u,cosPhi:f}=this,g=-(a-.5)/u,y=re(se((n-.5)/u)/f,-180,180),T=Math.asin(re(g*f,-1,1)),M=re(se(T),-_s,_s);return new Di(y,M)}}class PP extends CS{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,a,u){let f=$p(n,a,u);return Cr(f,f,Qp(Va(u))),{x:f[0],y:f[1],z:f[2]}}locationPoint(n,a){let u=Rd(a.lat,a.lng),f=Fs([],u),g=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(a),n._centerAltitude):n._centerAltitude;Zp(u,u,f,ma(1,0)*Zn*g);let y=fa(new Float64Array(16));return Wu(y,n.pixelMatrix,n.globeMatrix),Cr(u,u,y),new G(u[0],u[1])}pixelsPerMeter(n,a){return ma(1,0)*a}pixelSpaceConversion(n,a,u){let f=ma(1,n)*a,g=Li(ma(1,45)*a,f,u);return this.pixelsPerMeter(n,a)/g}createTileMatrix(n,a,u){let f=cx(Va(u.canonical));return Wu(new Float64Array(16),n.globeMatrix,f)}createInversionMatrix(n,a){let{center:u}=n,f=Qp(Va(a));return K_(f,f,me(u.lng)),ex(f,f,me(u.lat)),qu(f,f,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(n,a,u,f){return lE(n,a,u,!0)||new kd(0,0)}pointCoordinate3D(n,a,u){let f=this.pointCoordinate(n,a,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(n,a){return!lE(n,a.x,a.y,!1)}farthestPixelDistance(n){let a=function(f,g){let y=f.cameraToCenterDistance,T=f._centerAltitude*g,M=f._camera,C=f._camera.forward(),O=Tl([],Mo([],C,-y),[0,0,T]),U=f.worldSize/(2*Math.PI),V=[0,0,-U],q=f.width/f.height,J=Math.tan(f.fovAboveCenter),ie=Mo([],M.up(),J),_e=Mo([],M.right(),J*q),ke=Fs([],Tl([],Tl([],C,ie),_e)),Ge=[],Le;if(new rx(O,ke).closestPointOnSphere(V,U,Ge)){let Ve=Tl([],Ge,V),We=pa([],Ve,O);Le=Math.cos(f.fovAboveCenter)*Wp(We)}else{let Ve=pa([],O,V),We=pa([],V,O);Fs(We,We);let He=Wp(Ve)-U;Le=Math.sqrt(He*(He+2*U));let pt=Math.acos(Le/(U+He))-Math.acos(Bo(C,We));Le*=Math.cos(pt)}return 1.01*Le}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),u=Pd(n.zoom);if(u>0){let f=IS(n,ma(1,n.center.lat)*n.worldSize),g=n.worldSize/(2*Math.PI),y=Math.max(n.width,n.height)/n.worldSize*Math.PI;return Li(a,f+g*(1-Math.cos(y)),Math.pow(u,10))}return a}upVector(n,a,u){return $p(a,u,n,1)}upVectorScale(n){return{metersToTile:Y_($_(Va(n)))}}}function PS(o){let n=o.parallels,a=!!n&&Math.abs(n[0]+n[1])<.01;switch(o.name){case"mercator":return new CS(o);case"equirectangular":return new CP(o);case"naturalEarth":return new DP(o);case"equalEarth":return new IP(o);case"winkelTripel":return new RP(o);case"albers":return a?new RS(o):new MP(o);case"lambertConformalConic":return a?new RS(o):new LP(o);case"globe":return new PP(o)}throw new Error(`Invalid projection name: ${o.name}`)}let kP=ly.types,zP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function by(o,n,a,u,f,g,y,T,M,C,O,U,V){let q=T?Math.min(Ec,Math.round(T[0])):0,J=T?Math.min(Ec,Math.round(T[1])):0;o.emplaceBack(n,a,Math.round(32*u),Math.round(32*f),g,y,(q<<1)+(M?1:0),J,16*C,16*O,256*U,256*V)}function wy(o,n,a,u,f,g,y){o.emplaceBack(n,a,u,f,g,y)}function Ty(o,n,a,u,f){o.emplaceBack(n,a,u,f),o.emplaceBack(n,a,u,f),o.emplaceBack(n,a,u,f),o.emplaceBack(n,a,u,f)}function OP(o){for(let n of o.sections)if(ee(n.text))return!0;return!1}class Nx{constructor(n){this.layoutVertexArray=new ca,this.indexArray=new ms,this.programConfigurations=n,this.segments=new kr,this.dynamicLayoutVertexArray=new Yi,this.opacityVertexArray=new Ji,this.placedSymbolArray=new kT,this.globeExtVertexArray=new ur}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,a,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,jR.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,qR.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,zP,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,WR.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Sn(Nx,"SymbolBuffers");class Fx{constructor(n,a,u){this.layoutVertexArray=new n,this.layoutAttributes=a,this.indexArray=new u,this.segments=new kr,this.collisionVertexArray=new or,this.collisionVertexArrayExt=new ps}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,XR.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,ZR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Sn(Fx,"CollisionBuffers");class Ac{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(y=>y.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fa([]),this.placementViewportMatrix=fa([]);let a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Mx(this.zoom,a["text-size"]),this.iconSizeData=Mx(this.zoom,a["icon-size"]);let u=this.layers[0].layout,f=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>Co[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=n.sourceID,this.projection=n.projection}createArrays(){this.text=new Nx(new ju(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Nx(new ju(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new NT,this.lineVertexArray=new FT,this.symbolInstances=new OT}calculateGlyphDependencies(n,a,u,f,g){for(let y=0;y<n.length;y++)if(a[n.charCodeAt(y)]=!0,f&&g){let T=um[n.charAt(y)];T&&(a[T.charCodeAt(0)]=!0)}}populate(n,a,u,f){let g=this.layers[0],y=g.layout,T=this.projection.name==="globe",M=y.get("text-font"),C=y.get("text-field"),O=y.get("icon-image"),U=(C.value.kind!=="constant"||C.value.value instanceof Kr&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),V=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,q=y.get("symbol-sort-key");if(this.features=[],!U&&!V)return;let J=a.iconDependencies,ie=a.glyphDependencies,_e=a.availableImages,ke=new it(this.zoom);for(let{feature:Ge,id:Le,index:Ve,sourceLayerIndex:We}of n){let He=g._featureFilter.needGeometry,pt=Yu(Ge,He);if(!g._featureFilter.filter(ke,pt,u))continue;if(He||(pt.geometry=El(Ge,u,f)),T&&Ge.type!==1&&u.z<=5){let vt=pt.geometry,Mt=.98078528056,kt=(Vt,Yt)=>Bo($p(Vt.x,Vt.y,u,1),$p(Yt.x,Yt.y,u,1))<Mt;for(let Vt=0;Vt<vt.length;Vt++)vt[Vt]=qD(vt[Vt],kt)}let ht,At;if(U){let vt=g.getValueAndResolveTokens("text-field",pt,u,_e),Mt=Kr.factory(vt);OP(Mt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ze()==="unavailable"||this.hasRTLText&&$e.isParsed())&&(ht=JR(Mt,g,pt))}if(V){let vt=g.getValueAndResolveTokens("icon-image",pt,u,_e);At=vt instanceof jr?vt:jr.fromString(vt)}if(!ht&&!At)continue;let Kt=this.sortFeaturesByKey?q.evaluate(pt,{},u):void 0;if(this.features.push({id:Le,text:ht,icon:At,index:Ve,sourceLayerIndex:We,geometry:pt.geometry,properties:Ge.properties,type:kP[Ge.type],sortKey:Kt}),At&&(J[At.name]=!0),ht){let vt=M.evaluate(pt,{},u).join(","),Mt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Co.vertical)>=0;for(let kt of ht.sections)if(kt.image)J[kt.image.name]=!0;else{let Vt=b(ht.toString()),Yt=kt.fontStack||vt,wt=ie[Yt]=ie[Yt]||{};this.calculateGlyphDependencies(kt.text,wt,Mt,this.allowVerticalPlacement,Vt)}}}y.get("symbol-placement")==="line"&&(this.features=function(Ge){let Le={},Ve={},We=[],He=0;function pt(vt){We.push(Ge[vt]),He++}function ht(vt,Mt,kt){let Vt=Ve[vt];return delete Ve[vt],Ve[Mt]=Vt,We[Vt].geometry[0].pop(),We[Vt].geometry[0]=We[Vt].geometry[0].concat(kt[0]),Vt}function At(vt,Mt,kt){let Vt=Le[Mt];return delete Le[Mt],Le[vt]=Vt,We[Vt].geometry[0].shift(),We[Vt].geometry[0]=kt[0].concat(We[Vt].geometry[0]),Vt}function Kt(vt,Mt,kt){let Vt=kt?Mt[0][Mt[0].length-1]:Mt[0][0];return`${vt}:${Vt.x}:${Vt.y}`}for(let vt=0;vt<Ge.length;vt++){let Mt=Ge[vt],kt=Mt.geometry,Vt=Mt.text?Mt.text.toString():null;if(!Vt){pt(vt);continue}let Yt=Kt(Vt,kt),wt=Kt(Vt,kt,!0);if(Yt in Ve&&wt in Le&&Ve[Yt]!==Le[wt]){let dn=At(Yt,wt,kt),Hn=ht(Yt,wt,We[dn].geometry);delete Le[Yt],delete Ve[wt],Ve[Kt(Vt,We[Hn].geometry,!0)]=Hn,We[dn].geometry=null}else Yt in Ve?ht(Yt,wt,kt):wt in Le?At(Yt,wt,kt):(pt(vt),Le[Yt]=He-1,Ve[wt]=He-1)}return We.filter(vt=>vt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ge,Le)=>Ge.sortKey-Le.sortKey)}update(n,a,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,a,this.layers,u,f),this.icon.programConfigurations.updatePaintArrays(n,a,this.layers,u,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=PS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,a){let u=this.lineVertexArray.length;if(n.segment!==void 0)for(let{x:f,y:g}of a)this.lineVertexArray.emplaceBack(f,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,a,u,f,g,y,T,M,C,O,U,V,q,J){let ie=n.indexArray,_e=n.layoutVertexArray,ke=n.globeExtVertexArray,Ge=n.segments.prepareSegment(4*a.length,_e,ie,this.canOverlap?y.sortKey:void 0),Le=this.glyphOffsetArray.length,Ve=Ge.vertexLength,We=this.allowVerticalPlacement&&T===Co.vertical?Math.PI/2:0,He=y.text&&y.text.sections;for(let ht=0;ht<a.length;ht++){let{tl:At,tr:Kt,bl:vt,br:Mt,tex:kt,pixelOffsetTL:Vt,pixelOffsetBR:Yt,minFontScaleX:wt,minFontScaleY:dn,glyphOffset:Hn,isSDF:_n,sectionIndex:Ln}=a[ht],fn=Ge.vertexLength,qn=Hn[1];if(by(_e,C.x,C.y,At.x,qn+At.y,kt.x,kt.y,u,_n,Vt.x,Vt.y,wt,dn),by(_e,C.x,C.y,Kt.x,qn+Kt.y,kt.x+kt.w,kt.y,u,_n,Yt.x,Vt.y,wt,dn),by(_e,C.x,C.y,vt.x,qn+vt.y,kt.x,kt.y+kt.h,u,_n,Vt.x,Yt.y,wt,dn),by(_e,C.x,C.y,Mt.x,qn+Mt.y,kt.x+kt.w,kt.y+kt.h,u,_n,Yt.x,Yt.y,wt,dn),M){let{x:xi,y:pi,z:hi}=M.anchor,[Xn,Gi,ti]=M.up;wy(ke,xi,pi,hi,Xn,Gi,ti),wy(ke,xi,pi,hi,Xn,Gi,ti),wy(ke,xi,pi,hi,Xn,Gi,ti),wy(ke,xi,pi,hi,Xn,Gi,ti),Ty(n.dynamicLayoutVertexArray,xi,pi,hi,We)}else Ty(n.dynamicLayoutVertexArray,C.x,C.y,C.z,We);ie.emplaceBack(fn,fn+1,fn+2),ie.emplaceBack(fn+1,fn+2,fn+3),Ge.vertexLength+=4,Ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Hn[0]),ht!==a.length-1&&Ln===a[ht+1].sectionIndex||n.programConfigurations.populatePaintArrays(_e.length,y,y.index,{},q,J,He&&He[Ln])}let pt=M?M.anchor:C;n.placedSymbolArray.emplaceBack(pt.x,pt.y,pt.z,C.x,C.y,Le,this.glyphOffsetArray.length-Le,Ve,O,U,C.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],T,0,!1,0,V,0)}_commitLayoutVertex(n,a,u,f,g,y,T){n.emplaceBack(a,u,f,g,y,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(n,a,u,f,g,y,T){let M=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),C=M.vertexLength,O=T.tileAnchorX,U=T.tileAnchorY;for(let q=0;q<4;q++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(a,-n.padding,-n.padding),u.collisionVertexArrayExt.emplaceBack(a,n.padding,-n.padding),u.collisionVertexArrayExt.emplaceBack(a,n.padding,n.padding),u.collisionVertexArrayExt.emplaceBack(a,-n.padding,n.padding),this._commitLayoutVertex(u.layoutVertexArray,f,g,y,O,U,new G(n.x1,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,g,y,O,U,new G(n.x2,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,g,y,O,U,new G(n.x2,n.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,g,y,O,U,new G(n.x1,n.y2)),M.vertexLength+=4;let V=u.indexArray;V.emplaceBack(C,C+1),V.emplaceBack(C+1,C+2),V.emplaceBack(C+2,C+3),V.emplaceBack(C+3,C),M.primitiveLength+=4}_addTextDebugCollisionBoxes(n,a,u,f,g,y){for(let T=f;T<g;T++){let M=u.get(T),C=this.getSymbolInstanceTextSize(n,y,a,T);this._addCollisionDebugVertices(M,C,this.textCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(n,a,u,f,g,y){for(let T=f;T<g;T++){let M=u.get(T),C=this.getSymbolInstanceIconSize(n,a,y.placedIconSymbolIndex);this._addCollisionDebugVertices(M,C,this.iconCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,y)}}generateCollisionDebugBuffers(n,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fx(wr,tS.members,Fa),this.iconCollisionBox=new Fx(wr,tS.members,Fa);let u=Ud(this.iconSizeData,n),f=Ud(this.textSizeData,n);for(let g=0;g<this.symbolInstances.length;g++){let y=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(f,n,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,n,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,n,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,n,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(n,a,u,f){let g=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:f),y=dy(this.textSizeData,n,g)/ys;return this.tilePixelRatio*y}getSymbolInstanceIconSize(n,a,u){let f=this.icon.placedSymbolArray.get(u),g=dy(this.iconSizeData,n,f);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(n,a,u){n.emplaceBack(a,-u,-u),n.emplaceBack(a,u,-u),n.emplaceBack(a,u,u),n.emplaceBack(a,-u,u)}_updateTextDebugCollisionBoxes(n,a,u,f,g,y){for(let T=f;T<g;T++){let M=u.get(T),C=this.getSymbolInstanceTextSize(n,y,a,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,M.padding)}}_updateIconDebugCollisionBoxes(n,a,u,f,g,y){for(let T=f;T<g;T++){let M=u.get(T),C=this.getSymbolInstanceIconSize(n,a,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,M.padding)}}updateCollisionDebugBuffers(n,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let u=Ud(this.iconSizeData,n),f=Ud(this.textSizeData,n);for(let g=0;g<this.symbolInstances.length;g++){let y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,n,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,n,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(u,n,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,n,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,a,u,f,g,y,T,M,C){let O={};if(a<u){let{x1:U,y1:V,x2:q,y2:J,padding:ie,projectedAnchorX:_e,projectedAnchorY:ke,projectedAnchorZ:Ge,tileAnchorX:Le,tileAnchorY:Ve,featureIndex:We}=n.get(a);O.textBox={x1:U,y1:V,x2:q,y2:J,padding:ie,projectedAnchorX:_e,projectedAnchorY:ke,projectedAnchorZ:Ge,tileAnchorX:Le,tileAnchorY:Ve},O.textFeatureIndex=We}if(f<g){let{x1:U,y1:V,x2:q,y2:J,padding:ie,projectedAnchorX:_e,projectedAnchorY:ke,projectedAnchorZ:Ge,tileAnchorX:Le,tileAnchorY:Ve,featureIndex:We}=n.get(f);O.verticalTextBox={x1:U,y1:V,x2:q,y2:J,padding:ie,projectedAnchorX:_e,projectedAnchorY:ke,projectedAnchorZ:Ge,tileAnchorX:Le,tileAnchorY:Ve},O.verticalTextFeatureIndex=We}if(y<T){let{x1:U,y1:V,x2:q,y2:J,padding:ie,projectedAnchorX:_e,projectedAnchorY:ke,projectedAnchorZ:Ge,tileAnchorX:Le,tileAnchorY:Ve,featureIndex:We}=n.get(y);O.iconBox={x1:U,y1:V,x2:q,y2:J,padding:ie,projectedAnchorX:_e,projectedAnchorY:ke,projectedAnchorZ:Ge,tileAnchorX:Le,tileAnchorY:Ve},O.iconFeatureIndex=We}if(M<C){let{x1:U,y1:V,x2:q,y2:J,padding:ie,projectedAnchorX:_e,projectedAnchorY:ke,projectedAnchorZ:Ge,tileAnchorX:Le,tileAnchorY:Ve,featureIndex:We}=n.get(M);O.verticalIconBox={x1:U,y1:V,x2:q,y2:J,padding:ie,projectedAnchorX:_e,projectedAnchorY:ke,projectedAnchorZ:Ge,tileAnchorX:Le,tileAnchorY:Ve},O.verticalIconFeatureIndex=We}return O}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){let u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,a){let u=n.placedSymbolArray.get(a),f=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<f;g+=4)n.indexArray.emplaceBack(g,g+1,g+2),n.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let a=Math.sin(n),u=Math.cos(n),f=[],g=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);let M=this.symbolInstances.get(T);f.push(0|Math.round(a*M.tileAnchorX+u*M.tileAnchorY)),g.push(M.featureIndex)}return y.sort((T,M)=>f[T]-f[M]||g[M]-g[T]),y}addToSortKeyRanges(n,a){let u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let a of this.symbolInstanceIndexes){let u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);let{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:C}=u;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&g!==f&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==f&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Sn(Ac,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ac.MAX_GLYPHS=65535,Ac.addDynamicAttributes=Ty;let NP=new jt({"symbol-placement":new tt(Tt.layout_symbol["symbol-placement"]),"symbol-spacing":new tt(Tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tt(Tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yt(Tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tt(Tt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new tt(Tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new tt(Tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new tt(Tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tt(Tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new yt(Tt.layout_symbol["icon-size"]),"icon-text-fit":new tt(Tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tt(Tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new yt(Tt.layout_symbol["icon-image"]),"icon-rotate":new yt(Tt.layout_symbol["icon-rotate"]),"icon-padding":new tt(Tt.layout_symbol["icon-padding"]),"icon-keep-upright":new tt(Tt.layout_symbol["icon-keep-upright"]),"icon-offset":new yt(Tt.layout_symbol["icon-offset"]),"icon-anchor":new yt(Tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tt(Tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tt(Tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tt(Tt.layout_symbol["text-rotation-alignment"]),"text-field":new yt(Tt.layout_symbol["text-field"]),"text-font":new yt(Tt.layout_symbol["text-font"]),"text-size":new yt(Tt.layout_symbol["text-size"]),"text-max-width":new yt(Tt.layout_symbol["text-max-width"]),"text-line-height":new yt(Tt.layout_symbol["text-line-height"]),"text-letter-spacing":new yt(Tt.layout_symbol["text-letter-spacing"]),"text-justify":new yt(Tt.layout_symbol["text-justify"]),"text-radial-offset":new yt(Tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tt(Tt.layout_symbol["text-variable-anchor"]),"text-anchor":new yt(Tt.layout_symbol["text-anchor"]),"text-max-angle":new tt(Tt.layout_symbol["text-max-angle"]),"text-writing-mode":new tt(Tt.layout_symbol["text-writing-mode"]),"text-rotate":new yt(Tt.layout_symbol["text-rotate"]),"text-padding":new tt(Tt.layout_symbol["text-padding"]),"text-keep-upright":new tt(Tt.layout_symbol["text-keep-upright"]),"text-transform":new yt(Tt.layout_symbol["text-transform"]),"text-offset":new yt(Tt.layout_symbol["text-offset"]),"text-allow-overlap":new tt(Tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new tt(Tt.layout_symbol["text-ignore-placement"]),"text-optional":new tt(Tt.layout_symbol["text-optional"])});var Bx={paint:new jt({"icon-opacity":new yt(Tt.paint_symbol["icon-opacity"]),"icon-color":new yt(Tt.paint_symbol["icon-color"]),"icon-halo-color":new yt(Tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new yt(Tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yt(Tt.paint_symbol["icon-halo-blur"]),"icon-translate":new tt(Tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new tt(Tt.paint_symbol["icon-translate-anchor"]),"text-opacity":new yt(Tt.paint_symbol["text-opacity"]),"text-color":new yt(Tt.paint_symbol["text-color"],{runtimeType:qe,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new yt(Tt.paint_symbol["text-halo-color"]),"text-halo-width":new yt(Tt.paint_symbol["text-halo-width"]),"text-halo-blur":new yt(Tt.paint_symbol["text-halo-blur"]),"text-translate":new tt(Tt.paint_symbol["text-translate"]),"text-translate-anchor":new tt(Tt.paint_symbol["text-translate-anchor"])}),layout:NP};class kS{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:La,this.defaultValue=n}evaluate(n){if(n.formattedSection){let a=this.defaultValue.property.overrides;if(a&&a.hasOverride(n.formattedSection))return a.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Sn(kS,"FormatSectionOverride",{omit:["defaultValue"]});class Ey extends da{constructor(n){super(n,Bx)}recalculate(n,a){super.recalculate(n,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let u=this.layout.get("text-writing-mode");if(u){let f=[];for(let g of u)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(n,a,u,f){let g=this.layout.get(n).evaluate(a,{},u,f),y=this._unevaluatedLayout._values[n];return y.isDataDriven()||dc(y.value)||!g?g:function(T,M){return M.replace(/{([^{}]+)}/g,(C,O)=>O in T?String(T[O]):"")}(a.properties,g)}createBucket(n){return new Ac(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let n of Bx.paint.overridableProperties){if(!Ey.hasPaintOverride(this.layout,n))continue;let a=this.paint.get(n),u=new kS(a),f=new md(u,a.property.specification),g=null;g=a.value.kind==="constant"||a.value.kind==="source"?new gd("source",f):new vl("composite",f,a.value.zoomStops,a.value._interpolationType),this.paint._values[n]=new Ut(a.property,g,a.parameters)}}_handleOverridablePaintPropertyUpdate(n,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&Ey.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,a){let u=n.get("text-field"),f=Bx.paint.properties[a],g=!1,y=T=>{for(let M of T)if(f.overrides&&f.overrides.hasOverride(M))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Kr)y(u.value.value.sections);else if(u.value.kind==="source"){let T=C=>{g||(C instanceof _u&&vr(C.value)===ui?y(C.value.sections):C instanceof yu?y(C.sections):C.eachChild(T))},M=u.value;M._styleExpression&&T(M._styleExpression.expression)}return g}getProgramConfiguration(n){return new wc(this,n)}}var FP={paint:new jt({"background-color":new tt(Tt.paint_background["background-color"]),"background-pattern":new tt(Tt.paint_background["background-pattern"]),"background-opacity":new tt(Tt.paint_background["background-opacity"])})},BP={paint:new jt({"raster-opacity":new tt(Tt.paint_raster["raster-opacity"]),"raster-hue-rotate":new tt(Tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tt(Tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tt(Tt.paint_raster["raster-brightness-max"]),"raster-saturation":new tt(Tt.paint_raster["raster-saturation"]),"raster-contrast":new tt(Tt.paint_raster["raster-contrast"]),"raster-resampling":new tt(Tt.paint_raster["raster-resampling"]),"raster-fade-duration":new tt(Tt.paint_raster["raster-fade-duration"])})};class UP extends da{constructor(n){super(n,{}),this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}var VP={paint:new jt({"sky-type":new tt(Tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new tt(Tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new tt(Tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new tt(Tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new tt(Tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Nt(Tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new tt(Tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new tt(Tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new tt(Tt.paint_sky["sky-opacity"])})};function Ux(o,n,a){let u=[0,0,1],f=iE([]);return sE(f,f,a?-me(o)+Math.PI:me(o)),rE(f,f,-me(n)),QT(u,u,f),Fs(u,u)}let GP={circle:class extends da{constructor(o){super(o,QD)}createBucket(o){return new mx(o)}queryRadius(o){let n=o;return zd("circle-radius",this,n)+zd("circle-stroke-width",this,n)+ty(this.paint.get("circle-translate"))}queryIntersectsFeature(o,n,a,u,f,g,y,T){let M=AE(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a);return ME(o,u,g,y,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",M,C)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new wc(this,o)}},heatmap:class extends da{createBucket(o){return new CE(o)}constructor(o){super(o,iR),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return zd("heatmap-radius",this,o)}queryIntersectsFeature(o,n,a,u,f,g,y,T){let M=this.paint.get("heatmap-radius").evaluate(n,a);return ME(o,u,g,y,T,!0,!0,new G(0,0),M)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new wc(this,o)}},hillshade:class extends da{constructor(o){super(o,rR)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends da{constructor(o){super(o,xR)}getProgramIds(){let o=this.paint.get("fill-pattern"),n=o&&o.constantOr(1),a=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(o){return new wc(this,o)}recalculate(o,n){super.recalculate(o,n);let a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new oy(o)}queryRadius(){return ty(this.paint.get("fill-translate"))}queryIntersectsFeature(o,n,a,u,f,g){return!o.queryGeometry.isAboveHorizon&&bE(SE(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends da{constructor(o){super(o,OR)}createBucket(o){return new am(o)}queryRadius(){return ty(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new wc(this,o)}queryIntersectsFeature(o,n,a,u,f,g,y,T,M){let C=AE(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(n,a),U=this.paint.get("fill-extrusion-base").evaluate(n,a),V=[0,0],q=T&&g.elevation,J=g.elevation?g.elevation.exaggeration():1,ie=o.tile.getBucket(this);if(q&&ie instanceof am){let Ve=ie.centroidVertexArray,We=M+1;We<Ve.length&&(V[0]=Ve.geta_centroid_pos0(We),V[1]=Ve.geta_centroid_pos1(We))}if(V[0]===0&&V[1]===1)return!1;g.projection.name==="globe"&&(u=XE([u],[new G(0,0),new G(Zn,Zn)],o.tileID.canonical).map(Ve=>Ve.polygon).flat());let _e=q?T:null,[ke,Ge]=function(Ve,We,He,pt,ht,At,Kt,vt,Mt,kt,Vt){return Ve.projection.name==="globe"?function(Yt,wt,dn,Hn,_n,Ln,fn,qn,xi,pi,hi){let Xn=[],Gi=[],ti=Yt.projection.upVectorScale(hi,Yt.center.lat,Yt.worldSize).metersToTile,bi=[0,0,0,1],qi=[0,0,0,1],ar=(lr,hr,Tr,ns)=>{lr[0]=hr,lr[1]=Tr,lr[2]=ns,lr[3]=1},ir=qE();dn>0&&(dn+=ir),Hn+=ir;for(let lr of wt){let hr=[],Tr=[];for(let ns of lr){let Hi=ns.x+_n.x,Br=ns.y+_n.y,Or=Yt.projection.projectTilePoint(Hi,Br,hi),Pi=Yt.projection.upVector(hi,ns.x,ns.y),_r=dn,Wr=Hn;if(fn){let Xi=JE(Hi,Br,dn,Hn,fn,qn,xi,pi);_r+=Xi.base,Wr+=Xi.top}dn!==0?ar(bi,Or.x+Pi[0]*ti*_r,Or.y+Pi[1]*ti*_r,Or.z+Pi[2]*ti*_r):ar(bi,Or.x,Or.y,Or.z),ar(qi,Or.x+Pi[0]*ti*Wr,Or.y+Pi[1]*ti*Wr,Or.z+Pi[2]*ti*Wr),Cr(bi,bi,Ln),Cr(qi,qi,Ln),hr.push(new Bd(bi[0],bi[1],bi[2])),Tr.push(new Bd(qi[0],qi[1],qi[2]))}Xn.push(hr),Gi.push(Tr)}return[Xn,Gi]}(Ve,We,He,pt,ht,At,Kt,vt,Mt,kt,Vt):Kt?function(Yt,wt,dn,Hn,_n,Ln,fn,qn,xi){let pi=[],hi=[],Xn=[0,0,0,1];for(let Gi of Yt){let ti=[],bi=[];for(let qi of Gi){let ar=qi.x+Hn.x,ir=qi.y+Hn.y,lr=JE(ar,ir,wt,dn,Ln,fn,qn,xi);Xn[0]=ar,Xn[1]=ir,Xn[2]=lr.base,Xn[3]=1,Xu(Xn,Xn,_n),Xn[3]=Math.max(Xn[3],1e-5);let hr=new Bd(Xn[0]/Xn[3],Xn[1]/Xn[3],Xn[2]/Xn[3]);Xn[0]=ar,Xn[1]=ir,Xn[2]=lr.top,Xn[3]=1,Xu(Xn,Xn,_n),Xn[3]=Math.max(Xn[3],1e-5);let Tr=new Bd(Xn[0]/Xn[3],Xn[1]/Xn[3],Xn[2]/Xn[3]);ti.push(hr),bi.push(Tr)}pi.push(ti),hi.push(bi)}return[pi,hi]}(We,He,pt,ht,At,Kt,vt,Mt,kt):function(Yt,wt,dn,Hn,_n){let Ln=[],fn=[],qn=_n[8]*wt,xi=_n[9]*wt,pi=_n[10]*wt,hi=_n[11]*wt,Xn=_n[8]*dn,Gi=_n[9]*dn,ti=_n[10]*dn,bi=_n[11]*dn;for(let qi of Yt){let ar=[],ir=[];for(let lr of qi){let hr=lr.x+Hn.x,Tr=lr.y+Hn.y,ns=_n[0]*hr+_n[4]*Tr+_n[12],Hi=_n[1]*hr+_n[5]*Tr+_n[13],Br=_n[2]*hr+_n[6]*Tr+_n[14],Or=_n[3]*hr+_n[7]*Tr+_n[15],Pi=ns+qn,_r=Hi+xi,Wr=Br+pi,Xi=Math.max(Or+hi,1e-5),Lr=ns+Xn,Ms=Hi+Gi,is=Br+ti,rs=Math.max(Or+bi,1e-5);ar.push(new Bd(Pi/Xi,_r/Xi,Wr/Xi)),ir.push(new Bd(Lr/rs,Ms/rs,is/rs))}Ln.push(ar),fn.push(ir)}return[Ln,fn]}(We,He,pt,ht,At)}(g,u,U,O,C,y,_e,V,J,g.center.lat,o.tileID.canonical),Le=o.queryGeometry;return function(Ve,We,He){let pt=1/0;bE(He,We)&&(pt=YE(He,We[0]));for(let ht=0;ht<We.length;ht++){let At=We[ht],Kt=Ve[ht];for(let vt=0;vt<At.length-1;vt++){let Mt=At[vt],kt=[Mt,At[vt+1],Kt[vt+1],Kt[vt],Mt];xE(He,kt)&&(pt=Math.min(pt,YE(He,kt)))}}return pt!==1/0&&pt}(ke,Ge,Le.isPointQuery()?Le.screenBounds:Le.screenGeometry)}},line:class extends da{constructor(o){super(o,$E),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){let n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof fp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,n){super.recalculate(o,n),this.paint._values["line-floorwidth"]=QE.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new hy(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new wc(this,o)}queryRadius(o){let n=o,a=eS(zd("line-width",this,n),zd("line-gap-width",this,n)),u=zd("line-offset",this,n);return a/2+Math.abs(u)+ty(this.paint.get("line-translate"))}queryIntersectsFeature(o,n,a,u,f,g){if(o.queryGeometry.isAboveHorizon)return!1;let y=SE(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),T=o.pixelToTileUnitsFactor/2*eS(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),M=this.paint.get("line-offset").evaluate(n,a);return M&&(u=function(C,O){let U=[],V=new G(0,0);for(let q=0;q<C.length;q++){let J=C[q],ie=[];for(let _e=0;_e<J.length;_e++){let ke=J[_e-1],Ge=J[_e],Le=J[_e+1],Ve=_e===0?V:Ge.sub(ke)._unit()._perp(),We=_e===J.length-1?V:Le.sub(Ge)._unit()._perp(),He=Ve._add(We)._unit();He._mult(1/(He.x*We.x+He.y*We.y)),ie.push(He._mult(O)._add(Ge))}U.push(ie)}return U}(u,M*o.pixelToTileUnitsFactor)),function(C,O,U){for(let V=0;V<O.length;V++){let q=O[V];if(C.length>=3){for(let J=0;J<q.length;J++)if(Ju(C,q[J]))return!0}if(KD(C,q,U))return!0}return!1}(y,u,T)}isTileClipped(){return!0}},symbol:Ey,background:class extends da{constructor(o){super(o,FP)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends da{constructor(o){super(o,BP)}getProgramIds(){return["raster"]}},sky:class extends da{constructor(o){super(o,VP),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vx({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let n=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(o,n){if(this.paint.get("sky-type")==="atmosphere"){let u=this.paint.get("sky-atmosphere-sun"),f=!u,g=o.style.light,y=g.properties.get("position");return f&&g.properties.get("anchor")==="viewport"&&nt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?Ux(y.azimuthal,90-y.polar,n):Ux(u[0],90-u[1],n)}let a=this.paint.get("sky-gradient-center");return Ux(a[0],90-a[1],n)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}}};class ym{constructor(n,a,u,f){this.context=n,this.format=u,this.texture=n.gl.createTexture(),this.update(a,f)}update(n,a,u){let{width:f,height:g}=n,{context:y}=this,{gl:T}=y,{HTMLImageElement:M,HTMLCanvasElement:C,HTMLVideoElement:O,ImageData:U,ImageBitmap:V}=x;if(T.bindTexture(T.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!a||a.premultiply!==!1)),u||this.size&&this.size[0]===f&&this.size[1]===g){let{x:q,y:J}=u||{x:0,y:0};n instanceof M||n instanceof C||n instanceof O||n instanceof U||V&&n instanceof V?T.texSubImage2D(T.TEXTURE_2D,0,q,J,T.RGBA,T.UNSIGNED_BYTE,n):T.texSubImage2D(T.TEXTURE_2D,0,q,J,f,g,T.RGBA,T.UNSIGNED_BYTE,n.data)}else this.size=[f,g],n instanceof M||n instanceof C||n instanceof O||n instanceof U||V&&n instanceof V?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,n):T.texImage2D(T.TEXTURE_2D,0,this.format,f,g,0,this.format,T.UNSIGNED_BYTE,n.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&T.generateMipmap(T.TEXTURE_2D)}bind(n,a){let{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?n===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:n),this.filter=n),a!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class HP{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class jP{constructor(){this.tasks={},this.taskQueue=[],Qe(["process"],this),this.invoker=new HP(this.process),this.nextId=0}add(n,a){let u=this.nextId++,f=function({type:g,isSymbolTile:y,zoom:T}){return T=T||0,g==="message"?0:g!=="maybePrepare"||y?g!=="parseTile"||y?g==="parseTile"&&y?300-T:g==="maybePrepare"&&y?400-T:500:200-T:100-T}(a);if(f===0){ut();try{n()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:n,metadata:a,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){ut();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;let n=this.pick();if(n===null)return;let a=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let n=null,a=1/0;for(let f=0;f<this.taskQueue.length;f++){let g=this.tasks[this.taskQueue[f]];g.priority<a&&(a=g.priority,n=f)}if(n===null)return null;let u=this.taskQueue[n];return this.taskQueue.splice(n,1),u}remove(){this.invoker.remove()}}class zS{constructor(n){this._stringToNumber={},this._numberToString=[];for(let a=0;a<n.length;a++){let u=n[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}let WP=["tile","layer","source","sourceLayer","state"];class OS{constructor(n,a,u,f,g){this.type="Feature",this._vectorTileFeature=n,this._z=a,this._x=u,this._y=f,this.properties=n.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){let n={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(n.id=this.id);for(let a of WP)this[a]!==void 0&&(n[a]=this[a]);return n}}let Go=32,Wa=33,Mc=new Uint16Array(8184);for(let o=0;o<2046;o++){let n=o+2,a=0,u=0,f=0,g=0,y=0,T=0;for(1&n?f=g=y=Go:a=u=T=Go;(n>>=1)>1;){let C=a+f>>1,O=u+g>>1;1&n?(f=a,g=u,a=y,u=T):(a=f,u=g,f=y,g=T),y=C,T=O}let M=4*o;Mc[M+0]=a,Mc[M+1]=u,Mc[M+2]=f,Mc[M+3]=g}let qa=new Uint16Array(2178),Ic=new Uint8Array(1089),Sy=new Uint16Array(1089);function NS(o){return o===0?-.03125:o===32?.03125:0}var FS=Fn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let BS={type:2,extent:Zn,loadGeometry:()=>[[new G(0,0),new G(8193,0),new G(8193,8193),new G(0,8193),new G(0,0)]]};class Vx{constructor(n,a,u,f,g){this.tileID=n,this.uid=pe(),this.uses=0,this.tileSize=a,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(n){let a=n+this.timeAdded;a<$n.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Qu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,u){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(f,g){let y={};if(!g)return y;for(let T of f){let M=T.layerIds.map(C=>g.getLayer(C)).filter(Boolean);if(M.length!==0){T.layers=M,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(C=>M.filter(O=>O.id===C)[0]));for(let C of M)y[C.id]=T}}return y}(n.buckets,a.style),this.hasSymbolBuckets=!1;for(let f in this.buckets){let g=this.buckets[f];if(g instanceof Ac){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let f in this.buckets){let g=this.buckets[f];if(g instanceof Ac&&g.hasRTLText){this.hasRTLText=!0,$e.isLoading()||$e.isLoaded()||Ze()!=="deferred"||je();break}}this.queryPadding=0;for(let f in this.buckets){let g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(g))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas)}else this.collisionBoxArray=new Zv}unloadVectorData(){if(this.hasData()){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.id]}upload(n){for(let u in this.buckets){let f=this.buckets[u];f.uploadPending()&&f.upload(n)}let a=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ym(n,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ym(n,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ym(n,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,a,u,f,g,y,T,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:T,transform:y,params:g,tileTransform:this.tileTransform},n,a,u):{}}querySourceFeatures(n,a){let u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;let f=u.loadVTLayers(),g=a?a.sourceLayer:"",y=f._geojsonTileLayer||f[g];if(!y)return;let T=yd(a&&a.filter),{z:M,x:C,y:O}=this.tileID.canonical,U={z:M,x:C,y:O};for(let V=0;V<y.length;V++){let q=y.feature(V);if(T.needGeometry){let _e=Yu(q,!0);if(!T.filter(new it(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!T.filter(new it(this.tileID.overscaledZ),q))continue;let J=u.getId(q,g),ie=new OS(q,M,C,O,J);ie.tile=U,n.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){let a=this.expirationTime;if(n.cacheControl){let u=Ot(n.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){let u=Date.now(),f=!1;if(this.expirationTime>u)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{let g=this.expirationTime-a;g?this.expirationTime=u+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0||!a)return;let u=this.latestFeatureIndex.loadVTLayers(),f=a.style.listImages();for(let g in this.buckets){if(!a.style.hasLayer(g))continue;let y=this.buckets[g],T=y.layers[0].sourceLayer||"_geojsonTileLayer",M=u[T],C=n[T];if(!M||!C||Object.keys(C).length===0)continue;if(y.update(C,M,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof hy||y instanceof oy){let U=a.style._getSourceCache(y.layers[0].source);a._terrain&&a._terrain.enabled&&U&&y.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(U.id,this.tileID)}let O=a&&a.style&&a.style.getLayer(g);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<$n.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=$n.now()+n}setTexture(n,a){let u=a.context,f=u.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture?this.texture.update(n,{useMipmap:!0}):(this.texture=new ym(u,n,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(n,a){let u={};for(let f of a)u[f]=!0;this.dependencies[n]=u}hasDependency(n,a){for(let u of n){let f=this.dependencies[u];if(f){for(let g of a)if(f[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;let u=El(BS,this.tileID.canonical,this.tileTransform)[0],f=new Bn,g=new Ba;for(let y=0;y<u.length;y++){let{x:T,y:M}=u[y];f.emplaceBack(T,M),g.emplaceBack(y)}g.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(g),this._tileDebugBuffer=n.createVertexBuffer(f,Yp.members),this._tileDebugSegments=kr.simpleSegment(0,0,f.length,g.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;let u=El(BS,this.tileID.canonical,this.tileTransform)[0],f,g;if(this.isRaster){let y=function(T,M){let C=Qu(T,M),O=Math.pow(2,T.z);for(let _e=0;_e<Wa;_e++)for(let ke=0;ke<Wa;ke++){let Ge=Io((T.x+(ke+NS(ke))/Go)/O),Le=gs((T.y+(_e+NS(_e))/Go)/O),Ve=M.project(Ge,Le),We=_e*Wa+ke;qa[2*We+0]=Math.round((Ve.x*C.scale-C.x)*Zn),qa[2*We+1]=Math.round((Ve.y*C.scale-C.y)*Zn)}Ic.fill(0),Sy.fill(0);for(let _e=2045;_e>=0;_e--){let ke=4*_e,Ge=Mc[ke+0],Le=Mc[ke+1],Ve=Mc[ke+2],We=Mc[ke+3],He=Ge+Ve>>1,pt=Le+We>>1,ht=He+pt-Le,At=pt+Ge-He,Kt=Le*Wa+Ge,vt=We*Wa+Ve,Mt=pt*Wa+He,kt=Math.hypot((qa[2*Kt+0]+qa[2*vt+0])/2-qa[2*Mt+0],(qa[2*Kt+1]+qa[2*vt+1])/2-qa[2*Mt+1])>=16;if(Ic[Mt]=Ic[Mt]||(kt?1:0),_e<1022){let Vt=(Le+At>>1)*Wa+(Ge+ht>>1),Yt=(We+At>>1)*Wa+(Ve+ht>>1);Ic[Mt]=Ic[Mt]||Ic[Vt]||Ic[Yt]}}let U=new Wi,V=new ms,q=0;function J(_e,ke){let Ge=ke*Wa+_e;return Sy[Ge]===0&&(U.emplaceBack(qa[2*Ge+0],qa[2*Ge+1],_e*Zn/Go,ke*Zn/Go),Sy[Ge]=++q),Sy[Ge]-1}function ie(_e,ke,Ge,Le,Ve,We){let He=_e+Ge>>1,pt=ke+Le>>1;if(Math.abs(_e-Ve)+Math.abs(ke-We)>1&&Ic[pt*Wa+He])ie(Ve,We,_e,ke,He,pt),ie(Ge,Le,Ve,We,He,pt);else{let ht=J(_e,ke),At=J(Ge,Le),Kt=J(Ve,We);V.emplaceBack(ht,At,Kt)}}return ie(0,0,Go,Go,Go,0),ie(Go,Go,0,0,0,Go),{vertices:U,indices:V}}(this.tileID.canonical,a);f=y.vertices,g=y.indices}else{f=new Wi,g=new ms;for(let{x:T,y:M}of u)f.emplaceBack(T,M,0,0);let y=Od(f.int16,void 0,4);for(let T=0;T<y.length;T+=3)g.emplaceBack(y[T],y[T+1],y[T+2])}this._tileBoundsBuffer=n.createVertexBuffer(f,FS.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(g),this._tileBoundsSegments=kr.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugBuffers(n,a){let u=a.projection;if(!u||u.name!=="globe"||a.freezeTileCoverage)return;let f=this.tileID.canonical,g=Qp(cE(f,a)),y=Pd(a.zoom),T;y>0&&(T=Qv(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,f,a,g,T,y),this._makeGlobeTileDebugTextBuffer(n,f,a,g,T,y)}_globePoint(n,a,u,f,g,y,T){let M=$p(n,a,u);if(y){let C=1<<u.z,O=Ga(f.center.lng),U=Ha(f.center.lat),V=(u.x+.5)/C-O,q=0;V>.5?q=-1:V<-.5&&(q=1);let J=(n/Zn+u.x)/C+q,ie=(a/Zn+u.y)/C;J=(J-O)*f._pixelsPerMercatorPixel+O,ie=(ie-U)*f._pixelsPerMercatorPixel+U;let _e=[J*f.worldSize,ie*f.worldSize,0];Cr(_e,_e,y),M=Ku(M,_e,T)}return Cr(M,M,g)}_makeGlobeTileDebugBorderBuffer(n,a,u,f,g,y){let T=new Bn,M=new Ba,C=new Fi,O=(V,q,J,ie,_e)=>{let ke=(J-V)/(_e-1),Ge=(ie-q)/(_e-1),Le=T.length;for(let Ve=0;Ve<_e;Ve++){let We=V+Ve*ke,He=q+Ve*Ge;T.emplaceBack(We,He);let pt=this._globePoint(We,He,a,u,f,g,y);C.emplaceBack(pt[0],pt[1],pt[2]),M.emplaceBack(Le+Ve)}},U=Zn;O(0,0,U,0,16),O(U,0,U,U,16),O(U,U,0,U,16),O(0,U,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(M),this._tileDebugBuffer=n.createVertexBuffer(T,Yp.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(C,aE.members),this._tileDebugSegments=kr.simpleSegment(0,0,T.length,M.length)}_makeGlobeTileDebugTextBuffer(n,a,u,f,g,y){let T=new Bn,M=new ms,C=new Fi,O=25;M.reserve(32),T.reserve(O),C.reserve(O);let U=(V,q)=>O*V+q;for(let V=0;V<O;V++){let q=2048*V;for(let J=0;J<O;J++){let ie=2048*J;T.emplaceBack(ie,q);let _e=this._globePoint(ie,q,a,u,f,g,y);C.emplaceBack(_e[0],_e[1],_e[2])}}for(let V=0;V<4;V++)for(let q=0;q<4;q++){let J=U(V,q),ie=U(V,q+1),_e=U(V+1,q),ke=U(V+1,q+1);M.emplaceBack(J,ie,_e),M.emplaceBack(_e,ie,ke)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(M),this._tileDebugTextBuffer=n.createVertexBuffer(T,Yp.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(C,aE.members),this._tileDebugTextSegments=kr.simpleSegment(0,0,O,32)}}class qP{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,u){let f=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][f]=this.stateChanges[n][f]||{},De(this.stateChanges[n][f],u),this.deletedStates[n]===null){this.deletedStates[n]={};for(let g in this.state[n])g!==f&&(this.deletedStates[n][g]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][f]===null){this.deletedStates[n][f]={};for(let g in this.state[n][f])u[g]||(this.deletedStates[n][f][g]=null)}else for(let g in u)this.deletedStates[n]&&this.deletedStates[n][f]&&this.deletedStates[n][f][g]===null&&delete this.deletedStates[n][f][g]}removeFeatureState(n,a,u){if(this.deletedStates[n]===null)return;let f=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},u&&a!==void 0)this.deletedStates[n][f]!==null&&(this.deletedStates[n][f]=this.deletedStates[n][f]||{},this.deletedStates[n][f][u]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][f])for(u in this.deletedStates[n][f]={},this.stateChanges[n][f])this.deletedStates[n][f][u]=null;else this.deletedStates[n][f]=null;else this.deletedStates[n]=null}getState(n,a){let u=String(a),f=De({},(this.state[n]||{})[u],(this.stateChanges[n]||{})[u]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){let g=this.deletedStates[n][a];if(g===null)return{};for(let y in g)delete f[y]}return f}initializeTileState(n,a){n.setFeatureState(this.state,a)}coalesceChanges(n,a){let u={};for(let f in this.stateChanges){this.state[f]=this.state[f]||{};let g={};for(let y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),De(this.state[f][y],this.stateChanges[f][y]),g[y]=this.state[f][y];u[f]=g}for(let f in this.deletedStates){this.state[f]=this.state[f]||{};let g={};if(this.deletedStates[f]===null)for(let y in this.state[f])g[y]={},this.state[f][y]={};else for(let y in this.deletedStates[f]){if(this.deletedStates[f][y]===null)this.state[f][y]={};else if(this.state[f][y])for(let T of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][T];g[y]=this.state[f][y]}u[f]=u[f]||{},De(u[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(let f in n)n[f].setFeatureState(u,a)}}class US{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,a){let u=this.toIdx(n,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(n,a){return this.leaves[this.toIdx(n,a)]}toIdx(n,a){return a*this.size+n}}function VS(o,n,a,u){let f=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(a[y]<o[y]||a[y]>n[y])return null}else{let T=1/u[y],M=(o[y]-a[y])*T,C=(n[y]-a[y])*T;if(M>C){let O=M;M=C,C=O}if(M>f&&(f=M),C<g&&(g=C),f>g)return null}return f}function GS(o,n,a,u,f,g,y,T,M,C,O){let U=u-o,V=f-n,q=g-a,J=y-o,ie=T-n,_e=M-a,ke=O[1]*_e-O[2]*ie,Ge=O[2]*J-O[0]*_e,Le=O[0]*ie-O[1]*J,Ve=U*ke+V*Ge+q*Le;if(Math.abs(Ve)<1e-15)return null;let We=1/Ve,He=C[0]-o,pt=C[1]-n,ht=C[2]-a,At=(He*ke+pt*Ge+ht*Le)*We;if(At<0||At>1)return null;let Kt=pt*q-ht*V,vt=ht*U-He*q,Mt=He*V-pt*U,kt=(O[0]*Kt+O[1]*vt+O[2]*Mt)*We;return kt<0||At+kt>1?null:(J*Kt+ie*vt+_e*Mt)*We}function HS(o,n,a){return(o-n)/(a-n)}function jS(o,n,a,u,f,g,y,T,M){let C=1<<a,O=g-u,U=y-f,V=(o+1)/C*O+u,q=(n+0)/C*U+f,J=(n+1)/C*U+f;T[0]=(o+0)/C*O+u,T[1]=q,M[0]=V,M[1]=J}class WS{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let a=function(g){let y=Math.ceil(Math.log2(g.dim/8)),T=[],M=Math.ceil(Math.pow(2,y)),C=1/M,O=(q,J,ie,_e,ke)=>{let Ge=_e?1:0,Le=(q+1)*ie-Ge,Ve=J*ie,We=(J+1)*ie-Ge;ke[0]=q*ie,ke[1]=Ve,ke[2]=Le,ke[3]=We},U=new US(M),V=[];for(let q=0;q<M*M;q++){O(q%M,Math.floor(q/M),C,!1,V);let J=Cc(V[0],V[1],g),ie=Cc(V[2],V[1],g),_e=Cc(V[2],V[3],g),ke=Cc(V[0],V[3],g);U.minimums.push(Math.min(J,ie,_e,ke)),U.maximums.push(Math.max(J,ie,_e,ke)),U.leaves.push(1)}for(T.push(U),M/=2;M>=1;M/=2){let q=T[T.length-1];U=new US(M);for(let J=0;J<M*M;J++){O(J%M,Math.floor(J/M),2,!0,V);let ie=q.getElevation(V[0],V[1]),_e=q.getElevation(V[2],V[1]),ke=q.getElevation(V[2],V[3]),Ge=q.getElevation(V[0],V[3]),Le=q.isLeaf(V[0],V[1]),Ve=q.isLeaf(V[2],V[1]),We=q.isLeaf(V[2],V[3]),He=q.isLeaf(V[0],V[3]),pt=Math.min(ie.min,_e.min,ke.min,Ge.min),ht=Math.max(ie.max,_e.max,ke.max,Ge.max),At=Le&&Ve&&We&&He;U.maximums.push(ht),U.minimums.push(pt),U.leaves.push(ht-pt<=5&&At?1:0)}T.push(U)}return T}(this.dem),u=a.length-1,f=a[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(n,a,u,f,g,y,T=1){return VS([n,a,-100],[u,f,this.maximums[0]*T],g,y)}raycast(n,a,u,f,g,y,T=1){if(!this.nodeCount)return null;let M=this.raycastRoot(n,a,u,f,g,y,T);if(M==null)return null;let C=[],O=[],U=[],V=[],q=[{idx:0,t:M,nodex:0,nodey:0,depth:0}];for(;q.length>0;){let{idx:J,t:ie,nodex:_e,nodey:ke,depth:Ge}=q.pop();if(this.leaves[J]){jS(_e,ke,Ge,n,a,u,f,U,V);let Ve=1<<Ge,We=(_e+0)/Ve,He=(_e+1)/Ve,pt=(ke+0)/Ve,ht=(ke+1)/Ve,At=Cc(We,pt,this.dem)*T,Kt=Cc(He,pt,this.dem)*T,vt=Cc(He,ht,this.dem)*T,Mt=Cc(We,ht,this.dem)*T,kt=GS(U[0],U[1],At,V[0],U[1],Kt,V[0],V[1],vt,g,y),Vt=GS(V[0],V[1],vt,U[0],V[1],Mt,U[0],U[1],At,g,y),Yt=Math.min(kt!==null?kt:Number.MAX_VALUE,Vt!==null?Vt:Number.MAX_VALUE);if(Yt!==Number.MAX_VALUE)return Yt;{let wt=Zp([],g,y,ie);if(qS(At,Kt,Mt,vt,HS(wt[0],U[0],V[0]),HS(wt[1],U[1],V[1]))>=wt[2])return ie}continue}let Le=0;for(let Ve=0;Ve<this._siblingOffset.length;Ve++){jS((_e<<1)+this._siblingOffset[Ve][0],(ke<<1)+this._siblingOffset[Ve][1],Ge+1,n,a,u,f,U,V),U[2]=-100,V[2]=this.maximums[this.childOffsets[J]+Ve]*T;let We=VS(U,V,g,y);if(We!=null){let He=We;C[Ve]=He;let pt=!1;for(let ht=0;ht<Le&&!pt;ht++)He>=C[O[ht]]&&(O.splice(ht,0,Ve),pt=!0);pt||(O[Le]=Ve),Le++}}for(let Ve=0;Ve<Le;Ve++){let We=O[Ve];q.push({idx:this.childOffsets[J]+We,t:C[We],nodex:(_e<<1)+this._siblingOffset[We][0],nodey:(ke<<1)+this._siblingOffset[We][1],depth:Ge+1})}}return null}_addNode(n,a,u){return this.minimums.push(n),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(n,a,u,f,g){if(n[f].isLeaf(a,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);let y=f-1,T=n[y],M=0,C=0;for(let O=0;O<this._siblingOffset.length;O++){let U=2*a+this._siblingOffset[O][0],V=2*u+this._siblingOffset[O][1],q=T.getElevation(U,V),J=T.isLeaf(U,V),ie=this._addNode(q.min,q.max,J);J&&(M|=1<<O),C||(C=ie)}for(let O=0;O<this._siblingOffset.length;O++)M&1<<O||this._construct(n,2*a+this._siblingOffset[O][0],2*u+this._siblingOffset[O][1],y,C+O)}}function qS(o,n,a,u,f,g){return Li(Li(o,a,g),Li(n,u,g),f)}function Cc(o,n,a){let u=a.dim,f=re(o*u-.5,0,u-1),g=re(n*u-.5,0,u-1),y=Math.floor(f),T=Math.floor(g),M=Math.min(y+1,u-1),C=Math.min(T+1,u-1);return qS(a.get(y,T),a.get(M,T),a.get(y,C),a.get(M,C),f-y,g-T)}let XS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ay{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,a,u,f=!1,g=!1){if(this.uid=n,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return nt(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;let y=this.dim=a.height-2,T=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let M=0;M<y;M++)T[this._idx(-1,M)]=T[this._idx(0,M)],T[this._idx(y,M)]=T[this._idx(y-1,M)],T[this._idx(M,-1)]=T[this._idx(M,0)],T[this._idx(M,y)]=T[this._idx(M,y-1)];T[this._idx(-1,-1)]=T[this._idx(0,0)],T[this._idx(y,-1)]=T[this._idx(y-1,0)],T[this._idx(-1,y)]=T[this._idx(0,y-1)],T[this._idx(y,y)]=T[this._idx(y-1,y-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new WS(this)}get(n,a,u=!1){u&&(n=re(n,-1,this.dim),a=re(a,-1,this.dim));let f=4*this._idx(n,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(n){return XS[n]}get unpackVector(){return XS[this.encoding]}_idx(n,a){if(n<-1||n>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(n+1)}_unpackMapbox(n,a,u){return(256*n*256+256*a+u)/10-1e4}_unpackTerrarium(n,a,u){return 256*n+a+u/256-32768}static pack(n,a){let u=[0,0,0,0],f=Ay.getUnpackVector(a),g=Math.floor((n+f[3])/f[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new co({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,a,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let f=a*this.dim,g=a*this.dim+this.dim,y=u*this.dim,T=u*this.dim+this.dim;switch(a){case-1:f=g-1;break;case 1:g=f+1}switch(u){case-1:y=T-1;break;case 1:T=y+1}let M=-a*this.dim,C=-u*this.dim;for(let O=y;O<T;O++)for(let U=f;U<g;U++){let V=4*this._idx(U,O),q=4*this._idx(U+M,O+C);this.pixels[V+0]=n.pixels[q+0],this.pixels[V+1]=n.pixels[q+1],this.pixels[V+2]=n.pixels[q+2],this.pixels[V+3]=n.pixels[q+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Sn(Ay,"DEMData"),Sn(WS,"DemMinMaxQuadTree",{omit:["dem"]});class XP{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(let n in this.data)for(let a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,u){let f=n.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);let g={value:a,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(n,g)},u)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){let y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){let a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){let a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;let u=n.wrapped().key,f=a===void 0?0:this.data[u].indexOf(a),g=this.data[u][f];return this.data[u].splice(f,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){let a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){let a=[];for(let u in this.data)for(let f of this.data[u])n(f.value)||a.push(f);for(let u of a)this.remove(u.value.tileID,u)}}class Xd{constructor(n,a,u){this.func=n,this.mask=a,this.range=u}}Xd.ReadOnly=!1,Xd.ReadWrite=!0,Xd.disabled=new Xd(519,Xd.ReadOnly,[0,1]);let Gx=7680;class Hx{constructor(n,a,u,f,g,y){this.test=n,this.ref=a,this.mask=u,this.fail=f,this.depthFail=g,this.pass=y}}Hx.disabled=new Hx({func:519,mask:0},0,0,Gx,Gx,Gx);class Xa{constructor(n,a,u){this.blendFunction=n,this.blendColor=a,this.mask=u}}Xa.Replace=[1,0],Xa.disabled=new Xa(Xa.Replace,Vi.transparent,[!1,!1,!1,!1]),Xa.unblended=new Xa(Xa.Replace,Vi.transparent,[!0,!0,!0,!0]),Xa.alphaBlended=new Xa([1,771],Vi.transparent,[!0,!0,!0,!0]);let jx=1029,Wx=2305;class ga{constructor(n,a,u){this.enable=n,this.mode=a,this.frontFace=u}}ga.disabled=new ga(!1,jx,Wx),ga.backCCW=new ga(!0,jx,Wx),ga.backCW=new ga(!0,jx,2304),ga.frontCW=new ga(!0,1028,2304),ga.frontCCW=new ga(!0,1028,Wx);class eh extends Fr{constructor(n,a,u){super(),this.id=n,this._onlySymbols=u,a.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new XP(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new qP,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let n in this._tiles){let a=this._tiles[n];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let a in this._tiles){let u=this._tiles[a];u.upload(n),u.prepare(this.map.style.imageManager)}}getIds(){return xe(this._tiles).map(n=>n.tileID).sort(ZS).map(n=>n.key)}getRenderableIds(n){let a=[];for(let u in this._tiles)this._isIdRenderable(+u,n)&&a.push(this._tiles[u]);return n?a.sort((u,f)=>{let g=u.tileID,y=f.tileID,T=new G(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),M=new G(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-y.overscaledZ||M.y-T.y||M.x-T.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(ZS).map(u=>u.key)}hasRenderableParent(n){let a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){let u=this._tiles[n];u&&(u.state!=="loading"&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,n,a)))}_tileLoaded(n,a,u,f){if(f)if(n.state="errored",f.status!==404)this._source.fire(new Rr(f,{tile:n}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else n.timeAdded=$n.now(),u==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new Qn("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){let a=this.getRenderableIds();for(let f=0;f<a.length;f++){let g=a[f];if(n.neighboringTiles&&n.neighboringTiles[g]){let y=this.getTileByID(g);u(n,y),u(y,n)}}function u(f,g){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=g.tileID.canonical.x-f.tileID.canonical.x,T=g.tileID.canonical.y-f.tileID.canonical.y,M=Math.pow(2,f.tileID.canonical.z),C=g.tileID.key;y===0&&T===0||Math.abs(T)>1||(Math.abs(y)>1&&(Math.abs(y+M)===1?y+=M:Math.abs(y-M)===1&&(y-=M)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,y,T),f.neighboringTiles&&f.neighboringTiles[C]&&(f.neighboringTiles[C].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,u,f){for(let g in this._tiles){let y=this._tiles[g];if(f[g]||!y.hasData()||y.tileID.overscaledZ<=a||y.tileID.overscaledZ>u)continue;let T=y.tileID;for(;y&&y.tileID.overscaledZ>a+1;){let C=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[C.key],y&&y.hasData()&&(T=C)}let M=T;for(;M.overscaledZ>a;)if(M=M.scaledTo(M.overscaledZ-1),n[M.key]){f[T.key]=T;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){let u=this._loadedParentTiles[n.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=n.overscaledZ-1;u>=a;u--){let f=n.scaledTo(u),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(n){let a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;let u=Math.ceil(n.width/a)+1,f=Math.ceil(n.height/a)+1,g=Math.floor(u*f*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(T)}handleWrapJump(n){let a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){let u={};for(let f in this._tiles){let g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),u[g.tileID.key]=g}this._tiles=u;for(let f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(let f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(n,a,u){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new Us(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(f=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(T=>this._source.hasTile(T)))):f=[];let g=this._updateRetainedTiles(f);if(KS(this._source.type)&&f.length!==0){let T={},M={},C=Object.keys(g);for(let U of C){let V=g[U],q=this._tiles[U];if(!q||q.fadeEndTime&&q.fadeEndTime<=$n.now())continue;let J=this.findLoadedParent(V,Math.max(V.overscaledZ-eh.maxOverzooming,this._source.minzoom));J&&(this._addTile(J.tileID),T[J.tileID.key]=J.tileID),M[U]=V}let O=f[f.length-1].overscaledZ;for(let U in this._tiles){let V=this._tiles[U];if(g[U]||!V.hasData())continue;let q=V.tileID;for(;q.overscaledZ>O;){q=q.scaledTo(q.overscaledZ-1);let J=this._tiles[q.key];if(J&&J.hasData()&&M[q.key]){g[U]=V.tileID;break}}}for(let U in T)g[U]||(this._coveredTiles[U]=!0,g[U]=T[U])}for(let T in g)this._tiles[T].clearFadeHold();let y=function(T,M){let C=[];for(let O in T)O in M||C.push(O);return C}(this._tiles,g);for(let T of y){let M=this._tiles[T];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(+T)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){let a={};if(n.length===0)return a;let u={},f=n.reduce((C,O)=>Math.min(C,O.overscaledZ),1/0),g=n[0].overscaledZ,y=Math.max(g-eh.maxOverzooming,this._source.minzoom),T=Math.max(g+eh.maxUnderzooming,this._source.minzoom),M={};for(let C of n){let O=this._addTile(C);a[C.key]=C,O.hasData()||f<this._source.maxzoom&&(M[C.key]=C)}this._retainLoadedChildren(M,f,T,a);for(let C of n){let O=this._tiles[C.key];if(O.hasData())continue;if(C.canonical.z>=this._source.maxzoom){let V=C.children(this._source.maxzoom)[0],q=this.getTile(V);if(q&&q.hasData()){a[V.key]=V;continue}}else{let V=C.children(this._source.maxzoom);if(a[V[0].key]&&a[V[1].key]&&a[V[2].key]&&a[V[3].key])continue}let U=O.wasRequested();for(let V=C.overscaledZ-1;V>=y;--V){let q=C.scaledTo(V);if(u[q.key]||(u[q.key]=!0,O=this.getTile(q),!O&&U&&(O=this._addTile(q)),O&&(a[q.key]=q,U=O.wasRequested(),O.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let n in this._tiles){let a=[],u,f=this._tiles[n].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}a.push(f.key);let g=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;f=g}for(let g of a)this._loadedParentTiles[g]=u}}_addTile(n){let a=this._tiles[n.key];if(a)return a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));let u=Boolean(a);if(!u){let f=this.map?this.map.painter:null;a=new Vx(n,this._source.tileSize*n.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a?(a.uses++,this._tiles[n.key]=a,u||this._source.fire(new Qn("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);let u=a.getExpiryTimeout();u&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},u))}_removeTile(n){let a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,u){let f=[],g=this.transform;if(!g)return f;let y=g.projection.name==="globe",T=Ga(g.center.lng);for(let M in this._tiles){let C=this._tiles[M];if(u&&C.clearQueryDebugViz(),C.holdingForFade())continue;let O;if(y){let U=C.tileID.canonical;if(U.z===0){let V=[Math.abs(re(T,...vm(U,-1))-T),Math.abs(re(T,...vm(U,1))-T)];O=[0,2*V.indexOf(Math.min(...V))-1]}else{let V=[Math.abs(re(T,...vm(U,-1))-T),Math.abs(re(T,...vm(U,0))-T),Math.abs(re(T,...vm(U,1))-T)];O=[V.indexOf(Math.min(...V))-1]}}else O=[0];for(let U of O){let V=n.containsTile(C,g,a,U);V&&f.push(V)}}return f}getVisibleCoordinates(n){let a=this.getRenderableIds(n).map(u=>this._tiles[u].tileID);for(let u of a)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(KS(this._source.type))for(let n in this._tiles){let a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=$n.now())return!0}return!1}setFeatureState(n,a,u){this._state.updateState(n=n||"_geojsonTileLayer",a,u)}removeFeatureState(n,a,u){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,u)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,u){let f=this._tiles[n];f&&f.setDependencies(a,u)}reloadTilesForDependencies(n,a){for(let u in this._tiles)this._tiles[u].hasDependency(n,a)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(n,a))}_preloadTiles(n,a){let u=new Map,f=Array.isArray(n)?n:[n],g=this.map.painter.terrain,y=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(let T of f){let M=T.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let C of M)u.set(C.key,C);this.usedForTerrain&&T.updateElevation(!1)}de(Array.from(u.values()),(T,M)=>{let C=new Vx(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(C,O=>{this._source.type==="raster-dem"&&C.dem&&this._backfillDEM(C),M(O,C)})},a)}}function ZS(o,n){let a=Math.abs(2*o.wrap)-+(o.wrap<0),u=Math.abs(2*n.wrap)-+(n.wrap<0);return o.overscaledZ-n.overscaledZ||u-a||n.canonical.y-o.canonical.y||n.canonical.x-o.canonical.x}function KS(o){return o==="raster"||o==="image"||o==="video"||o==="custom"}function vm(o,n){let a=1<<o.z;return[o.x/a+n,(o.x+1)/a+n]}eh.maxOverzooming=10,eh.maxUnderzooming=3;class My{constructor(n,a,u){this._demTile=n,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(n,a,u){let f=u||n.findDEMTileFor(a);if(!f||!f.dem)return;let g=f.dem,y=f.tileID,T=1<<a.canonical.z-y.canonical.z;return new My(f,f.tileSize/Zn/T,[(a.canonical.x/T-y.canonical.x)*g.dim,(a.canonical.y/T-y.canonical.y)*g.dim])}tileCoordToPixel(n,a){let u=a*this._scale+this._offset[1],f=Math.floor(n*this._scale+this._offset[0]),g=Math.floor(u);return new G(f,g)}getElevationAt(n,a,u,f){let g=n*this._scale+this._offset[0],y=a*this._scale+this._offset[1],T=Math.floor(g),M=Math.floor(y),C=this._dem;return f=!!f,u?Li(Li(C.get(T,M,f),C.get(T,M+1,f),y-M),Li(C.get(T+1,M,f),C.get(T+1,M+1,f),y-M),g-T):C.get(T,M,f)}getElevationAtPixel(n,a,u){return this._dem.get(n,a,!!u)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*ma(1,n)*this._dem.stride}}class YS{constructor(n,a){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new _c(Zn,16,0),this.featureIndexArray=new UT,this.promoteId=a}insert(n,a,u,f,g,y=0){let T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,g,y);let M=this.grid;for(let C=0;C<a.length;C++){let O=a[C],U=[1/0,1/0,-1/0,-1/0];for(let V=0;V<O.length;V++){let q=O[V];U[0]=Math.min(U[0],q.x),U[1]=Math.min(U[1],q.y),U[2]=Math.max(U[2],q.x),U[3]=Math.max(U[3],q.y)}U[0]<Zn&&U[1]<Zn&&U[2]>=0&&U[3]>=0&&M.insert(T,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ax(new hm(this.rawTileData)).layers,this.sourceLayerCoder=new zS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,a,u,f){this.loadVTLayers();let g=n.params||{},y=yd(g.filter),T=n.tileResult,M=n.transform,C=T.bufferedTilespaceBounds,O=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(J,ie,_e,ke)=>EE(T.bufferedTilespaceGeometry,J,ie,_e,ke));O.sort(ZP);let U=null;M.elevation&&O.length>0&&(U=My.create(M.elevation,this.tileID));let V={},q;for(let J=0;J<O.length;J++){let ie=O[J];if(ie===q)continue;q=ie;let _e=this.featureIndexArray.get(ie),ke=null;this.loadMatchingFeature(V,_e,y,g.layers,g.availableImages,a,u,f,(Ge,Le,Ve,We=0)=>(ke||(ke=El(Ge,this.tileID.canonical,n.tileTransform)),Le.queryIntersectsFeature(T,Ge,Ve,ke,this.z,n.transform,n.pixelPosMatrix,U,We)))}return V}loadMatchingFeature(n,a,u,f,g,y,T,M,C){let{featureIndex:O,bucketIndex:U,sourceLayerIndex:V,layoutVertexArrayOffset:q}=a,J=this.bucketLayerIDs[U];if(f&&!function(Ge,Le){for(let Ve=0;Ve<Ge.length;Ve++)if(Le.indexOf(Ge[Ve])>=0)return!0;return!1}(f,J))return;let ie=this.sourceLayerCoder.decode(V),_e=this.vtLayers[ie].feature(O);if(u.needGeometry){let Ge=Yu(_e,!0);if(!u.filter(new it(this.tileID.overscaledZ),Ge,this.tileID.canonical))return}else if(!u.filter(new it(this.tileID.overscaledZ),_e))return;let ke=this.getId(_e,ie);for(let Ge=0;Ge<J.length;Ge++){let Le=J[Ge];if(f&&f.indexOf(Le)<0)continue;let Ve=y[Le];if(!Ve)continue;let We={};ke!==void 0&&M&&(We=M.getState(Ve.sourceLayer||"_geojsonTileLayer",ke));let He=De({},T[Le]);He.paint=JS(He.paint,Ve.paint,_e,We,g),He.layout=JS(He.layout,Ve.layout,_e,We,g);let pt=!C||C(_e,Ve,We,q);if(!pt)continue;let ht=new OS(_e,this.z,this.x,this.y,ke);ht.layer=He;let At=n[Le];At===void 0&&(At=n[Le]=[]),At.push({featureIndex:O,feature:ht,intersectionZ:pt})}}lookupSymbolFeatures(n,a,u,f,g,y,T,M){let C={};this.loadVTLayers();let O=yd(g);for(let U of n)this.loadMatchingFeature(C,{bucketIndex:u,sourceLayerIndex:f,featureIndex:U,layoutVertexArrayOffset:0},O,y,T,M,a);return C}loadFeature(n){let{featureIndex:a,sourceLayerIndex:u}=n;this.loadVTLayers();let f=this.sourceLayerCoder.decode(u),g=this.vtFeatures[f];if(g[a])return g[a];let y=this.vtLayers[f].feature(a);return g[a]=y,y}hasLayer(n){for(let a of this.bucketLayerIDs)for(let u of a)if(n===u)return!0;return!1}getId(n,a){let u=n.id;if(this.promoteId){let f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[a];f!=null&&(u=n.properties[f]),typeof u=="boolean"&&(u=Number(u))}return u}}function JS(o,n,a,u,f){return Zt(o,(g,y)=>{let T=n instanceof ft?n.get(y):null;return T&&T.evaluate?T.evaluate(a,u,f):T})}function ZP(o,n){return n-o}Sn(YS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class $S{constructor(n,a){this.width=n,this.height=a,this.nextRow=0,this.image=new Sl({width:n,height:a}),this.positions={},this.uploaded=!1}getDash(n,a){let u=this.getKey(n,a);return this.positions[u]}trim(){let n=this.width,a=this.height=Ct(this.nextRow);this.image.resize({width:n,height:a})}getKey(n,a){return n.join(",")+a}getDashRanges(n,a,u){let f=[],g=n.length%2==1?-n[n.length-1]*u:0,y=n[0]*u,T=!0;f.push({left:g,right:y,isDash:T,zeroLength:n[0]===0});let M=n[0];for(let C=1;C<n.length;C++){T=!T;let O=n[C];g=M*u,M+=O,y=M*u,f.push({left:g,right:y,isDash:T,zeroLength:O===0})}return f}addRoundDash(n,a,u){let f=a/2;for(let g=-u;g<=u;g++){let y=this.width*(this.nextRow+u+g),T=0,M=n[T];for(let C=0;C<this.width;C++){C/M.right>1&&(M=n[++T]);let O=Math.abs(C-M.left),U=Math.abs(C-M.right),V=Math.min(O,U),q,J=g/u*(f+1);if(M.isDash){let ie=f-Math.abs(J);q=Math.sqrt(V*V+ie*ie)}else q=f-Math.sqrt(V*V+J*J);this.image.data[y+C]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(n,a){for(let M=n.length-1;M>=0;--M){let C=n[M],O=n[M+1];C.zeroLength?n.splice(M,1):O&&O.isDash===C.isDash&&(O.left=C.left,n.splice(M,1))}let u=n[0],f=n[n.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);let g=this.width*this.nextRow,y=0,T=n[y];for(let M=0;M<this.width;M++){M/T.right>1&&(T=n[++y]);let C=Math.abs(M-T.left),O=Math.abs(M-T.right),U=Math.min(C,O);this.image.data[g+M]=Math.max(0,Math.min(255,(T.isDash?U:-U)+a+128))}}addDash(n,a){let u=this.getKey(n,a);if(this.positions[u])return this.positions[u];let f=a==="round",g=f?7:0,y=2*g+1;if(this.nextRow+y>this.height)return nt("LineAtlas out of space"),null;n.length===0&&n.push(1);let T=0;for(let O=0;O<n.length;O++)n[O]<0&&(nt("Negative value is found in line dasharray, replacing values with 0"),n[O]=0),T+=n[O];if(T!==0){let O=this.width/T,U=this.getDashRanges(n,this.width,O);f?this.addRoundDash(U,O,g):this.addRegularDash(U,a==="square"?.5*O:0)}let M=this.nextRow+g;this.nextRow+=y;let C={tl:[M,g],br:[T,0]};return this.positions[u]=C,C}}Sn($S,"LineAtlas");class QS{constructor(n){let a={},u=[];for(let T in n){let M=n[T],C=a[T]={};for(let O in M.glyphs){let U=M.glyphs[+O];if(!U||U.bitmap.width===0||U.bitmap.height===0)continue;let V=U.metrics.localGlyph?2:1,q={x:0,y:0,w:U.bitmap.width+2*V,h:U.bitmap.height+2*V};u.push(q),C[O]=q}}let{w:f,h:g}=Cx(u),y=new Sl({width:f||1,height:g||1});for(let T in n){let M=n[T];for(let C in M.glyphs){let O=M.glyphs[+C];if(!O||O.bitmap.width===0||O.bitmap.height===0)continue;let U=a[T][C],V=O.metrics.localGlyph?2:1;Sl.copy(O.bitmap,y,{x:0,y:0},{x:U.x+V,y:U.y+V},O.bitmap)}}this.image=y,this.positions=a}}Sn(QS,"GlyphAtlas");class KP{constructor(n){this.tileID=new Us(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),this.tileZoom=n.tileZoom,this.uid=n.uid,this.zoom=n.zoom,this.canonical=n.tileID.canonical,this.pixelRatio=n.pixelRatio,this.tileSize=n.tileSize,this.source=n.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=n.showCollisionBoxes,this.collectResourceTiming=!!n.collectResourceTiming,this.returnDependencies=!!n.returnDependencies,this.promoteId=n.promoteId,this.enableTerrain=!!n.enableTerrain,this.isSymbolTile=n.isSymbolTile,this.tileTransform=Qu(n.tileID.canonical,n.projection),this.projection=n.projection}parse(n,a,u,f,g){this.status="parsing",this.data=n,this.collisionBoxArray=new Zv;let y=new zS(Object.keys(n.layers).sort()),T=new YS(this.tileID,this.promoteId);T.bucketLayerIDs=[];let M={},C=new $S(256,256),O={featureIndex:T,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:C,availableImages:u},U=a.familiesBySource[this.source];for(let We in U){let He=n.layers[We];if(!He)continue;let pt=!1,ht=!1;for(let vt of U[We])vt[0].type==="symbol"?pt=!0:ht=!0;if(this.isSymbolTile===!0&&!pt||this.isSymbolTile===!1&&!ht)continue;He.version===1&&nt(`Vector tile source "${this.source}" layer "${We}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let At=y.encode(We),Kt=[];for(let vt=0;vt<He.length;vt++){let Mt=He.feature(vt),kt=T.getId(Mt,We);Kt.push({feature:Mt,id:kt,index:vt,sourceLayerIndex:At})}for(let vt of U[We]){let Mt=vt[0];this.isSymbolTile!==void 0&&Mt.type==="symbol"!==this.isSymbolTile||Mt.minzoom&&this.zoom<Math.floor(Mt.minzoom)||Mt.maxzoom&&this.zoom>=Mt.maxzoom||Mt.visibility!=="none"&&(qx(vt,this.zoom,u),(M[Mt.id]=Mt.createBucket({index:T.bucketLayerIDs.length,layers:vt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:At,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(Kt,O,this.tileID.canonical,this.tileTransform),T.bucketLayerIDs.push(vt.map(kt=>kt.id)))}}let V,q,J,ie;C.trim();let _e={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ke=Zt(O.glyphDependencies,We=>Object.keys(We).map(Number));Object.keys(ke).length?f.send("getGlyphs",{uid:this.uid,stacks:ke},(We,He)=>{V||(V=We,q=He,Ve.call(this))},void 0,!1,_e):q={};let Ge=Object.keys(O.iconDependencies);Ge.length?f.send("getImages",{icons:Ge,source:this.source,tileID:this.tileID,type:"icons"},(We,He)=>{V||(V=We,J=He,Ve.call(this))},void 0,!1,_e):J={};let Le=Object.keys(O.patternDependencies);function Ve(){if(V)return g(V);if(q&&J&&ie){let We=new QS(q),He=new lS(J,ie);for(let pt in M){let ht=M[pt];ht instanceof Ac?(qx(ht.layers,this.zoom,u),TP(ht,q,We.positions,J,He.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):ht.hasPattern&&(ht instanceof hy||ht instanceof oy||ht instanceof am)&&(qx(ht.layers,this.zoom,u),ht.addFeatures(O,this.tileID.canonical,He.patternPositions,u,this.tileTransform))}this.status="done",g(null,{buckets:xe(M).filter(pt=>!pt.isEmpty()),featureIndex:T,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:We.image,lineAtlas:C,imageAtlas:He,glyphMap:this.returnDependencies?q:null,iconMap:this.returnDependencies?J:null,glyphPositions:this.returnDependencies?We.positions:null})}}Le.length?f.send("getImages",{icons:Le,source:this.source,tileID:this.tileID,type:"patterns"},(We,He)=>{V||(V=We,ie=He,Ve.call(this))},void 0,!1,_e):ie={},Ve.call(this)}}function qx(o,n,a){let u=new it(n);for(let f of o)f.recalculate(u,a)}class e2{constructor(n){this.entries={},this.scheduler=n}request(n,a,u,f){let g=this.entries[n]=this.entries[n]||{callbacks:[]};if(g.result){let[y,T]=g.result;return this.scheduler?this.scheduler.add(()=>{f(y,T)},a):f(y,T),()=>{}}return g.callbacks.push(f),g.cancel||(g.cancel=u((y,T)=>{g.result=[y,T];for(let M of g.callbacks)this.scheduler?this.scheduler.add(()=>{M(y,T)},a):M(y,T);setTimeout(()=>delete this.entries[n],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(y=>y!==f),g.callbacks.length||(g.cancel(),delete this.entries[n]))}}}function t2(o,n,a){let u=JSON.stringify(o.request);return o.data&&(this.deduped.entries[u]={result:[null,o.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},f=>{let g=sn(o.request,(y,T,M,C)=>{y?f(y):T&&f(null,{vectorTile:a?void 0:new Ax(new hm(T)),rawData:T,cacheControl:M,expires:C})});return()=>{g.cancel(),f()}},n)}r.ARRAY_TYPE=lo,r.AUTH_ERR_MSG=Nn,r.Aabb=Bs,r.Actor=class{constructor(o,n,a){this.target=o,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Qe(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ut()?o:x,this.scheduler=new jP}send(o,n,a,u,f=!1,g){let y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=g,this.callbacks[y]=a);let T=bn(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:o,hasCallback:!!a,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Fu(n,T)},T),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(o){let n=o.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(n.mustQueue||ut()){let u=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,n),u&&u.metadata||{type:"message"})}else this.processTask(a,n)}processTask(o,n){if(n.type==="<response>"){let a=this.callbacks[o];delete this.callbacks[o],a&&(n.error?a(Bu(n.error)):a(null,Bu(n.data)))}else{let a=bn(this.globalScope)?void 0:[],u=n.hasCallback?(g,y)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:g?Fu(g):null,data:Fu(y,a)},a)}:g=>{},f=Bu(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,f,u);else if(this.parent.getWorkerSource){let g=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,g[0],f.source)[g[1]](f,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},r.CanonicalTileID=uy,r.Color=Vi,r.ColorMode=Xa,r.CullFaceMode=ga,r.DEMData=Ay,r.DataConstantProperty=tt,r.DedupedRequest=e2,r.DepthMode=Xd,r.EXTENT=Zn,r.Elevation=class{isDataAvailableAtPoint(o){let n=this._source();if(this.isUsingMockSource()||!n||o.y<0||o.y>1)return!1;let a=n.getSource().maxzoom,u=1<<a,f=Math.floor(o.x),g=Math.floor((o.x-f)*u),y=Math.floor(o.y*u),T=this.findDEMTileFor(new Us(a,f,a,g,y));return!(!T||!T.dem)}getAtPointOrZero(o,n=0){return this.getAtPoint(o,n)||0}getAtPoint(o,n,a=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);let u=this._source();if(!u||o.y<0||o.y>1)return n;let f=u.getSource().maxzoom,g=1<<f,y=Math.floor(o.x),T=o.x-y,M=new Us(f,y,f,Math.floor(T*g),Math.floor(o.y*g)),C=this.findDEMTileFor(M);if(!C||!C.dem)return n;let O=C.dem,U=1<<C.tileID.canonical.z,V=(T*U-C.tileID.canonical.x)*O.dim,q=(o.y*U-C.tileID.canonical.y)*O.dim,J=Math.floor(V),ie=Math.floor(q);return(a?this.exaggeration():1)*Li(Li(O.get(J,ie),O.get(J,ie+1),q-ie),Li(O.get(J+1,ie),O.get(J+1,ie+1),q-ie),V-J)}getAtTileOffset(o,n,a){let u=1<<o.canonical.z;return this.getAtPointOrZero(new kd(o.wrap+(o.canonical.x+n/Zn)/u,(o.canonical.y+a/Zn)/u))}getAtTileOffsetFunc(o,n,a,u){return f=>{let g=this.getAtTileOffset(o,f.x,f.y),y=u.upVector(o.canonical,f.x,f.y);return Mo(y,y,g*u.upVectorScale(o.canonical,n,a).metersToTile),y}}getForTilePoints(o,n,a,u){if(this.isUsingMockSource())return!1;let f=My.create(this,o,u);return!!f&&(n.forEach(g=>{g[2]=this.exaggeration()*f.getElevationAt(g[0],g[1],a)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;let n=this.findDEMTileFor(o);if(!n||!n.dem)return null;let a=n.dem.tree,u=n.tileID,f=1<<o.canonical.z-u.canonical.z,g=o.canonical.x/f-u.canonical.x,y=o.canonical.y/f-u.canonical.y,T=0;for(let M=0;M<o.canonical.z-u.canonical.z&&!a.leaves[T];M++){g*=2,y*=2;let C=2*Math.floor(y)+Math.floor(g);T=a.childOffsets[T]+C,g%=1,y%=1}return{min:this.exaggeration()*a.minimums[T],max:this.exaggeration()*a.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,n,a){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},r.ErrorEvent=Rr,r.EvaluationParameters=it,r.Event=Qn,r.Evented=Fr,r.FillExtrusionBucket=am,r.Frustum=ox,r.FrustumCorners=sx,r.GLOBE_RADIUS=Ua,r.GLOBE_SCALE_MATCH_LATITUDE=45,r.GLOBE_ZOOM_THRESHOLD_MAX=6,r.GLOBE_ZOOM_THRESHOLD_MIN=5,r.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let o of this._poleSegments)o.destroy();for(let o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(let o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,n){let a=new Bn,u=new ms,f=[],g=o+1+2,y=n[0]+1,T=n[0]+1+(1+n.length),M=(C,O,U)=>{let V=C===g-1?C-2:C===0?C:C-1;return V+=U?24575:0,[V,O]};for(let C=0;C<g;++C)a.emplaceBack(...M(C,0,!0));for(let C=0;C<y;++C)for(let O=0;O<g;++O)a.emplaceBack(...M(O,C,(O===0||O===g-1)&&!0));for(let C=0;C<n.length;++C){let O=n[C];for(let U=0;U<g;++U)a.emplaceBack(...M(U,O,!0))}for(let C=0;C<n.length;++C){let O=u.length,U=n[C]+1+2,V=new ms;for(let ie=0;ie<U-1;ie++){let _e=ie===U-2,ke=_e?g*(T-n.length+C-ie):g;for(let Ge=0;Ge<g-1;Ge++){let Le=ie*g+Ge;ie===0||_e||Ge===0||Ge===g-2?(V.emplaceBack(Le+1,Le,Le+ke),V.emplaceBack(Le+ke,Le+ke+1,Le+1)):(u.emplaceBack(Le+1,Le,Le+ke),u.emplaceBack(Le+ke,Le+ke+1,Le+1))}}let q=kr.simpleSegment(0,O,a.length,u.length-O);for(let ie=0;ie<V.uint16.length;ie+=3)u.emplaceBack(V.uint16[ie],V.uint16[ie+1],V.uint16[ie+2]);let J=kr.simpleSegment(0,O,a.length,u.length-O);f.push({withoutSkirts:q,withSkirts:J})}return{vertices:a,indices:u,segments:f}}_createGrid(o){let n=this._fillGridMeshWithLods(Zu,Jp);this._gridSegments=n.segments,this._gridBuffer=o.createVertexBuffer(n.vertices,Yp.members),this._gridIndexBuffer=o.createIndexBuffer(n.indices,!0)}_createPoles(o){let n=new ms;for(let f=0;f<=Zu;f++)n.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=o.createIndexBuffer(n,!0);let a=new ao,u=new ao;this._poleSegments=[];for(let f=0,g=0;f<5;f++){let y=360/(1<<f);a.emplaceBack(0,-Ua,0,.5,0),u.emplaceBack(0,-Ua,0,.5,1);for(let T=0;T<=Zu;T++){let M=T/Zu,C=Li(0,y,M),[O,U,V]=Dd(jD,WD,C,Ua);a.emplaceBack(O,U,V,M,0),u.emplaceBack(O,U,V,M,1)}this._poleSegments.push(kr.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(a,oE,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(u,oE,!1)}getGridBuffers(o,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,n){if(!this._wireframeSegments){let a=new Fa,u=Zu,f=u+1+2,g=1;this._wireframeSegments=[];for(let y=0,T=0;y<Jp.length;y++){let M=Jp[y];for(let O=g;O<M+g;O++)for(let U=g;U<u+g;U++){let V=O*f+U;a.emplaceBack(V,V+1),a.emplaceBack(V,V+f),a.emplaceBack(V,V+f+1)}let C=M*u*3;this._wireframeSegments.push(kr.simpleSegment(0,T,(M+1)*f,C)),T+=C}this._wireframeIndexBuffer=o.createIndexBuffer(a)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[n]]}},r.GlyphManager=jd,r.ImagePosition=Lx,r.LivePerformanceUtils=rt,r.LngLat=Di,r.LngLatBounds=Tc,r.LocalGlyphMode=Px,r.MAX_MERCATOR_LATITUDE=_s,r.MercatorCoordinate=kd,r.ONE_EM=ys,r.OverscaledTileID=Us,r.PerformanceMarkers=Ke,r.Properties=jt,r.RGBAImage=co,r.Ray=rx,r.RequestManager=class{constructor(o,n,a){this._transformRequestFn=o,this._customAccessToken=n,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){let o=function(){let n="";for(let a=0;a<10;a++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",B,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,n){return this._transformRequestFn&&this._transformRequestFn(o,n)||{url:o}}normalizeStyleURL(o,n){if(!Kn(o))return o;let a=kn(o);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||n)}normalizeGlyphsURL(o,n){if(!Kn(o))return o;let a=kn(o);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||n)}normalizeSourceURL(o,n,a,u){if(!Kn(o))return o;let f=kn(o);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),a&&f.params.push(`language=${a}`),u&&f.params.push(`worldview=${u}`),this._makeAPIURL(f,this._customAccessToken||n)}normalizeSpriteURL(o,n,a,u){let f=kn(o);return Kn(o)?(f.path=`/styles/v1${f.path}/sprite${n}${a}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${n}${a}`,Un(f))}normalizeTileURL(o,n,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Kn(o))return o;let u=kn(o);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||a&&u.authority!=="raster"&&a===512?"@2x":""}${A.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${S.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${S.TILE_URL_VERSION}${u.path}`);let f=this._customAccessToken||function(g){for(let y of g){let T=y.match(/^access_token=(.*)$/);if(T)return T[1]}return null}(u.params)||S.ACCESS_TOKEN;return S.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(o,n){let a=kn(o);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return o;let u="mapbox://";a.path.match(/^\/raster\/v1\//)?u+=`raster/${a.path.replace(`/${S.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${a.path.replace(`/${S.TILE_URL_VERSION}/`,"")}`;let f=a.params;return n&&(f=f.filter(g=>!g.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(o,n){let a=!!n&&Kn(n),u=[];for(let f of o.tiles||[])Gn(f)?u.push(this.canonicalizeTileURL(f,a)):u.push(f);return u}_makeAPIURL(o,n){let a="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=kn(S.API_URL);if(o.protocol=u.protocol,o.authority=u.authority,o.protocol==="http"){let f=o.params.indexOf("secure");f>=0&&o.params.splice(f,1)}if(u.path!=="/"&&(o.path=`${u.path}${o.path}`),!S.REQUIRE_ACCESS_TOKEN)return Un(o);if(n=n||S.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return o.params=o.params.filter(f=>f.indexOf("access_token")===-1),o.params.push(`access_token=${n||""}`),Un(o)}},r.ResourceType=et,r.SegmentVector=kr,r.SourceCache=eh,r.StencilMode=Hx,r.StructArrayLayout1ui2=Ba,r.StructArrayLayout2f1f2i16=fs,r.StructArrayLayout2i4=Bn,r.StructArrayLayout2ui4=Fa,r.StructArrayLayout3f12=ps,r.StructArrayLayout3ui6=ms,r.StructArrayLayout4i8=Wi,r.StructArrayLayout5f20=ao,r.Texture=ym,r.Tile=Vx,r.Transitionable=Qt,r.Uniform1f=q_,r.Uniform1i=class extends bl{constructor(o){super(o),this.current=0}set(o,n,a){this.fetchUniformLocation(o,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},r.Uniform2f=class extends bl{constructor(o){super(o),this.current=[0,0]}set(o,n,a){this.fetchUniformLocation(o,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}},r.Uniform3f=class extends bl{constructor(o){super(o),this.current=[0,0,0]}set(o,n,a){this.fetchUniformLocation(o,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}},r.Uniform4f=jT,r.UniformColor=WT,r.UniformMatrix2f=class extends bl{constructor(o){super(o),this.current=CD}set(o,n,a){if(this.fetchUniformLocation(o,n)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}},r.UniformMatrix3f=class extends bl{constructor(o){super(o),this.current=ID}set(o,n,a){if(this.fetchUniformLocation(o,n)){for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},r.UniformMatrix4f=class extends bl{constructor(o){super(o),this.current=MD}set(o,n,a){if(this.fetchUniformLocation(o,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}},r.UnwrappedTileID=KE,r.ValidationError=yn,r.VectorTileFeature=ly,r.VectorTileWorkerSource=class extends Fr{constructor(o,n,a,u,f){super(),this.actor=o,this.layerIndex=n,this.availableImages=a,this.loadVectorData=f||t2,this.loading={},this.loaded={},this.deduped=new e2(o.scheduler),this.isSpriteLoaded=u,this.scheduler=o.scheduler}loadTile(o,n){let a=o.uid,u=o&&o.request,f=u&&u.collectResourceTiming,g=this.loading[a]=new KP(o);g.abort=this.loadVectorData(o,(y,T)=>{let M=!this.loading[a];if(delete this.loading[a],M||y||!T)return g.status="done",M||(this.loaded[a]=g),n(y);let C=T.rawData,O={};T.expires&&(O.expires=T.expires),T.cacheControl&&(O.cacheControl=T.cacheControl),g.vectorTile=T.vectorTile||new Ax(new hm(C));let U=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(V,q)=>{if(V||!q)return n(V);let J={};if(f){let ie=Jt(u);ie.length>0&&(J.resourceTiming=JSON.parse(JSON.stringify(ie)))}n(null,De({rawTileData:C.slice(0)},q,O,J))})};this.isSpriteLoaded?U():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(U,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):U()}),this.loaded=this.loaded||{},this.loaded[a]=g})}reloadTile(o,n){let a=this.loaded,u=o.uid,f=this;if(a&&a[u]){let g=a[u];g.showCollisionBoxes=o.showCollisionBoxes,g.enableTerrain=!!o.enableTerrain,g.projection=o.projection,g.tileTransform=Qu(o.tileID.canonical,o.projection);let y=(T,M)=>{let C=g.reloadCallback;C&&(delete g.reloadCallback,g.parse(g.vectorTile,f.layerIndex,this.availableImages,f.actor,C)),n(T,M)};g.status==="parsing"?g.reloadCallback=y:g.status==="done"&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(o,n){let a=o.uid,u=this.loading[a];u&&(u.abort&&u.abort(),delete this.loading[a]),n()}removeTile(o,n){let a=this.loaded,u=o.uid;a&&a[u]&&delete a[u],n()}},r.WritingMode=Co,r.ZoomDependentExpression=vl,r.add=Tl,r.addDynamicAttributes=Ty,r.adjoint=function(o,n){var a=n[0],u=n[1],f=n[2],g=n[3],y=n[4],T=n[5],M=n[6],C=n[7],O=n[8];return o[0]=y*O-T*C,o[1]=f*C-u*O,o[2]=u*T-f*y,o[3]=T*M-g*O,o[4]=a*O-f*M,o[5]=f*g-a*T,o[6]=g*C-y*M,o[7]=u*M-a*C,o[8]=a*y-u*g,o},r.asyncAll=de,r.bezier=Xe,r.bindAll=Qe,r.boundsAttributes=FS,r.bufferConvexPolygon=function(o,n){let a=[];for(let u=0;u<o.length;u++){let f=ae(u-1,-1,o.length-1),g=ae(u+1,-1,o.length-1),y=o[u],T=o[g],M=o[f].sub(y).unit(),C=T.sub(y).unit(),O=C.angleWithSep(M.x,M.y),U=M.add(C).unit().mult(-1*n/Math.sin(O/2));a.push(y.add(U))}return a},r.cacheEntryPossiblyAdded=function(o){Ee++,Ee>Rt&&(o.getActor().send("enforceCacheSizeLimit",gt),Ee=0)},r.calculateGlobeLabelMatrix=function(o,n){let{x:a,y:u}=o.point,f=dE(a,u,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Wu(f,f,cx(Va(n)))},r.calculateGlobeMatrix=function(o){let{x:n,y:a}=o.point,{lng:u,lat:f}=o._center;return dE(n,a,o.worldSize,u,f)},r.calculateGlobeMercatorMatrix=function(o){let n=o.pixelsPerMeter,a=n/ma(1,o.center.lat),u=fa(new Float64Array(16));return jp(u,u,[o.point.x,o.point.y,0]),qu(u,u,[a,a,n]),Float32Array.from(u)},r.circumferenceAtLatitude=hx,r.clamp=re,r.clearTileCache=function(o){if(!Xt())return;let n=x.caches.delete(ei);o&&n.catch(o).then(()=>o())},r.clipLine=xS,r.clone=function(o){var n=new lo(16);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=o[6],n[7]=o[7],n[8]=o[8],n[9]=o[9],n[10]=o[10],n[11]=o[11],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n},r.clone$1=Re,r.collisionCircleLayout=KR,r.config=S,r.conjugate=function(o,n){return o[0]=-n[0],o[1]=-n[1],o[2]=-n[2],o[3]=n[3],o},r.create=function(){var o=new lo(16);return lo!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},r.create$1=XT,r.createExpression=fc,r.createLayout=Fn,r.createStyleLayer=function(o){return o.type==="custom"?new UP(o):new GP[o.type](o)},r.cross=ix,r.degToRad=me,r.distance=function(o,n){return Math.hypot(n[0]-o[0],n[1]-o[1],n[2]-o[2])},r.div=function(o,n,a){return o[0]=n[0]/a[0],o[1]=n[1]/a[1],o[2]=n[2]/a[2],o},r.dot=Bo,r.earthRadius=em,r.ease=ge,r.easeCubicInOut=ye,r.ecefToLatLng=function([o,n,a]){let u=Math.hypot(o,n,a),f=Math.atan2(o,a),g=.5*Math.PI-Math.acos(-n/u);return new Di(se(f),se(g))},r.emitValidationErrors=D_,r.endsWith=zt,r.enforceCacheSizeLimit=function(o){gn(),ze&&ze.then(n=>{n.keys().then(a=>{for(let u=0;u<a.length-o;u++)n.delete(a[u])})})},r.evaluateSizeForFeature=dy,r.evaluateSizeForZoom=Ud,r.evaluateVariableOffset=SS,r.evented=Ue,r.exactEquals=function(o,n){return o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]&&o[3]===n[3]},r.exactEquals$1=function(o,n){return o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]},r.exported=$n,r.exported$1=A,r.extend=De,r.extend$1=hs,r.fillExtrusionHeightLift=qE,r.filterObject=Lt,r.fromMat4=function(o,n){return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[4],o[4]=n[5],o[5]=n[6],o[6]=n[8],o[7]=n[9],o[8]=n[10],o},r.fromQuat=function(o,n){var a=n[0],u=n[1],f=n[2],g=n[3],y=a+a,T=u+u,M=f+f,C=a*y,O=u*y,U=u*T,V=f*y,q=f*T,J=f*M,ie=g*y,_e=g*T,ke=g*M;return o[0]=1-U-J,o[1]=O+ke,o[2]=V-_e,o[3]=0,o[4]=O-ke,o[5]=1-C-J,o[6]=q+ie,o[7]=0,o[8]=V+_e,o[9]=q-ie,o[10]=1-C-U,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},r.fromRotation=function(o,n){var a=Math.sin(n),u=Math.cos(n);return o[0]=u,o[1]=a,o[2]=0,o[3]=-a,o[4]=u,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},r.fromScaling=KT,r.furthestTileCorner=function(o){let n=Math.round((o+45+360)%360/90)%4;return Y[n]},r.getAABBPointSquareDist=function(o,n,a){let u=0;for(let f=0;f<2;++f){let g=a?a[f]:0;o[f]>g&&(u+=(o[f]-g)*(o[f]-g)),n[f]<g&&(u+=(g-n[f])*(g-n[f]))}return u},r.getAnchorAlignment=Rx,r.getAnchorJustification=zx,r.getBounds=function(o){let n=1/0,a=1/0,u=-1/0,f=-1/0;for(let g of o)n=Math.min(n,g.x),a=Math.min(a,g.y),u=Math.max(u,g.x),f=Math.max(f,g.y);return{min:new G(n,a),max:new G(u,f)}},r.getColumn=xn,r.getGridMatrix=function(o,n,a,u){let f=n.getNorth(),g=n.getSouth(),y=n.getWest(),T=n.getEast(),M=1<<o.z,C=T-y,O=f-g,U=C/Zu,V=-O/Jp[a],q=[0,U,0,V,0,0,f,y,0];if(o.z>0){let J=180/u;ZT(q,q,[J/C+1,0,0,0,J/O+1,0,-.5*J/U,.5*J/V,1])}return q[2]=M,q[5]=o.x,q[8]=o.y,q},r.getImage=un,r.getJSON=function(o,n){return Je(De(o,{type:"json"}),n)},r.getLatitudinalLod=function(o){let n=_s-5;o=re(o,-n,n)/n*90;let a=Math.pow(Math.abs(Math.sin(me(o))),3);return Math.round(a*(Jp.length-1))},r.getMapSessionAPI=Fe,r.getPerformanceMeasurement=Jt,r.getProjection=PS,r.getRTLTextPluginStatus=Ze,r.getReferrer=tn,r.getTilePoint=function(o,{x:n,y:a},u=0){return new G(((n-u)*o.scale-o.x)*Zn,(a*o.scale-o.y)*Zn)},r.getTileVec3=function(o,n,a=0){return Ld(((n.x-a)*o.scale-o.x)*Zn,(n.y*o.scale-o.y)*Zn,gE(n.z,n.y))},r.getVideo=function(o,n){let a=x.document.createElement("video");a.muted=!0,a.onloadstart=function(){n(null,a)};for(let u=0;u<o.length;u++){let f=x.document.createElement("source");nn(o[u])||(a.crossOrigin="Anonymous"),f.src=o[u],a.appendChild(f)}return{cancel:()=>{}}},r.globeCenterToScreenPoint=function(o){let n=[0,0,0],a=fa(new Float64Array(16));return Wu(a,o.pixelMatrix,o.globeMatrix),Cr(n,n,a),new G(n[0],n[1])},r.globeDenormalizeECEF=cx,r.globeECEFOrigin=function(o,n){let a=[0,0,0];return Cr(a,a,Qp(Va(n.canonical))),Cr(a,a,o),a},r.globeMetersToEcef=Y_,r.globeNormalizeECEF=Qp,r.globePixelsToTileUnits=function(o,n){return Zn/(512*Math.pow(2,o))*$_(Va(n))},r.globePoleMatrixForTile=function(o,n,a){let u=fa(new Float64Array(16)),f=(n/(1<<o)-.5)*Math.PI*2;return K_(u,a.globeMatrix,f),Float32Array.from(u)},r.globeTileBounds=Va,r.globeTiltAtLngLat=fE,r.globeToMercatorTransition=Pd,r.globeUseCustomAntiAliasing=function(o,n,a){let u=Pd(a.zoom),f=o.style.map._antialias,g=!!n.extStandardDerivatives,y=n.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return u===0&&!f&&!y&&g},r.identity=fa,r.identity$1=iE,r.invert=Qv,r.isFullscreen=function(){return!!x.document.fullscreenElement||!!x.document.webkitFullscreenElement},r.isLngLatBehindGlobe=ux,r.isMapAuthenticated=function(o){return Ne.has(o)},r.isMapboxURL=Kn,r.isSafariWithAntialiasingBug=function(o){let n=o.navigator?o.navigator.userAgent:null;return!!bn(o)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.latFromMercatorY=gs,r.latLngToECEF=Rd,r.len=FD,r.length=Wp,r.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},r.lngFromMercatorX=Io,r.loadVectorTile=t2,r.makeRequest=Je,r.mapValue=function(o,n,a,u,f){return re((o-n)/(a-n)*(f-u)+u,u,f)},r.mercatorScale=_E,r.mercatorXfromLng=Ga,r.mercatorYfromLat=Ha,r.mercatorZfromAltitude=ma,r.mul=OD,r.mul$1=ND,r.multiply=Wu,r.multiply$1=ZT,r.multiply$2=$T,r.nextPowerOfTwo=Ct,r.normalize=Fs,r.normalize$1=BD,r.normalize$2=tE,r.number=Li,r.ortho=function(o,n,a,u,f,g,y){var T=1/(n-a),M=1/(u-f),C=1/(g-y);return o[0]=-2*T,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*M,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*C,o[11]=0,o[12]=(n+a)*T,o[13]=(f+u)*M,o[14]=(y+g)*C,o[15]=1,o},r.pbf=hm,r.perspective=function(o,n,a,u,f){var g,y=1/Math.tan(n/2);return o[0]=y/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=y,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,f!=null&&f!==1/0?(o[10]=(f+u)*(g=1/(u-f)),o[14]=2*f*u*g):(o[10]=-1,o[14]=-2*u),o},r.pick=function(o,n){let a={};for(let u=0;u<n.length;u++){let f=n[u];f in o&&(a[f]=o[f])}return a},r.plugin=$e,r.pointGeometry=G,r.polesInViewport=function(o){let n=fa(new Float64Array(16));Wu(n,o.pixelMatrix,o.globeMatrix);let a=[0,Uo,0],u=[0,Vo,0];return Cr(a,a,n),Cr(u,u,n),[a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!ux(o,new Di(o.center.lat,90)),u[0]>0&&u[0]<=o.width&&u[1]>0&&u[1]<=o.height&&!ux(o,new Di(o.center.lat,-90))]},r.polygonContainsPoint=Ju,r.polygonIntersectsBox=EE,r.polygonIntersectsPolygon=xE,r.polygonizeBounds=function(o,n,a=0,u=!0){let f=new G(a,a),g=o.sub(f),y=n.add(f),T=[g,new G(y.x,g.y),y,new G(g.x,y.y)];return u&&T.push(g.clone()),T},r.posAttributes=Yp,r.postMapLoadEvent=K,r.postPerformanceEvent=oe,r.postTurnstileEvent=X,r.potpack=Cx,r.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},r.radToDeg=se,r.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.registerForPluginStateChange=function(o){return o({pluginStatus:Me,pluginURL:ce}),Ue.on("pluginStateChange",o),o},r.removeAuthState=function(o){Ne.delete(o)},r.renderColorRamp=vx,r.resample=yE,r.rotateX=ex,r.rotateX$1=rE,r.rotateY=K_,r.rotateY$1=sE,r.rotateZ=function(o,n,a){var u=Math.sin(a),f=Math.cos(a),g=n[0],y=n[1],T=n[2],M=n[3],C=n[4],O=n[5],U=n[6],V=n[7];return n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=g*f+C*u,o[1]=y*f+O*u,o[2]=T*f+U*u,o[3]=M*f+V*u,o[4]=C*f-g*u,o[5]=O*f-y*u,o[6]=U*f-T*u,o[7]=V*f-M*u,o},r.rotateZ$1=function(o,n,a){a*=.5;var u=n[0],f=n[1],g=n[2],y=n[3],T=Math.sin(a),M=Math.cos(a);return o[0]=u*M+f*T,o[1]=f*M-u*T,o[2]=g*M+y*T,o[3]=y*M-g*T,o},r.scale=qu,r.scale$1=eE,r.scale$2=Mo,r.scaleAndAdd=Zp,r.set=function(o,n,a,u){return o[0]=n,o[1]=a,o[2]=u,o},r.setCacheLimits=function(o,n){gt=o,Rt=n},r.setColumn=function(o,n,a){o[4*n+0]=a[0],o[4*n+1]=a[1],o[4*n+2]=a[2],o[4*n+3]=a[3]},r.setRTLTextPlugin=function(o,n,a=!1){if(Me===fe||Me===Te||Me===we)throw new Error("setRTLTextPlugin cannot be called multiple times.");ce=$n.resolveURL(o),Me=fe,Se=n,Pe(),a||je()},r.smoothstep=ve,r.spec=Tt,r.squaredLength=function(o){var n=o[0],a=o[1],u=o[2];return n*n+a*a+u*u},r.storeAuthState=function(o,n){n?Ne.add(o):Ne.delete(o)},r.sub=pa,r.subtract=nx,r.symbolSize=YR,r.tileAABB=function(o,n,a,u,f,g,y,T,M){if(M.name==="globe")return HD(o,n,new uy(a,u,f));let C=Qu({z:a,x:u,y:f},M);return new Bs([(g+C.x/C.scale)*n,n*(C.y/C.scale),y],[(g+C.x2/C.scale)*n,n*(C.y2/C.scale),T])},r.tileCornersToBounds=J_,r.tileTransform=Qu,r.transformMat3=function(o,n,a){var u=n[0],f=n[1],g=n[2];return o[0]=u*a[0]+f*a[3]+g*a[6],o[1]=u*a[1]+f*a[4]+g*a[7],o[2]=u*a[2]+f*a[5]+g*a[8],o},r.transformMat4=Cr,r.transformMat4$1=Xu,r.transformQuat=QT,r.transitionTileAABBinECEF=cE,r.translate=jp,r.transpose=function(o,n){if(o===n){var a=n[1],u=n[2],f=n[5];o[1]=n[3],o[2]=n[6],o[3]=a,o[5]=n[7],o[6]=u,o[7]=f}else o[0]=n[0],o[1]=n[3],o[2]=n[6],o[3]=n[1],o[4]=n[4],o[5]=n[7],o[6]=n[2],o[7]=n[5],o[8]=n[8];return o},r.triggerPluginCompletionEvent=Oe,r.uniqueId=pe,r.updateGlobeVertexNormal=function(o,n,a,u,f){let g=5*n+2;o.float32[g+0]=a,o.float32[g+1]=u,o.float32[g+2]=f},r.validateCustomStyleLayer=function(o){let n=[],a=o.id;return a===void 0&&n.push({message:`layers.${a}: missing required property "id"`}),o.render===void 0&&n.push({message:`layers.${a}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&n.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),n},r.validateFilter=o=>la(kp(o)),r.validateFog=o=>la(I_(o)),r.validateLayer=o=>la(Op(o)),r.validateLight=o=>la(M_(o)),r.validateSource=o=>la(Ou(o)),r.validateStyle=C_,r.validateTerrain=o=>la(Np(o)),r.values=xe,r.vectorTile=ay,r.version=v,r.warnOnce=nt,r.window=x,r.wrap=ae}),h(["./shared"],function(r){function x(he){if(typeof he=="number"||typeof he=="boolean"||typeof he=="string"||he==null)return JSON.stringify(he);if(Array.isArray(he)){let N="[";for(let K of he)N+=`${x(K)},`;return`${N}]`}let X="{";for(let N of Object.keys(he).sort())X+=`${N}:${x(he[N])},`;return`${X}}`}function v(he){let X="";for(let N of r.refProperties)X+=`/${x(he[N])}`;return X}class w{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,N){for(let ne of X)this._layerConfigs[ne.id]=ne,(this._layers[ne.id]=r.createStyleLayer(ne)).compileFilter(),this.keyCache[ne.id]&&delete this.keyCache[ne.id];for(let ne of N)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};let K=function(ne,oe){let be={};for(let Ne=0;Ne<ne.length;Ne++){let Ke=oe&&oe[ne[Ne].id]||v(ne[Ne]);oe&&(oe[ne[Ne].id]=Ke);let rt=be[Ke];rt||(rt=be[Ke]=[]),rt.push(ne[Ne])}let Fe=[];for(let Ne in be)Fe.push(be[Ne]);return Fe}(r.values(this._layerConfigs),this.keyCache);for(let ne of K){let oe=ne.map(Pt=>this._layers[Pt.id]),be=oe[0];if(be.visibility==="none")continue;let Fe=be.source||"",Ne=this.familiesBySource[Fe];Ne||(Ne=this.familiesBySource[Fe]={});let Ke=be.sourceLayer||"_geojsonTileLayer",rt=Ne[Ke];rt||(rt=Ne[Ke]=[]),rt.push(oe)}}}class S{loadTile(X,N){let{uid:K,encoding:ne,rawImageData:oe,padding:be,buildQuadTree:Fe}=X,Ne=r.window.ImageBitmap&&oe instanceof r.window.ImageBitmap?this.getImageData(oe,be):oe;N(null,new r.DEMData(K,Ne,ne,be<1,Fe))}getImageData(X,N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);let K=this.offscreenCanvasContext.getImageData(-N,-N,X.width+2*N,X.height+2*N);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),K}}var A=function he(X,N){var K,ne=X&&X.type;if(ne==="FeatureCollection")for(K=0;K<X.features.length;K++)he(X.features[K],N);else if(ne==="GeometryCollection")for(K=0;K<X.geometries.length;K++)he(X.geometries[K],N);else if(ne==="Feature")he(X.geometry,N);else if(ne==="Polygon")I(X.coordinates,N);else if(ne==="MultiPolygon")for(K=0;K<X.coordinates.length;K++)I(X.coordinates[K],N);return X};function I(he,X){if(he.length!==0){R(he[0],X);for(var N=1;N<he.length;N++)R(he[N],!X)}}function R(he,X){for(var N=0,K=0,ne=0,oe=he.length,be=oe-1;ne<oe;be=ne++){var Fe=(he[ne][0]-he[be][0])*(he[be][1]+he[ne][1]),Ne=N+Fe;K+=Math.abs(N)>=Math.abs(Fe)?N-Ne+Fe:Fe-Ne+N,N=Ne}N+K>=0!=!!X&&he.reverse()}let k=r.VectorTileFeature.prototype.toGeoJSON;class L{constructor(X){this._feature=X,this.extent=r.EXTENT,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))}loadGeometry(){if(this._feature.type===1){let X=[];for(let N of this._feature.geometry)X.push([new r.pointGeometry(N[0],N[1])]);return X}{let X=[];for(let N of this._feature.geometry){let K=[];for(let ne of N)K.push(new r.pointGeometry(ne[0],ne[1]));X.push(K)}return X}}toGeoJSON(X,N,K){return k.call(this,X,N,K)}}class z{constructor(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.EXTENT,this.length=X.length,this._features=X}feature(X){return new L(this._features[X])}}var B={},$={get exports(){return B},set exports(he){B=he}},H=r.pointGeometry,G=r.vectorTile.VectorTileFeature,le=te;function te(he,X){this.options=X||{},this.features=he,this.length=he.length}function ue(he,X){this.id=typeof he.id=="number"?he.id:void 0,this.type=he.type,this.rawGeometry=he.type===1?[he.geometry]:he.geometry,this.properties=he.tags,this.extent=X||4096}te.prototype.feature=function(he){return new ue(this.features[he],this.options.extent)},ue.prototype.loadGeometry=function(){var he=this.rawGeometry;this.geometry=[];for(var X=0;X<he.length;X++){for(var N=he[X],K=[],ne=0;ne<N.length;ne++)K.push(new H(N[ne][0],N[ne][1]));this.geometry.push(K)}return this.geometry},ue.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var he=this.geometry,X=1/0,N=-1/0,K=1/0,ne=-1/0,oe=0;oe<he.length;oe++)for(var be=he[oe],Fe=0;Fe<be.length;Fe++){var Ne=be[Fe];X=Math.min(X,Ne.x),N=Math.max(N,Ne.x),K=Math.min(K,Ne.y),ne=Math.max(ne,Ne.y)}return[X,K,N,ne]},ue.prototype.toGeoJSON=G.prototype.toGeoJSON;var me=r.pbf,se=le;function Y(he){var X=new me;return function(N,K){for(var ne in N.layers)K.writeMessage(3,ye,N.layers[ne])}(he,X),X.finish()}function ye(he,X){var N;X.writeVarintField(15,he.version||1),X.writeStringField(1,he.name||""),X.writeVarintField(5,he.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<he.length;N++)K.feature=he.feature(N),X.writeMessage(2,Xe,K);var ne=K.keys;for(N=0;N<ne.length;N++)X.writeStringField(3,ne[N]);var oe=K.values;for(N=0;N<oe.length;N++)X.writeMessage(4,de,oe[N])}function Xe(he,X){var N=he.feature;N.id!==void 0&&X.writeVarintField(1,N.id),X.writeMessage(2,ge,he),X.writeVarintField(3,N.type),X.writeMessage(4,ae,N)}function ge(he,X){var N=he.feature,K=he.keys,ne=he.values,oe=he.keycache,be=he.valuecache;for(var Fe in N.properties){var Ne=N.properties[Fe],Ke=oe[Fe];if(Ne!==null){Ke===void 0&&(K.push(Fe),oe[Fe]=Ke=K.length-1),X.writeVarint(Ke);var rt=typeof Ne;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(Ne=JSON.stringify(Ne));var Pt=rt+":"+Ne,_t=be[Pt];_t===void 0&&(ne.push(Ne),be[Pt]=_t=ne.length-1),X.writeVarint(_t)}}}function re(he,X){return(X<<3)+(7&he)}function ve(he){return he<<1^he>>31}function ae(he,X){for(var N=he.loadGeometry(),K=he.type,ne=0,oe=0,be=N.length,Fe=0;Fe<be;Fe++){var Ne=N[Fe],Ke=1;K===1&&(Ke=Ne.length),X.writeVarint(re(1,Ke));for(var rt=K===3?Ne.length-1:Ne.length,Pt=0;Pt<rt;Pt++){Pt===1&&K!==1&&X.writeVarint(re(2,rt-1));var _t=Ne[Pt].x-ne,Jt=Ne[Pt].y-oe;X.writeVarint(ve(_t)),X.writeVarint(ve(Jt)),ne+=_t,oe+=Jt}K===3&&X.writeVarint(re(7,1))}}function de(he,X){var N=typeof he;N==="string"?X.writeStringField(1,he):N==="boolean"?X.writeBooleanField(7,he):N==="number"&&(he%1!=0?X.writeDoubleField(3,he):he<0?X.writeSVarintField(6,he):X.writeVarintField(5,he))}function xe(he,X,N,K,ne,oe){if(ne-K<=N)return;let be=K+ne>>1;De(he,X,be,K,ne,oe%2),xe(he,X,N,K,be-1,oe+1),xe(he,X,N,be+1,ne,oe+1)}function De(he,X,N,K,ne,oe){for(;ne>K;){if(ne-K>600){let Ke=ne-K+1,rt=N-K+1,Pt=Math.log(Ke),_t=.5*Math.exp(2*Pt/3),Jt=.5*Math.sqrt(Pt*_t*(Ke-_t)/Ke)*(rt-Ke/2<0?-1:1);De(he,X,N,Math.max(K,Math.floor(N-rt*_t/Ke+Jt)),Math.min(ne,Math.floor(N+(Ke-rt)*_t/Ke+Jt)),oe)}let be=X[2*N+oe],Fe=K,Ne=ne;for(Ce(he,X,K,N),X[2*ne+oe]>be&&Ce(he,X,K,ne);Fe<Ne;){for(Ce(he,X,Fe,Ne),Fe++,Ne--;X[2*Fe+oe]<be;)Fe++;for(;X[2*Ne+oe]>be;)Ne--}X[2*K+oe]===be?Ce(he,X,K,Ne):(Ne++,Ce(he,X,Ne,ne)),Ne<=N&&(K=Ne+1),N<=Ne&&(ne=Ne-1)}}function Ce(he,X,N,K){pe(he,N,K),pe(X,2*N,2*K),pe(X,2*N+1,2*K+1)}function pe(he,X,N){let K=he[X];he[X]=he[N],he[N]=K}function xt(he,X,N,K){let ne=he-N,oe=X-K;return ne*ne+oe*oe}$.exports=Y,B.fromVectorTileJs=Y,B.fromGeojsonVt=function(he,X){X=X||{};var N={};for(var K in he)N[K]=new se(he[K].features,X),N[K].name=K,N[K].version=X.version,N[K].extent=X.extent;return Y({layers:N})},B.GeoJSONWrapper=se;let Ct=he=>he[0],ct=he=>he[1];class Qe{constructor(X,N=Ct,K=ct,ne=64,oe=Float64Array){this.nodeSize=ne,this.points=X;let be=X.length<65536?Uint16Array:Uint32Array,Fe=this.ids=new be(X.length),Ne=this.coords=new oe(2*X.length);for(let Ke=0;Ke<X.length;Ke++)Fe[Ke]=Ke,Ne[2*Ke]=N(X[Ke]),Ne[2*Ke+1]=K(X[Ke]);xe(Fe,Ne,ne,0,Fe.length-1,0)}range(X,N,K,ne){return function(oe,be,Fe,Ne,Ke,rt,Pt){let _t=[0,oe.length-1,0],Jt=[],Ht,cn;for(;_t.length;){let In=_t.pop(),Wn=_t.pop(),$n=_t.pop();if(Wn-$n<=Pt){for(let Qn=$n;Qn<=Wn;Qn++)Ht=be[2*Qn],cn=be[2*Qn+1],Ht>=Fe&&Ht<=Ke&&cn>=Ne&&cn<=rt&&Jt.push(oe[Qn]);continue}let hn=Math.floor(($n+Wn)/2);Ht=be[2*hn],cn=be[2*hn+1],Ht>=Fe&&Ht<=Ke&&cn>=Ne&&cn<=rt&&Jt.push(oe[hn]);let yi=(In+1)%2;(In===0?Fe<=Ht:Ne<=cn)&&(_t.push($n),_t.push(hn-1),_t.push(yi)),(In===0?Ke>=Ht:rt>=cn)&&(_t.push(hn+1),_t.push(Wn),_t.push(yi))}return Jt}(this.ids,this.coords,X,N,K,ne,this.nodeSize)}within(X,N,K){return function(ne,oe,be,Fe,Ne,Ke){let rt=[0,ne.length-1,0],Pt=[],_t=Ne*Ne;for(;rt.length;){let Jt=rt.pop(),Ht=rt.pop(),cn=rt.pop();if(Ht-cn<=Ke){for(let yi=cn;yi<=Ht;yi++)xt(oe[2*yi],oe[2*yi+1],be,Fe)<=_t&&Pt.push(ne[yi]);continue}let In=Math.floor((cn+Ht)/2),Wn=oe[2*In],$n=oe[2*In+1];xt(Wn,$n,be,Fe)<=_t&&Pt.push(ne[In]);let hn=(Jt+1)%2;(Jt===0?be-Ne<=Wn:Fe-Ne<=$n)&&(rt.push(cn),rt.push(In-1),rt.push(hn)),(Jt===0?be+Ne>=Wn:Fe+Ne>=$n)&&(rt.push(In+1),rt.push(Ht),rt.push(hn))}return Pt}(this.ids,this.coords,X,N,K,this.nodeSize)}}let zt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:he=>he},Zt=Math.fround||(Lt=new Float32Array(1),he=>(Lt[0]=+he,Lt[0]));var Lt;class Re{constructor(X){this.options=bn(Object.create(zt),X),this.trees=new Array(this.options.maxZoom+1)}load(X){let{log:N,minZoom:K,maxZoom:ne,nodeSize:oe}=this.options;N&&console.time("total time");let be=`prepare ${X.length} points`;N&&console.time(be),this.points=X;let Fe=[];for(let Ne=0;Ne<X.length;Ne++)X[Ne].geometry&&Fe.push(nt(X[Ne],Ne));this.trees[ne+1]=new Qe(Fe,wn,xn,oe,Float32Array),N&&console.timeEnd(be);for(let Ne=ne;Ne>=K;Ne--){let Ke=+Date.now();Fe=this._cluster(Fe,Ne),this.trees[Ne]=new Qe(Fe,wn,xn,oe,Float32Array),N&&console.log("z%d: %d clusters in %dms",Ne,Fe.length,+Date.now()-Ke)}return N&&console.timeEnd("total time"),this}getClusters(X,N){let K=((X[0]+180)%360+360)%360-180,ne=Math.max(-90,Math.min(90,X[1])),oe=X[2]===180?180:((X[2]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)K=-180,oe=180;else if(K>oe){let rt=this.getClusters([K,ne,180,be],N),Pt=this.getClusters([-180,ne,oe,be],N);return rt.concat(Pt)}let Fe=this.trees[this._limitZoom(N)],Ne=Fe.range(ut(K),Ot(be),ut(oe),Ot(ne)),Ke=[];for(let rt of Ne){let Pt=Fe.points[rt];Ke.push(Pt.numPoints?at(Pt):this.points[Pt.index])}return Ke}getChildren(X){let N=this._getOriginId(X),K=this._getOriginZoom(X),ne="No cluster with the specified id.",oe=this.trees[K];if(!oe)throw new Error(ne);let be=oe.points[N];if(!be)throw new Error(ne);let Fe=this.options.radius/(this.options.extent*Math.pow(2,K-1)),Ne=oe.within(be.x,be.y,Fe),Ke=[];for(let rt of Ne){let Pt=oe.points[rt];Pt.parentId===X&&Ke.push(Pt.numPoints?at(Pt):this.points[Pt.index])}if(Ke.length===0)throw new Error(ne);return Ke}getLeaves(X,N,K){let ne=[];return this._appendLeaves(ne,X,N=N||10,K=K||0,0),ne}getTile(X,N,K){let ne=this.trees[this._limitZoom(X)],oe=Math.pow(2,X),{extent:be,radius:Fe}=this.options,Ne=Fe/be,Ke=(K-Ne)/oe,rt=(K+1+Ne)/oe,Pt={features:[]};return this._addTileFeatures(ne.range((N-Ne)/oe,Ke,(N+1+Ne)/oe,rt),ne.points,N,K,oe,Pt),N===0&&this._addTileFeatures(ne.range(1-Ne/oe,Ke,1,rt),ne.points,oe,K,oe,Pt),N===oe-1&&this._addTileFeatures(ne.range(0,Ke,Ne/oe,rt),ne.points,-1,K,oe,Pt),Pt.features.length?Pt:null}getClusterExpansionZoom(X){let N=this._getOriginZoom(X)-1;for(;N<=this.options.maxZoom;){let K=this.getChildren(X);if(N++,K.length!==1)break;X=K[0].properties.cluster_id}return N}_appendLeaves(X,N,K,ne,oe){let be=this.getChildren(N);for(let Fe of be){let Ne=Fe.properties;if(Ne&&Ne.cluster?oe+Ne.point_count<=ne?oe+=Ne.point_count:oe=this._appendLeaves(X,Ne.cluster_id,K,ne,oe):oe<ne?oe++:X.push(Fe),X.length===K)break}return oe}_addTileFeatures(X,N,K,ne,oe,be){for(let Fe of X){let Ne=N[Fe],Ke=Ne.numPoints,rt,Pt,_t;if(Ke)rt=St(Ne),Pt=Ne.x,_t=Ne.y;else{let cn=this.points[Ne.index];rt=cn.properties,Pt=ut(cn.geometry.coordinates[0]),_t=Ot(cn.geometry.coordinates[1])}let Jt={type:1,geometry:[[Math.round(this.options.extent*(Pt*oe-K)),Math.round(this.options.extent*(_t*oe-ne))]],tags:rt},Ht;Ke?Ht=Ne.id:this.options.generateId?Ht=Ne.index:this.points[Ne.index].id&&(Ht=this.points[Ne.index].id),Ht!==void 0&&(Jt.id=Ht),be.features.push(Jt)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,N){let K=[],{radius:ne,extent:oe,reduce:be,minPoints:Fe}=this.options,Ne=ne/(oe*Math.pow(2,N));for(let Ke=0;Ke<X.length;Ke++){let rt=X[Ke];if(rt.zoom<=N)continue;rt.zoom=N;let Pt=this.trees[N+1],_t=Pt.within(rt.x,rt.y,Ne),Jt=rt.numPoints||1,Ht=Jt;for(let cn of _t){let In=Pt.points[cn];In.zoom>N&&(Ht+=In.numPoints||1)}if(Ht>Jt&&Ht>=Fe){let cn=rt.x*Jt,In=rt.y*Jt,Wn=be&&Jt>1?this._map(rt,!0):null,$n=(Ke<<5)+(N+1)+this.points.length;for(let hn of _t){let yi=Pt.points[hn];if(yi.zoom<=N)continue;yi.zoom=N;let Qn=yi.numPoints||1;cn+=yi.x*Qn,In+=yi.y*Qn,yi.parentId=$n,be&&(Wn||(Wn=this._map(rt,!0)),be(Wn,this._map(yi)))}rt.parentId=$n,K.push(qt(cn/Ht,In/Ht,$n,Ht,Wn))}else if(K.push(rt),Ht>1)for(let cn of _t){let In=Pt.points[cn];In.zoom<=N||(In.zoom=N,K.push(In))}}return K}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,N){if(X.numPoints)return N?bn({},X.properties):X.properties;let K=this.points[X.index].properties,ne=this.options.map(K);return N&&ne===K?bn({},ne):ne}}function qt(he,X,N,K,ne){return{x:Zt(he),y:Zt(X),zoom:1/0,id:N,parentId:-1,numPoints:K,properties:ne}}function nt(he,X){let[N,K]=he.geometry.coordinates;return{x:Zt(ut(N)),y:Zt(Ot(K)),zoom:1/0,index:X,parentId:-1}}function at(he){return{type:"Feature",id:he.id,properties:St(he),geometry:{type:"Point",coordinates:[(X=he.x,360*(X-.5)),Pn(he.y)]}};var X}function St(he){let X=he.numPoints,N=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X;return bn(bn({},he.properties),{cluster:!0,cluster_id:he.id,point_count:X,point_count_abbreviated:N})}function ut(he){return he/360+.5}function Ot(he){let X=Math.sin(he*Math.PI/180),N=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return N<0?0:N>1?1:N}function Pn(he){let X=(180-360*he)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function bn(he,X){for(let N in X)he[N]=X[N];return he}function wn(he){return he.x}function xn(he){return he.y}function ei(he,X,N,K){for(var ne,oe=K,be=N-X>>1,Fe=N-X,Ne=he[X],Ke=he[X+1],rt=he[N],Pt=he[N+1],_t=X+3;_t<N;_t+=3){var Jt=ze(he[_t],he[_t+1],Ne,Ke,rt,Pt);if(Jt>oe)ne=_t,oe=Jt;else if(Jt===oe){var Ht=Math.abs(_t-be);Ht<Fe&&(ne=_t,Fe=Ht)}}oe>K&&(ne-X>3&&ei(he,X,ne,K),he[ne+2]=oe,N-ne>3&&ei(he,ne,N,K))}function ze(he,X,N,K,ne,oe){var be=ne-N,Fe=oe-K;if(be!==0||Fe!==0){var Ne=((he-N)*be+(X-K)*Fe)/(be*be+Fe*Fe);Ne>1?(N=ne,K=oe):Ne>0&&(N+=be*Ne,K+=Fe*Ne)}return(be=he-N)*be+(Fe=X-K)*Fe}function Ae(he,X,N,K){var ne={id:he===void 0?null:he,type:X,geometry:N,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(oe){var be=oe.geometry,Fe=oe.type;if(Fe==="Point"||Fe==="MultiPoint"||Fe==="LineString")gt(oe,be);else if(Fe==="Polygon"||Fe==="MultiLineString")for(var Ne=0;Ne<be.length;Ne++)gt(oe,be[Ne]);else if(Fe==="MultiPolygon")for(Ne=0;Ne<be.length;Ne++)for(var Ke=0;Ke<be[Ne].length;Ke++)gt(oe,be[Ne][Ke])}(ne),ne}function gt(he,X){for(var N=0;N<X.length;N+=3)he.minX=Math.min(he.minX,X[N]),he.minY=Math.min(he.minY,X[N+1]),he.maxX=Math.max(he.maxX,X[N]),he.maxY=Math.max(he.maxY,X[N+1])}function Rt(he,X,N,K){if(X.geometry){var ne=X.geometry.coordinates,oe=X.geometry.type,be=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),Fe=[],Ne=X.id;if(N.promoteId?Ne=X.properties[N.promoteId]:N.generateId&&(Ne=K||0),oe==="Point")Xt(ne,Fe);else if(oe==="MultiPoint")for(var Ke=0;Ke<ne.length;Ke++)Xt(ne[Ke],Fe);else if(oe==="LineString")gn(ne,Fe,be,!1);else if(oe==="MultiLineString"){if(N.lineMetrics){for(Ke=0;Ke<ne.length;Ke++)gn(ne[Ke],Fe=[],be,!1),he.push(Ae(Ne,"LineString",Fe,X.properties));return}Tn(ne,Fe,be,!1)}else if(oe==="Polygon")Tn(ne,Fe,be,!0);else{if(oe!=="MultiPolygon"){if(oe==="GeometryCollection"){for(Ke=0;Ke<X.geometry.geometries.length;Ke++)Rt(he,{id:Ne,geometry:X.geometry.geometries[Ke],properties:X.properties},N,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ke=0;Ke<ne.length;Ke++){var rt=[];Tn(ne[Ke],rt,be,!0),Fe.push(rt)}}he.push(Ae(Ne,oe,Fe,X.properties))}}function Xt(he,X){X.push(Ee(he[0])),X.push(et(he[1])),X.push(0)}function gn(he,X,N,K){for(var ne,oe,be=0,Fe=0;Fe<he.length;Fe++){var Ne=Ee(he[Fe][0]),Ke=et(he[Fe][1]);X.push(Ne),X.push(Ke),X.push(0),Fe>0&&(be+=K?(ne*Ke-Ne*oe)/2:Math.sqrt(Math.pow(Ne-ne,2)+Math.pow(Ke-oe,2))),ne=Ne,oe=Ke}var rt=X.length-3;X[2]=1,ei(X,0,rt,N),X[rt+2]=1,X.size=Math.abs(be),X.start=0,X.end=X.size}function Tn(he,X,N,K){for(var ne=0;ne<he.length;ne++){var oe=[];gn(he[ne],oe,N,K),X.push(oe)}}function Ee(he){return he/360+.5}function et(he){var X=Math.sin(he*Math.PI/180),N=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return N<0?0:N>1?1:N}function rn(he,X,N,K,ne,oe,be,Fe){if(K/=X,oe>=(N/=X)&&be<K)return he;if(be<N||oe>=K)return null;for(var Ne=[],Ke=0;Ke<he.length;Ke++){var rt=he[Ke],Pt=rt.geometry,_t=rt.type,Jt=ne===0?rt.minX:rt.minY,Ht=ne===0?rt.maxX:rt.maxY;if(Jt>=N&&Ht<K)Ne.push(rt);else if(!(Ht<N||Jt>=K)){var cn=[];if(_t==="Point"||_t==="MultiPoint")tn(Pt,cn,N,K,ne);else if(_t==="LineString")Je(Pt,cn,N,K,ne,!1,Fe.lineMetrics);else if(_t==="MultiLineString")nn(Pt,cn,N,K,ne,!1);else if(_t==="Polygon")nn(Pt,cn,N,K,ne,!0);else if(_t==="MultiPolygon")for(var In=0;In<Pt.length;In++){var Wn=[];nn(Pt[In],Wn,N,K,ne,!0),Wn.length&&cn.push(Wn)}if(cn.length){if(Fe.lineMetrics&&_t==="LineString"){for(In=0;In<cn.length;In++)Ne.push(Ae(rt.id,_t,cn[In],rt.tags));continue}_t!=="LineString"&&_t!=="MultiLineString"||(cn.length===1?(_t="LineString",cn=cn[0]):_t="MultiLineString"),_t!=="Point"&&_t!=="MultiPoint"||(_t=cn.length===3?"Point":"MultiPoint"),Ne.push(Ae(rt.id,_t,cn,rt.tags))}}}return Ne.length?Ne:null}function tn(he,X,N,K,ne){for(var oe=0;oe<he.length;oe+=3){var be=he[oe+ne];be>=N&&be<=K&&(X.push(he[oe]),X.push(he[oe+1]),X.push(he[oe+2]))}}function Je(he,X,N,K,ne,oe,be){for(var Fe,Ne,Ke=sn(he),rt=ne===0?Et:Dn,Pt=he.start,_t=0;_t<he.length-3;_t+=3){var Jt=he[_t],Ht=he[_t+1],cn=he[_t+2],In=he[_t+3],Wn=he[_t+4],$n=ne===0?Jt:Ht,hn=ne===0?In:Wn,yi=!1;be&&(Fe=Math.sqrt(Math.pow(Jt-In,2)+Math.pow(Ht-Wn,2))),$n<N?hn>N&&(Ne=rt(Ke,Jt,Ht,In,Wn,N),be&&(Ke.start=Pt+Fe*Ne)):$n>K?hn<K&&(Ne=rt(Ke,Jt,Ht,In,Wn,K),be&&(Ke.start=Pt+Fe*Ne)):An(Ke,Jt,Ht,cn),hn<N&&$n>=N&&(Ne=rt(Ke,Jt,Ht,In,Wn,N),yi=!0),hn>K&&$n<=K&&(Ne=rt(Ke,Jt,Ht,In,Wn,K),yi=!0),!oe&&yi&&(be&&(Ke.end=Pt+Fe*Ne),X.push(Ke),Ke=sn(he)),be&&(Pt+=Fe)}var Qn=he.length-3;Jt=he[Qn],Ht=he[Qn+1],cn=he[Qn+2],($n=ne===0?Jt:Ht)>=N&&$n<=K&&An(Ke,Jt,Ht,cn),Qn=Ke.length-3,oe&&Qn>=3&&(Ke[Qn]!==Ke[0]||Ke[Qn+1]!==Ke[1])&&An(Ke,Ke[0],Ke[1],Ke[2]),Ke.length&&X.push(Ke)}function sn(he){var X=[];return X.size=he.size,X.start=he.start,X.end=he.end,X}function nn(he,X,N,K,ne,oe){for(var be=0;be<he.length;be++)Je(he[be],X,N,K,ne,oe,!1)}function An(he,X,N,K){he.push(X),he.push(N),he.push(K)}function Et(he,X,N,K,ne,oe){var be=(oe-X)/(K-X);return he.push(oe),he.push(N+(ne-N)*be),he.push(1),be}function Dn(he,X,N,K,ne,oe){var be=(oe-N)/(ne-N);return he.push(X+(K-X)*be),he.push(oe),he.push(1),be}function un(he,X){for(var N=[],K=0;K<he.length;K++){var ne,oe=he[K],be=oe.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")ne=Nn(oe.geometry,X);else if(be==="MultiLineString"||be==="Polygon"){ne=[];for(var Fe=0;Fe<oe.geometry.length;Fe++)ne.push(Nn(oe.geometry[Fe],X))}else if(be==="MultiPolygon")for(ne=[],Fe=0;Fe<oe.geometry.length;Fe++){for(var Ne=[],Ke=0;Ke<oe.geometry[Fe].length;Ke++)Ne.push(Nn(oe.geometry[Fe][Ke],X));ne.push(Ne)}N.push(Ae(oe.id,be,ne,oe.tags))}return N}function Nn(he,X){var N=[];N.size=he.size,he.start!==void 0&&(N.start=he.start,N.end=he.end);for(var K=0;K<he.length;K+=3)N.push(he[K]+X,he[K+1],he[K+2]);return N}function Kn(he,X){if(he.transformed)return he;var N,K,ne,oe=1<<he.z,be=he.x,Fe=he.y;for(N=0;N<he.features.length;N++){var Ne=he.features[N],Ke=Ne.geometry,rt=Ne.type;if(Ne.geometry=[],rt===1)for(K=0;K<Ke.length;K+=2)Ne.geometry.push(Gn(Ke[K],Ke[K+1],X,oe,be,Fe));else for(K=0;K<Ke.length;K++){var Pt=[];for(ne=0;ne<Ke[K].length;ne+=2)Pt.push(Gn(Ke[K][ne],Ke[K][ne+1],X,oe,be,Fe));Ne.geometry.push(Pt)}}return he.transformed=!0,he}function Gn(he,X,N,K,ne,oe){return[Math.round(N*(he*K-ne)),Math.round(N*(X*K-oe))]}function Ei(he,X,N,K,ne){for(var oe=X===ne.maxZoom?0:ne.tolerance/((1<<X)*ne.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:K,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Fe=0;Fe<he.length;Fe++){be.numFeatures++,ln(be,he[Fe],oe,ne);var Ne=he[Fe].minX,Ke=he[Fe].minY,rt=he[Fe].maxX,Pt=he[Fe].maxY;Ne<be.minX&&(be.minX=Ne),Ke<be.minY&&(be.minY=Ke),rt>be.maxX&&(be.maxX=rt),Pt>be.maxY&&(be.maxY=Pt)}return be}function ln(he,X,N,K){var ne=X.geometry,oe=X.type,be=[];if(oe==="Point"||oe==="MultiPoint")for(var Fe=0;Fe<ne.length;Fe+=3)be.push(ne[Fe]),be.push(ne[Fe+1]),he.numPoints++,he.numSimplified++;else if(oe==="LineString")li(be,ne,he,N,!1,!1);else if(oe==="MultiLineString"||oe==="Polygon")for(Fe=0;Fe<ne.length;Fe++)li(be,ne[Fe],he,N,oe==="Polygon",Fe===0);else if(oe==="MultiPolygon")for(var Ne=0;Ne<ne.length;Ne++){var Ke=ne[Ne];for(Fe=0;Fe<Ke.length;Fe++)li(be,Ke[Fe],he,N,!0,Fe===0)}if(be.length){var rt=X.tags||null;if(oe==="LineString"&&K.lineMetrics){for(var Pt in rt={},X.tags)rt[Pt]=X.tags[Pt];rt.mapbox_clip_start=ne.start/ne.size,rt.mapbox_clip_end=ne.end/ne.size}var _t={geometry:be,type:oe==="Polygon"||oe==="MultiPolygon"?3:oe==="LineString"||oe==="MultiLineString"?2:1,tags:rt};X.id!==null&&(_t.id=X.id),he.features.push(_t)}}function li(he,X,N,K,ne,oe){var be=K*K;if(K>0&&X.size<(ne?be:K))N.numPoints+=X.length/3;else{for(var Fe=[],Ne=0;Ne<X.length;Ne+=3)(K===0||X[Ne+2]>be)&&(N.numSimplified++,Fe.push(X[Ne]),Fe.push(X[Ne+1])),N.numPoints++;ne&&function(Ke,rt){for(var Pt=0,_t=0,Jt=Ke.length,Ht=Jt-2;_t<Jt;Ht=_t,_t+=2)Pt+=(Ke[_t]-Ke[Ht])*(Ke[_t+1]+Ke[Ht+1]);if(Pt>0===rt)for(_t=0,Jt=Ke.length;_t<Jt/2;_t+=2){var cn=Ke[_t],In=Ke[_t+1];Ke[_t]=Ke[Jt-2-_t],Ke[_t+1]=Ke[Jt-1-_t],Ke[Jt-2-_t]=cn,Ke[Jt-1-_t]=In}}(Fe,oe),he.push(Fe)}}function $t(he,X){var N=(X=this.options=function(ne,oe){for(var be in oe)ne[be]=oe[be];return ne}(Object.create(this.options),X)).debug;if(N&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var K=function(ne,oe){var be=[];if(ne.type==="FeatureCollection")for(var Fe=0;Fe<ne.features.length;Fe++)Rt(be,ne.features[Fe],oe,Fe);else Rt(be,ne.type==="Feature"?ne:{geometry:ne},oe);return be}(he,X);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),K=function(ne,oe){var be=oe.buffer/oe.extent,Fe=ne,Ne=rn(ne,1,-1-be,be,0,-1,2,oe),Ke=rn(ne,1,1-be,2+be,0,-1,2,oe);return(Ne||Ke)&&(Fe=rn(ne,1,-be,1+be,0,-1,2,oe)||[],Ne&&(Fe=un(Ne,1).concat(Fe)),Ke&&(Fe=Fe.concat(un(Ke,-1)))),Fe}(K,X),K.length&&this.splitTile(K,0,0,0),N&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function kn(he,X,N){return 32*((1<<he)*N+X)+he}function Un(he,X){let N=he.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);let K=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!K)return X(null,null);let ne=new z(K.features),oe=B(ne);oe.byteOffset===0&&oe.byteLength===oe.buffer.byteLength||(oe=new Uint8Array(oe)),X(null,{vectorTile:ne,rawData:oe.buffer})}$t.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$t.prototype.splitTile=function(he,X,N,K,ne,oe,be){for(var Fe=[he,X,N,K],Ne=this.options,Ke=Ne.debug;Fe.length;){K=Fe.pop(),N=Fe.pop(),X=Fe.pop(),he=Fe.pop();var rt=1<<X,Pt=kn(X,N,K),_t=this.tiles[Pt];if(!_t&&(Ke>1&&console.time("creation"),_t=this.tiles[Pt]=Ei(he,X,N,K,Ne),this.tileCoords.push({z:X,x:N,y:K}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,N,K,_t.numFeatures,_t.numPoints,_t.numSimplified),console.timeEnd("creation"));var Jt="z"+X;this.stats[Jt]=(this.stats[Jt]||0)+1,this.total++}if(_t.source=he,ne){if(X===Ne.maxZoom||X===ne)continue;var Ht=1<<ne-X;if(N!==Math.floor(oe/Ht)||K!==Math.floor(be/Ht))continue}else if(X===Ne.indexMaxZoom||_t.numPoints<=Ne.indexMaxPoints)continue;if(_t.source=null,he.length!==0){Ke>1&&console.time("clipping");var cn,In,Wn,$n,hn,yi,Qn=.5*Ne.buffer/Ne.extent,Rr=.5-Qn,Fr=.5+Qn,Tt=1+Qn;cn=In=Wn=$n=null,hn=rn(he,rt,N-Qn,N+Fr,0,_t.minX,_t.maxX,Ne),yi=rn(he,rt,N+Rr,N+Tt,0,_t.minX,_t.maxX,Ne),he=null,hn&&(cn=rn(hn,rt,K-Qn,K+Fr,1,_t.minY,_t.maxY,Ne),In=rn(hn,rt,K+Rr,K+Tt,1,_t.minY,_t.maxY,Ne),hn=null),yi&&(Wn=rn(yi,rt,K-Qn,K+Fr,1,_t.minY,_t.maxY,Ne),$n=rn(yi,rt,K+Rr,K+Tt,1,_t.minY,_t.maxY,Ne),yi=null),Ke>1&&console.timeEnd("clipping"),Fe.push(cn||[],X+1,2*N,2*K),Fe.push(In||[],X+1,2*N,2*K+1),Fe.push(Wn||[],X+1,2*N+1,2*K),Fe.push($n||[],X+1,2*N+1,2*K+1)}}},$t.prototype.getTile=function(he,X,N){var K=this.options,ne=K.extent,oe=K.debug;if(he<0||he>24)return null;var be=1<<he,Fe=kn(he,X=(X%be+be)%be,N);if(this.tiles[Fe])return Kn(this.tiles[Fe],ne);oe>1&&console.log("drilling down to z%d-%d-%d",he,X,N);for(var Ne,Ke=he,rt=X,Pt=N;!Ne&&Ke>0;)Ke--,rt=Math.floor(rt/2),Pt=Math.floor(Pt/2),Ne=this.tiles[kn(Ke,rt,Pt)];return Ne&&Ne.source?(oe>1&&console.log("found parent tile z%d-%d-%d",Ke,rt,Pt),oe>1&&console.time("drilling down"),this.splitTile(Ne.source,Ke,rt,Pt,he,X,N),oe>1&&console.timeEnd("drilling down"),this.tiles[Fe]?Kn(this.tiles[Fe],ne):null):null};class Yn extends r.VectorTileWorkerSource{constructor(X,N,K,ne,oe){super(X,N,K,ne,Un),oe&&(this.loadGeoJSON=oe)}loadData(X,N){let K=X&&X.request,ne=K&&K.collectResourceTiming;this.loadGeoJSON(X,(oe,be)=>{if(oe||!be)return N(oe);if(typeof be!="object")return N(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{A(be,!0);try{if(X.filter){let Ne=r.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ne.result==="error")throw new Error(Ne.value.map(rt=>`${rt.key}: ${rt.message}`).join(", "));let Ke=be.features.filter(rt=>Ne.value.evaluate({zoom:0},rt));be={type:"FeatureCollection",features:Ke}}this._geoJSONIndex=X.cluster?new Re(function({superclusterOptions:Ne,clusterProperties:Ke}){if(!Ke||!Ne)return Ne;let rt={},Pt={},_t={accumulated:null,zoom:0},Jt={properties:null},Ht=Object.keys(Ke);for(let cn of Ht){let[In,Wn]=Ke[cn],$n=r.createExpression(Wn),hn=r.createExpression(typeof In=="string"?[In,["accumulated"],["get",cn]]:In);rt[cn]=$n.value,Pt[cn]=hn.value}return Ne.map=cn=>{Jt.properties=cn;let In={};for(let Wn of Ht)In[Wn]=rt[Wn].evaluate(_t,Jt);return In},Ne.reduce=(cn,In)=>{Jt.properties=In;for(let Wn of Ht)_t.accumulated=cn[Wn],cn[Wn]=Pt[Wn].evaluate(_t,Jt)},Ne}(X)).load(be.features):function(Ne,Ke){return new $t(Ne,Ke)}(be,X.geojsonVtOptions)}catch(Ne){return N(Ne)}this.loaded={};let Fe={};if(ne){let Ne=r.getPerformanceMeasurement(K);Ne&&(Fe.resourceTiming={},Fe.resourceTiming[X.source]=JSON.parse(JSON.stringify(Ne)))}N(null,Fe)}})}reloadTile(X,N){let K=this.loaded;return K&&K[X.uid]?super.reloadTile(X,N):this.loadTile(X,N)}loadGeoJSON(X,N){if(X.request)r.getJSON(X.request,N);else{if(typeof X.data!="string")return N(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return N(null,JSON.parse(X.data))}catch(K){return N(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(K){N(K)}}getClusterChildren(X,N){try{N(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(K){N(K)}}getClusterLeaves(X,N){try{N(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(K){N(K)}}}class Ft{constructor(X){this.self=X,this.actor=new r.Actor(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.getProjection({name:"mercator"}),this.workerSourceTypes={vector:r.VectorTileWorkerSource,geojson:Yn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,K)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=K},this.self.registerRTLTextPlugin=N=>{if(r.plugin.isParsed())throw new Error("RTL text plugin already registered.");r.plugin.applyArabicShaping=N.applyArabicShaping,r.plugin.processBidirectionalText=N.processBidirectionalText,r.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}clearCaches(X,N,K){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],K()}checkIfReady(X,N,K){K()}setReferrer(X,N){this.referrer=N}spriteLoaded(X,N){this.isSpriteLoaded[X]=N;for(let K in this.workerSources[X]){let ne=this.workerSources[X][K];for(let oe in ne)ne[oe]instanceof r.VectorTileWorkerSource&&(ne[oe].isSpriteLoaded=N,ne[oe].fire(new r.Event("isSpriteLoaded")))}}setImages(X,N,K){this.availableImages[X]=N;for(let ne in this.workerSources[X]){let oe=this.workerSources[X][ne];for(let be in oe)oe[be].availableImages=N}K()}enableTerrain(X,N,K){this.terrain=N,K()}setProjection(X,N){this.projections[X]=r.getProjection(N)}setLayers(X,N,K){this.getLayerIndex(X).replace(N),K()}updateLayers(X,N,K){this.getLayerIndex(X).update(N.layers,N.removedIds),K()}loadTile(X,N,K){let ne=this.enableTerrain?r.extend({enableTerrain:this.terrain},N):N;ne.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,N.type,N.source).loadTile(ne,K)}loadDEMTile(X,N,K){let ne=this.enableTerrain?r.extend({buildQuadTree:this.terrain},N):N;this.getDEMWorkerSource(X,N.source).loadTile(ne,K)}reloadTile(X,N,K){let ne=this.enableTerrain?r.extend({enableTerrain:this.terrain},N):N;ne.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,N.type,N.source).reloadTile(ne,K)}abortTile(X,N,K){this.getWorkerSource(X,N.type,N.source).abortTile(N,K)}removeTile(X,N,K){this.getWorkerSource(X,N.type,N.source).removeTile(N,K)}removeSource(X,N,K){if(!this.workerSources[X]||!this.workerSources[X][N.type]||!this.workerSources[X][N.type][N.source])return;let ne=this.workerSources[X][N.type][N.source];delete this.workerSources[X][N.type][N.source],ne.removeSource!==void 0?ne.removeSource(N,K):K()}loadWorkerSource(X,N,K){try{this.self.importScripts(N.url),K()}catch(ne){K(ne.toString())}}syncRTLPluginState(X,N,K){try{r.plugin.setState(N);let ne=r.plugin.getPluginURL();if(r.plugin.isLoaded()&&!r.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);let oe=r.plugin.isParsed();K(oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),oe)}}catch(ne){K(ne.toString())}}getAvailableImages(X){let N=this.availableImages[X];return N||(N=[]),N}getLayerIndex(X){let N=this.layerIndexes[X];return N||(N=this.layerIndexes[X]=new w),N}getWorkerSource(X,N,K){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][N]||(this.workerSources[X][N]={}),!this.workerSources[X][N][K]){let ne={send:(oe,be,Fe,Ne,Ke,rt)=>{this.actor.send(oe,be,Fe,X,Ke,rt)},scheduler:this.actor.scheduler};this.workerSources[X][N][K]=new this.workerSourceTypes[N](ne,this.getLayerIndex(X),this.getAvailableImages(X),this.isSpriteLoaded[X])}return this.workerSources[X][N][K]}getDEMWorkerSource(X,N){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][N]||(this.demWorkerSources[X][N]=new S),this.demWorkerSources[X][N]}enforceCacheSizeLimit(X,N){r.enforceCacheSizeLimit(N)}getWorkerPerformanceMetrics(X,N,K){K(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ft(self)),Ft}),h(["./shared"],function(r){function x(m,l){if(Array.isArray(m)){if(!Array.isArray(l)||m.length!==l.length)return!1;for(let d=0;d<m.length;d++)if(!x(m[d],l[d]))return!1;return!0}if(typeof m=="object"&&m!==null&&l!==null){if(typeof l!="object"||Object.keys(m).length!==Object.keys(l).length)return!1;for(let d in m)if(!x(m[d],l[d]))return!1;return!0}return m===l}var v=w;function w(m){return!function(l){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,E=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(E);try{b=new Worker(D),_=!0}catch(P){_=!1}return b&&b.terminate(),URL.revokeObjectURL(D),_}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var E=b.getImageData(0,0,1,1);return E&&E.width===_.width}()?(S[d=l&&l.failIfMajorPerformanceCaveat]===void 0&&(S[d]=function(_){var b,E=function(D){var P=document.createElement("canvas"),F=Object.create(w.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=D,P.getContext("webgl",F)||P.getContext("experimental-webgl",F)}(_);if(!E)return!1;try{b=E.createShader(E.VERTEX_SHADER)}catch(D){return!1}return!(!b||E.isContextLost())&&(E.shaderSource(b,"void main() {}"),E.compileShader(b),E.getShaderParameter(b,E.COMPILE_STATUS)===!0)}(d)),S[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var d}(m)}var S={};function A(m,l,d){let _=r.window.document.createElement(m);return l!==void 0&&(_.className=l),d&&d.appendChild(_),_}function I(m,l,d){let _=r.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(let b of Object.keys(l))_.setAttributeNS(null,b,l[b]);return d&&d.appendChild(_),_}w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let R=r.window.document&&r.window.document.documentElement.style,k=R&&R.userSelect!==void 0?"userSelect":"WebkitUserSelect",L;function z(){R&&k&&(L=R[k],R[k]="none")}function B(){R&&k&&(R[k]=L)}function $(m){m.preventDefault(),m.stopPropagation(),r.window.removeEventListener("click",$,!0)}function H(){r.window.addEventListener("click",$,!0),r.window.setTimeout(()=>{r.window.removeEventListener("click",$,!0)},0)}function G(m,l){let d=m.getBoundingClientRect();return ue(m,d,l)}function le(m,l){let d=m.getBoundingClientRect(),_=[];for(let b=0;b<l.length;b++)_.push(ue(m,d,l[b]));return _}function te(m){return r.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&r.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function ue(m,l,d){let _=m.offsetWidth===l.width?1:m.offsetWidth/l.width;return new r.pointGeometry((d.clientX-l.left)*_,(d.clientY-l.top)*_)}function me(m,l){var d=l[0],_=l[1],b=l[2],E=l[3],D=d*E-b*_;return D?(m[0]=E*(D=1/D),m[1]=-_*D,m[2]=-b*D,m[3]=d*D,m):null}function se(m){let{userImage:l}=m;return!!(l&&l.render&&l.render())&&(m.data.replace(new Uint8Array(l.data.buffer)),!0)}class Y extends r.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new r.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(let{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,d){this._validate(l,d)&&(this.images[l]=d)}_validate(l,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new r.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new r.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new r.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,d){if(!l)return!0;let _=0;for(let b of l){if(b[0]<_||b[1]<b[0]||d<b[1])return!1;_=b[1]}return!0}_validateContent(l,d){return!(l&&(l.length!==4||l[0]<0||d.data.width<l[0]||l[1]<0||d.data.height<l[1]||l[2]<0||d.data.width<l[2]||l[3]<0||d.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,d){d.version=this.images[l].version+1,this.images[l]=d,this.updatedImages[l]=!0}removeImage(l){let d=this.images[l];delete this.images[l],delete this.patterns[l],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,d){let _=!0;if(!this.isLoaded())for(let b of l)this.images[b]||(_=!1);this.isLoaded()||_?this._notify(l,d):this.requestors.push({ids:l,callback:d})}_notify(l,d){let _={};for(let b of l){this.images[b]||this.fire(new r.Event("styleimagemissing",{id:b}));let E=this.images[b];E?_[b]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:Boolean(E.userImage&&E.userImage.render)}:r.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){let{width:l,height:d}=this.atlasImage;return{width:l,height:d}}getPattern(l){let d=this.patterns[l],_=this.getImage(l);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{let b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},E=new r.ImagePosition(b,_);this.patterns[l]={bin:b,position:E}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){let d=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new r.Texture(l,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){let l=[];for(let E in this.patterns)l.push(this.patterns[E].bin);let{w:d,h:_}=r.potpack(l),b=this.atlasImage;b.resize({width:d||1,height:_||1});for(let E in this.patterns){let{bin:D}=this.patterns[E],P=D.x+1,F=D.y+1,j=this.images[E].data,W=j.width,ee=j.height;r.RGBAImage.copy(j,b,{x:0,y:0},{x:P,y:F},{width:W,height:ee}),r.RGBAImage.copy(j,b,{x:0,y:ee-1},{x:P,y:F-1},{width:W,height:1}),r.RGBAImage.copy(j,b,{x:0,y:0},{x:P,y:F+ee},{width:W,height:1}),r.RGBAImage.copy(j,b,{x:W-1,y:0},{x:P-1,y:F},{width:1,height:ee}),r.RGBAImage.copy(j,b,{x:0,y:0},{x:P+W,y:F},{width:1,height:ee})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(let d of l){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;let _=this.images[d];se(_)&&this.updateImage(d,_)}}}let ye=new r.Properties({anchor:new r.DataConstantProperty(r.spec.light.anchor),position:new class{constructor(){this.specification=r.spec.light.position}possiblyEvaluate(m,l){return function([d,_,b]){let E=r.degToRad(_+90),D=r.degToRad(b);return{x:d*Math.cos(E)*Math.sin(D),y:d*Math.sin(E)*Math.sin(D),z:d*Math.cos(D),azimuthal:_,polar:b}}(m.expression.evaluate(l))}interpolate(m,l,d){return{x:r.number(m.x,l.x,d),y:r.number(m.y,l.y,d),z:r.number(m.z,l.z,d),azimuthal:r.number(m.azimuthal,l.azimuthal,d),polar:r.number(m.polar,l.polar,d)}}},color:new r.DataConstantProperty(r.spec.light.color),intensity:new r.DataConstantProperty(r.spec.light.intensity)}),Xe="-transition";class ge extends r.Evented{constructor(l){super(),this._transitionable=new r.Transitionable(ye),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d={}){if(!this._validate(r.validateLight,l,d))for(let _ in l){let b=l[_];r.endsWith(_,Xe)?this._transitionable.setTransition(_.slice(0,-Xe.length),b):this._transitionable.setValue(_,b)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,_){return(!_||_.validate!==!1)&&r.emitValidationErrors(this,l.call(r.validateStyle,r.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}let re=new r.Properties({source:new r.DataConstantProperty(r.spec.terrain.source),exaggeration:new r.DataConstantProperty(r.spec.terrain.exaggeration)}),ve="-transition";class ae extends r.Evented{constructor(l,d){super(),this._transitionable=new r.Transitionable(re),this.set(l),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d}get(){return this._transitionable.serialize()}set(l){for(let d in l){let _=l[d];r.endsWith(d,ve)?this._transitionable.setTransition(d.slice(0,-ve.length),_):this._transitionable.setValue(d,_)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}}function de(m,l,d,_){let b=r.smoothstep(45,65,d),[E,D]=xe(m,_),P=r.length(l),F=1-Math.min(1,Math.exp((P-E)/(D-E)*-6));return F*=F*F,F=Math.min(1,1.00747*F),F*b*m.alpha}function xe(m,l){let d=.5/Math.tan(.5*l);return[m.range[0]+d,m.range[1]+d]}let De=new r.Properties({range:new r.DataConstantProperty(r.spec.fog.range),color:new r.DataConstantProperty(r.spec.fog.color),"high-color":new r.DataConstantProperty(r.spec.fog["high-color"]),"space-color":new r.DataConstantProperty(r.spec.fog["space-color"]),"horizon-blend":new r.DataConstantProperty(r.spec.fog["horizon-blend"]),"star-intensity":new r.DataConstantProperty(r.spec.fog["star-intensity"])}),Ce="-transition";class pe extends r.Evented{constructor(l,d){super(),this._transitionable=new r.Transitionable(De),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){let l=this._transform,d=l.projection.name==="globe",_=r.globeToMercatorTransition(l.zoom),b=this.properties.get("range"),E=[.5,3];return{range:d?[r.number(E[0],b[0],_),r.number(E[1],b[1],_)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,d={}){if(!this._validate(r.validateFog,l,d)){for(let _ of Object.keys(r.spec.fog))l&&l[_]===void 0&&(l[_]=r.spec.fog[_].default);for(let _ in l){let b=l[_];r.endsWith(_,Ce)?this._transitionable.setTransition(_.slice(0,-Ce.length),b):this._transitionable.setValue(_,b)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;let d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.smoothstep(45,65,l))*d.a}getOpacityAtLatLng(l,d){return this._transform.projection.supportsFog?function(_,b,E){let D=r.MercatorCoordinate.fromLngLat(b),P=E.elevation?E.elevation.getAtPointOrZero(D):0,F=[D.x,D.y,P];return r.transformMat4(F,F,E.mercatorFogMatrix),de(_,F,E.pitch,E._fov)}(this.state,l,d):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?xe(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,_){return(!_||_.validate!==!1)&&r.emitValidationErrors(this,l.call(r.validateStyle,r.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}class xt{constructor(l,d){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=r.uniqueId();let _=this.workerPool.acquire(this.id);for(let b=0;b<_.length;b++){let E=new xt.Actor(_[b],d,this.id);E.name=`Worker ${b}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,d,_){r.asyncAll(this.actors,(b,E)=>{b.send(l,d,E)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ct(m,l,d){return l*(r.EXTENT/(m.tileSize*Math.pow(2,d-m.tileID.overscaledZ)))}xt.Actor=r.Actor;class ct{constructor(l,d,_,b){this.screenBounds=l,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(l,d){let _,b;if(l instanceof r.pointGeometry||typeof l[0]=="number"){let E=r.pointGeometry.convert(l);_=[E],b=d.isPointAboveHorizon(E)}else{let E=r.pointGeometry.convert(l[0]),D=r.pointGeometry.convert(l[1]);_=[E,D],b=r.polygonizeBounds(E,D).every(P=>d.isPointAboveHorizon(P))}return new ct(_,d.getCameraPoint(),b,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return r.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){let d=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new r.pointGeometry(1,1)):this.screenBounds[1],b=r.polygonizeBounds(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),r.bufferConvexPolygon(b,l)}bufferedCameraGeometryGlobe(l){let d=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new r.pointGeometry(1,1)):this.screenBounds[1],b=r.polygonizeBounds(d,_,l),E=this.cameraPoint.clone();switch(3*((E.y>d.y)+(E.y>_.y))+((E.x>d.x)+(E.x>_.x))){case 0:b[0]=E,b[4]=E.clone();break;case 1:b.splice(1,0,E);break;case 2:b[1]=E;break;case 3:b.splice(4,0,E);break;case 5:b.splice(2,0,E);break;case 6:b[3]=E;break;case 7:b.splice(3,0,E);break;case 8:b[2]=E}return b}containsTile(l,d,_,b=0){let E=l.queryPadding/d._pixelsPerMercatorPixel+1,D=_?this._bufferedCameraMercator(E,d):this._bufferedScreenMercator(E,d),P=l.tileID.wrap+(D.unwrapped?b:0),F=D.polygon.map(Me=>r.getTilePoint(l.tileTransform,Me,P));if(!r.polygonIntersectsBox(F,0,0,r.EXTENT,r.EXTENT))return;P=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);let j=this.screenGeometryMercator.polygon.map(Me=>r.getTileVec3(l.tileTransform,Me,P)),W=j.map(Me=>new r.pointGeometry(Me[0],Me[1])),ee=d.getFreeCameraOptions().position||new r.MercatorCoordinate(0,0,0),fe=r.getTileVec3(l.tileTransform,ee,P),Te=j.map(Me=>{let ce=r.sub(Me,Me,fe);return r.normalize(ce,ce),new r.Ray(fe,ce)}),we=Ct(l,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:W,tilespaceRays:Te,bufferedTilespaceGeometry:F,bufferedTilespaceBounds:(Se=r.getBounds(F),Se.min.x=r.clamp(Se.min.x,0,r.EXTENT),Se.min.y=r.clamp(Se.min.y,0,r.EXTENT),Se.max.x=r.clamp(Se.max.x,0,r.EXTENT),Se.max.y=r.clamp(Se.max.y,0,r.EXTENT),Se),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:we};var Se}_bufferedScreenMercator(l,d){let _=Zt(l);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),d):{polygon:this.bufferedScreenGeometry(l).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[_]=b,b}}_bufferedCameraMercator(l,d){let _=Zt(l);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),d):{polygon:this.bufferedCameraGeometry(l).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[_]=b,b}}_projectAndResample(l,d){let _=function(E,D){let P=r.multiply([],D.pixelMatrix,D.globeMatrix),F=[0,-r.GLOBE_RADIUS,0,1],j=[0,r.GLOBE_RADIUS,0,1],W=[0,0,0,1];r.transformMat4$1(F,F,P),r.transformMat4$1(j,j,P),r.transformMat4$1(W,W,P);let ee=new r.pointGeometry(F[0]/F[3],F[1]/F[3]),fe=new r.pointGeometry(j[0]/j[3],j[1]/j[3]),Te=r.polygonContainsPoint(E,ee)&&F[3]<W[3],we=r.polygonContainsPoint(E,fe)&&j[3]<W[3];if(!Te&&!we)return null;let Se=function($e,it,dt){for(let mt=1;mt<$e.length;mt++){let Qt=zt(it.pointCoordinate3D($e[mt-1]).x),lt=zt(it.pointCoordinate3D($e[mt]).x);if(dt<0){if(Qt<lt)return{idx:mt,t:-Qt/(lt-1-Qt)}}else if(lt<Qt)return{idx:mt,t:(1-Qt)/(lt+1-Qt)}}return null}(E,D,Te?-1:1);if(!Se)return null;let{idx:Me,t:ce}=Se,Oe=Me>1?Qe(E.slice(0,Me),D):[],Pe=Me<E.length?Qe(E.slice(Me),D):[];Oe=Oe.map($e=>new r.pointGeometry(zt($e.x),$e.y)),Pe=Pe.map($e=>new r.pointGeometry(zt($e.x),$e.y));let Ue=[...Oe];Ue.length===0&&Ue.push(Pe[Pe.length-1]);let Ze=r.number(Ue[Ue.length-1].y,(Pe.length===0?Oe[0]:Pe[0]).y,ce),je;return je=Te?[new r.pointGeometry(0,Ze),new r.pointGeometry(0,0),new r.pointGeometry(1,0),new r.pointGeometry(1,Ze)]:[new r.pointGeometry(1,Ze),new r.pointGeometry(1,1),new r.pointGeometry(0,1),new r.pointGeometry(0,Ze)],Ue.push(...je),Pe.length===0?Ue.push(Oe[0]):Ue.push(...Pe),{polygon:Ue.map($e=>new r.MercatorCoordinate($e.x,$e.y)),unwrapped:!1}}(l,d);if(_)return _;let b=function(E,D){let P=!1,F=-1/0,j=0;for(let ee=0;ee<E.length-1;ee++)E[ee].x>F&&(F=E[ee].x,j=ee);for(let ee=0;ee<E.length-1;ee++){let fe=(j+ee)%(E.length-1),Te=E[fe],we=E[fe+1];Math.abs(Te.x-we.x)>.5&&(Te.x<we.x?(Te.x+=1,fe===0&&(E[E.length-1].x+=1)):(we.x+=1,fe+1===E.length-1&&(E[0].x+=1)),P=!0)}let W=r.mercatorXfromLng(D.center.lng);return P&&W<Math.abs(W-1)&&E.forEach(ee=>{ee.x-=1}),{polygon:E,unwrapped:P}}(Qe(l,d).map(E=>new r.pointGeometry(zt(E.x),E.y)),d);return{polygon:b.polygon.map(E=>new r.MercatorCoordinate(E.x,E.y)),unwrapped:b.unwrapped}}}function Qe(m,l){return r.resample(m,d=>{let _=l.pointCoordinate3D(d);d.x=_.x,d.y=_.y},1/256)}function zt(m){return m<0?1+m%1:m%1}function Zt(m){return 100*m|0}function Lt(m,l,d,_,b){let E=function(D,P){if(D)return b(D);if(P){m.url&&P.tiles&&m.tiles&&delete m.tiles;let F=r.pick(r.extend(P,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(F.vectorLayers=P.vector_layers,F.vectorLayerIds=F.vectorLayers.map(j=>j.id)),F.tiles=l.canonicalizeTileset(F,m.url),b(null,F)}};return m.url?r.getJSON(l.transformRequest(l.normalizeSourceURL(m.url,null,d,_),r.ResourceType.Source),E):r.exported.frame(()=>E(null,m))}class Re{constructor(l,d,_){this.bounds=r.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){let d=Math.pow(2,l.z),_=Math.floor(r.mercatorXfromLng(this.bounds.getWest())*d),b=Math.floor(r.mercatorYfromLat(this.bounds.getNorth())*d),E=Math.ceil(r.mercatorXfromLng(this.bounds.getEast())*d),D=Math.ceil(r.mercatorYfromLat(this.bounds.getSouth())*d);return l.x>=_&&l.x<E&&l.y>=b&&l.y<D}}class qt{constructor(l,d,_){this.context=l;let b=l.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){let d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let nt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class at{constructor(l,d,_,b){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.context=l;let E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){let d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let _=0;_<this.attributes.length;_++){let b=d.attributes[this.attributes[_].name];b!==void 0&&l.enableVertexAttribArray(b)}}setVertexAttribPointers(l,d,_){for(let b=0;b<this.attributes.length;b++){let E=this.attributes[b],D=d.attributes[E.name];D!==void 0&&l.vertexAttribPointer(D,E.components,l[nt[E.type]],!1,this.itemSize,E.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class St{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ut extends St{getDefault(){return r.Color.transparent}set(l){let d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ot extends St{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Pn extends St{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class bn extends St{getDefault(){return[!0,!0,!0,!0]}set(l){let d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class wn extends St{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class xn extends St{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class ei extends St{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){let d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class ze extends St{getDefault(){let l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){let d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Ae extends St{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class gt extends St{getDefault(){return[0,1]}set(l){let d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Rt extends St{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class Xt extends St{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class gn extends St{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class Tn extends St{getDefault(){let l=this.gl;return[l.ONE,l.ZERO]}set(l){let d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Ee extends St{getDefault(){return r.Color.transparent}set(l){let d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class et extends St{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class rn extends St{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class tn extends St{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Je extends St{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class sn extends St{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class nn extends St{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class An extends St{getDefault(){let l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){let d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Et extends St{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Dn extends St{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class un extends St{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Nn extends St{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Kn extends St{getDefault(){return null}set(l){let d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Gn extends St{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class Ei extends St{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class ln extends St{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class li extends St{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;let d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class $t extends St{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class kn extends $t{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Un extends $t{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Yn extends Un{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ft{constructor(l,d,_,b){this.context=l,this.width=d,this.height=_;let E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new kn(l,E),b&&(this.depthAttachment=new Un(l,E))}destroy(){let l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){let _=this.depthAttachment.get();_&&l.deleteRenderbuffer(_)}l.deleteFramebuffer(this.framebuffer)}}class he{constructor(l,d=!1){if(this.gl=l,this.isWebGL2=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),d){let _=l;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(l),deleteVertexArrayOES:_.deleteVertexArray.bind(l),bindVertexArrayOES:_.bindVertexArray.bind(l)}}this.clearColor=new ut(this),this.clearDepth=new Ot(this),this.clearStencil=new Pn(this),this.colorMask=new bn(this),this.depthMask=new wn(this),this.stencilMask=new xn(this),this.stencilFunc=new ei(this),this.stencilOp=new ze(this),this.stencilTest=new Ae(this),this.depthRange=new gt(this),this.depthTest=new Rt(this),this.depthFunc=new Xt(this),this.blend=new gn(this),this.blendFunc=new Tn(this),this.blendColor=new Ee(this),this.blendEquation=new et(this),this.cullFace=new rn(this),this.cullFaceSide=new tn(this),this.frontFace=new Je(this),this.program=new sn(this),this.activeTexture=new nn(this),this.viewport=new An(this),this.bindFramebuffer=new Et(this),this.bindRenderbuffer=new Dn(this),this.bindTexture=new un(this),this.bindVertexBuffer=new Nn(this),this.bindElementBuffer=new Kn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Gn(this),this.pixelStoreUnpack=new Ei(this),this.pixelStoreUnpackPremultiplyAlpha=new ln(this),this.pixelStoreUnpackFlipY=new li(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),d||(this.extTextureHalfFloat=l.getExtension("OES_texture_half_float")),(d||this.extTextureHalfFloat&&l.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=d||l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d){return new qt(this,l,d)}createVertexBuffer(l,d,_){return new at(this,l,d,_)}createRenderbuffer(l,d,_){let b=this.gl,E=b.createRenderbuffer();return this.bindRenderbuffer.set(E),b.renderbufferStorage(b.RENDERBUFFER,l,d,_),this.bindRenderbuffer.set(null),E}createFramebuffer(l,d,_){return new Ft(this,l,d,_)}clear({color:l,depth:d,stencil:_}){let b=this.gl,E=0;l&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),_!==void 0&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(E)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){x(l.blendFunction,r.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class X extends r.Evented{constructor(l,d,_,b){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.extend(this,r.pick(d,["url","scheme","tileSize","promoteId"])),this._options=r.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new r.DedupedRequest}load(l){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"}));let d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Lt(this._options,this.map._requestManager,d,_,(b,E)=>{this._tileJSONRequest=null,this._loaded=!0,b?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new r.ErrorEvent(b))):E&&(r.extend(this,E),E.bounds&&(this.tileBounds=new Re(E.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(b)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.extend({},this._options)}loadTile(l,d){let _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(_,r.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=d:l.request=l.actor.send("reloadTile",b,E.bind(this));else if(l.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",b,E.bind(this),void 0,!0);else{let D=r.loadVectorTile.call({deduped:this._deduped},b,(P,F)=>{P||!F?E.call(this,P):(b.data={cacheControl:F.cacheControl,expires:F.expires,rawData:F.rawData.slice(0)},l.actor&&l.actor.send("loadTile",b,E.bind(this),void 0,!0))},!0);l.request={cancel:D}}function E(D,P){return delete l.request,l.aborted?d(null):D&&D.status!==404?d(D):(P&&P.resourceTiming&&(l.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&l.setExpiryData(P),l.loadVectorData(P,this.map.painter),r.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class N extends r.Evented{constructor(l,d,_,b){super(),this.id=l,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.extend({type:"raster"},d),r.extend(this,r.pick(d,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lt(this._options,this.map._requestManager,null,null,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new r.ErrorEvent(d)):_&&(r.extend(this,_),_.bounds&&(this.tileBounds=new Re(_.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(_.tiles),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(d)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){let _=r.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);l.request=r.getImage(this.map._requestManager.transformRequest(b,r.ResourceType.Tile),(E,D,P,F)=>(delete l.request,l.aborted?(l.state="unloaded",d(null)):E?(l.state="errored",d(E)):D?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:P,expires:F}),l.setTexture(D,this.map.painter),l.state="loaded",r.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(l,d,_){l.setTexture(d,_)}static unloadTileData(l,d){l.texture&&d.saveTileTexture(l.texture)}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d()}unloadTile(l,d){l.texture&&this.map.painter.saveTileTexture(l.texture),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let K;function ne(m,l,d,_,b,E,D,P){let F=[m,d,b,l,_,E,1,1,1],j=[D,P,1],W=r.adjoint([],F),[ee,fe,Te]=r.transformMat3(j,j,r.transpose(W,W));return r.multiply$1(F,[ee,0,0,0,fe,0,0,0,Te],F)}class oe extends r.Evented{constructor(l,d,_,b){super(),this.id=l,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=d,this._dirty=!1}load(l,d){this._loaded=d||!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=r.getImage(this.map._requestManager.transformRequest(this.url,r.ResourceType.Image),(_,b)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new r.ErrorEvent(_));else if(b){let{HTMLImageElement:E}=r.window;this.image=b instanceof E?r.exported.getImageData(b):b,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;let d=l.map(r.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let b=1/0,E=1/0,D=-1/0,P=-1/0;for(let ee of _)b=Math.min(b,ee.x),E=Math.min(E,ee.y),D=Math.max(D,ee.x),P=Math.max(P,ee.y);let F=Math.max(D-b,P-E),j=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),W=Math.pow(2,j);return new r.CanonicalTileID(j,Math.floor((b+D)/2*W),Math.floor((E+P)/2*W))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(let F in this.tiles){let j=this.tiles[F];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture)}if(this._boundsArray)return;let d=r.tileTransform(this.tileID,this.map.transform.projection),[_,b,E,D]=this.coordinates.map(F=>{let j=d.projection.project(F[0],F[1]);return r.getTilePoint(d,j)._round()});this.perspectiveTransform=function(F,j,W,ee,fe,Te,we,Se,Me,ce){let Oe=ne(0,0,F,0,0,j,F,j),Pe=ne(W,ee,fe,Te,we,Se,Me,ce);return r.multiply$1(Pe,r.adjoint(Oe,Oe),Pe),[Pe[6]/Pe[8]*F/r.EXTENT,Pe[7]/Pe[8]*j/r.EXTENT]}(this.width,this.height,_.x,_.y,b.x,b.y,D.x,D.y,E.x,E.y);let P=this._boundsArray=new r.StructArrayLayout4i8;P.emplaceBack(_.x,_.y,0,0),P.emplaceBack(b.x,b.y,r.EXTENT,0),P.emplaceBack(D.x,D.y,0,r.EXTENT),P.emplaceBack(E.x,E.y,r.EXTENT,r.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(P,r.boundsAttributes.members),this.boundsSegments=r.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let l=this.map.painter.context,d=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new r.Texture(l,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,d){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},d(null)):(l.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}let be={vector:X,raster:N,"raster-dem":class extends N{constructor(m,l,d,_){super(m,l,d,_),this.type="raster-dem",this.maxzoom=22,this._options=r.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(m,l){let d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(b,E){b&&(m.state="errored",l(b)),E&&(m.dem=E,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",l(null))}m.request=r.getImage(this.map._requestManager.transformRequest(d,r.ResourceType.Tile),function(b,E,D,P){if(delete m.request,m.aborted)m.state="unloaded",l(null);else if(b)m.state="errored",l(b);else if(E){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:D,expires:P});let F=r.window.ImageBitmap&&E instanceof r.window.ImageBitmap&&(K==null&&(K=r.window.OffscreenCanvas&&new r.window.OffscreenCanvas(1,1).getContext("2d")&&typeof r.window.createImageBitmap=="function"),K),j=1-(E.width-r.prevPowerOfTwo(E.width))/2;j<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));let W=F?E:r.exported.getImageData(E,j),ee={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:W,encoding:this.encoding,padding:j};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",ee,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){let l=m.canonical,d=Math.pow(2,l.z),_=(l.x-1+d)%d,b=l.x===0?m.wrap-1:m.wrap,E=(l.x+1+d)%d,D=l.x+1===d?m.wrap+1:m.wrap,P={};return P[new r.OverscaledTileID(m.overscaledZ,b,l.z,_,l.y).key]={backfilled:!1},P[new r.OverscaledTileID(m.overscaledZ,D,l.z,E,l.y).key]={backfilled:!1},l.y>0&&(P[new r.OverscaledTileID(m.overscaledZ,b,l.z,_,l.y-1).key]={backfilled:!1},P[new r.OverscaledTileID(m.overscaledZ,m.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},P[new r.OverscaledTileID(m.overscaledZ,D,l.z,E,l.y-1).key]={backfilled:!1}),l.y+1<d&&(P[new r.OverscaledTileID(m.overscaledZ,b,l.z,_,l.y+1).key]={backfilled:!1},P[new r.OverscaledTileID(m.overscaledZ,m.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},P[new r.OverscaledTileID(m.overscaledZ,D,l.z,E,l.y+1).key]={backfilled:!1}),P}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends r.Evented{constructor(m,l,d,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=l.data,this._options=r.extend({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;let b=r.EXTENT/this.tileSize;this.workerOptions=r.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*b,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*b,extent:r.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:r.EXTENT,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*b,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},l),this}getClusterChildren(m,l){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},l),this}getClusterLeaves(m,l,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:l,offset:d},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.Event("dataloading",{dataType:"source"})),this._loaded=!1;let m=r.extend({},this.workerOptions),l=this._data;typeof l=="string"?(m.request=this.map._requestManager.transformRequest(r.exported.resolveURL(l),r.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new r.ErrorEvent(d));else{let b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),this.fire(new r.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,l){let d=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(d,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,b)=>(delete m.request,m.unloadVectorData(),m.aborted?l(null):_?l(_):(m.loadVectorData(b,this.map.painter,d==="reloadTile"),l(null))),void 0,d==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends oe{constructor(m,l,d,_){super(m,l,d,_),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;let m=this.options;this.urls=[];for(let l of m.urls)this.urls.push(this.map._requestManager.transformRequest(l,r.ResourceType.Source).url);r.getVideo(this.urls,(l,d)=>{this._loaded=!0,l?this.fire(new r.ErrorEvent(l)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){let l=this.video.seekable;m<l.start(0)||m>l.end(0)?this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let m=this.map.painter.context,l=m.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new r.Texture(m,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:oe,canvas:class extends oe{constructor(m,l,d,_){super(m,l,d,_),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(E=>typeof E!="number"))||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof r.window.HTMLCanvasElement||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof r.window.HTMLCanvasElement?this.options.canvas:r.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let l=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends r.Evented{constructor(m,l,d,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=l,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Re(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),r.extend(this,r.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){let{x:l,y:d,z:_}=m.canonical;return this._implementation.hasTile({x:l,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,l){let{x:d,y:_,z:b}=m.tileID.canonical,E=new r.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:d,y:_,z:b},{signal:E.signal})).then(function(D){return delete m.request,m.aborted?(m.state="unloaded",l(null)):D===void 0?(m.state="errored",l(null)):D===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",l(null)):function(P){return P instanceof r.window.ImageData||P instanceof r.window.HTMLCanvasElement||P instanceof r.window.ImageBitmap||P instanceof r.window.HTMLImageElement}(D)?(this.loadTileData(m,D),m.state="loaded",void l(null)):(m.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(D=>{D.code!==20&&(m.state="errored",l(D))}),m.request.cancel=()=>E.abort()}loadTileData(m,l){N.loadTileData(m,l,this._map.painter)}unloadTileData(m){N.unloadTileData(m,this._map.painter)}unloadTile(m,l){if(this.unloadTileData(m),this._implementation.unloadTile){let{x:d,y:_,z:b}=m.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:b})}l()}abortTile(m,l){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Fe=function(m,l,d,_){let b=new be[l.type](m,l,d,_);if(b.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${b.id}`);return r.bindAll(["load","abort","unload","serialize","prepare"],b),b};function Ne(m,l){let d=r.identity([]);return r.scale(d,d,[.5*m.width,.5*-m.height,1]),r.translate(d,d,[1,-1,0]),r.multiply(d,d,m.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(d)}function Ke(m,l,d,_,b,E,D,P=!1){let F=m.tilesIn(_,D,P);F.sort(Pt);let j=[];for(let ee of F)j.push({wrappedTileID:ee.tile.tileID.wrapped().key,queryResults:ee.tile.queryRenderedFeatures(l,d,m._state,ee,b,E,Ne(m.transform,ee.tile.tileID),P)});let W=function(ee){let fe={},Te={};for(let we of ee){let Se=we.queryResults,Me=we.wrappedTileID,ce=Te[Me]=Te[Me]||{};for(let Oe in Se){let Pe=Se[Oe],Ue=ce[Oe]=ce[Oe]||{},Ze=fe[Oe]=fe[Oe]||[];for(let je of Pe)Ue[je.featureIndex]||(Ue[je.featureIndex]=!0,Ze.push(je))}}return fe}(j);for(let ee in W)W[ee].forEach(fe=>{let Te=fe.feature,we=Te.layer;we&&we.type!=="background"&&we.type!=="sky"&&(Te.source=we.source,we["source-layer"]&&(Te.sourceLayer=we["source-layer"]),Te.state=Te.id!==void 0?m.getFeatureState(we["source-layer"],Te.id):{})});return W}function rt(m,l){let d=m.getRenderableIds().map(E=>m.getTileByID(E)),_=[],b={};for(let E=0;E<d.length;E++){let D=d[E],P=D.tileID.canonical.key;b[P]||(b[P]=!0,D.querySourceFeatures(_,l))}return _}function Pt(m,l){let d=m.tileID,_=l.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function _t(){return Gu.workerClass!=null?new Gu.workerClass:new r.window.Worker(Gu.workerUrl)}let Jt="mapboxgl_preloaded_worker_pool";class Ht{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<Ht.workerCount;)this.workers.push(new _t);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Jt]}numActive(){return Object.keys(this.active).length}}let cn;function In(){return cn||(cn=new Ht),cn}function Wn(m,l){let d={};for(let _ in m)_!=="ref"&&(d[_]=m[_]);return r.refProperties.forEach(_=>{_ in l&&(d[_]=l[_])}),d}function $n(m){m=m.slice();let l=Object.create(null);for(let d=0;d<m.length;d++)l[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=Wn(m[d],l[m[d].ref]));return m}Ht.workerCount=2;let hn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function yi(m,l,d){d.push({command:hn.addSource,args:[m,l[m]]})}function Qn(m,l,d){l.push({command:hn.removeSource,args:[m]}),d[m]=!0}function Rr(m,l,d,_){Qn(m,d,_),yi(m,l,d)}function Fr(m,l,d){let _;for(_ in m[d])if(m[d].hasOwnProperty(_)&&_!=="data"&&!x(m[d][_],l[d][_]))return!1;for(_ in l[d])if(l[d].hasOwnProperty(_)&&_!=="data"&&!x(m[d][_],l[d][_]))return!1;return!0}function Tt(m,l,d,_,b,E){let D;for(D in l=l||{},m=m||{})m.hasOwnProperty(D)&&(x(m[D],l[D])||d.push({command:E,args:[_,D,l[D],b]}));for(D in l)l.hasOwnProperty(D)&&!m.hasOwnProperty(D)&&(x(m[D],l[D])||d.push({command:E,args:[_,D,l[D],b]}))}function hs(m){return m.id}function Si(m,l){return m[l.id]=l,m}class As{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=r.clamp(l,0,1);let d=1,_=this._distances[d],b=l*this.paddedLength+this.padding;for(;_<b&&d<this._distances.length;)_=this._distances[++d];let E=d-1,D=this._distances[E],P=_-D,F=P>0?(b-D)/P:0;return this.points[E].mult(1-F).add(this.points[d].mult(F))}}class ia{constructor(l,d,_){let b=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(d/_);for(let D=0;D<this.xCellCount*this.yCellCount;D++)b.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,_,b,E){this._forEachCell(d,_,b,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(E)}insertCircle(l,d,_,b){this._forEachCell(d-b,_-b,d+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(_),this.circles.push(b)}_insertBoxCell(l,d,_,b,E,D){this.boxCells[E].push(D)}_insertCircleCell(l,d,_,b,E,D){this.circleCells[E].push(D)}_query(l,d,_,b,E,D){if(_<0||l>this.width||b<0||d>this.height)return!E&&[];let P=[];if(l<=0&&d<=0&&this.width<=_&&this.height<=b){if(E)return!0;for(let F=0;F<this.boxKeys.length;F++)P.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){let j=this.circles[3*F],W=this.circles[3*F+1],ee=this.circles[3*F+2];P.push({key:this.circleKeys[F],x1:j-ee,y1:W-ee,x2:j+ee,y2:W+ee})}return D?P.filter(D):P}return this._forEachCell(l,d,_,b,this._queryCell,P,{hitTest:E,seenUids:{box:{},circle:{}}},D),E?P.length>0:P}_queryCircle(l,d,_,b,E){let D=l-_,P=l+_,F=d-_,j=d+_;if(P<0||D>this.width||j<0||F>this.height)return!b&&[];let W=[];return this._forEachCell(D,F,P,j,this._queryCellCircle,W,{hitTest:b,circle:{x:l,y:d,radius:_},seenUids:{box:{},circle:{}}},E),b?W.length>0:W}query(l,d,_,b,E){return this._query(l,d,_,b,!1,E)}hitTest(l,d,_,b,E){return this._query(l,d,_,b,!0,E)}hitTestCircle(l,d,_,b){return this._queryCircle(l,d,_,!0,b)}_queryCell(l,d,_,b,E,D,P,F){let j=P.seenUids,W=this.boxCells[E];if(W!==null){let fe=this.bboxes;for(let Te of W)if(!j.box[Te]){j.box[Te]=!0;let we=4*Te;if(l<=fe[we+2]&&d<=fe[we+3]&&_>=fe[we+0]&&b>=fe[we+1]&&(!F||F(this.boxKeys[Te]))){if(P.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[Te],x1:fe[we],y1:fe[we+1],x2:fe[we+2],y2:fe[we+3]})}}}let ee=this.circleCells[E];if(ee!==null){let fe=this.circles;for(let Te of ee)if(!j.circle[Te]){j.circle[Te]=!0;let we=3*Te;if(this._circleAndRectCollide(fe[we],fe[we+1],fe[we+2],l,d,_,b)&&(!F||F(this.circleKeys[Te]))){if(P.hitTest)return D.push(!0),!0;{let Se=fe[we],Me=fe[we+1],ce=fe[we+2];D.push({key:this.circleKeys[Te],x1:Se-ce,y1:Me-ce,x2:Se+ce,y2:Me+ce})}}}}}_queryCellCircle(l,d,_,b,E,D,P,F){let j=P.circle,W=P.seenUids,ee=this.boxCells[E];if(ee!==null){let Te=this.bboxes;for(let we of ee)if(!W.box[we]){W.box[we]=!0;let Se=4*we;if(this._circleAndRectCollide(j.x,j.y,j.radius,Te[Se+0],Te[Se+1],Te[Se+2],Te[Se+3])&&(!F||F(this.boxKeys[we])))return D.push(!0),!0}}let fe=this.circleCells[E];if(fe!==null){let Te=this.circles;for(let we of fe)if(!W.circle[we]){W.circle[we]=!0;let Se=3*we;if(this._circlesCollide(Te[Se],Te[Se+1],Te[Se+2],j.x,j.y,j.radius)&&(!F||F(this.circleKeys[we])))return D.push(!0),!0}}}_forEachCell(l,d,_,b,E,D,P,F){let j=this._convertToXCellCoord(l),W=this._convertToYCellCoord(d),ee=this._convertToXCellCoord(_),fe=this._convertToYCellCoord(b);for(let Te=j;Te<=ee;Te++)for(let we=W;we<=fe;we++)if(E.call(this,l,d,_,b,this.xCellCount*we+Te,D,P,F))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,_,b,E,D){let P=b-l,F=E-d,j=_+D;return j*j>P*P+F*F}_circleAndRectCollide(l,d,_,b,E,D,P){let F=(D-b)/2,j=Math.abs(l-(b+F));if(j>F+_)return!1;let W=(P-E)/2,ee=Math.abs(d-(E+W));if(ee>W+_)return!1;if(j<=F||ee<=W)return!0;let fe=j-F,Te=ee-W;return fe*fe+Te*Te<=_*_}}let yr=Math.tan(85*Math.PI/180);function Po(m,l,d,_,b,E,D){let P=r.create();if(d)if(E.name==="globe"){let F=r.calculateGlobeLabelMatrix(b,l);r.multiply(P,P,F)}else{let F=me([],D);P[0]=F[0],P[1]=F[1],P[4]=F[2],P[5]=F[3],_||r.rotateZ(P,P,b.angle)}else r.multiply(P,b.labelPlaneMatrix,m);return P}function ko(m,l,d,_,b,E,D){let P=Po(m,l,d,_,b,E,D);return E.name==="globe"&&d||(P[2]=P[6]=P[10]=P[14]=0),P}function La(m,l,d,_,b,E,D){if(d){if(E.name==="globe"){let P=Po(m,l,d,_,b,E,D);return r.invert(P,P),r.multiply(P,m,P),P}{let P=r.clone(m),F=r.identity([]);return F[0]=D[0],F[1]=D[1],F[4]=D[2],F[5]=D[3],r.multiply(P,P,F),_||r.rotateZ(P,P,-b.angle),P}}return b.glCoordMatrix}function an(m,l,d,_){let b=[m,l,d,1];d?r.transformMat4$1(b,b,_):ra(b,b,_);let E=b[3];return b[0]/=E,b[1]/=E,b[2]/=E,b}function di(m,l){return Math.min(.5+m/l*.5,1.5)}function ci(m,l){let d=m[0]/m[3],_=m[1]/m[3];return d>=-l[0]&&d<=l[0]&&_>=-l[1]&&_<=l[1]}function qe(m,l,d,_,b,E,D,P,F,j){let W=d.transform,ee=_?m.textSizeData:m.iconSizeData,fe=r.evaluateSizeForZoom(ee,d.transform.zoom),Te=W.projection.name==="globe",we=[256/d.width*2+1,256/d.height*2+1],Se=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Se.clear();let Me=null;Te&&(Me=_?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);let ce=m.lineVertexArray,Oe=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,Pe=d.transform.width/d.transform.height,Ue,Ze=!1;for(let je=0;je<Oe.length;je++){let $e=Oe.get(je),{numGlyphs:it,writingMode:dt}=$e;if(dt!==r.WritingMode.vertical||Ze||Ue===r.WritingMode.horizontal||(Ze=!0),Ue=dt,($e.hidden||dt===r.WritingMode.vertical)&&!Ze){fi(it,Se);continue}Ze=!1;let mt=new r.pointGeometry($e.tileAnchorX,$e.tileAnchorY),{x:Qt,y:lt,z:Dt}=W.projection.projectTilePoint(mt.x,mt.y,j.canonical);if(F){let[oi,Mn,vn]=F(mt);Qt+=oi,lt+=Mn,Dt+=vn}let bt=[Qt,lt,Dt,1];if(r.transformMat4$1(bt,bt,l),!ci(bt,we)){fi(it,Se);continue}let Ut=di(d.transform.cameraToCenterDistance,bt[3]),ft=r.evaluateSizeForFeature(ee,fe,$e),tt=D?ft/Ut:ft*Ut,yt=an(Qt,lt,Dt,b);if(yt[3]<=0){fi(it,Se);continue}let Nt={},jt=D?null:F,zn=Ye($e,tt,!1,P,l,b,E,m.glyphOffsetArray,ce,Se,Me,yt,mt,Nt,Pe,jt,W.projection,j,D);Ze=zn.useVertical,jt&&zn.needsFlipping&&(Nt={}),(zn.notEnoughRoom||Ze||zn.needsFlipping&&Ye($e,tt,!0,P,l,b,E,m.glyphOffsetArray,ce,Se,Me,yt,mt,Nt,Pe,jt,W.projection,j,D).notEnoughRoom)&&fi(it,Se)}_?(m.text.dynamicLayoutVertexBuffer.updateData(Se),Me&&m.text.globeExtVertexBuffer.updateData(Me)):(m.icon.dynamicLayoutVertexBuffer.updateData(Se),Me&&m.icon.globeExtVertexBuffer.updateData(Me))}function pn(m,l,d,_,b,E,D,P,F,j,W,ee,fe,Te,we,Se){let{lineStartIndex:Me,glyphStartIndex:ce,segment:Oe}=P,Pe=ce+P.numGlyphs,Ue=Me+P.lineLength,Ze=l.getoffsetX(ce),je=l.getoffsetX(Pe-1),$e=Mi(m*Ze,d,_,b,E,D,Oe,Me,Ue,F,j,W,ee,fe,!0,Te,we,Se);if(!$e)return null;let it=Mi(m*je,d,_,b,E,D,Oe,Me,Ue,F,j,W,ee,fe,!0,Te,we,Se);return it?{first:$e,last:it}:null}function st(m,l,d,_){return m===r.WritingMode.horizontal&&Math.abs(_)>Math.abs(d)?{useVertical:!0}:m===r.WritingMode.vertical?_>0?{needsFlipping:!0}:null:l!==0&&function(b,E){return b===0||Math.abs(E/b)>yr}(d,_)?l===1?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function Ye(m,l,d,_,b,E,D,P,F,j,W,ee,fe,Te,we,Se,Me,ce,Oe){let Pe=l/24,Ue=m.lineOffsetX*Pe,Ze=m.lineOffsetY*Pe,{lineStartIndex:je,glyphStartIndex:$e,numGlyphs:it,segment:dt,writingMode:mt,flipState:Qt}=m,lt=je+m.lineLength,Dt=bt=>{if(W){let[yt,Nt,jt]=bt.up,zn=j.length;r.updateGlobeVertexNormal(W,zn+0,yt,Nt,jt),r.updateGlobeVertexNormal(W,zn+1,yt,Nt,jt),r.updateGlobeVertexNormal(W,zn+2,yt,Nt,jt),r.updateGlobeVertexNormal(W,zn+3,yt,Nt,jt)}let[Ut,ft,tt]=bt.point;r.addDynamicAttributes(j,Ut,ft,tt,bt.angle)};if(it>1){let bt=pn(Pe,P,Ue,Ze,d,ee,fe,m,F,E,Te,Se,!1,Me,ce,Oe);if(!bt)return{notEnoughRoom:!0};if(_&&!d){let[Ut,ft,tt]=bt.first.point,[yt,Nt,jt]=bt.last.point;[Ut,ft]=an(Ut,ft,tt,D),[yt,Nt]=an(yt,Nt,jt,D);let zn=st(mt,Qt,(yt-Ut)*we,Nt-ft);if(m.flipState=zn&&zn.needsFlipping?1:2,zn)return zn}Dt(bt.first);for(let Ut=$e+1;Ut<$e+it-1;Ut++){let ft=Mi(Pe*P.getoffsetX(Ut),Ue,Ze,d,ee,fe,dt,je,lt,F,E,Te,Se,!1,!1,Me,ce,Oe);if(!ft)return j.length-=4*(Ut-$e),{notEnoughRoom:!0};Dt(ft)}Dt(bt.last)}else{if(_&&!d){let Ut=an(fe.x,fe.y,0,b),ft=je+dt+1,tt=new r.pointGeometry(F.getx(ft),F.gety(ft)),yt=an(tt.x,tt.y,0,b),Nt=yt[3]>0?yt:Cn(fe,tt,Ut,1,b,void 0,Me,ce.canonical),jt=st(mt,Qt,(Nt[0]-Ut[0])*we,Nt[1]-Ut[1]);if(m.flipState=jt&&jt.needsFlipping?1:2,jt)return jt}let bt=Mi(Pe*P.getoffsetX($e),Ue,Ze,d,ee,fe,dt,je,lt,F,E,Te,Se,!1,!1,Me,ce,Oe);if(!bt)return{notEnoughRoom:!0};Dt(bt)}return{}}function ui(m,l,d,_,b){let{x:E,y:D,z:P}=_.projectTilePoint(m.x,m.y,l);if(!b)return an(E,D,P,d);let[F,j,W]=b(m);return an(E+F,D+j,P+W,d)}function Cn(m,l,d,_,b,E,D,P){let F=ui(m.sub(l)._unit()._add(m),P,b,D,E);return r.sub(F,d,F),r.normalize(F,F),r.scaleAndAdd(F,d,F,_)}function Mi(m,l,d,_,b,E,D,P,F,j,W,ee,fe,Te,we,Se,Me,ce){let Oe=_?m-l:m+l,Pe=Oe>0?1:-1,Ue=0;_&&(Pe*=-1,Ue=Math.PI),Pe<0&&(Ue+=Math.PI);let Ze=P+D+(Pe>0?0:1)|0,je=b,$e=b,it=0,dt=0,mt=Math.abs(Oe),Qt=[],lt=[],Dt=E,bt=Dt,Ut=()=>Cn(bt,Dt,$e,mt-it+1,W,fe,Se,Me.canonical);for(;it+dt<=mt;){if(Ze+=Pe,Ze<P||Ze>=F)return null;if($e=je,bt=Dt,Qt.push($e),Te&&lt.push(bt),Dt=new r.pointGeometry(j.getx(Ze),j.gety(Ze)),je=ee[Ze],!je){let vn=ui(Dt,Me.canonical,W,Se,fe);je=vn[3]>0?ee[Ze]=vn:Ut()}it+=dt,dt=r.distance($e,je)}we&&fe&&(ee[Ze]&&(je=Ut(),dt=r.distance($e,je)),ee[Ze]=je);let ft=(mt-it)/dt,tt=Dt.sub(bt)._mult(ft)._add(bt),yt=r.sub([],je,$e),Nt=r.scaleAndAdd([],$e,yt,ft),jt=[0,0,1],zn=yt[0],oi=yt[1];if(ce&&(jt=Se.upVector(Me.canonical,tt.x,tt.y),jt[0]!==0||jt[1]!==0||jt[2]!==1)){let vn=[jt[2],0,-jt[0]],Fn=r.cross([],jt,vn);r.normalize(vn,vn),r.normalize(Fn,Fn),zn=r.dot(yt,vn),oi=r.dot(yt,Fn)}if(d){let vn=r.cross([],jt,yt);r.normalize(vn,vn),r.scaleAndAdd(Nt,Nt,vn,d*Pe)}let Mn=Ue+Math.atan2(oi,zn);return Qt.push(Nt),Te&&lt.push(tt),{point:Nt,angle:Mn,path:Qt,tilePath:lt,up:jt}}function fi(m,l){let d=l.length,_=d+4*m;l.resize(_),l.float32.fill(-1/0,4*d,4*_)}function ra(m,l,d){let _=l[0],b=l[1];return m[0]=d[0]*_+d[4]*b+d[12],m[1]=d[1]*_+d[5]*b+d[13],m[3]=d[3]*_+d[7]*b+d[15],m}let Ir=100;class nc{constructor(l,d,_=new ia(l.width+200,l.height+200,25),b=new ia(l.width+200,l.height+200,25)){this.transform=l,this.grid=_,this.ignoredGrid=b,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Ir,this.screenBottomBoundary=l.height+Ir,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=d}placeCollisionBox(l,d,_,b,E,D,P,F){let j=_.projectedAnchorX,W=_.projectedAnchorY,ee=_.projectedAnchorZ,fe=_.elevation,Te=_.tileID,we=l.getProjection();if(fe&&Te){let[je,$e,it]=we.upVector(Te.canonical,_.tileAnchorX,_.tileAnchorY),dt=we.upVectorScale(Te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;j+=je*fe*dt,W+=$e*fe*dt,ee+=it*fe*dt}let Se=this.projectAndGetPerspectiveRatio(P,j,W,ee,_.tileID,we.name==="globe"||!!fe||this.transform.pitch>0,we),Me=D*Se.perspectiveRatio,ce=(_.x1*d+b.x-_.padding)*Me+Se.point.x,Oe=(_.y1*d+b.y-_.padding)*Me+Se.point.y,Pe=(_.x2*d+b.x+_.padding)*Me+Se.point.x,Ue=(_.y2*d+b.y+_.padding)*Me+Se.point.y,Ze=Se.perspectiveRatio<=.55||Se.occluded;return!this.isInsideGrid(ce,Oe,Pe,Ue)||!E&&this.grid.hitTest(ce,Oe,Pe,Ue,F)||Ze?{box:[],offscreen:!1,occluded:Se.occluded}:{box:[ce,Oe,Pe,Ue],offscreen:this.isOffscreen(ce,Oe,Pe,Ue),occluded:!1}}placeCollisionCircles(l,d,_,b,E,D,P,F,j,W,ee,fe,Te,we,Se){let Me=[],ce=this.transform.elevation,Oe=l.getProjection(),Pe=ce?ce.getAtTileOffsetFunc(Se,this.transform.center.lat,this.transform.worldSize,Oe):null,Ue=new r.pointGeometry(_.tileAnchorX,_.tileAnchorY),{x:Ze,y:je,z:$e}=Oe.projectTilePoint(Ue.x,Ue.y,Se.canonical);if(Pe){let[tt,yt,Nt]=Pe(Ue);Ze+=tt,je+=yt,$e+=Nt}let it=Oe.name==="globe",dt=this.projectAndGetPerspectiveRatio(P,Ze,je,$e,Se,it||!!ce||this.transform.pitch>0,Oe),{perspectiveRatio:mt}=dt,Qt=(ee?D/mt:D*mt)/r.ONE_EM,lt=an(Ze,je,$e,F),Dt=dt.signedDistanceFromCamera>0?pn(Qt,E,_.lineOffsetX*Qt,_.lineOffsetY*Qt,!1,lt,Ue,_,b,F,{},ce&&!ee?Pe:null,ee&&!!ce,Oe,Se,ee):null,bt=!1,Ut=!1,ft=!0;if(Dt&&!dt.occluded){let tt=.5*Te*mt+we,yt=new r.pointGeometry(-100,-100),Nt=new r.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),jt=new As,{first:zn,last:oi}=Dt,Mn=zn.path.length,vn=[];for(let Bn=Mn-1;Bn>=1;Bn--)vn.push(zn.path[Bn]);for(let Bn=1;Bn<oi.path.length;Bn++)vn.push(oi.path[Bn]);let Fn=2.5*tt;j&&(vn=vn.map(([Bn,Fi,Wi],tr)=>(Pe&&!it&&(Wi=Pe(tr<Mn-1?zn.tilePath[Mn-1-tr]:oi.tilePath[tr-Mn+2])[2]),an(Bn,Fi,Wi,j))),vn.some(Bn=>Bn[3]<=0)&&(vn=[]));let vi=[];if(vn.length>0){let Bn=1/0,Fi=-1/0,Wi=1/0,tr=-1/0;for(let Yi of vn)Bn=Math.min(Bn,Yi[0]),Wi=Math.min(Wi,Yi[1]),Fi=Math.max(Fi,Yi[0]),tr=Math.max(tr,Yi[1]);Fi>=yt.x&&Bn<=Nt.x&&tr>=yt.y&&Wi<=Nt.y&&(vi=[vn.map(Yi=>new r.pointGeometry(Yi[0],Yi[1]))],(Bn<yt.x||Fi>Nt.x||Wi<yt.y||tr>Nt.y)&&(vi=r.clipLine(vi,yt.x,yt.y,Nt.x,Nt.y)))}for(let Bn of vi){jt.reset(Bn,.25*tt);let Fi=0;Fi=jt.length<=.5*tt?1:Math.ceil(jt.paddedLength/Fn)+1;for(let Wi=0;Wi<Fi;Wi++){let tr=Wi/Math.max(Fi-1,1),Yi=jt.lerp(tr),Pr=Yi.x+Ir,Ns=Yi.y+Ir;Me.push(Pr,Ns,tt,0);let Ao=Pr-tt,ca=Ns-tt,ur=Pr+tt,Ji=Ns+tt;if(ft=ft&&this.isOffscreen(Ao,ca,ur,Ji),Ut=Ut||this.isInsideGrid(Ao,ca,ur,Ji),!d&&this.grid.hitTestCircle(Pr,Ns,tt,fe)&&(bt=!0,!W))return{circles:[],offscreen:!1,collisionDetected:bt,occluded:!1}}}}return{circles:!W&&bt||!Ut?[]:Me,offscreen:ft,collisionDetected:bt,occluded:dt.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let d=[],_=1/0,b=1/0,E=-1/0,D=-1/0;for(let W of l){let ee=new r.pointGeometry(W.x+Ir,W.y+Ir);_=Math.min(_,ee.x),b=Math.min(b,ee.y),E=Math.max(E,ee.x),D=Math.max(D,ee.y),d.push(ee)}let P=this.grid.query(_,b,E,D).concat(this.ignoredGrid.query(_,b,E,D)),F={},j={};for(let W of P){let ee=W.key;if(F[ee.bucketInstanceId]===void 0&&(F[ee.bucketInstanceId]={}),F[ee.bucketInstanceId][ee.featureIndex])continue;let fe=[new r.pointGeometry(W.x1,W.y1),new r.pointGeometry(W.x2,W.y1),new r.pointGeometry(W.x2,W.y2),new r.pointGeometry(W.x1,W.y2)];r.polygonIntersectsPolygon(d,fe)&&(F[ee.bucketInstanceId][ee.featureIndex]=!0,j[ee.bucketInstanceId]===void 0&&(j[ee.bucketInstanceId]=[]),j[ee.bucketInstanceId].push(ee.featureIndex))}return j}insertCollisionBox(l,d,_,b,E){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:E},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,_,b,E){let D=d?this.ignoredGrid:this.grid,P={bucketInstanceId:_,featureIndex:b,collisionGroupID:E};for(let F=0;F<l.length;F+=4)D.insertCircle(P,l[F],l[F+1],l[F+2])}projectAndGetPerspectiveRatio(l,d,_,b,E,D,P){let F=[d,_,b,1],j=!1;if(b||this.transform.pitch>0){r.transformMat4$1(F,F,l);let ee=P.name==="globe";this.fogState&&E&&!ee&&(j=function(Te,we,Se,Me,ce,Oe){let Pe=Oe.calculateFogTileMatrix(ce),Ue=[we,Se,Me];return r.transformMat4(Ue,Ue,Pe),de(Te,Ue,Oe.pitch,Oe._fov)}(this.fogState,d,_,b,E.toUnwrapped(),this.transform)>.9)}else ra(F,F,l);let W=F[3];return{point:new r.pointGeometry((F[0]/W+1)/2*this.transform.width+Ir,(-F[1]/W+1)/2*this.transform.height+Ir),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/W*.5,1.5),signedDistanceFromCamera:W,occluded:D&&F[2]>W||j}}isOffscreen(l,d,_,b){return _<Ir||l>=this.screenRightBoundary||b<Ir||d>this.screenBottomBoundary}isInsideGrid(l,d,_,b){return _>=0&&l<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){let l=r.identity([]);return r.translate(l,l,[-100,-100,0]),l}}function zo(m,l,d){let _=l.createTileMatrix(m,m.worldSize,d.toUnwrapped());return r.multiply(new Float32Array(16),m.projMatrix,_)}function mu(m,l,d){if(l.projection.name===d.projection.name)return m.projMatrix;let _=d.clone();return _.setProjection(l.projection),zo(_,l.getProjection(),m)}function pl(m,l,d){return l.name===d.projection.name?m.projMatrix:zo(d,l,m)}class ml{constructor(l,d,_,b){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):b&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class sa{constructor(l,d,_,b,E,D=!1){this.text=new ml(l?l.text:null,d,_,E),this.icon=new ml(l?l.icon:null,d,b,E),this.clipped=D}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Da{constructor(l,d,_,b=!1){this.text=l,this.icon=d,this.skipFade=_,this.clipped=b}}class Oi{constructor(){this.invProjMatrix=r.create(),this.viewportMatrix=r.create(),this.circles=[]}}class pr{constructor(l,d,_,b,E){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=E}}class Vi{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){let d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[l]}}function So(m,l,d,_,b){let{horizontalAlign:E,verticalAlign:D}=r.getAnchorAlignment(m),P=-(E-.5)*l,F=-(D-.5)*d,j=r.evaluateVariableOffset(m,_);return new r.pointGeometry(P+j[0]*b,F+j[1]*b)}function Oo(m,l,d,_,b){let E=new r.pointGeometry(m,l);return d&&E._rotate(_?b:-b),E}class Kr{constructor(l,d,_,b,E){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new nc(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Vi(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,_,b){let E=_.getBucket(d),D=_.latestFeatureIndex;if(!E||!D||d.id!==E.layerIds[0])return;let P=E.layers[0].layout,F=_.collisionBoxArray,j=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),W=_.tileSize/r.EXTENT,ee=_.tileID.toUnwrapped();this.transform.setProjection(E.projection);let fe=(Te=_.tileID,we=E.getProjection(),Se=this.transform,we.name===this.projection?Se.calculateProjMatrix(Te.toUnwrapped()):zo(Se,we,Te));var Te,we,Se;let Me=P.get("text-pitch-alignment")==="map",ce=P.get("text-rotation-alignment")==="map";d.compileFilter();let Oe=d.dynamicFilter(),Pe=d.dynamicFilterNeedsFeature(),Ue=this.transform.calculatePixelsToTileUnitsMatrix(_),Ze=ko(fe,_.tileID.canonical,Me,ce,this.transform,E.getProjection(),Ue),je=null;if(Me){let dt=La(fe,_.tileID.canonical,Me,ce,this.transform,E.getProjection(),Ue);je=r.multiply([],this.transform.labelPlaneMatrix,dt)}let $e=null;Oe&&_.latestFeatureIndex&&($e={unwrappedTileID:ee,dynamicFilter:Oe,dynamicFilterNeedsFeature:Pe,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new pr(E.bucketInstanceId,D,E.sourceLayerIndex,E.index,_.tileID);let it={bucket:E,layout:P,posMatrix:fe,textLabelPlaneMatrix:Ze,labelToScreenMatrix:je,clippingData:$e,scale:j,textPixelRatio:W,holdingForFade:_.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:r.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(b)for(let dt of E.sortKeyRanges){let{sortKey:mt,symbolInstanceStart:Qt,symbolInstanceEnd:lt}=dt;l.push({sortKey:mt,symbolInstanceStart:Qt,symbolInstanceEnd:lt,parameters:it})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:it})}attemptAnchorPlacement(l,d,_,b,E,D,P,F,j,W,ee,fe,Te,we,Se,Me,ce,Oe){let{textOffset0:Pe,textOffset1:Ue,crossTileID:Ze}=fe,je=[Pe,Ue],$e=So(l,_,b,je,E),it=this.collisionIndex.placeCollisionBox(we,E,d,Oo($e.x,$e.y,D,P,this.transform.angle),ee,F,j,W.predicate);if(Me){let dt=we.getSymbolInstanceIconSize(Oe,this.transform.zoom,fe.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(we,dt,Me,Oo($e.x,$e.y,D,P,this.transform.angle),ee,F,j,W.predicate).box.length===0)return}if(it.box.length>0){let dt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ze]&&this.prevPlacement.placements[Ze]&&this.prevPlacement.placements[Ze].text&&(dt=this.prevPlacement.variableOffsets[Ze].anchor),this.variableOffsets[Ze]={textOffset:je,width:_,height:b,anchor:l,textScale:E,prevAnchor:dt},this.markUsedJustification(we,l,fe,Se),we.allowVerticalPlacement&&(this.markUsedOrientation(we,Se,fe),this.placedOrientations[Ze]=Se),{shift:$e,placedGlyphBoxes:it}}}placeLayerBucketPart(l,d,_,b){let{bucket:E,layout:D,posMatrix:P,textLabelPlaneMatrix:F,labelToScreenMatrix:j,clippingData:W,textPixelRatio:ee,holdingForFade:fe,collisionBoxArray:Te,partiallyEvaluatedTextSize:we,partiallyEvaluatedIconSize:Se,collisionGroup:Me}=l.parameters,ce=D.get("text-optional"),Oe=D.get("icon-optional"),Pe=D.get("text-allow-overlap"),Ue=D.get("icon-allow-overlap"),Ze=D.get("text-rotation-alignment")==="map",je=D.get("text-pitch-alignment")==="map",$e=D.get("icon-text-fit")!=="none",it=D.get("symbol-z-order")==="viewport-y";this.transform.setProjection(E.projection);let dt=Pe&&(Ue||!E.hasIconData()||Oe),mt=Ue&&(Pe||!E.hasTextData()||ce);!E.collisionArrays&&Te&&E.deserializeCollisionBoxes(Te),_&&b&&E.updateCollisionDebugBuffers(this.transform.zoom,Te);let Qt=(lt,Dt,bt)=>{let{crossTileID:Ut,numVerticalGlyphVertices:ft}=lt;if(W){let ur={zoom:this.transform.zoom,pitch:this.transform.pitch},Ji=null;if(W.dynamicFilterNeedsFeature){let Ri=this.retainedQueryData[E.bucketInstanceId];Ji=W.featureIndex.loadFeature({featureIndex:lt.featureIndex,bucketIndex:Ri.bucketIndex,sourceLayerIndex:Ri.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,W.dynamicFilter)(ur,Ji,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new r.pointGeometry(lt.tileAnchorX,lt.tileAnchorY),this.transform.calculateDistanceTileData(W.unwrappedTileID)))return this.placements[Ut]=new Da(!1,!1,!1,!0),void(d[Ut]=!0)}if(d[Ut])return;if(fe)return void(this.placements[Ut]=new Da(!1,!1,!1));let tt=!1,yt=!1,Nt=!0,jt=!1,zn=!1,oi=null,Mn={box:null,offscreen:null,occluded:null},vn={box:null,offscreen:null,occluded:null},Fn=null,vi=null,Bn=null,Fi=0,Wi=0,tr=0;bt.textFeatureIndex?Fi=bt.textFeatureIndex:lt.useRuntimeCollisionCircles&&(Fi=lt.featureIndex),bt.verticalTextFeatureIndex&&(Wi=bt.verticalTextFeatureIndex);let Yi=ur=>{ur.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;let Ji=this.transform.elevation;(Ji||ur.elevation)&&(ur.elevation=Ji?Ji.getAtTileOffset(ur.tileID,ur.tileAnchorX,ur.tileAnchorY):0)},Pr=bt.textBox;if(Pr){Yi(Pr);let ur=Ri=>{let wr=r.WritingMode.horizontal;if(E.allowVerticalPlacement&&!Ri&&this.prevPlacement){let fs=this.prevPlacement.placedOrientations[Ut];fs&&(this.placedOrientations[Ut]=fs,wr=fs,this.markUsedOrientation(E,wr,lt))}return wr},Ji=(Ri,wr)=>{if(E.allowVerticalPlacement&&ft>0&&bt.verticalTextBox){for(let fs of E.writingModes)if(fs===r.WritingMode.vertical?(Mn=wr(),vn=Mn):Mn=Ri(),Mn&&Mn.box&&Mn.box.length)break}else Mn=Ri()};if(D.get("text-variable-anchor")){let Ri=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ut]){let or=this.prevPlacement.variableOffsets[Ut];Ri.indexOf(or.anchor)>0&&(Ri=Ri.filter(ps=>ps!==or.anchor),Ri.unshift(or.anchor))}let wr=(or,ps,ms)=>{let Na=E.getSymbolInstanceTextSize(we,lt,this.transform.zoom,Dt),vc=(or.x2-or.x1)*Na+2*or.padding,Xs=(or.y2-or.y1)*Na+2*or.padding,ao=$e&&!Ue?ps:null;ao&&Yi(ao);let ua={box:[],offscreen:!1,occluded:!1},Fa=Pe?2*Ri.length:Ri.length;for(let Ba=0;Ba<Fa;++Ba){let xc=this.attemptAnchorPlacement(Ri[Ba%Ri.length],or,vc,Xs,Na,Ze,je,ee,P,Me,Ba>=Ri.length,lt,Dt,E,ms,ao,we,Se);if(xc&&(ua=xc.placedGlyphBoxes,ua&&ua.box&&ua.box.length)){tt=!0,oi=xc.shift;break}}return ua};Ji(()=>wr(Pr,bt.iconBox,r.WritingMode.horizontal),()=>{let or=bt.verticalTextBox;return or&&Yi(or),E.allowVerticalPlacement&&!(Mn&&Mn.box&&Mn.box.length)&&ft>0&&or?wr(or,bt.verticalIconBox,r.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Mn&&(tt=Mn.box,Nt=Mn.offscreen,jt=Mn.occluded);let fs=ur(Mn&&Mn.box);if(!tt&&this.prevPlacement){let or=this.prevPlacement.variableOffsets[Ut];or&&(this.variableOffsets[Ut]=or,this.markUsedJustification(E,or.anchor,lt,fs))}}else{let Ri=(wr,fs)=>{let or=E.getSymbolInstanceTextSize(we,lt,this.transform.zoom,Dt),ps=this.collisionIndex.placeCollisionBox(E,or,wr,new r.pointGeometry(0,0),Pe,ee,P,Me.predicate);return ps&&ps.box&&ps.box.length&&(this.markUsedOrientation(E,fs,lt),this.placedOrientations[Ut]=fs),ps};Ji(()=>Ri(Pr,r.WritingMode.horizontal),()=>{let wr=bt.verticalTextBox;return E.allowVerticalPlacement&&ft>0&&wr?(Yi(wr),Ri(wr,r.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ur(Mn&&Mn.box&&Mn.box.length)}}if(Fn=Mn,tt=Fn&&Fn.box&&Fn.box.length>0,Nt=Fn&&Fn.offscreen,jt=Fn&&Fn.occluded,lt.useRuntimeCollisionCircles){let ur=E.text.placedSymbolArray.get(lt.centerJustifiedTextSymbolIndex>=0?lt.centerJustifiedTextSymbolIndex:lt.verticalPlacedTextSymbolIndex),Ji=r.evaluateSizeForFeature(E.textSizeData,we,ur),Ri=D.get("text-padding");vi=this.collisionIndex.placeCollisionCircles(E,Pe,ur,E.lineVertexArray,E.glyphOffsetArray,Ji,P,F,j,_,je,Me.predicate,lt.collisionCircleDiameter*Ji/r.ONE_EM,Ri,this.retainedQueryData[E.bucketInstanceId].tileID),tt=Pe||vi.circles.length>0&&!vi.collisionDetected,Nt=Nt&&vi.offscreen,jt=vi.occluded}if(bt.iconFeatureIndex&&(tr=bt.iconFeatureIndex),bt.iconBox){let ur=Ji=>{Yi(Ji);let Ri=$e&&oi?Oo(oi.x,oi.y,Ze,je,this.transform.angle):new r.pointGeometry(0,0),wr=E.getSymbolInstanceIconSize(Se,this.transform.zoom,lt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,wr,Ji,Ri,Ue,ee,P,Me.predicate)};vn&&vn.box&&vn.box.length&&bt.verticalIconBox?(Bn=ur(bt.verticalIconBox),yt=Bn.box.length>0):(Bn=ur(bt.iconBox),yt=Bn.box.length>0),Nt=Nt&&Bn.offscreen,zn=Bn.occluded}let Ns=ce||lt.numHorizontalGlyphVertices===0&&ft===0,Ao=Oe||lt.numIconVertices===0;if(Ns||Ao?Ao?Ns||(yt=yt&&tt):tt=yt&&tt:yt=tt=yt&&tt,tt&&Fn&&Fn.box&&this.collisionIndex.insertCollisionBox(Fn.box,D.get("text-ignore-placement"),E.bucketInstanceId,vn&&vn.box&&Wi?Wi:Fi,Me.ID),yt&&Bn&&this.collisionIndex.insertCollisionBox(Bn.box,D.get("icon-ignore-placement"),E.bucketInstanceId,tr,Me.ID),vi&&(tt&&this.collisionIndex.insertCollisionCircles(vi.circles,D.get("text-ignore-placement"),E.bucketInstanceId,Fi,Me.ID),_)){let ur=E.bucketInstanceId,Ji=this.collisionCircleArrays[ur];Ji===void 0&&(Ji=this.collisionCircleArrays[ur]=new Oi);for(let Ri=0;Ri<vi.circles.length;Ri+=4)Ji.circles.push(vi.circles[Ri+0]),Ji.circles.push(vi.circles[Ri+1]),Ji.circles.push(vi.circles[Ri+2]),Ji.circles.push(vi.collisionDetected?1:0)}let ca=E.projection.name!=="globe";dt=dt&&(ca||!jt),mt=mt&&(ca||!zn),this.placements[Ut]=new Da(tt||dt,yt||mt,Nt||E.justReloaded),d[Ut]=!0};if(it){let lt=E.getSortedSymbolIndexes(this.transform.angle);for(let Dt=lt.length-1;Dt>=0;--Dt){let bt=lt[Dt];Qt(E.symbolInstances.get(bt),bt,E.collisionArrays[bt])}}else for(let lt=l.symbolInstanceStart;lt<l.symbolInstanceEnd;lt++)Qt(E.symbolInstances.get(lt),lt,E.collisionArrays[lt]);if(_&&E.bucketInstanceId in this.collisionCircleArrays){let lt=this.collisionCircleArrays[E.bucketInstanceId];r.invert(lt.invProjMatrix,P),lt.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(l,d,_,b){let{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:F,crossTileID:j}=_,W=r.getAnchorJustification(d),ee=b===r.WritingMode.vertical?F:W==="left"?E:W==="center"?D:W==="right"?P:-1;E>=0&&(l.text.placedSymbolArray.get(E).crossTileID=ee>=0&&E!==ee?0:j),D>=0&&(l.text.placedSymbolArray.get(D).crossTileID=ee>=0&&D!==ee?0:j),P>=0&&(l.text.placedSymbolArray.get(P).crossTileID=ee>=0&&P!==ee?0:j),F>=0&&(l.text.placedSymbolArray.get(F).crossTileID=ee>=0&&F!==ee?0:j)}markUsedOrientation(l,d,_){let b=d===r.WritingMode.horizontal||d===r.WritingMode.horizontalOnly?d:0,E=d===r.WritingMode.vertical?d:0,{leftJustifiedTextSymbolIndex:D,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:j}=_,W=l.text.placedSymbolArray;D>=0&&(W.get(D).placedOrientation=b),P>=0&&(W.get(P).placedOrientation=b),F>=0&&(W.get(F).placedOrientation=b),j>=0&&(W.get(j).placedOrientation=E)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;let d=this.prevPlacement,_=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;let b=d?d.symbolFadeChange(l):1,E=d?d.opacities:{},D=d?d.variableOffsets:{},P=d?d.placedOrientations:{};for(let F in this.placements){let j=this.placements[F],W=E[F];W?(this.opacities[F]=new sa(W,b,j.text,j.icon,null,j.clipped),_=_||j.text!==W.text.placed||j.icon!==W.icon.placed):(this.opacities[F]=new sa(null,b,j.text,j.icon,j.skipFade,j.clipped),_=_||j.text||j.icon)}for(let F in E){let j=E[F];if(!this.opacities[F]){let W=new sa(j,b,!1,!1);W.isHidden()||(this.opacities[F]=W,_=_||j.text.placed||j.icon.placed)}}for(let F in D)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=D[F]);for(let F in P)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=P[F]);_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d){let _={};for(let b of d){let E=b.getBucket(l);E&&b.latestFeatureIndex&&l.id===E.layerIds[0]&&this.updateBucketOpacities(E,_,b.collisionBoxArray)}}updateBucketOpacities(l,d,_){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();let b=l.layers[0].layout,E=!!l.layers[0].dynamicFilter(),D=new sa(null,0,!1,!1,!0),P=b.get("text-allow-overlap"),F=b.get("icon-allow-overlap"),j=b.get("text-variable-anchor"),W=b.get("text-rotation-alignment")==="map",ee=b.get("text-pitch-alignment")==="map",fe=b.get("icon-text-fit")!=="none",Te=new sa(null,0,P&&(F||!l.hasIconData()||b.get("icon-optional")),F&&(P||!l.hasTextData()||b.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);let we=(Me,ce,Oe)=>{for(let Pe=0;Pe<ce/4;Pe++)Me.opacityVertexArray.emplaceBack(Oe)},Se=0;for(let Me=0;Me<l.symbolInstances.length;Me++){let ce=l.symbolInstances.get(Me),{numHorizontalGlyphVertices:Oe,numVerticalGlyphVertices:Pe,crossTileID:Ue,numIconVertices:Ze}=ce,je=this.opacities[Ue];d[Ue]?je=D:je||(je=Te,this.opacities[Ue]=je),d[Ue]=!0;let $e=Oe>0||Pe>0,it=Ze>0,dt=this.placedOrientations[Ue],mt=dt===r.WritingMode.vertical,Qt=dt===r.WritingMode.horizontal||dt===r.WritingMode.horizontalOnly;if(!$e&&!it||je.isHidden()||Se++,$e){let lt=Jh(je.text);we(l.text,Oe,mt?rc:lt),we(l.text,Pe,Qt?rc:lt);let Dt=je.text.isHidden(),{leftJustifiedTextSymbolIndex:bt,centerJustifiedTextSymbolIndex:Ut,rightJustifiedTextSymbolIndex:ft,verticalPlacedTextSymbolIndex:tt}=ce,yt=l.text.placedSymbolArray,Nt=Dt||mt?1:0;bt>=0&&(yt.get(bt).hidden=Nt),Ut>=0&&(yt.get(Ut).hidden=Nt),ft>=0&&(yt.get(ft).hidden=Nt),tt>=0&&(yt.get(tt).hidden=Dt||Qt?1:0);let jt=this.variableOffsets[Ue];jt&&this.markUsedJustification(l,jt.anchor,ce,dt);let zn=this.placedOrientations[Ue];zn&&(this.markUsedJustification(l,"left",ce,zn),this.markUsedOrientation(l,zn,ce))}if(it){let lt=Jh(je.icon),{placedIconSymbolIndex:Dt,verticalPlacedIconSymbolIndex:bt}=ce,Ut=l.icon.placedSymbolArray,ft=je.icon.isHidden()?1:0;Dt>=0&&(we(l.icon,Ze,mt?rc:lt),Ut.get(Dt).hidden=ft),bt>=0&&(we(l.icon,ce.numVerticalIconVertices,Qt?rc:lt),Ut.get(bt).hidden=ft)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){let lt=l.collisionArrays[Me];if(lt){let Dt=new r.pointGeometry(0,0),bt=!0;if(lt.textBox||lt.verticalTextBox){if(j){let ft=this.variableOffsets[Ue];ft?(Dt=So(ft.anchor,ft.width,ft.height,ft.textOffset,ft.textScale),W&&Dt._rotate(ee?this.transform.angle:-this.transform.angle)):bt=!1}E&&(bt=!je.clipped),lt.textBox&&jr(l.textCollisionBox.collisionVertexArray,je.text.placed,!bt||mt,Dt.x,Dt.y),lt.verticalTextBox&&jr(l.textCollisionBox.collisionVertexArray,je.text.placed,!bt||Qt,Dt.x,Dt.y)}let Ut=bt&&Boolean(!Qt&&lt.verticalIconBox);lt.iconBox&&jr(l.iconCollisionBox.collisionVertexArray,je.icon.placed,Ut,fe?Dt.x:0,fe?Dt.y:0),lt.verticalIconBox&&jr(l.iconCollisionBox.collisionVertexArray,je.icon.placed,!Ut,fe?Dt.x:0,fe?Dt.y:0)}}}if(l.fullyClipped=Se===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){let Me=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Me.invProjMatrix,l.placementViewportMatrix=Me.viewportMatrix,l.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){let _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function jr(m,l,d,_,b){m.emplaceBack(l?1:0,d?1:0,_||0,b||0),m.emplaceBack(l?1:0,d?1:0,_||0,b||0),m.emplaceBack(l?1:0,d?1:0,_||0,b||0),m.emplaceBack(l?1:0,d?1:0,_||0,b||0)}let ic=Math.pow(2,25),Ra=Math.pow(2,24),vr=Math.pow(2,17),gu=Math.pow(2,16),sp=Math.pow(2,9),_u=Math.pow(2,8),ts=Math.pow(2,1);function Jh(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;let l=m.placed?1:0,d=Math.floor(127*m.opacity);return d*ic+l*Ra+d*vr+l*gu+d*sp+l*_u+d*ts+l}let rc=0;class oa{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,d,_,b,E){let D=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(D,b,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((P,F)=>P.sortKey-F.sortKey));this._currentPartIndex<D.length;){let P=D[this._currentPartIndex];if(d.placeLayerBucketPart(P,this._seenCrossTileIDs,_,P.symbolInstanceStart===0),this._currentPartIndex++,E())return!0}return!1}}class yu{constructor(l,d,_,b,E,D,P,F){this.placement=new Kr(l,E,D,P,F),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(l,d,_){let b=r.exported.now(),E=()=>{let D=r.exported.now()-b;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){let D=d[l[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=P)&&(!D.maxzoom||D.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new oa(D)),this._inProgressLayer.continuePlacement(_[D.source],this.placement,this._showCollisionBoxes,D,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}let $h=512/r.EXTENT/2;class Ov{constructor(l,d,_){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let b=0;b<d.length;b++){let E=d.get(b),D=E.key;this.indexedSymbolInstances[D]||(this.indexedSymbolInstances[D]=[]),this.indexedSymbolInstances[D].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}}getScaledCoordinates(l,d){let _=$h/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*r.EXTENT+l.tileAnchorX)*_),y:Math.floor((d.canonical.y*r.EXTENT+l.tileAnchorY)*_)}}findMatches(l,d,_){let b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let E=0;E<l.length;E++){let D=l.get(E);if(D.crossTileID)continue;let P=this.indexedSymbolInstances[D.key];if(!P)continue;let F=this.getScaledCoordinates(D,d);for(let j of P)if(Math.abs(j.coord.x-F.x)<=b&&Math.abs(j.coord.y-F.y)<=b&&!_[j.crossTileID]){_[j.crossTileID]=!0,D.crossTileID=j.crossTileID;break}}}}class op{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class sc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){let d=Math.round((l-this.lng)/360);if(d!==0)for(let _ in this.indexes){let b=this.indexes[_],E={};for(let D in b){let P=b[D];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),E[P.tileID.key]=P}this.indexes[_]=E}this.lng=l}addBucket(l,d,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let E=0;E<d.symbolInstances.length;E++)d.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});let b=this.usedCrossTileIDs[l.overscaledZ];for(let E in this.indexes){let D=this.indexes[E];if(Number(E)>l.overscaledZ)for(let P in D){let F=D[P];F.tileID.isChildOf(l)&&F.findMatches(d.symbolInstances,l,b)}else{let P=D[l.scaledTo(Number(E)).key];P&&P.findMatches(d.symbolInstances,l,b)}}for(let E=0;E<d.symbolInstances.length;E++){let D=d.symbolInstances.get(E);D.crossTileID||(D.crossTileID=_.generate(),b[D.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ov(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(let _ in d.indexedSymbolInstances)for(let b of d.indexedSymbolInstances[_])delete this.usedCrossTileIDs[l][b.crossTileID]}removeStaleBuckets(l){let d=!1;for(let _ in this.indexes){let b=this.indexes[_];for(let E in b)l[b[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[E]),delete b[E],d=!0)}return d}}class Yg{constructor(){this.layerIndexes={},this.crossTileIDs=new op,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,_,b){let E=this.layerIndexes[l.id];E===void 0&&(E=this.layerIndexes[l.id]=new sc);let D=!1,P={};b.name!=="globe"&&E.handleWrapJump(_);for(let F of d){let j=F.getBucket(l);j&&l.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(F.tileID,j,this.crossTileIDs)&&(D=!0),P[j.bucketInstanceId]=!0)}return E.removeStaleBuckets(P)&&(D=!0),D}pruneUnusedLayers(l){let d={};l.forEach(_=>{d[_]=!0});for(let _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}let vu=(m,l)=>r.emitValidationErrors(m,l&&l.filter(d=>d.identifier!=="source.canvas")),oc=r.pick(hn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Pa=r.pick(hn,["setCenter","setZoom","setBearing","setPitch"]),Qh={version:8,layers:[],sources:{}},ka={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class so extends r.Evented{constructor(l,d={}){super(),this.map=l,this.dispatcher=new xt(In(),this),this.imageManager=new Y,this.imageManager.setEventedParent(this),this.glyphManager=new r.GlyphManager(l._requestManager,d.localFontFamily?r.LocalGlyphMode.all:d.localIdeographFontFamily?r.LocalGlyphMode.ideographs:r.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.crossTileSymbolIndex=new Yg,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",r.getReferrer());let _=this;this._rtlTextPluginCallback=so.registerForPluginStateChange(b=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(E,D)=>{if(r.triggerPluginCompletionEvent(E),D&&D.every(P=>P))for(let P in _._sourceCaches){let F=_._sourceCaches[P],j=F.getSource().type;j!=="vector"&&j!=="geojson"||F.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;let E=this.getSource(b.sourceId);if(E&&E.vectorLayerIds)for(let D in this._layers){let P=this._layers[D];P.source===E.id&&this._validateLayer(P)}})}loadURL(l,d={}){this.fire(new r.Event("dataloading",{dataType:"style"}));let _=typeof d.validate=="boolean"?d.validate:!r.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,d.accessToken);let b=this.map._requestManager.transformRequest(l,r.ResourceType.Style);this._request=r.getJSON(b,(E,D)=>{this._request=null,E?this.fire(new r.ErrorEvent(E)):D&&this._load(D,_)})}loadJSON(l,d={}){this.fire(new r.Event("dataloading",{dataType:"style"})),this._request=r.exported.frame(()=>{this._request=null,this._load(l,d.validate!==!1)})}loadEmpty(){this.fire(new r.Event("dataloading",{dataType:"style"})),this._load(Qh,!1)}_updateLayerCount(l,d){let _=d?1:-1;l.is3D()&&(this._num3DLayers+=_),l.type==="circle"&&(this._numCircleLayers+=_),l.type==="symbol"&&(this._numSymbolLayers+=_)}_load(l,d){if(d&&vu(this,r.validateStyle(l)))return;this._loaded=!0,this.stylesheet=r.clone$1(l),this._updateMapProjection();for(let b in l.sources)this.addSource(b,l.sources[b],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);let _=$n(this.stylesheet.layers);this._order=_.map(b=>b.id),this._layers={},this._serializedLayers={};for(let b of _)b=r.createStyleLayer(b),b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ge(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new r.Event("data",{dataType:"style"})),this.fire(new r.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=function(d,_,b){let E,D,P,F=r.exported.devicePixelRatio>1?"@2x":"",j=r.getJSON(_.transformRequest(_.normalizeSpriteURL(d,F,".json"),r.ResourceType.SpriteJSON),(fe,Te)=>{j=null,P||(P=fe,E=Te,ee())}),W=r.getImage(_.transformRequest(_.normalizeSpriteURL(d,F,".png"),r.ResourceType.SpriteImage),(fe,Te)=>{W=null,P||(P=fe,D=Te,ee())});function ee(){if(P)b(P);else if(E&&D){let fe=r.exported.getImageData(D),Te={};for(let we in E){let{width:Se,height:Me,x:ce,y:Oe,sdf:Pe,pixelRatio:Ue,stretchX:Ze,stretchY:je,content:$e}=E[we],it=new r.RGBAImage({width:Se,height:Me});r.RGBAImage.copy(fe,it,{x:ce,y:Oe},{x:0,y:0},{width:Se,height:Me}),Te[we]={data:it,pixelRatio:Ue,sdf:Pe,stretchX:Ze,stretchY:je,content:$e}}b(null,Te)}}return{cancel(){j&&(j.cancel(),j=null),W&&(W.cancel(),W=null)}}}(l,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new r.ErrorEvent(d));else if(_)for(let b in _)this.imageManager.addImage(b,_[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new r.Event("data",{dataType:"style"}))})}_validateLayer(l){let d=this.getSource(l.source);if(!d)return;let _=l.sourceLayer;_&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(_)===-1)&&this.fire(new r.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){let d=[];for(let _ of l){let b=this._layers[_];b.type!=="custom"&&d.push(b.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(let l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(let l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&(typeof l.isLayerDraped=="function"?l.isLayerDraped():ka[l.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;let d=this._changed;if(this._changed){let b=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(b.length||E.length)&&this._updateWorkerLayers(b,E);for(let D in this._updatedSources){let P=this._updatedSources[D];P==="reload"?this._reloadSource(D):P==="clear"&&this._clearSource(D)}this._updateTilesForChangedImages();for(let D in this._updatedPaintProps)this._layers[D].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}let _={};for(let b in this._sourceCaches){let E=this._sourceCaches[b];_[b]=E.used,E.used=!1}for(let b of this._order){let E=this._layers[b];if(E.recalculate(l,this._availableImages),!E.isHidden(l.zoom)){let P=this._getLayerSourceCache(E);P&&(P.used=!0)}let D=this.map.painter;if(D){let P=E.getProgramIds();if(!P)continue;let F=E.getProgramConfiguration(l.zoom);for(let j of P)D.useProgram(j,F)}}for(let b in _){let E=this._sourceCaches[b];_[b]!==E.used&&E.getSource().fire(new r.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new r.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let l=Object.keys(this._changedImages);if(l.length){for(let d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),vu(this,r.validateStyle(l)))return!1;(l=r.clone$1(l)).layers=$n(l.layers);let d=function(b,E){if(!b)return[{command:hn.setStyle,args:[E]}];let D=[];try{if(!x(b.version,E.version))return[{command:hn.setStyle,args:[E]}];x(b.center,E.center)||D.push({command:hn.setCenter,args:[E.center]}),x(b.zoom,E.zoom)||D.push({command:hn.setZoom,args:[E.zoom]}),x(b.bearing,E.bearing)||D.push({command:hn.setBearing,args:[E.bearing]}),x(b.pitch,E.pitch)||D.push({command:hn.setPitch,args:[E.pitch]}),x(b.sprite,E.sprite)||D.push({command:hn.setSprite,args:[E.sprite]}),x(b.glyphs,E.glyphs)||D.push({command:hn.setGlyphs,args:[E.glyphs]}),x(b.transition,E.transition)||D.push({command:hn.setTransition,args:[E.transition]}),x(b.light,E.light)||D.push({command:hn.setLight,args:[E.light]}),x(b.fog,E.fog)||D.push({command:hn.setFog,args:[E.fog]}),x(b.projection,E.projection)||D.push({command:hn.setProjection,args:[E.projection]});let P={},F=[];(function(ee,fe,Te,we){let Se;for(Se in fe=fe||{},ee=ee||{})ee.hasOwnProperty(Se)&&(fe.hasOwnProperty(Se)||Qn(Se,Te,we));for(Se in fe)fe.hasOwnProperty(Se)&&(ee.hasOwnProperty(Se)?x(ee[Se],fe[Se])||(ee[Se].type==="geojson"&&fe[Se].type==="geojson"&&Fr(ee,fe,Se)?Te.push({command:hn.setGeoJSONSourceData,args:[Se,fe[Se].data]}):Rr(Se,fe,Te,we)):yi(Se,fe,Te))})(b.sources,E.sources,F,P);let j=[];b.layers&&b.layers.forEach(ee=>{ee.source&&P[ee.source]?D.push({command:hn.removeLayer,args:[ee.id]}):j.push(ee)});let W=b.terrain;W&&P[W.source]&&(D.push({command:hn.setTerrain,args:[void 0]}),W=void 0),D=D.concat(F),x(W,E.terrain)||D.push({command:hn.setTerrain,args:[E.terrain]}),function(ee,fe,Te){fe=fe||[];let we=(ee=ee||[]).map(hs),Se=fe.map(hs),Me=ee.reduce(Si,{}),ce=fe.reduce(Si,{}),Oe=we.slice(),Pe=Object.create(null),Ue,Ze,je,$e,it,dt,mt;for(Ue=0,Ze=0;Ue<we.length;Ue++)je=we[Ue],ce.hasOwnProperty(je)?Ze++:(Te.push({command:hn.removeLayer,args:[je]}),Oe.splice(Oe.indexOf(je,Ze),1));for(Ue=0,Ze=0;Ue<Se.length;Ue++)je=Se[Se.length-1-Ue],Oe[Oe.length-1-Ue]!==je&&(Me.hasOwnProperty(je)?(Te.push({command:hn.removeLayer,args:[je]}),Oe.splice(Oe.lastIndexOf(je,Oe.length-Ze),1)):Ze++,dt=Oe[Oe.length-Ue],Te.push({command:hn.addLayer,args:[ce[je],dt]}),Oe.splice(Oe.length-Ue,0,je),Pe[je]=!0);for(Ue=0;Ue<Se.length;Ue++)if(je=Se[Ue],$e=Me[je],it=ce[je],!Pe[je]&&!x($e,it))if(x($e.source,it.source)&&x($e["source-layer"],it["source-layer"])&&x($e.type,it.type)){for(mt in Tt($e.layout,it.layout,Te,je,null,hn.setLayoutProperty),Tt($e.paint,it.paint,Te,je,null,hn.setPaintProperty),x($e.filter,it.filter)||Te.push({command:hn.setFilter,args:[je,it.filter]}),x($e.minzoom,it.minzoom)&&x($e.maxzoom,it.maxzoom)||Te.push({command:hn.setLayerZoomRange,args:[je,it.minzoom,it.maxzoom]}),$e)$e.hasOwnProperty(mt)&&mt!=="layout"&&mt!=="paint"&&mt!=="filter"&&mt!=="metadata"&&mt!=="minzoom"&&mt!=="maxzoom"&&(mt.indexOf("paint.")===0?Tt($e[mt],it[mt],Te,je,mt.slice(6),hn.setPaintProperty):x($e[mt],it[mt])||Te.push({command:hn.setLayerProperty,args:[je,mt,it[mt]]}));for(mt in it)it.hasOwnProperty(mt)&&!$e.hasOwnProperty(mt)&&mt!=="layout"&&mt!=="paint"&&mt!=="filter"&&mt!=="metadata"&&mt!=="minzoom"&&mt!=="maxzoom"&&(mt.indexOf("paint.")===0?Tt($e[mt],it[mt],Te,je,mt.slice(6),hn.setPaintProperty):x($e[mt],it[mt])||Te.push({command:hn.setLayerProperty,args:[je,mt,it[mt]]}))}else Te.push({command:hn.removeLayer,args:[je]}),dt=Oe[Oe.lastIndexOf(je)+1],Te.push({command:hn.addLayer,args:[it,dt]})}(j,E.layers,D)}catch(P){console.warn("Unable to compute style diff:",P),D=[{command:hn.setStyle,args:[E]}]}return D}(this.serialize(),l).filter(b=>!(b.command in Pa));if(d.length===0)return!1;let _=d.filter(b=>!(b.command in oc));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{b.command!=="setTransition"&&b.command!=="setProjection"&&this[b.command].apply(this,b.args)}),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,d){return this.getImage(l)?this.fire(new r.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,d),this._afterImageUpdated(l),this)}updateImage(l,d){this.imageManager.updateImage(l,d)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new r.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new r.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,d,_={}){if(this._checkLoaded(),this.getSource(l)!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(r.validateSource,`sources.${l}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);let b=Fe(l,d,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:b.serialize(),sourceId:l}));let E=D=>{let P=(D?"symbol:":"other:")+l,F=this._sourceCaches[P]=new r.SourceCache(P,b,D);(D?this._symbolSourceCaches:this._otherSourceCaches)[l]=F,F.style=this,F.onAdd(this.map)};E(!1),d.type!=="vector"&&d.type!=="geojson"||E(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();let d=this.getSource(l);if(!d)throw new Error("There is no source with this ID");for(let b in this._layers)if(this._layers[b].source===l)return this.fire(new r.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new r.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));let _=this._getSourceCaches(l);for(let b of _)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new r.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,d){this._checkLoaded(),this.getSource(l).setData(d),this._changed=!0}getSource(l){let d=this._getSourceCache(l);return d&&d.getSource()}_getSources(){let l=[];for(let d in this._otherSourceCaches){let _=this._getSourceCache(d);_&&l.push(_.getSource())}return l}addLayer(l,d,_={}){this._checkLoaded();let b=l.id;if(this.getLayer(b))return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let E;if(l.type==="custom"){if(vu(this,r.validateCustomStyleLayer(l)))return;E=r.createStyleLayer(l)}else{if(typeof l.source=="object"&&(this.addSource(b,l.source),l=r.clone$1(l),l=r.extend(l,{source:b})),this._validate(r.validateLayer,`layers.${b}`,l,{arrayIndex:-1},_))return;E=r.createStyleLayer(l),this._validateLayer(E),E.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}let D=d?this._order.indexOf(d):this._order.length;if(d&&D===-1)return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(D,0,b),this._layerOrderChanged=!0,this._layers[b]=E;let P=this._getLayerSourceCache(E);if(this._removedLayers[b]&&E.source&&P&&E.type!=="custom"){let F=this._removedLayers[b];delete this._removedLayers[b],F.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",P.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,d){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new r.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===d)return;let _=this._order.indexOf(l);this._order.splice(_,1);let b=d?this._order.indexOf(d):this._order.length;d&&b===-1?this.fire(new r.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(b,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();let d=this._layers[l];if(!d)return void this.fire(new r.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);let _=this._order.indexOf(l);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=d,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(let d in this._layers)if(this._layers[d].type===l)return!0;return!1}setLayerZoomRange(l,d,_){this._checkLoaded();let b=this.getLayer(l);b?b.minzoom===d&&b.maxzoom===_||(d!=null&&(b.minzoom=d),_!=null&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new r.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,d,_={}){this._checkLoaded();let b=this.getLayer(l);if(b){if(!x(b.filter,d))return d==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(r.validateFilter,`layers.${b.id}.filter`,d,{layerType:b.type},_)||(b.filter=r.clone$1(d),this._updateLayer(b)))}else this.fire(new r.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){let d=this.getLayer(l);return d&&r.clone$1(d.filter)}setLayoutProperty(l,d,_,b={}){this._checkLoaded();let E=this.getLayer(l);E?x(E.getLayoutProperty(d),_)||(E.setLayoutProperty(d,_,b),this._updateLayer(E)):this.fire(new r.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,d){let _=this.getLayer(l);if(_)return _.getLayoutProperty(d);this.fire(new r.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,d,_,b={}){this._checkLoaded();let E=this.getLayer(l);E?x(E.getPaintProperty(d),_)||(E.setPaintProperty(d,_,b)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new r.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,d){let _=this.getLayer(l);return _&&_.getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();let _=l.source,b=l.sourceLayer,E=this.getSource(_);if(!E)return void this.fire(new r.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));let D=E.type;if(D==="geojson"&&b)return void this.fire(new r.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(D==="vector"&&!b)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided.")));let P=this._getSourceCaches(_);for(let F of P)F.setFeatureState(b,l.id,d)}removeFeatureState(l,d){this._checkLoaded();let _=l.source,b=this.getSource(_);if(!b)return void this.fire(new r.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));let E=b.type,D=E==="vector"?l.sourceLayer:void 0;if(E==="vector"&&!D)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new r.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));let P=this._getSourceCaches(_);for(let F of P)F.removeFeatureState(D,l.id,d)}getFeatureState(l){this._checkLoaded();let d=l.source,_=l.sourceLayer,b=this.getSource(d);if(b){if(b.type!=="vector"||_)return l.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(_,l.id);this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new r.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return r.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){let l={};for(let d in this._sourceCaches){let _=this._sourceCaches[d].getSource();l[_.id]||(l[_.id]=_.serialize())}return r.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0;let d=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&d&&d.getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",d.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){let d=D=>this._layers[D].type==="fill-extrusion",_={},b=[];for(let D=this._order.length-1;D>=0;D--){let P=this._order[D];if(d(P)){_[P]=D;for(let F of l){let j=F[P];if(j)for(let W of j)b.push(W)}}}b.sort((D,P)=>P.intersectionZ-D.intersectionZ);let E=[];for(let D=this._order.length-1;D>=0;D--){let P=this._order[D];if(d(P))for(let F=b.length-1;F>=0;F--){let j=b[F].feature;if(_[j.layer.id]<D)break;E.push(j),b.pop()}else for(let F of l){let j=F[P];if(j)for(let W of j)E.push(W.feature)}}return E}queryRenderedFeatures(l,d,_){d&&d.filter&&this._validate(r.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);let b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new r.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(let F of d.layers){let j=this._layers[F];if(!j)return this.fire(new r.ErrorEvent(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];b[j.source]=!0}}let E=[];d.availableImages=this._availableImages;let D=d&&d.layers?d.layers.some(F=>{let j=this.getLayer(F);return j&&j.is3D()}):this.has3DLayers(),P=ct.createFromScreenPoints(l,_);for(let F in this._sourceCaches){let j=this._sourceCaches[F].getSource().id;d.layers&&!b[j]||E.push(Ke(this._sourceCaches[F],this._layers,this._serializedLayers,P,d,_,D,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(F,j,W,ee,fe,Te,we){let Se={},Me=Te.queryRenderedSymbols(ee),ce=[];for(let Oe of Object.keys(Me).map(Number))ce.push(we[Oe]);ce.sort(Pt);for(let Oe of ce){let Pe=Oe.featureIndex.lookupSymbolFeatures(Me[Oe.bucketInstanceId],j,Oe.bucketIndex,Oe.sourceLayerIndex,fe.filter,fe.layers,fe.availableImages,F);for(let Ue in Pe){let Ze=Se[Ue]=Se[Ue]||[],je=Pe[Ue];je.sort(($e,it)=>{let dt=Oe.featureSortOrder;if(dt){let mt=dt.indexOf($e.featureIndex);return dt.indexOf(it.featureIndex)-mt}return it.featureIndex-$e.featureIndex});for(let $e of je)Ze.push($e)}}for(let Oe in Se)Se[Oe].forEach(Pe=>{let Ue=Pe.feature,Ze=W(F[Oe]).getFeatureState(Ue.layer["source-layer"],Ue.id);Ue.source=Ue.layer.source,Ue.layer["source-layer"]&&(Ue.sourceLayer=Ue.layer["source-layer"]),Ue.state=Ze});return Se}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),P.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(l,d){d&&d.filter&&this._validate(r.validateFilter,"querySourceFeatures.filter",d.filter,null,d);let _=this._getSourceCaches(l),b=[];for(let E of _)b=b.concat(rt(E,d));return b}addSourceType(l,d,_){return so.getSourceType(l)?_(new Error(`A source type called "${l}" already exists.`)):(so.setSourceType(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(l,d={}){this._checkLoaded();let _=this.light.getLight(),b=!1;for(let D in l)if(!x(l[D],_[D])){b=!0;break}if(!b)return;let E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,d),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,d=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(d===1){if(typeof l.source=="object"){let _="terrain-dem-src";this.addSource(_,l.source),l=r.clone$1(l),l=r.extend(l,{source:_})}if(this._validate(r.validateTerrain,"terrain",l))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode)this._createTerrain(l,d);else{let _=this.terrain,b=_.get();for(let E of Object.keys(r.spec.terrain))!l.hasOwnProperty(E)&&r.spec.terrain[E].default&&(l[E]=r.spec.terrain[E].default);for(let E in l)if(!x(l[E],b[E])){_.set(l),this.stylesheet.terrain=l;let D=this._setTransitionParameters({duration:0});_.updateTransitions(D);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){let d=this.fog=new pe(l,this.map.transform);this.stylesheet.fog=l;let _=this._setTransitionParameters({duration:0});d.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let d=this.fog,_=d.get();Object.keys(l).length===0&&d.set(l);for(let b in l)if(!x(l[b],_[b])){d.set(l),this.stylesheet.fog=l;let E=this._setTransitionParameters({duration:0});d.updateTransitions(E);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:r.exported.now(),transition:r.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;let l=this._order.filter(_=>this.isLayerDraped(this._layers[_])),d=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...d)}_createTerrain(l,d){let _=this.terrain=new ae(l,d);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();let b=this._setTransitionParameters({duration:0});_.updateTransitions(b)}_force3DLayerUpdate(){for(let l in this._layers){let d=this._layers[l];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(let l in this._layers){let d=this._layers[l];d.type==="symbol"&&this._updateLayer(d)}}_validate(l,d,_,b,E={}){return(!E||E.validate!==!1)&&vu(this,l.call(r.validateStyle,r.extend({key:d,style:this.serialize(),value:_,styleSpec:r.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(let l in this._layers)this._layers[l].setEventedParent(null);for(let l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){let d=this._getSourceCaches(l);for(let _ of d)_.clearTiles()}_reloadSource(l){let d=this._getSourceCaches(l);for(let _ of d)_.resume(),_.reload()}_reloadSources(){for(let l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(let d in this._sourceCaches)this._sourceCaches[d].update(l)}_generateCollisionBoxes(){for(let l in this._sourceCaches){let d=this._sourceCaches[l];d.resume(),d.reload()}}_updatePlacement(l,d,_,b,E=!1){let D=!1,P=!1,F={};for(let j of this._order){let W=this._layers[j];if(W.type!=="symbol")continue;if(!F[W.source]){let fe=this._getLayerSourceCache(W);if(!fe)continue;F[W.source]=fe.getRenderableIds(!0).map(Te=>fe.getTileByID(Te)).sort((Te,we)=>we.tileID.overscaledZ-Te.tileID.overscaledZ||(Te.tileID.isLessThan(we.tileID)?-1:1))}let ee=this.crossTileSymbolIndex.addLayer(W,F[W.source],l.center.lng,l.projection);D=D||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new r.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.exported.now(),l.zoom))&&(this.pauseablePlacement=new yu(l,this._order,E,d,_,b,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.exported.now()),P=!0),D&&this.pauseablePlacement.placement.setStale()),P||D)for(let j of this._order){let W=this._layers[j];W.type==="symbol"&&this.placement.updateLayerOpacities(W,F[W.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.exported.now())}_releaseSymbolFadeTiles(){for(let l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();let b=E=>{E&&E.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(l,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(l,d,_){return r.makeRequest(d,_)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){let d=[];return this._otherSourceCaches[l]&&d.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&d.push(this._symbolSourceCaches[l]),d}_isSourceCacheLoaded(l){let d=this._getSourceCaches(l);return d.length===0?(this.fire(new r.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}so.getSourceType=function(m){return be[m]},so.setSourceType=function(m,l){be[m]=l},so.registerForPluginStateChange=r.registerForPluginStateChange;var xu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Jg="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",$g=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,ed=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qg=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let ap={},lp={},ac=[];gl(xu,ac),gl($g,ac),gl(ed,ac),gl(Qg,ac),ap=Ni("",$g),lp=Ni(Qg,ed);let e_=Ni(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),td=xu,nd=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var cp={background:Ni(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ni(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ni(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ni("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ni(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ni(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ni("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ni("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ni(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ni(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ni(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ni(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ni(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ni(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ni(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ni(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ni(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ni(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ni(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ni(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Ni(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Ni(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Ni(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Ni(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ni(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Jg),skyboxGradient:Ni(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Jg),skyboxCapture:Ni(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ni(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ni(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function gl(m,l){let d=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of d)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let b=_.split(" ");for(let E of b)l.includes(E)||l.push(E)}}function Ni(m,l){let d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b={},E=[...ac];return gl(m,E),gl(l,E),{fragmentSource:m=m.replace(d,(D,P,F,j,W)=>(b[W]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${W}
varying ${F} ${j} ${W};
#else
uniform ${F} ${j} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${F} ${j} ${W} = u_${W};
#endif
`)),vertexSource:l=l.replace(d,(D,P,F,j,W)=>{let ee=j==="float"?"vec2":"vec4",fe=W.match(/color/)?"color":ee;return b[W]?P==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${F} ${ee} a_${W};
varying ${F} ${j} ${W};
#else
uniform ${F} ${j} u_${W};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${F} ${j} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${fe}(a_${W}, u_${W}_t);
#else
    ${F} ${j} ${W} = u_${W};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${F} ${ee} a_${W};
#else
uniform ${F} ${j} u_${W};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${F} ${j} ${W} = a_${W};
#else
    ${F} ${j} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${F} ${j} ${W} = unpack_mix_${fe}(a_${W}, u_${W}_t);
#else
    ${F} ${j} ${W} = u_${W};
#endif
`}),staticAttributes:_,usedDefines:E}}class bu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,d,_,b,E,D,P){this.context=l;let F=this.boundPaintVertexBuffers.length!==b.length;for(let W=0;!F&&W<b.length;W++)this.boundPaintVertexBuffers[W]!==b[W]&&(F=!0);let j=this.boundDynamicVertexBuffers.length!==P.length;for(let W=0;!j&&W<P.length;W++)this.boundDynamicVertexBuffers[W]!==P[W]&&(j=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||F||j||this.boundIndexBuffer!==E||this.boundVertexOffset!==D)this.freshBind(d,_,b,E,D,P);else{l.bindVertexArrayOES.set(this.vao);for(let W of P)W&&W.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(l,d,_,b,E,D){let P,F=l.numAttributes,j=this.context,W=j.gl;if(j.extVertexArrayObject)this.vao&&this.destroy(),this.vao=j.extVertexArrayObject.createVertexArrayOES(),j.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=D;else{P=j.currentNumAttributes||0;for(let ee=F;ee<P;ee++)W.disableVertexAttribArray(ee)}d.enableAttributes(W,l),d.bind(),d.setVertexAttribPointers(W,l,E);for(let ee of _)ee.enableAttributes(W,l),ee.bind(),ee.setVertexAttribPointers(W,l,E);for(let ee of D)ee&&(ee.enableAttributes(W,l),ee.bind(),ee.setVertexAttribPointers(W,l,E));b&&b.bind(),j.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function up(m,l){let d=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new r.MercatorCoordinate(0,_/d).toLngLat().lat,new r.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}function wu(m,l,d,_,b,E,D){let P=m.context,F=P.gl,j=d.fbo;if(!j)return;m.prepareDrawTile();let W=m.useProgram("hillshade");P.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,j.colorAttachment.get());let ee=((Se,Me,ce,Oe)=>{let Pe=ce.paint.get("hillshade-shadow-color"),Ue=ce.paint.get("hillshade-highlight-color"),Ze=ce.paint.get("hillshade-accent-color"),je=ce.paint.get("hillshade-illumination-direction")*(Math.PI/180);ce.paint.get("hillshade-illumination-anchor")==="viewport"&&(je-=Se.transform.angle);let $e=!Se.options.moving;return{u_matrix:Oe||Se.transform.calculateProjMatrix(Me.tileID.toUnwrapped(),$e),u_image:0,u_latrange:up(0,Me.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),je],u_shadow:Pe,u_highlight:Ue,u_accent:Ze}})(m,d,_,m.terrain?l.projMatrix:null);m.prepareDrawProgram(P,W,l.toUnwrapped());let{tileBoundsBuffer:fe,tileBoundsIndexBuffer:Te,tileBoundsSegments:we}=m.getTileBoundsBuffers(d);W.draw(P,F.TRIANGLES,b,E,D,r.CullFaceMode.disabled,ee,_.id,fe,Te,we)}function Tu(m,l,d){if(!l.needsDEMTextureUpload)return;let _=m.context,b=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||m.getTileTexture(d.stride);let E=d.getPixels();l.demTexture?l.demTexture.update(E,{premultiply:!1}):l.demTexture=new r.Texture(_,E,b.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function id(m,l,d,_,b,E){let D=m.context,P=D.gl;if(!l.dem)return;let F=l.dem;if(D.activeTexture.set(P.TEXTURE1),Tu(m,l,F),!l.demTexture)return;l.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);let j=F.dim;D.activeTexture.set(P.TEXTURE0);let W=l.fbo;if(!W){let we=new r.Texture(D,{width:j,height:j,data:null},P.RGBA);we.bind(P.LINEAR,P.CLAMP_TO_EDGE),W=l.fbo=D.createFramebuffer(j,j,!0),W.colorAttachment.set(we.texture)}D.bindFramebuffer.set(W.framebuffer),D.viewport.set([0,0,j,j]);let{tileBoundsBuffer:ee,tileBoundsIndexBuffer:fe,tileBoundsSegments:Te}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(D,P.TRIANGLES,_,b,E,r.CullFaceMode.disabled,((we,Se)=>{let Me=Se.stride,ce=r.create();return r.ortho(ce,0,r.EXTENT,-r.EXTENT,0,0,1),r.translate(ce,ce,[0,-r.EXTENT,0]),{u_matrix:ce,u_image:1,u_dimension:[Me,Me],u_zoom:we.overscaledZ,u_unpack:Se.unpackVector}})(l.tileID,F),d.id,ee,fe,Te),l.needsHillshadePrepare=!1}let rd=m=>({u_matrix:new r.UniformMatrix4f(m),u_image0:new r.Uniform1i(m),u_skirt_height:new r.Uniform1f(m)}),hp=(m,l)=>({u_matrix:m,u_image0:0,u_skirt_height:l}),sd=(m,l,d,_,b,E,D,P,F,j,W,ee,fe,Te,we)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:E,u_image0:0,u_frustum_tl:D,u_frustum_tr:P,u_frustum_br:F,u_frustum_bl:j,u_globe_pos:W,u_globe_radius:ee,u_viewport:fe,u_grid_matrix:we?Float32Array.from(we):new Float32Array(9),u_skirt_height:Te});function dp(m,l){return m!=null&&l!=null&&!(!m.hasData()||!l.hasData())&&m.demTexture!=null&&l.demTexture!=null&&m.tileID.key!==l.tileID.key}let za=new class{constructor(){this.operations={}}newMorphing(m,l,d,_,b){if(m in this.operations){let E=this.operations[m];E.to.tileID.key!==d.tileID.key&&(E.queued=d)}else this.operations[m]={startTime:_,phase:0,duration:b,from:l,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;let l=this.operations[m];return{from:l.from,to:l.to,phase:l.phase}}update(m){for(let l in this.operations){let d=this.operations[l];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[l];break}}}_nextOp(m,l){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=l,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},_l={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function od(m){return 6*Math.pow(1.5,22-m)}function fp(m,l){let d=1<<m.z;return!l&&(m.x===0||m.x===d-1)||m.y===0||m.y===d-1}let Li=m=>({u_matrix:m});function Eu(m,l,d,_,b){if(b>0){let E=r.exported.now(),D=(E-m.timeAdded)/b,P=l?(E-l.timeAdded)/b:-1,F=d.getSource(),j=_.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),W=!l||Math.abs(l.tileID.overscaledZ-j)>Math.abs(m.tileID.overscaledZ-j),ee=W&&m.refreshedUponExpiration?1:r.clamp(W?D:1-P,0,1);return m.refreshedUponExpiration&&D>=1&&(m.refreshedUponExpiration=!1),l?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}class t_ extends r.SourceCache{constructor(l){let d={type:"raster-dem",maxzoom:l.transform.maxZoom},_=new xt(In(),null),b=Fe("mock-dem",d,_,l.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,d){l.state="loaded",d(null)}}class n_ extends r.SourceCache{constructor(l){let d=Fe("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new xt(In(),null),l.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,d,_){if(l.freezeTileCoverage)return;this.transform=l;let b=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,D)=>{if(E[D.key]="",!this._tiles[D.key]){let P=new r.Tile(D,this._source.tileSize*D.overscaleFactor(),l.tileZoom);P.state="loaded",this._tiles[D.key]=P}return E},{});for(let E in this._tiles)E in b||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(l){let d=this.proxyCachedFBO[l];if(d!==void 0){let _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class pp extends r.OverscaledTileID{constructor(l,d,_){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class mp extends r.Elevation{constructor(l,d){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[_,b,E]=function(F){let j=new r.StructArrayLayout2i4,W=new r.StructArrayLayout3ui6,ee=131;j.reserve(17161),W.reserve(33800);let fe=r.EXTENT/128,Te=r.EXTENT+fe/2,we=Te+fe;for(let Me=-fe;Me<we;Me+=fe)for(let ce=-fe;ce<we;ce+=fe){let Oe=ce<0||ce>Te||Me<0||Me>Te?24575:0,Pe=r.clamp(Math.round(ce),0,r.EXTENT),Ue=r.clamp(Math.round(Me),0,r.EXTENT);j.emplaceBack(Pe+Oe,Ue)}let Se=(Me,ce)=>{let Oe=ce*ee+Me;W.emplaceBack(Oe+1,Oe,Oe+ee),W.emplaceBack(Oe+ee,Oe+ee+1,Oe+1)};for(let Me=1;Me<129;Me++)for(let ce=1;ce<129;ce++)Se(ce,Me);return[0,129].forEach(Me=>{for(let ce=0;ce<130;ce++)Se(ce,Me),Se(Me,ce)}),[j,W,32768]}(),D=l.context;this.gridBuffer=D.createVertexBuffer(_,r.posAttributes.members),this.gridIndexBuffer=D.createIndexBuffer(b),this.gridSegments=r.SegmentVector.simpleSegment(0,0,_.length,b.length),this.gridNoSkirtSegments=r.SegmentVector.simpleSegment(0,0,_.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new n_(d.map),this.orthoMatrix=r.create(),r.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.EXTENT,0,r.EXTENT,0,1);let P=D.gl;this._overlapStencilMode=new r.StencilMode({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new t_(d.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,d,_){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;let b=l.terrain.properties;this.sourceCache=l.terrain.drapeRenderMode===0?this._mockSourceCache:l._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");let E=()=>{this.sourceCache.used&&r.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let D=this.getScaledDemTileSize();this.sourceCache.update(d,D,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),d.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){let l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||l.efficiency!==100&&r.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let b=this.proxyCoords=d.getIds().map(F=>{let j=d.getTileByID(F).tileID;return j.projMatrix=_.calculateProjMatrix(j.toUnwrapped()),j});(function(F,j){let W=j.transform.pointCoordinate(j.transform.getCameraPoint()),ee=new r.pointGeometry(W.x,W.y);F.sort((fe,Te)=>{if(Te.overscaledZ-fe.overscaledZ)return Te.overscaledZ-fe.overscaledZ;let we=new r.pointGeometry(fe.canonical.x+(1<<fe.canonical.z)*fe.wrap,fe.canonical.y),Se=new r.pointGeometry(Te.canonical.x+(1<<Te.canonical.z)*Te.wrap,Te.canonical.y),Me=ee.mult(1<<fe.canonical.z);return Me.x-=.5,Me.y-=.5,Me.distSqr(we)-Me.distSqr(Se)})})(b,this.painter),this._previousZoom=_.zoom;let E=this.proxyToSource||{};this.proxyToSource={},b.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};let D=this._style._sourceCaches;for(let F in D){let j=D[F];if(!j.used||(j!==this.sourceCache&&this.resetTileLookupCache(j.id),this._setupProxiedCoordsForOrtho(j,l[F],E),j.usedForTerrain))continue;let W=l[F];j.getSource().reparseOverscaled&&this._assignTerrainTiles(W)}this.proxiedCoords[d.id]=b.map(F=>new pp(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=r.exported.now();let P={};this._visibleDemTiles=[];for(let F of this.proxyCoords){let j=this.terrainTileForTile[F.key];if(!j)continue;let W=j.tileID.key;W in P||(this._visibleDemTiles.push(j),P[W]=W)}}_assignTerrainTiles(l){this._initializing||l.forEach(d=>{if(this.terrainTileForTile[d.key])return;let _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){let l=this.painter.context,d=l.gl;for(let _ in this.terrainTileForTile){let b=this.terrainTileForTile[_],E=b.dem;!E||b.demTexture&&!b.needsDEMTextureUpload||(l.activeTexture.set(d.TEXTURE1),Tu(this.painter,b,E))}}_prepareDemTileUniforms(l,d,_,b){if(!d||d.demTexture==null)return!1;let E=l.tileID.canonical,D=Math.pow(2,d.tileID.canonical.z-E.z),P=b||"";return _[`u_dem_tl${P}`]=[E.x*D%1,E.y*D%1],_[`u_dem_scale${P}`]=D,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let l=this.painter.context,d=l.gl;if(!this._emptyDepthBufferTexture){let _=new r.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.Texture(l,_,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0,d=this._visibleDemTiles.reduce((_,b)=>{if(!b.dem)return _;let E=b.dem.tree.minimums[0];return E>0&&l++,_+E},0);return l?d/l:0}_updateEmptyDEMTexture(){let l=this.painter.context,d=l.gl;l.activeTexture.set(d.TEXTURE2);let _=this._getLoadedAreaMinimum(),b=new r.RGBAImage({width:1,height:1},new Uint8Array(r.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(b,{premultiply:!1}):E=this._emptyDEMTexture=new r.Texture(l,b,d.RGBA,{premultiply:!1}),E}setupElevationDraw(l,d,_){let b=this.painter.context,E=b.gl,D=(P=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:r.DEMData.getUnpackVector(P),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var P;D.u_dem_size=this.sourceCache.getSource().tileSize,D.u_exaggeration=this.exaggeration();let F=null,j=null,W=1;if(_&&_.morphing&&this._useVertexMorphing){let ee=_.morphing.srcDemTile,fe=_.morphing.dstDemTile;W=_.morphing.phase,ee&&fe&&(this._prepareDemTileUniforms(l,ee,D,"_prev")&&(j=ee),this._prepareDemTileUniforms(l,fe,D)&&(F=fe))}if(j&&F?(b.activeTexture.set(E.TEXTURE2),F.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),b.activeTexture.set(E.TEXTURE4),j.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),D.u_dem_lerp=W):(F=this.terrainTileForTile[l.tileID.key],b.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(l,F,D)?F.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),b.activeTexture.set(E.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(D.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),D.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&F){let ee=(1<<F.tileID.canonical.z)*r.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;D.u_meter_to_dem=ee}if(_&&_.labelPlaneMatrixInv&&(D.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(b,D),this.painter.transform.projection.name==="globe"){let ee=this.globeUniformValues(this.painter.transform,l.tileID.canonical,_&&_.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,ee)}}globeUniformValues(l,d,_){let b=l.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,r.EXTENT,0),u_tile_br_up:b.upVector(d,r.EXTENT,r.EXTENT),u_tile_bl_up:b.upVector(d,0,r.EXTENT),u_tile_up_scale:_?r.globeMetersToEcef(1):b.upVectorScale(d,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){let d=this.painter,_=this.painter.context;l.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,E,D,P,F){if(b.transform.projection.name==="globe")(function(j,W,ee,fe,Te){let we=j.context,Se=we.gl,Me,ce,Oe=j.options.showTerrainWireframe?2:0,Pe=j.transform,Ue=r.globeUseCustomAntiAliasing(j,we,Pe),Ze=(Ut,ft)=>{if(ce===Ut)return;let tt=[_l[Ut],"PROJECTION_GLOBE_VIEW"];Ue&&tt.push("CUSTOM_ANTIALIASING"),ft&&tt.push(_l[Oe]),Me=j.useProgram("globeRaster",null,tt),ce=Ut},je=j.colorModeForRenderPass(),$e=new r.DepthMode(Se.LEQUAL,r.DepthMode.ReadWrite,j.depthRangeFor3D);za.update(Te);let it=r.calculateGlobeMercatorMatrix(Pe),dt=[r.mercatorXfromLng(Pe.center.lng),r.mercatorYfromLat(Pe.center.lat)],mt=Oe?[!1,!0]:[!1],Qt=j.globeSharedBuffers,lt=[Pe.width*r.exported.devicePixelRatio,Pe.height*r.exported.devicePixelRatio],Dt=Float32Array.from(Pe.globeMatrix),bt={useDenormalizedUpVectorScale:!0};if(mt.forEach(Ut=>{let ft=j.transform,tt=od(ft.zoom)*W.exaggeration();ce=-1;let yt=Ut?Se.LINES:Se.TRIANGLES;for(let Nt of fe){let jt=ee.getTile(Nt),zn=r.StencilMode.disabled,oi=W.prevTerrainTileForTile[Nt.key],Mn=W.terrainTileForTile[Nt.key];dp(oi,Mn)&&za.newMorphing(Nt.key,oi,Mn,Te,250),we.activeTexture.set(Se.TEXTURE0),jt.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE);let vn=za.getMorphValuesForProxy(Nt.key),Fn=vn?1:0;vn&&r.extend$1(bt,{morphing:{srcDemTile:vn.from,dstDemTile:vn.to,phase:r.easeCubicInOut(vn.phase)}});let vi=r.tileCornersToBounds(Nt.canonical),Bn=r.getLatitudinalLod(vi.getCenter().lat),Fi=r.getGridMatrix(Nt.canonical,vi,Bn,ft.worldSize/ft._pixelsPerMercatorPixel),Wi=r.globeNormalizeECEF(r.globeTileBounds(Nt.canonical)),tr=sd(ft.projMatrix,Dt,it,Wi,r.globeToMercatorTransition(ft.zoom),dt,ft.frustumCorners.TL,ft.frustumCorners.TR,ft.frustumCorners.BR,ft.frustumCorners.BL,ft.globeCenterInViewSpace,ft.globeRadius,lt,tt,Fi);if(Ze(Fn,Ut),W.setupElevationDraw(jt,Me,bt),j.prepareDrawProgram(we,Me,Nt.toUnwrapped()),Qt){let[Yi,Pr,Ns]=Ut?Qt.getWirefameBuffers(j.context,Bn):Qt.getGridBuffers(Bn,tt!==0);Me.draw(we,yt,$e,zn,je,r.CullFaceMode.backCCW,tr,"globe_raster",Yi,Pr,Ns)}}}),Qt){let Ut=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ue&&Ut.push("CUSTOM_ANTIALIASING"),Me=j.useProgram("globeRaster",null,Ut);for(let ft of fe){let{x:tt,y:yt,z:Nt}=ft.canonical,jt=yt===0,zn=yt===(1<<Nt)-1,[oi,Mn,vn,Fn]=Qt.getPoleBuffers(Nt);if(Fn&&(jt||zn)){let vi=ee.getTile(ft);we.activeTexture.set(Se.TEXTURE0),vi.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE);let Bn=r.globePoleMatrixForTile(Nt,tt,Pe),Fi=r.globeNormalizeECEF(r.globeTileBounds(ft.canonical)),Wi=(tr,Yi)=>tr.draw(we,Se.TRIANGLES,$e,r.StencilMode.disabled,je,r.CullFaceMode.disabled,sd(Pe.projMatrix,Bn,Bn,Fi,0,dt,Pe.frustumCorners.TL,Pe.frustumCorners.TR,Pe.frustumCorners.BR,Pe.frustumCorners.BL,Pe.globeCenterInViewSpace,Pe.globeRadius,lt,0),"globe_pole_raster",Yi,vn,Fn);W.setupElevationDraw(vi,Me,bt),j.prepareDrawProgram(we,Me,ft.toUnwrapped()),jt&&Wi(Me,oi),zn&&(Bn=r.scale(r.create(),Bn,[1,-1,1]),Wi(Me,Mn))}}}})(b,E,D,P,F);else{let j=b.context,W=j.gl,ee,fe,Te=b.options.showTerrainWireframe?2:0,we=(Pe,Ue)=>{if(fe===Pe)return;let Ze=[_l[Pe]];Ue&&Ze.push(_l[Te]),ee=b.useProgram("terrainRaster",null,Ze),fe=Pe},Se=b.colorModeForRenderPass(),Me=new r.DepthMode(W.LEQUAL,r.DepthMode.ReadWrite,b.depthRangeFor3D);za.update(F);let ce=b.transform,Oe=od(ce.zoom)*E.exaggeration();(Te?[!1,!0]:[!1]).forEach(Pe=>{fe=-1;let Ue=Pe?W.LINES:W.TRIANGLES,[Ze,je]=Pe?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(let $e of P){let it=D.getTile($e),dt=r.StencilMode.disabled,mt=E.prevTerrainTileForTile[$e.key],Qt=E.terrainTileForTile[$e.key];dp(mt,Qt)&&za.newMorphing($e.key,mt,Qt,F,250),j.activeTexture.set(W.TEXTURE0),it.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST);let lt=za.getMorphValuesForProxy($e.key),Dt=lt?1:0,bt;lt&&(bt={morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:r.easeCubicInOut(lt.phase)}});let Ut=hp($e.projMatrix,fp($e.canonical,ce.renderWorldCopies)?Oe/10:Oe);we(Dt,Pe),E.setupElevationDraw(it,ee,bt),b.prepareDrawProgram(j,ee,$e.toUnwrapped()),ee.draw(j,Ue,Me,dt,Se,r.CullFaceMode.backCCW,Ut,"terrain_raster",E.gridBuffer,Ze,je)}})}}(d,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;let d=this.painter,_=this.painter.context,b=this.proxySourceCache,E=this.proxiedCoords[b.id],D=this._drapedRenderBatches.shift(),P=[],F=d.style.order,j=0;for(let W of E){let ee=b.getTileByID(W.proxyTileKey),fe=b.proxyCachedFBO[W.key]?b.proxyCachedFBO[W.key][l]:void 0,Te=fe!==void 0?b.renderCache[fe]:this.pool[j++],we=fe!==void 0;if(ee.texture=Te.tex,we&&!Te.dirty){P.push(ee.tileID);continue}let Se;_.bindFramebuffer.set(Te.fb.framebuffer),this.renderedToTile=!1,Te.dirty&&(_.clear({color:r.Color.transparent,stencil:0}),Te.dirty=!1);for(let Me=D.start;Me<=D.end;++Me){let ce=d.style._layers[F[Me]];if(ce.isHidden(d.transform.zoom))continue;let Oe=d.style._getLayerSourceCache(ce),Pe=Oe?this.proxyToSource[W.key][Oe.id]:[W];if(!Pe)continue;let Ue=Pe;_.viewport.set([0,0,Te.fb.width,Te.fb.height]),Se!==(Oe?Oe.id:null)&&(this._setupStencil(Te,Pe,ce,Oe),Se=Oe?Oe.id:null),d.renderLayer(d,Oe,ce,Ue)}this.renderedToTile?(Te.dirty=!0,P.push(ee.tileID)):we||--j,j===5&&(j=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),D.end+1}postRender(){}renderCacheEfficiency(l){let d=l.order.length;if(d===0)return{efficiency:100};let _,b=0,E=0,D=!1;for(let P=0;P<d;++P){let F=l._layers[l.order[P]];this._style.isLayerDraped(F)?(D&&++b,++E):D||(D=!0,_=F.id)}return E===0?{efficiency:100}:{efficiency:100*(1-b/E),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{l=Math.min(l,d.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,d,_){if(!this._visibleDemTiles)return null;let b=this._visibleDemTiles.filter(E=>E.dem).map(E=>{let D=E.tileID,P=1<<D.overscaledZ,{x:F,y:j}=D.canonical,W=F/P,ee=(F+1)/P,fe=j/P,Te=(j+1)/P;return{minx:W,miny:fe,maxx:ee,maxy:Te,t:E.dem.tree.raycastRoot(W,fe,ee,Te,l,d,_),tile:E}});b.sort((E,D)=>(E.t!==null?E.t:Number.MAX_VALUE)-(D.t!==null?D.t:Number.MAX_VALUE));for(let E of b){if(E.t==null)return null;let D=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,l,d,_);if(D!=null)return D}return null}_createFBO(){let l=this.painter.context,d=l.gl,_=this.drapeBufferSize;l.activeTexture.set(d.TEXTURE0);let b=new r.Texture(l,{width:_[0],height:_[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);let E=l.createFramebuffer(_[0],_[1],!1);return E.colorAttachment.set(b.texture),E.depthAttachment=new Yn(l,E.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:E,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(let l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{let d=this._style._layers[l],_=d.isHidden(this.painter.transform.zoom);return d.type==="custom"?!_&&d.shouldRedrape():!_&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(let _ of this._style._getSources())if(_ instanceof X){l=!0;break}if(!l)return;let d={};for(let _=0;_<this._style.order.length;++_){let b=this._style._layers[this._style.order[_]],E=this._style._getLayerSourceCache(b);if(E&&!d[E.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof r.ZoomDependentExpression){d[E.id]=!0;for(let D of this.proxyCoords){let P=this.proxyToSource[D.key][E.id];if(P)for(let F of P)this._clearRenderCacheForTile(E.id,F)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(let _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof N){l=!0;break}if(!l)return;let d={};for(let _=0;_<this._style.order.length;++_){let b=this._style._layers[this._style.order[_]],E=this._style._getLayerSourceCache(b);if(!E||d[E.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;let D=b.paint.get("raster-fade-duration");for(let P of this.proxyCoords){let F=this.proxyToSource[P.key][E.id];if(F)for(let j of F){let W=Eu(E.getTile(j),E.findLoadedParent(j,0),E,this.painter.transform,D);(W.opacity!==1||W.mix!==0)&&this._clearRenderCacheForTile(E.id,j)}}}}_setupDrapedRenderBatches(){let l=this._style.order,d=l.length;if(d===0)return;let _=[],b,E=0,D=this._style._layers[l[E]];for(;!this._style.isLayerDraped(D)&&D.isHidden(this.painter.transform.zoom)&&++E<d;)D=this._style._layers[l[E]];for(;E<d;++E){let P=this._style._layers[l[E]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?b===void 0&&(b=E):b!==void 0&&(_.push({start:b,end:E-1}),b=void 0))}b!==void 0&&_.push({start:b,end:E-1}),this._drapedRenderBatches=_}_setupRenderCache(l){let d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){let D=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let P=0;P<D.length;++P){let F=Object.values(D[P]);d.renderCachePool.push(...F)}}return}this._clearRasterLayersFromRenderCache();let _=this.proxyCoords,b=this._tilesDirty;for(let D=_.length-1;D>=0;D--){let P=_[D];if(d.getTileByID(P.key),d.proxyCachedFBO[P.key]!==void 0){let F=l[P.key],j=this.proxyToSource[P.key],W=0;for(let ee in j){let fe=j[ee],Te=F[ee];if(!Te||Te.length!==fe.length||fe.some((we,Se)=>we!==Te[Se]||b[ee]&&b[ee].hasOwnProperty(we.key))){W=-1;break}++W}for(let ee in d.proxyCachedFBO[P.key])d.renderCache[d.proxyCachedFBO[P.key][ee]].dirty=W<0||W!==Object.values(F).length}}let E=[...this._drapedRenderBatches];E.sort((D,P)=>P.end-P.start-(D.end-D.start));for(let D of E)for(let P of _){if(d.proxyCachedFBO[P.key])continue;let F=d.renderCachePool.pop();F===void 0&&d.renderCache.length<50&&(F=d.renderCache.length,d.renderCache.push(this._createFBO())),F!==void 0&&(d.proxyCachedFBO[P.key]={},d.proxyCachedFBO[P.key][D.start]=F,d.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(l,d,_,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let E=this.painter.context,D=E.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let P;if(_.isTileClipped())P=d.length,this._overlapStencilMode.test={func:D.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:D.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):r.StencilMode.disabled}_renderTileClippingMasks(l,d){let _=this.painter,b=this.painter.context,E=b.gl;_._tileClippingMaskIDs={},b.setColorMode(r.ColorMode.disabled),b.setDepthMode(r.DepthMode.disabled);let D=_.useProgram("clippingMask");for(let P of l){let F=_._tileClippingMaskIDs[P.key]=--d;D.draw(b,E.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:E.ALWAYS,mask:0},F,255,E.KEEP,E.KEEP,E.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,Li(P.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(l){let d=this.painter.transform;if(l.x<0||l.x>d.width||l.y<0||l.y>d.height)return null;let _=[l.x,l.y,1,1];r.transformMat4$1(_,_,d.pixelMatrixInverse),r.scale$1(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;let b=d._camera.position,E=r.mercatorZfromAltitude(1,d.center.lat),D=[b[0],b[1],b[2]/E,0],P=r.subtract([],_.slice(0,3),D);r.normalize(P,P);let F=this.raycast(D,P,this._exaggeration);return F!==null&&F?(r.scaleAndAdd(D,D,P,F),D[3]=D[2],D[2]*=E,D):null}drawDepth(){let l=this.painter,d=l.context,_=this.proxySourceCache,b=Math.ceil(l.width),E=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let D=d.gl,P=d.createFramebuffer(b,E,!0);d.activeTexture.set(D.TEXTURE0);let F=new r.Texture(d,{width:b,height:E,data:null},D.RGBA);F.bind(D.NEAREST,D.CLAMP_TO_EDGE),P.colorAttachment.set(F.texture);let j=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,E);P.depthAttachment.set(j),this._depthFBO=P,this._depthTexture=F}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,E]),function(D,P,F,j){if(D.transform.projection.name==="globe")return;let W=D.context,ee=W.gl;W.clear({depth:1});let fe=D.useProgram("terrainDepth"),Te=new r.DepthMode(ee.LESS,r.DepthMode.ReadWrite,D.depthRangeFor3D);for(let we of j){let Se=F.getTile(we),Me=hp(we.projMatrix,0);P.setupElevationDraw(Se,fe),fe.draw(W,ee.TRIANGLES,Te,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.backCCW,Me,"terrain_depth",P.gridBuffer,P.gridIndexBuffer,P.gridNoSkirtSegments)}}(l,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,d,_){if(l.getSource()instanceof oe)return this._setupProxiedCoordsForImageSource(l,d,_);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};let b=this.proxiedCoords[l.id]=[],E=this.proxyCoords;for(let P=0;P<E.length;P++){let F=E[P],j=this._findTileCoveringTileID(F,l);if(j){let W=this._createProxiedId(F,j,_[F.key]&&_[F.key][l.id]);b.push(W),this.proxyToSource[F.key][l.id]=[W]}}let D=!1;for(let P=0;P<d.length;P++){let F=l.getTile(d[P]);if(!F||!F.hasData())continue;let j=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==F.tileID.canonical.z){let W=this.proxyToSource[j.tileID.key][l.id],ee=this._createProxiedId(j.tileID,F,_[j.tileID.key]&&_[j.tileID.key][l.id]);W?W.splice(W.length-1,0,ee):this.proxyToSource[j.tileID.key][l.id]=[ee],b.push(ee),D=!0}}this._sourceTilesOverlap[l.id]=D}_setupProxiedCoordsForImageSource(l,d,_){if(!l.getSource().loaded())return;let b=this.proxiedCoords[l.id]=[],E=this.proxyCoords,D=l.getSource(),P=new r.pointGeometry(D.tileID.x,D.tileID.y)._div(1<<D.tileID.z),F=D.coordinates.map(r.MercatorCoordinate.fromLngLat).reduce((W,ee)=>(W.min.x=Math.min(W.min.x,ee.x-P.x),W.min.y=Math.min(W.min.y,ee.y-P.y),W.max.x=Math.max(W.max.x,ee.x-P.x),W.max.y=Math.max(W.max.y,ee.y-P.y),W),{min:new r.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(W,ee)=>{let fe=W.wrap+W.canonical.x/(1<<W.canonical.z),Te=W.canonical.y/(1<<W.canonical.z),we=r.EXTENT/(1<<W.canonical.z),Se=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),Me=ee.canonical.y/(1<<ee.canonical.z);return fe+we<Se+F.min.x||fe>Se+F.max.x||Te+we<Me+F.min.y||Te>Me+F.max.y};for(let W=0;W<E.length;W++){let ee=E[W];for(let fe=0;fe<d.length;fe++){let Te=l.getTile(d[fe]);if(!Te||!Te.hasData()||j(ee,Te.tileID))continue;let we=this._createProxiedId(ee,Te,_[ee.key]&&_[ee.key][l.id]),Se=this.proxyToSource[ee.key][l.id];Se?Se.push(we):this.proxyToSource[ee.key][l.id]=[we],b.push(we)}}}_createProxiedId(l,d,_){let b=this.orthoMatrix;if(_){let E=_.find(D=>D.key===d.tileID.key);if(E)return E}if(d.tileID.key!==l.key){let E=l.canonical.z-d.tileID.canonical.z,D,P,F;b=r.create();let j=d.tileID.wrap-l.wrap<<l.overscaledZ;E>0?(D=r.EXTENT>>E,P=D*((d.tileID.canonical.x<<E)-l.canonical.x+j),F=D*((d.tileID.canonical.y<<E)-l.canonical.y)):(D=r.EXTENT<<-E,P=r.EXTENT*(d.tileID.canonical.x-(l.canonical.x+j<<-E)),F=r.EXTENT*(d.tileID.canonical.y-(l.canonical.y<<-E))),r.ortho(b,0,D,0,D,0,1),r.translate(b,b,[P,F,0])}return new pp(d.tileID,l.key,b)}_findTileCoveringTileID(l,d){let _=d.getTile(l);if(_&&_.hasData())return _;let b=this._findCoveringTileCache[d.id],E=b[l.key];if(_=E?d.getTileByID(E):null,_&&_.hasData()||E===null)return _;let D=_?_.tileID:l,P=D.overscaledZ,F=d.getSource().minzoom,j=[];if(!E){let ee=d.getSource().maxzoom;if(l.canonical.z>=ee){let fe=l.canonical.z-ee;d.getSource().reparseOverscaled?(P=Math.max(l.canonical.z+2,d.transform.tileZoom),D=new r.OverscaledTileID(P,l.wrap,ee,l.canonical.x>>fe,l.canonical.y>>fe)):fe!==0&&(P=ee,D=new r.OverscaledTileID(P,l.wrap,ee,l.canonical.x>>fe,l.canonical.y>>fe))}D.key!==l.key&&(j.push(D.key),_=d.getTile(D))}let W=ee=>{j.forEach(fe=>{b[fe]=ee}),j.length=0};for(P-=1;P>=F&&(!_||!_.hasData());P--){_&&W(_.tileID.key);let ee=D.calculateScaledKey(P);if(_=d.getTileByID(ee),_&&_.hasData())break;let fe=b[ee];if(fe===null)break;fe===void 0?j.push(ee):_=d.getTileByID(fe)}return W(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,d){let _=this._tilesDirty[l];_||(_=this._tilesDirty[l]={}),_[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){let l=function(d){let _=0,b=new r.StructArrayLayout2ui4,E=131;for(let D=1;D<129;D++){for(let P=1;P<129;P++)_=D*E+P,b.emplaceBack(_,_+1),b.emplaceBack(_,_+E),b.emplaceBack(_+1,_+E),D===128&&b.emplaceBack(_+E,_+E+1);b.emplaceBack(_+1,_+1+E)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=r.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class gp{static cacheKey(l,d,_,b){let E=`${d}${b?b.cacheKey:""}`;for(let D of _)l.usedDefines.includes(D)&&(E+=`/${D}`);return E}constructor(l,d,_,b,E,D){let P=l.gl;this.program=P.createProgram();let F=function(ce){let Oe=[];for(let Pe=0;Pe<ce.length;Pe++){if(ce[Pe]===null)continue;let Ue=ce[Pe].split(" ");Oe.push(Ue.pop())}return Oe}(_.staticAttributes),j=b?b.getBinderAttributes():[],W=F.concat(j),ee=b?b.defines():[];ee=ee.concat(D.map(ce=>`#define ${ce}`));let fe=l.isWebGL2?`#version 300 es
`:"",Te=fe+ee.concat(l.extStandardDerivatives&&fe.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(nd):nd,nd,td,e_.fragmentSource,lp.fragmentSource,_.fragmentSource).join(`
`),we=fe+ee.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,td,e_.vertexSource,lp.vertexSource,ap.vertexSource,_.vertexSource).join(`
`),Se=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(Se,Te),P.compileShader(Se),P.attachShader(this.program,Se);let Me=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Me,we),P.compileShader(Me),P.attachShader(this.program,Me),this.attributes={},this.numAttributes=W.length;for(let ce=0;ce<this.numAttributes;ce++)W[ce]&&(P.bindAttribLocation(this.program,ce,W[ce]),this.attributes[W[ce]]=ce);P.linkProgram(this.program),P.deleteShader(Me),P.deleteShader(Se),this.fixedUniforms=E(l),this.binderUniforms=b?b.getUniforms(l):[],D.includes("TERRAIN")&&(this.terrainUniforms=(ce=>({u_dem:new r.Uniform1i(ce),u_dem_prev:new r.Uniform1i(ce),u_dem_unpack:new r.Uniform4f(ce),u_dem_tl:new r.Uniform2f(ce),u_dem_scale:new r.Uniform1f(ce),u_dem_tl_prev:new r.Uniform2f(ce),u_dem_scale_prev:new r.Uniform1f(ce),u_dem_size:new r.Uniform1f(ce),u_dem_lerp:new r.Uniform1f(ce),u_exaggeration:new r.Uniform1f(ce),u_depth:new r.Uniform1i(ce),u_depth_size_inv:new r.Uniform2f(ce),u_meter_to_dem:new r.Uniform1f(ce),u_label_plane_matrix_inv:new r.UniformMatrix4f(ce)}))(l)),D.includes("GLOBE")&&(this.globeUniforms=(ce=>({u_tile_tl_up:new r.Uniform3f(ce),u_tile_tr_up:new r.Uniform3f(ce),u_tile_br_up:new r.Uniform3f(ce),u_tile_bl_up:new r.Uniform3f(ce),u_tile_up_scale:new r.Uniform1f(ce)}))(l)),D.includes("FOG")&&(this.fogUniforms=(ce=>({u_fog_matrix:new r.UniformMatrix4f(ce),u_fog_range:new r.Uniform2f(ce),u_fog_color:new r.Uniform4f(ce),u_fog_horizon_blend:new r.Uniform1f(ce),u_fog_temporal_offset:new r.Uniform1f(ce),u_frustum_tl:new r.Uniform3f(ce),u_frustum_tr:new r.Uniform3f(ce),u_frustum_br:new r.Uniform3f(ce),u_frustum_bl:new r.Uniform3f(ce),u_globe_pos:new r.Uniform3f(ce),u_globe_radius:new r.Uniform1f(ce),u_globe_transition:new r.Uniform1f(ce),u_is_globe:new r.Uniform1i(ce),u_viewport:new r.Uniform2f(ce)}))(l))}}setTerrainUniformValues(l,d){if(!this.terrainUniforms)return;let _=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let b in d)_[b]&&_[b].set(this.program,b,d[b])}}setGlobeUniformValues(l,d){if(!this.globeUniforms)return;let _=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let b in d)_[b]&&_[b].set(this.program,b,d[b])}}setFogUniformValues(l,d){if(!this.fogUniforms)return;let _=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(let b in d)_[b].set(this.program,b,d[b])}}draw(l,d,_,b,E,D,P,F,j,W,ee,fe,Te,we,Se){let Me=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(_),l.setStencilMode(b),l.setColorMode(E),l.setCullFace(D);for(let Oe of Object.keys(this.fixedUniforms))this.fixedUniforms[Oe].set(this.program,Oe,P[Oe]);we&&we.setUniforms(this.program,l,this.binderUniforms,fe,{zoom:Te});let ce={[Me.LINES]:2,[Me.TRIANGLES]:3,[Me.LINE_STRIP]:1}[d];for(let Oe of ee.get()){let Pe=Oe.vaos||(Oe.vaos={});(Pe[F]||(Pe[F]=new bu)).bind(l,this,j,we?we.getPaintVertexBuffers():[],W,Oe.vertexOffset,Se||[]),Me.drawElements(d,Oe.primitiveLength*ce,Me.UNSIGNED_SHORT,Oe.primitiveOffset*ce*2)}}}function i_(m,l){let d=Math.pow(2,l.tileID.overscaledZ),_=l.tileSize*Math.pow(2,m.transform.tileZoom)/d,b=_*(l.tileID.canonical.x+l.tileID.wrap*d),E=_*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_tile_units_to_pixels:1/Ct(l,1,m.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}let Nv=r.create(),ad=(m,l,d,_,b,E,D,P,F,j,W)=>{let ee=l.style.light,fe=ee.properties.get("position"),Te=[fe.x,fe.y,fe.z],we=r.create$1();ee.properties.get("anchor")==="viewport"&&(r.fromRotation(we,-l.transform.angle),r.transformMat3(Te,Te,we));let Se=ee.properties.get("color"),Me=l.transform,ce={u_matrix:m,u_lightpos:Te,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nv,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:E};return Me.projection.name==="globe"&&(ce.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],ce.u_zoom_transition=F,ce.u_inv_rot_matrix=W,ce.u_merc_center=j,ce.u_up_dir=Me.projection.upVector(new r.CanonicalTileID(0,0,0),j[0]*r.EXTENT,j[1]*r.EXTENT),ce.u_height_lift=P),ce},_p=(m,l,d,_,b,E,D,P,F,j,W,ee)=>{let fe=ad(m,l,d,_,b,E,D,F,j,W,ee),Te={u_height_factor:-Math.pow(2,D.overscaledZ)/P.tileSize/8};return r.extend(fe,i_(l,P),Te)},ld=m=>({u_matrix:m}),cd=(m,l,d)=>r.extend(ld(m),i_(l,d)),r_=(m,l)=>({u_matrix:m,u_world:l}),s_=(m,l,d,_)=>r.extend(cd(m,l,d),{u_world:_}),Fv=r.create(),Su=(m,l,d,_,b,E)=>{let D=m.transform,P=D.projection.name==="globe",F;if(E.paint.get("circle-pitch-alignment")==="map")if(P){let W=r.globePixelsToTileUnits(D.zoom,l.canonical)*D._pixelsPerMercatorPixel;F=Float32Array.from([W,0,0,W])}else F=D.calculatePixelsToTileUnitsMatrix(d);else F=new Float32Array([D.pixelsToGLUnits[0],0,0,D.pixelsToGLUnits[1]]);let j={u_camera_to_center_distance:D.cameraToCenterDistance,u_matrix:m.translatePosMatrix(l.projMatrix,d,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:r.exported.devicePixelRatio,u_extrude_scale:F,u_inv_rot_matrix:Fv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){j.u_inv_rot_matrix=_,j.u_merc_center=b,j.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],j.u_zoom_transition=r.globeToMercatorTransition(D.zoom);let W=b[0]*r.EXTENT,ee=b[1]*r.EXTENT;j.u_up_dir=D.projection.upVector(new r.CanonicalTileID(0,0,0),W,ee)}return j},Au=m=>{let l=[];return m.paint.get("circle-pitch-alignment")==="map"&&l.push("PITCH_WITH_MAP"),m.paint.get("circle-pitch-scale")==="map"&&l.push("SCALE_WITH_MAP"),l},o_=(m,l,d,_)=>{let b=r.EXTENT/d.tileSize;return{u_matrix:m,u_camera_to_center_distance:l.getCameraToCenterDistance(_),u_extrude_scale:[l.pixelsToGLUnits[0]/b,l.pixelsToGLUnits[1]/b]}},Mu=(m,l,d=1)=>({u_matrix:m,u_color:l,u_overlay:0,u_overlay_scale:d}),yp=r.create(),No=(m,l,d,_,b,E,D)=>{let P=m.transform,F=P.projection.name==="globe",j=F?r.globePixelsToTileUnits(P.zoom,l.canonical)*P._pixelsPerMercatorPixel:Ct(d,1,E),W={u_matrix:l.projMatrix,u_extrude_scale:j,u_intensity:D,u_inv_rot_matrix:yp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){W.u_inv_rot_matrix=_,W.u_merc_center=b,W.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],W.u_zoom_transition=r.globeToMercatorTransition(P.zoom);let ee=b[0]*r.EXTENT,fe=b[1]*r.EXTENT;W.u_up_dir=P.projection.upVector(new r.CanonicalTileID(0,0,0),ee,fe)}return W},vp=(m,l,d,_,b,E,D)=>{let P=m.transform,F=P.calculatePixelsToTileUnitsMatrix(l);return{u_matrix:xp(m,l,d,_),u_pixels_to_tile_units:F,u_device_pixel_ratio:E,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:hd(d)?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ud(l,m.transform),u_alpha_discard_threshold:0,u_trim_offset:D}},a_=(m,l,d,_,b)=>{let E=m.transform;return{u_matrix:xp(m,l,d,_),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:b,u_image:0,u_tile_units_to_pixels:ud(l,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ud(m,l){return 1/Ct(m,1,l.tileZoom)}function xp(m,l,d,_){return m.translatePosMatrix(_||l.tileID.projMatrix,l,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function hd(m){let l=m.paint.get("line-dasharray").value;return l.value||l.kind!=="constant"}let Bv=(m,l,d,_,b,E)=>{return{u_matrix:m,u_tl_parent:l,u_scale_parent:d,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(P=b.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(D=b.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:bp(b.paint.get("raster-hue-rotate")),u_perspective_transform:E};var D,P};function bp(m){m*=Math.PI/180;let l=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}let l_=r.create(),Iu=(m,l,d,_,b,E,D,P,F,j,W,ee,fe,Te,we,Se)=>{let Me=b.transform,ce={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:Me.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:Me.width/Me.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:D,u_coord_matrix:P,u_is_text:+F,u_pitch_with_map:+_,u_texsize:j,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:l_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:l_,u_up_vector:[0,-1,0]};return Se.name==="globe"&&(ce.u_tile_id=[W.canonical.x,W.canonical.y,1<<W.canonical.z],ce.u_zoom_transition=ee,ce.u_inv_rot_matrix=Te,ce.u_merc_center=fe,ce.u_camera_forward=Me._camera.forward(),ce.u_ecef_origin=r.globeECEFOrigin(Me.globeMatrix,W.toUnwrapped()),ce.u_tile_matrix=Float32Array.from(Me.globeMatrix),ce.u_up_vector=we),ce},c_=(m,l,d,_,b,E,D,P,F,j,W,ee,fe,Te,we,Se,Me)=>r.extend(Iu(m,l,d,_,b,E,D,P,F,j,ee,fe,Te,we,Se,Me),{u_gamma_scale:_?b.transform.cameraToCenterDistance*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:r.exported.devicePixelRatio,u_is_halo:+W}),wp=(m,l,d,_,b,E,D,P,F,j,W,ee,fe,Te,we,Se)=>r.extend(c_(m,l,d,_,b,E,D,P,!0,F,!0,W,ee,fe,Te,we,Se),{u_texsize_icon:j,u_texture_icon:1}),Uv=(m,l,d)=>({u_matrix:m,u_opacity:l,u_color:d}),Tp=(m,l,d,_,b)=>r.extend(function(E,D,P){let F=D.imageManager.getPattern(E.toString()),{width:j,height:W}=D.imageManager.getPixelSize(),ee=Math.pow(2,P.tileID.overscaledZ),fe=P.tileSize*Math.pow(2,D.transform.tileZoom)/ee,Te=fe*(P.tileID.canonical.x+P.tileID.wrap*ee),we=fe*P.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[j,W],u_pattern_size:F.displaySize,u_tile_units_to_pixels:1/Ct(P,1,D.transform.tileZoom),u_pixel_coord_upper:[Te>>16,we>>16],u_pixel_coord_lower:[65535&Te,65535&we]}}(_,d,b),{u_matrix:m,u_opacity:l}),Vv={fillExtrusion:m=>({u_matrix:new r.UniformMatrix4f(m),u_lightpos:new r.Uniform3f(m),u_lightintensity:new r.Uniform1f(m),u_lightcolor:new r.Uniform3f(m),u_vertical_gradient:new r.Uniform1f(m),u_opacity:new r.Uniform1f(m),u_edge_radius:new r.Uniform1f(m),u_ao:new r.Uniform2f(m),u_tile_id:new r.Uniform3f(m),u_zoom_transition:new r.Uniform1f(m),u_inv_rot_matrix:new r.UniformMatrix4f(m),u_merc_center:new r.Uniform2f(m),u_up_dir:new r.Uniform3f(m),u_height_lift:new r.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new r.UniformMatrix4f(m),u_lightpos:new r.Uniform3f(m),u_lightintensity:new r.Uniform1f(m),u_lightcolor:new r.Uniform3f(m),u_vertical_gradient:new r.Uniform1f(m),u_height_factor:new r.Uniform1f(m),u_edge_radius:new r.Uniform1f(m),u_ao:new r.Uniform2f(m),u_tile_id:new r.Uniform3f(m),u_zoom_transition:new r.Uniform1f(m),u_inv_rot_matrix:new r.UniformMatrix4f(m),u_merc_center:new r.Uniform2f(m),u_up_dir:new r.Uniform3f(m),u_height_lift:new r.Uniform1f(m),u_image:new r.Uniform1i(m),u_texsize:new r.Uniform2f(m),u_pixel_coord_upper:new r.Uniform2f(m),u_pixel_coord_lower:new r.Uniform2f(m),u_tile_units_to_pixels:new r.Uniform1f(m),u_opacity:new r.Uniform1f(m)}),fill:m=>({u_matrix:new r.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new r.UniformMatrix4f(m),u_image:new r.Uniform1i(m),u_texsize:new r.Uniform2f(m),u_pixel_coord_upper:new r.Uniform2f(m),u_pixel_coord_lower:new r.Uniform2f(m),u_tile_units_to_pixels:new r.Uniform1f(m)}),fillOutline:m=>({u_matrix:new r.UniformMatrix4f(m),u_world:new r.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new r.UniformMatrix4f(m),u_world:new r.Uniform2f(m),u_image:new r.Uniform1i(m),u_texsize:new r.Uniform2f(m),u_pixel_coord_upper:new r.Uniform2f(m),u_pixel_coord_lower:new r.Uniform2f(m),u_tile_units_to_pixels:new r.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new r.Uniform1f(m),u_extrude_scale:new r.UniformMatrix2f(m),u_device_pixel_ratio:new r.Uniform1f(m),u_matrix:new r.UniformMatrix4f(m),u_inv_rot_matrix:new r.UniformMatrix4f(m),u_merc_center:new r.Uniform2f(m),u_tile_id:new r.Uniform3f(m),u_zoom_transition:new r.Uniform1f(m),u_up_dir:new r.Uniform3f(m)}),collisionBox:m=>({u_matrix:new r.UniformMatrix4f(m),u_camera_to_center_distance:new r.Uniform1f(m),u_extrude_scale:new r.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new r.UniformMatrix4f(m),u_inv_matrix:new r.UniformMatrix4f(m),u_camera_to_center_distance:new r.Uniform1f(m),u_viewport_size:new r.Uniform2f(m)}),debug:m=>({u_color:new r.UniformColor(m),u_matrix:new r.UniformMatrix4f(m),u_overlay:new r.Uniform1i(m),u_overlay_scale:new r.Uniform1f(m)}),clippingMask:m=>({u_matrix:new r.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new r.Uniform1f(m),u_intensity:new r.Uniform1f(m),u_matrix:new r.UniformMatrix4f(m),u_inv_rot_matrix:new r.UniformMatrix4f(m),u_merc_center:new r.Uniform2f(m),u_tile_id:new r.Uniform3f(m),u_zoom_transition:new r.Uniform1f(m),u_up_dir:new r.Uniform3f(m)}),heatmapTexture:m=>({u_image:new r.Uniform1i(m),u_color_ramp:new r.Uniform1i(m),u_opacity:new r.Uniform1f(m)}),hillshade:m=>({u_matrix:new r.UniformMatrix4f(m),u_image:new r.Uniform1i(m),u_latrange:new r.Uniform2f(m),u_light:new r.Uniform2f(m),u_shadow:new r.UniformColor(m),u_highlight:new r.UniformColor(m),u_accent:new r.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new r.UniformMatrix4f(m),u_image:new r.Uniform1i(m),u_dimension:new r.Uniform2f(m),u_zoom:new r.Uniform1f(m),u_unpack:new r.Uniform4f(m)}),line:m=>({u_matrix:new r.UniformMatrix4f(m),u_pixels_to_tile_units:new r.UniformMatrix2f(m),u_device_pixel_ratio:new r.Uniform1f(m),u_units_to_pixels:new r.Uniform2f(m),u_dash_image:new r.Uniform1i(m),u_gradient_image:new r.Uniform1i(m),u_image_height:new r.Uniform1f(m),u_texsize:new r.Uniform2f(m),u_tile_units_to_pixels:new r.Uniform1f(m),u_alpha_discard_threshold:new r.Uniform1f(m),u_trim_offset:new r.Uniform2f(m)}),linePattern:m=>({u_matrix:new r.UniformMatrix4f(m),u_texsize:new r.Uniform2f(m),u_pixels_to_tile_units:new r.UniformMatrix2f(m),u_device_pixel_ratio:new r.Uniform1f(m),u_image:new r.Uniform1i(m),u_units_to_pixels:new r.Uniform2f(m),u_tile_units_to_pixels:new r.Uniform1f(m),u_alpha_discard_threshold:new r.Uniform1f(m)}),raster:m=>({u_matrix:new r.UniformMatrix4f(m),u_tl_parent:new r.Uniform2f(m),u_scale_parent:new r.Uniform1f(m),u_fade_t:new r.Uniform1f(m),u_opacity:new r.Uniform1f(m),u_image0:new r.Uniform1i(m),u_image1:new r.Uniform1i(m),u_brightness_low:new r.Uniform1f(m),u_brightness_high:new r.Uniform1f(m),u_saturation_factor:new r.Uniform1f(m),u_contrast_factor:new r.Uniform1f(m),u_spin_weights:new r.Uniform3f(m),u_perspective_transform:new r.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new r.Uniform1i(m),u_is_size_feature_constant:new r.Uniform1i(m),u_size_t:new r.Uniform1f(m),u_size:new r.Uniform1f(m),u_camera_to_center_distance:new r.Uniform1f(m),u_rotate_symbol:new r.Uniform1i(m),u_aspect_ratio:new r.Uniform1f(m),u_fade_change:new r.Uniform1f(m),u_matrix:new r.UniformMatrix4f(m),u_label_plane_matrix:new r.UniformMatrix4f(m),u_coord_matrix:new r.UniformMatrix4f(m),u_is_text:new r.Uniform1i(m),u_pitch_with_map:new r.Uniform1i(m),u_texsize:new r.Uniform2f(m),u_tile_id:new r.Uniform3f(m),u_zoom_transition:new r.Uniform1f(m),u_inv_rot_matrix:new r.UniformMatrix4f(m),u_merc_center:new r.Uniform2f(m),u_camera_forward:new r.Uniform3f(m),u_tile_matrix:new r.UniformMatrix4f(m),u_up_vector:new r.Uniform3f(m),u_ecef_origin:new r.Uniform3f(m),u_texture:new r.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new r.Uniform1i(m),u_is_size_feature_constant:new r.Uniform1i(m),u_size_t:new r.Uniform1f(m),u_size:new r.Uniform1f(m),u_camera_to_center_distance:new r.Uniform1f(m),u_rotate_symbol:new r.Uniform1i(m),u_aspect_ratio:new r.Uniform1f(m),u_fade_change:new r.Uniform1f(m),u_matrix:new r.UniformMatrix4f(m),u_label_plane_matrix:new r.UniformMatrix4f(m),u_coord_matrix:new r.UniformMatrix4f(m),u_is_text:new r.Uniform1i(m),u_pitch_with_map:new r.Uniform1i(m),u_texsize:new r.Uniform2f(m),u_texture:new r.Uniform1i(m),u_gamma_scale:new r.Uniform1f(m),u_device_pixel_ratio:new r.Uniform1f(m),u_tile_id:new r.Uniform3f(m),u_zoom_transition:new r.Uniform1f(m),u_inv_rot_matrix:new r.UniformMatrix4f(m),u_merc_center:new r.Uniform2f(m),u_camera_forward:new r.Uniform3f(m),u_tile_matrix:new r.UniformMatrix4f(m),u_up_vector:new r.Uniform3f(m),u_ecef_origin:new r.Uniform3f(m),u_is_halo:new r.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new r.Uniform1i(m),u_is_size_feature_constant:new r.Uniform1i(m),u_size_t:new r.Uniform1f(m),u_size:new r.Uniform1f(m),u_camera_to_center_distance:new r.Uniform1f(m),u_rotate_symbol:new r.Uniform1i(m),u_aspect_ratio:new r.Uniform1f(m),u_fade_change:new r.Uniform1f(m),u_matrix:new r.UniformMatrix4f(m),u_label_plane_matrix:new r.UniformMatrix4f(m),u_coord_matrix:new r.UniformMatrix4f(m),u_is_text:new r.Uniform1i(m),u_pitch_with_map:new r.Uniform1i(m),u_texsize:new r.Uniform2f(m),u_texsize_icon:new r.Uniform2f(m),u_texture:new r.Uniform1i(m),u_texture_icon:new r.Uniform1i(m),u_gamma_scale:new r.Uniform1f(m),u_device_pixel_ratio:new r.Uniform1f(m),u_is_halo:new r.Uniform1i(m)}),background:m=>({u_matrix:new r.UniformMatrix4f(m),u_opacity:new r.Uniform1f(m),u_color:new r.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new r.UniformMatrix4f(m),u_opacity:new r.Uniform1f(m),u_image:new r.Uniform1i(m),u_pattern_tl:new r.Uniform2f(m),u_pattern_br:new r.Uniform2f(m),u_texsize:new r.Uniform2f(m),u_pattern_size:new r.Uniform2f(m),u_pixel_coord_upper:new r.Uniform2f(m),u_pixel_coord_lower:new r.Uniform2f(m),u_tile_units_to_pixels:new r.Uniform1f(m)}),terrainRaster:rd,terrainDepth:rd,skybox:m=>({u_matrix:new r.UniformMatrix4f(m),u_sun_direction:new r.Uniform3f(m),u_cubemap:new r.Uniform1i(m),u_opacity:new r.Uniform1f(m),u_temporal_offset:new r.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new r.UniformMatrix4f(m),u_color_ramp:new r.Uniform1i(m),u_center_direction:new r.Uniform3f(m),u_radius:new r.Uniform1f(m),u_opacity:new r.Uniform1f(m),u_temporal_offset:new r.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new r.UniformMatrix3f(m),u_sun_direction:new r.Uniform3f(m),u_sun_intensity:new r.Uniform1f(m),u_color_tint_r:new r.Uniform4f(m),u_color_tint_m:new r.Uniform4f(m),u_luminance:new r.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new r.UniformMatrix4f(m),u_globe_matrix:new r.UniformMatrix4f(m),u_normalize_matrix:new r.UniformMatrix4f(m),u_merc_matrix:new r.UniformMatrix4f(m),u_zoom_transition:new r.Uniform1f(m),u_merc_center:new r.Uniform2f(m),u_image0:new r.Uniform1i(m),u_grid_matrix:new r.UniformMatrix3f(m),u_skirt_height:new r.Uniform1f(m),u_frustum_tl:new r.Uniform3f(m),u_frustum_tr:new r.Uniform3f(m),u_frustum_br:new r.Uniform3f(m),u_frustum_bl:new r.Uniform3f(m),u_globe_pos:new r.Uniform3f(m),u_globe_radius:new r.Uniform1f(m),u_viewport:new r.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new r.Uniform3f(m),u_frustum_tr:new r.Uniform3f(m),u_frustum_br:new r.Uniform3f(m),u_frustum_bl:new r.Uniform3f(m),u_horizon:new r.Uniform1f(m),u_transition:new r.Uniform1f(m),u_fadeout_range:new r.Uniform1f(m),u_color:new r.Uniform4f(m),u_high_color:new r.Uniform4f(m),u_space_color:new r.Uniform4f(m),u_star_intensity:new r.Uniform1f(m),u_star_density:new r.Uniform1f(m),u_star_size:new r.Uniform1f(m),u_temporal_offset:new r.Uniform1f(m),u_horizon_angle:new r.Uniform1f(m),u_rotation_matrix:new r.UniformMatrix4f(m)})},yl;function u_(m,l,d,_,b,E,D){let P=m.context,F=P.gl,j=m.transform,W=m.useProgram("collisionBox"),ee=[],fe=0,Te=0;for(let Ue=0;Ue<_.length;Ue++){let Ze=_[Ue],je=l.getTile(Ze),$e=je.getBucket(d);if(!$e)continue;let it=mu(Ze,$e,j),dt=it;b[0]===0&&b[1]===0||(dt=m.translatePosMatrix(it,je,b,E));let mt=D?$e.textCollisionBox:$e.iconCollisionBox,Qt=$e.collisionCircleArray;if(Qt.length>0){let lt=r.create(),Dt=dt;r.mul(lt,$e.placementInvProjMatrix,j.glCoordMatrix),r.mul(lt,lt,$e.placementViewportMatrix),ee.push({circleArray:Qt,circleOffset:Te,transform:Dt,invTransform:lt,projection:$e.getProjection()}),fe+=Qt.length/4,Te=fe}mt&&(m.terrain&&m.terrain.setupElevationDraw(je,W),W.draw(P,F.LINES,r.DepthMode.disabled,r.StencilMode.disabled,m.colorModeForRenderPass(),r.CullFaceMode.disabled,o_(dt,j,je,$e.getProjection()),d.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,null,j.zoom,null,[mt.collisionVertexBuffer,mt.collisionVertexBufferExt]))}if(!D||!ee.length)return;let we=m.useProgram("collisionCircle"),Se=new r.StructArrayLayout2f1f2i16;Se.resize(4*fe),Se._trim();let Me=0;for(let Ue of ee)for(let Ze=0;Ze<Ue.circleArray.length/4;Ze++){let je=4*Ze,$e=Ue.circleArray[je+0],it=Ue.circleArray[je+1],dt=Ue.circleArray[je+2],mt=Ue.circleArray[je+3];Se.emplace(Me++,$e,it,dt,mt,0),Se.emplace(Me++,$e,it,dt,mt,1),Se.emplace(Me++,$e,it,dt,mt,2),Se.emplace(Me++,$e,it,dt,mt,3)}(!yl||yl.length<2*fe)&&(yl=function(Ue){let Ze=2*Ue,je=new r.StructArrayLayout3ui6;je.resize(Ze),je._trim();for(let $e=0;$e<Ze;$e++){let it=6*$e;je.uint16[it+0]=4*$e+0,je.uint16[it+1]=4*$e+1,je.uint16[it+2]=4*$e+2,je.uint16[it+3]=4*$e+2,je.uint16[it+4]=4*$e+3,je.uint16[it+5]=4*$e+0}return je}(fe));let ce=P.createIndexBuffer(yl,!0),Oe=P.createVertexBuffer(Se,r.collisionCircleLayout.members,!0);for(let Ue of ee){let Ze={u_matrix:Ue.transform,u_inv_matrix:Ue.invTransform,u_camera_to_center_distance:(Pe=j).getCameraToCenterDistance(Ue.projection),u_viewport_size:[Pe.width,Pe.height]};we.draw(P,F.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,m.colorModeForRenderPass(),r.CullFaceMode.disabled,Ze,d.id,Oe,ce,r.SegmentVector.simpleSegment(0,2*Ue.circleOffset,Ue.circleArray.length,Ue.circleArray.length/2),null,j.zoom)}var Pe;Oe.destroy(),ce.destroy()}let Ep=r.create();function h_({width:m,height:l,anchor:d,textOffset:_,textScale:b},E){let{horizontalAlign:D,verticalAlign:P}=r.getAnchorAlignment(d),F=-(D-.5)*m,j=-(P-.5)*l,W=r.evaluateVariableOffset(d,_);return new r.pointGeometry((F/b+W[0])*E,(j/b+W[1])*E)}function lc(m,l,d,_,b,E,D,P,F,j,W){let ee=m.text.placedSymbolArray,fe=m.text.dynamicLayoutVertexArray,Te=m.icon.dynamicLayoutVertexArray,we={},Se=m.getProjection(),Me=pl(P,Se,E),ce=E.elevation,Oe=Se.upVectorScale(P.canonical,E.center.lat,E.worldSize).metersToTile;fe.clear();for(let Pe=0;Pe<ee.length;Pe++){let Ue=ee.get(Pe),{tileAnchorX:Ze,tileAnchorY:je,numGlyphs:$e}=Ue,it=m.allowVerticalPlacement&&!Ue.placedOrientation,dt=Ue.hidden||!Ue.crossTileID||it?null:_[Ue.crossTileID];if(dt){let mt=0,Qt=0,lt=0;if(ce){let zn=ce?ce.getAtTileOffset(P,Ze,je):0,[oi,Mn,vn]=Se.upVector(P.canonical,Ze,je);mt=zn*oi*Oe,Qt=zn*Mn*Oe,lt=zn*vn*Oe}let[Dt,bt,Ut,ft]=an(Ue.projectedAnchorX+mt,Ue.projectedAnchorY+Qt,Ue.projectedAnchorZ+lt,d?Me:D),tt=di(E.getCameraToCenterDistance(Se),ft),yt=b.evaluateSizeForFeature(m.textSizeData,j,Ue)*tt/r.ONE_EM;d&&(yt*=m.tilePixelRatio/F);let Nt=h_(dt,yt);d?({x:Dt,y:bt,z:Ut}=Se.projectTilePoint(Ze+Nt.x,je+Nt.y,P.canonical),[Dt,bt,Ut]=an(Dt+mt,bt+Qt,Ut+lt,D)):(l&&Nt._rotate(-E.angle),Dt+=Nt.x,bt+=Nt.y,Ut=0);let jt=m.allowVerticalPlacement&&Ue.placedOrientation===r.WritingMode.vertical?Math.PI/2:0;for(let zn=0;zn<$e;zn++)r.addDynamicAttributes(fe,Dt,bt,Ut,jt);W&&Ue.associatedIconIndex>=0&&(we[Ue.associatedIconIndex]={x:Dt,y:bt,z:Ut,angle:jt})}else fi($e,fe)}if(W){Te.clear();let Pe=m.icon.placedSymbolArray;for(let Ue=0;Ue<Pe.length;Ue++){let Ze=Pe.get(Ue),{numGlyphs:je}=Ze,$e=we[Ue];if(Ze.hidden||!$e)fi(je,Te);else{let{x:it,y:dt,z:mt,angle:Qt}=$e;for(let lt=0;lt<je;lt++)r.addDynamicAttributes(Te,it,dt,mt,Qt)}}m.icon.dynamicLayoutVertexBuffer.updateData(Te)}m.text.dynamicLayoutVertexBuffer.updateData(fe)}function Gv(m,l,d){return d.iconsInText&&l?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function d_(m,l,d,_,b,E,D,P,F,j,W,ee){let fe=m.context,Te=fe.gl,we=m.transform,Se=P==="map",Me=F==="map",ce=Se&&d.layout.get("symbol-placement")!=="point",Oe=Se&&!Me&&!ce,Pe=d.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ue=!1,Ze=m.depthModeForSublayer(0,r.DepthMode.ReadOnly),je=[r.mercatorXfromLng(we.center.lng),r.mercatorYfromLat(we.center.lat)],$e=d.layout.get("text-variable-anchor"),it=we.projection.name==="globe",dt=[],mt=[0,-1,0],Qt=mt;!it&&!we.mercatorFromTransition||Se||(Qt=function(lt){let Dt=lt._camera.getWorldToCamera(lt.worldSize,1),bt=r.multiply([],Dt,lt.globeMatrix);r.invert(bt,bt);let Ut=[0,0,0],ft=[0,1,0,0];return r.transformMat4$1(ft,ft,bt),Ut[0]=ft[0],Ut[1]=ft[1],Ut[2]=ft[2],r.normalize(Ut,Ut),Ut}(we));for(let lt of _){let Dt=l.getTile(lt),bt=Dt.getBucket(d);if(!bt||bt.projection.name==="mercator"&&it)continue;let Ut=b?bt.text:bt.icon;if(!Ut||bt.fullyClipped||!Ut.segments.get().length)continue;let ft=Ut.programConfigurations.get(d.id),tt=b||bt.sdfIcons,yt=b?bt.textSizeData:bt.iconSizeData,Nt=Me||we.pitch!==0,jt=r.evaluateSizeForZoom(yt,we.zoom),zn,oi,Mn,vn,Fn=[0,0],vi=null;if(b){if(oi=Dt.glyphAtlasTexture,Mn=Te.LINEAR,zn=Dt.glyphAtlasTexture.size,bt.iconsInText){Fn=Dt.imageAtlasTexture.size,vi=Dt.imageAtlasTexture;let Xs=yt.kind==="composite"||yt.kind==="camera";vn=Nt||m.options.rotating||m.options.zooming||Xs?Te.LINEAR:Te.NEAREST}}else{let Xs=d.layout.get("icon-size").constantOr(0)!==1||bt.iconsNeedLinear;oi=Dt.imageAtlasTexture,Mn=tt||m.options.rotating||m.options.zooming||Xs||Nt?Te.LINEAR:Te.NEAREST,zn=Dt.imageAtlasTexture.size}let Bn=bt.projection.name==="globe",Fi=Bn?Qt:mt,Wi=Bn?r.globeToMercatorTransition(we.zoom):0,tr=pl(lt,bt.getProjection(),we),Yi=we.calculatePixelsToTileUnitsMatrix(Dt),Pr=Po(tr,Dt.tileID.canonical,Me,Se,we,bt.getProjection(),Yi),Ns=m.terrain&&Me&&ce?r.invert(r.create(),Pr):Ep,Ao=La(tr,Dt.tileID.canonical,Me,Se,we,bt.getProjection(),Yi),ca=$e&&bt.hasTextData(),ur=d.layout.get("icon-text-fit")!=="none"&&ca&&bt.hasIconData();if(ce){let Xs=we.elevation,ao=Xs?Xs.getAtTileOffsetFunc(lt,we.center.lat,we.worldSize,bt.getProjection()):null,ua=ko(tr,Dt.tileID.canonical,Me,Se,we,bt.getProjection(),Yi);qe(bt,tr,m,b,ua,Ao,Me,j,ao,lt)}let Ji=ce||b&&$e||ur,Ri=m.translatePosMatrix(tr,Dt,E,D),wr=Ji?Ep:Pr,fs=m.translatePosMatrix(Ao,Dt,E,D,!0),or=bt.getProjection().createInversionMatrix(we,lt.canonical),ps=[];m.terrainRenderModeElevated()&&Me&&ps.push("PITCH_WITH_MAP_TERRAIN"),Bn&&ps.push("PROJECTION_GLOBE_VIEW"),Ji&&ps.push("PROJECTED_POS_ON_VIEWPORT");let ms=tt&&d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Na;Na=tt?bt.iconsInText?wp(yt.kind,jt,Oe,Me,m,Ri,wr,fs,zn,Fn,lt,Wi,je,or,Fi,bt.getProjection()):c_(yt.kind,jt,Oe,Me,m,Ri,wr,fs,b,zn,!0,lt,Wi,je,or,Fi,bt.getProjection()):Iu(yt.kind,jt,Oe,Me,m,Ri,wr,fs,b,zn,lt,Wi,je,or,Fi,bt.getProjection());let vc={program:m.useProgram(Gv(tt,b,bt),ft,ps),buffers:Ut,uniformValues:Na,atlasTexture:oi,atlasTextureIcon:vi,atlasInterpolation:Mn,atlasInterpolationIcon:vn,isSDF:tt,hasHalo:ms,tile:Dt,labelPlaneMatrixInv:Ns};if(Pe&&bt.canOverlap){Ue=!0;let Xs=Ut.segments.get();for(let ao of Xs)dt.push({segments:new r.SegmentVector([ao]),sortKey:ao.sortKey,state:vc})}else dt.push({segments:Ut.segments,sortKey:0,state:vc})}Ue&&dt.sort((lt,Dt)=>lt.sortKey-Dt.sortKey);for(let lt of dt){let Dt=lt.state;if(m.terrain&&m.terrain.setupElevationDraw(Dt.tile,Dt.program,{useDepthForOcclusion:!it,labelPlaneMatrixInv:Dt.labelPlaneMatrixInv}),fe.activeTexture.set(Te.TEXTURE0),Dt.atlasTexture.bind(Dt.atlasInterpolation,Te.CLAMP_TO_EDGE),Dt.atlasTextureIcon&&(fe.activeTexture.set(Te.TEXTURE1),Dt.atlasTextureIcon&&Dt.atlasTextureIcon.bind(Dt.atlasInterpolationIcon,Te.CLAMP_TO_EDGE)),Dt.isSDF){let bt=Dt.uniformValues;Dt.hasHalo&&(bt.u_is_halo=1,f_(Dt.buffers,lt.segments,d,m,Dt.program,Ze,W,ee,bt)),bt.u_is_halo=0}f_(Dt.buffers,lt.segments,d,m,Dt.program,Ze,W,ee,Dt.uniformValues)}}function f_(m,l,d,_,b,E,D,P,F){let j=_.context,W=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];b.draw(j,j.gl.TRIANGLES,E,D,P,r.CullFaceMode.disabled,F,d.id,m.layoutVertexBuffer,m.indexBuffer,l,d.paint,_.transform.zoom,m.programConfigurations.get(d.id),W)}function p_(m,l,d,_,b,E,D){let P=m.context.gl,F=d.paint.get("fill-pattern"),j=F&&F.constantOr(1),W,ee,fe,Te,we;D?(ee=j&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=P.LINES):(ee=j?"fillPattern":"fill",W=P.TRIANGLES);for(let Se of _){let Me=l.getTile(Se);if(j&&!Me.patternsLoaded())continue;let ce=Me.getBucket(d);if(!ce)continue;m.prepareDrawTile();let Oe=ce.programConfigurations.get(d.id),Pe=m.useProgram(ee,Oe);j&&(m.context.activeTexture.set(P.TEXTURE0),Me.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Oe.updatePaintBuffers());let Ue=F.constantOr(null);if(Ue&&Me.imageAtlas){let je=Me.imageAtlas.patternPositions[Ue.toString()];je&&Oe.setConstantPatternPositions(je)}let Ze=m.translatePosMatrix(Se.projMatrix,Me,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(D){Te=ce.indexBuffer2,we=ce.segments2;let je=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];fe=ee==="fillOutlinePattern"&&j?s_(Ze,m,Me,je):r_(Ze,je)}else Te=ce.indexBuffer,we=ce.segments,fe=j?cd(Ze,m,Me):ld(Ze);m.prepareDrawProgram(m.context,Pe,Se.toUnwrapped()),Pe.draw(m.context,W,b,m.stencilModeForClipping(Se),E,r.CullFaceMode.disabled,fe,d.id,ce.layoutVertexBuffer,Te,we,d.paint,m.transform.zoom,Oe)}}function Sp(m,l,d,_,b,E,D){let P=m.context,F=P.gl,j=m.transform,W=d.paint.get("fill-extrusion-pattern"),ee=W.constantOr(1),fe=d.paint.get("fill-extrusion-opacity"),Te=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),d.paint.get("fill-extrusion-ambient-occlusion-radius")],we=d.layout.get("fill-extrusion-edge-radius"),Se=j.projection.name==="globe"?r.fillExtrusionHeightLift():0,Me=j.projection.name==="globe",ce=Me?r.globeToMercatorTransition(j.zoom):0,Oe=[r.mercatorXfromLng(j.center.lng),r.mercatorYfromLat(j.center.lat)],Pe=[];Me&&Pe.push("PROJECTION_GLOBE_VIEW"),Te[0]>0&&Pe.push("FAUX_AO");for(let Ue of _){let Ze=l.getTile(Ue),je=Ze.getBucket(d);if(!je||je.projection.name!==j.projection.name)continue;let $e=je.programConfigurations.get(d.id),it=m.useProgram(ee?"fillExtrusionPattern":"fillExtrusion",$e,Pe);if(m.terrain){let Ut=m.terrain;if(m.style.terrainSetForDrapingOnly())Ut.setupElevationDraw(Ze,it,{useMeterToDem:!0});else{if(!je.enableTerrain)continue;if(Ut.setupElevationDraw(Ze,it,{useMeterToDem:!0}),Hv(P,l,Ue,je,d,Ut),!je.centroidVertexBuffer){let ft=it.attributes.a_centroid_pos;ft!==void 0&&F.vertexAttrib2f(ft,0,0)}}}ee&&(m.context.activeTexture.set(F.TEXTURE0),Ze.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),$e.updatePaintBuffers());let dt=W.constantOr(null);if(dt&&Ze.imageAtlas){let Ut=Ze.imageAtlas.patternPositions[dt.toString()];Ut&&$e.setConstantPatternPositions(Ut)}let mt=m.translatePosMatrix(Ue.projMatrix,Ze,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Qt=j.projection.createInversionMatrix(j,Ue.canonical),lt=d.paint.get("fill-extrusion-vertical-gradient"),Dt=ee?_p(mt,m,lt,fe,Te,we,Ue,Ze,Se,ce,Oe,Qt):ad(mt,m,lt,fe,Te,we,Ue,Se,ce,Oe,Qt);m.prepareDrawProgram(P,it,Ue.toUnwrapped());let bt=[];m.terrain&&bt.push(je.centroidVertexBuffer),Me&&bt.push(je.layoutVertexExtBuffer),it.draw(P,P.gl.TRIANGLES,b,E,D,r.CullFaceMode.backCCW,Dt,d.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,d.paint,m.transform.zoom,$e,bt)}}function Hv(m,l,d,_,b,E){let D=[ce=>{let Oe=ce.canonical.x-1,Pe=ce.wrap;return Oe<0&&(Oe=(1<<ce.canonical.z)-1,Pe--),new r.OverscaledTileID(ce.overscaledZ,Pe,ce.canonical.z,Oe,ce.canonical.y)},ce=>{let Oe=ce.canonical.x+1,Pe=ce.wrap;return Oe===1<<ce.canonical.z&&(Oe=0,Pe++),new r.OverscaledTileID(ce.overscaledZ,Pe,ce.canonical.z,Oe,ce.canonical.y)},ce=>new r.OverscaledTileID(ce.overscaledZ,ce.wrap,ce.canonical.z,ce.canonical.x,(ce.canonical.y===0?1<<ce.canonical.z:ce.canonical.y)-1),ce=>new r.OverscaledTileID(ce.overscaledZ,ce.wrap,ce.canonical.z,ce.canonical.x,ce.canonical.y===(1<<ce.canonical.z)-1?0:ce.canonical.y+1)],P=ce=>{let Oe=l.getSource().minzoom,Pe=Ze=>{let je=l.getTileByID(Ze);if(je&&je.hasData())return je.getBucket(b)},Ue=[0,-1,1];for(let Ze of Ue){if(ce.overscaledZ+Ze<Oe)continue;let je=Pe(ce.calculateScaledKey(ce.overscaledZ+Ze));if(je)return je}},F=[0,0,0],j=(ce,Oe)=>(F[0]=Math.min(ce.min.y,Oe.min.y),F[1]=Math.max(ce.max.y,Oe.max.y),F[2]=r.EXTENT-Oe.min.x>ce.max.x?Oe.min.x-r.EXTENT:ce.max.x,F),W=(ce,Oe)=>(F[0]=Math.min(ce.min.x,Oe.min.x),F[1]=Math.max(ce.max.x,Oe.max.x),F[2]=r.EXTENT-Oe.min.y>ce.max.y?Oe.min.y-r.EXTENT:ce.max.y,F),ee=[(ce,Oe)=>j(ce,Oe),(ce,Oe)=>j(Oe,ce),(ce,Oe)=>W(ce,Oe),(ce,Oe)=>W(Oe,ce)],fe=new r.pointGeometry(0,0),Te,we,Se,Me=(ce,Oe,Pe,Ue,Ze)=>{let je=[[Ue?Pe:ce,Ue?ce:Pe,0],[Ue?Pe:Oe,Ue?Oe:Pe,0]],$e=Ze<0?r.EXTENT+Ze:Ze,it=[Ue?$e:(ce+Oe)/2,Ue?(ce+Oe)/2:$e,0];return Pe===0&&Ze<0||Pe!==0&&Ze>0?E.getForTilePoints(Se,[it],!0,we):je.push(it),E.getForTilePoints(d,je,!0,Te),Math.max(je[0][2],je[1][2],it[2])/E.exaggeration()};for(let ce=0;ce<4;ce++){let Oe=(ce<2?1:5)-ce,Pe=_.borders[ce];if(Pe.length===0)continue;let Ue=Se=D[ce](d),Ze=P(Ue);if(!(Ze&&Ze instanceof r.FillExtrusionBucket&&Ze.enableTerrain)||_.borderDoneWithNeighborZ[ce]===Ze.canonical.z&&Ze.borderDoneWithNeighborZ[Oe]===_.canonical.z||(we=E.findDEMTileFor(Ue),!we||!we.dem))continue;if(!Te){let dt=E.findDEMTileFor(d);if(!dt||!dt.dem)return;Te=dt}let je=Ze.borders[Oe],$e=0,it=Ze.borderDoneWithNeighborZ[Oe]!==_.canonical.z;if(_.canonical.z===Ze.canonical.z){for(let dt=0;dt<Pe.length;dt++){let mt=_.featuresOnBorder[Pe[dt]],Qt=mt.borders[ce],lt;for(;$e<je.length&&(lt=Ze.featuresOnBorder[je[$e]],!(lt.borders[Oe][1]>Qt[0]+3));)it&&Ze.encodeCentroid(void 0,lt,!1),$e++;if(lt&&$e<je.length){let Dt=$e,bt=0;for(;!(lt.borders[Oe][0]>Qt[1]-3)&&(bt++,++$e!==je.length);)lt=Ze.featuresOnBorder[je[$e]];if(lt=Ze.featuresOnBorder[je[Dt]],mt.intersectsCount()>1||lt.intersectsCount()>1||bt!==1){bt!==1&&($e=Dt),_.encodeCentroid(void 0,mt,!1),it&&Ze.encodeCentroid(void 0,lt,!1);continue}let Ut=ee[ce](mt,lt),ft=ce%2?r.EXTENT-1:0;fe.x=Me(Ut[0],Math.min(r.EXTENT-1,Ut[1]),ft,ce<2,Ut[2]),fe.y=0,_.encodeCentroid(fe,mt,!1),it&&Ze.encodeCentroid(fe,lt,!1)}else _.encodeCentroid(void 0,mt,!1)}_.borderDoneWithNeighborZ[ce]=Ze.canonical.z,_.needsCentroidUpdate=!0,it&&(Ze.borderDoneWithNeighborZ[Oe]=_.canonical.z,Ze.needsCentroidUpdate=!0)}else{for(let dt of Pe)_.encodeCentroid(void 0,_.featuresOnBorder[dt],!1);if(it){for(let dt of je)Ze.encodeCentroid(void 0,Ze.featuresOnBorder[dt],!1);Ze.borderDoneWithNeighborZ[Oe]=_.canonical.z,Ze.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[ce]=Ze.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(m)}let Ap=new r.Color(1,0,0,1),Mp=new r.Color(0,1,0,1),m_=new r.Color(0,0,1,1),g_=new r.Color(1,0,1,1),__=new r.Color(0,1,1,1);function Ip(m,l,d){let _=m.context,b=m.transform,E=_.gl,D=b.projection.name==="globe",P=D?["PROJECTION_GLOBE_VIEW"]:null,F=d.projMatrix;if(D&&r.globeToMercatorTransition(b.zoom)>0){let mt=r.transitionTileAABBinECEF(d.canonical,b),Qt=r.globeDenormalizeECEF(mt);F=r.multiply(new Float32Array(16),b.globeMatrix,Qt),r.multiply(F,b.projMatrix,F)}let j=m.useProgram("debug",null,P),W=l.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(W,j);let ee=r.DepthMode.disabled,fe=r.StencilMode.disabled,Te=m.colorModeForRenderPass(),we="$debug";_.activeTexture.set(E.TEXTURE0),m.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),D?W._makeGlobeTileDebugBuffers(m.context,b):W._makeDebugTileBoundsBuffers(m.context,b.projection);let Se=W._tileDebugBuffer||m.debugBuffer,Me=W._tileDebugIndexBuffer||m.debugIndexBuffer,ce=W._tileDebugSegments||m.debugSegments;j.draw(_,E.LINE_STRIP,ee,fe,Te,r.CullFaceMode.disabled,Mu(F,r.Color.red),we,Se,Me,ce,null,null,null,[W._globeTileDebugBorderBuffer]);let Oe=W.latestRawTileData,Pe=Math.floor((Oe&&Oe.byteLength||0)/1024),Ue=l.getTile(d).tileSize,Ze=512/Math.min(Ue,512)*(d.overscaledZ/b.zoom)*.5,je=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(je+=` => ${d.overscaledZ}`),je+=` ${Pe}kb`,function(mt,Qt){mt.initDebugOverlayCanvas();let lt=mt.debugOverlayCanvas,Dt=mt.context.gl,bt=mt.debugOverlayCanvas.getContext("2d");bt.clearRect(0,0,lt.width,lt.height),bt.shadowColor="white",bt.shadowBlur=2,bt.lineWidth=1.5,bt.strokeStyle="white",bt.textBaseline="top",bt.font="bold 36px Open Sans, sans-serif",bt.fillText(Qt,5,5),bt.strokeText(Qt,5,5),mt.debugOverlayTexture.update(lt),mt.debugOverlayTexture.bind(Dt.LINEAR,Dt.CLAMP_TO_EDGE)}(m,je);let $e=W._tileDebugTextBuffer||m.debugBuffer,it=W._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,dt=W._tileDebugTextSegments||m.debugSegments;j.draw(_,E.TRIANGLES,ee,fe,r.ColorMode.alphaBlended,r.CullFaceMode.disabled,Mu(F,r.Color.transparent,Ze),we,$e,it,dt,null,null,null,[W._globeTileDebugTextBuffer])}function Oa(m,l,d,_){Cu(m,0,l+d/2,m.transform.width,d,_)}function cc(m,l,d,_){Cu(m,l-d/2,0,d,m.transform.height,_)}function Cu(m,l,d,_,b,E){let D=m.context,P=D.gl;P.enable(P.SCISSOR_TEST),P.scissor(l*r.exported.devicePixelRatio,d*r.exported.devicePixelRatio,_*r.exported.devicePixelRatio,b*r.exported.devicePixelRatio),D.clear({color:E}),P.disable(P.SCISSOR_TEST)}let uc=r.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:hc}=uc;function aa(m,l,d,_){m.emplaceBack(l,d,_)}class dd{constructor(l){this.vertexArray=new r.StructArrayLayout3f12,this.indices=new r.StructArrayLayout3ui6,aa(this.vertexArray,-1,-1,1),aa(this.vertexArray,1,-1,1),aa(this.vertexArray,-1,1,1),aa(this.vertexArray,1,1,1),aa(this.vertexArray,-1,-1,-1),aa(this.vertexArray,1,-1,-1),aa(this.vertexArray,-1,1,-1),aa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,hc),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=r.SegmentVector.simpleSegment(0,0,36,12)}}function Ci(m,l,d,_,b,E){let D=m.gl,P=l.paint.get("sky-atmosphere-color"),F=l.paint.get("sky-atmosphere-halo-color"),j=l.paint.get("sky-atmosphere-sun-intensity"),W=((ee,fe,Te,we,Se)=>({u_matrix_3f:ee,u_sun_direction:fe,u_sun_intensity:Te,u_color_tint_r:[we.r,we.g,we.b,we.a],u_color_tint_m:[Se.r,Se.g,Se.b,Se.a],u_luminance:5e-5}))(r.fromMat4(r.create$1(),_),b,j,P,F);D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+E,l.skyboxTexture,0),d.draw(m,D.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.frontCW,W,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}let fd=r.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class jv{constructor(l){let d=new r.StructArrayLayout5f20;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);let _=new r.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(d,fd.members),this.indexBuffer=l.createIndexBuffer(_),this.segments=r.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Cp={symbol:function(m,l,d,_,b){if(m.renderPass!=="translucent")return;let E=r.StencilMode.disabled,D=m.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(P,F,j,W,ee,fe,Te){let we=F.transform,Se=ee==="map",Me=fe==="map";for(let ce of P){let Oe=W.getTile(ce),Pe=Oe.getBucket(j);if(!Pe||!Pe.text||!Pe.text.segments.get().length)continue;let Ue=r.evaluateSizeForZoom(Pe.textSizeData,we.zoom),Ze=pl(ce,Pe.getProjection(),we),je=we.calculatePixelsToTileUnitsMatrix(Oe),$e=Po(Ze,Oe.tileID.canonical,Me,Se,we,Pe.getProjection(),je),it=j.layout.get("icon-text-fit")!=="none"&&Pe.hasIconData();if(Ue){let dt=Math.pow(2,we.zoom-Oe.tileID.overscaledZ);lc(Pe,Se,Me,Te,r.symbolSize,we,$e,ce,dt,Ue,it)}}}(_,m,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),d.paint.get("icon-opacity").constantOr(1)!==0&&d_(m,l,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),E,D),d.paint.get("text-opacity").constantOr(1)!==0&&d_(m,l,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),E,D),l.map.showCollisionBoxes&&(u_(m,l,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),u_(m,l,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,l,d,_){if(m.renderPass!=="translucent")return;let b=d.paint.get("circle-opacity"),E=d.paint.get("circle-stroke-width"),D=d.paint.get("circle-stroke-opacity"),P=d.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)===0&&(E.constantOr(1)===0||D.constantOr(1)===0))return;let F=m.context,j=F.gl,W=m.transform,ee=m.depthModeForSublayer(0,r.DepthMode.ReadOnly),fe=r.StencilMode.disabled,Te=m.colorModeForRenderPass(),we=W.projection.name==="globe",Se=[r.mercatorXfromLng(W.center.lng),r.mercatorYfromLat(W.center.lat)],Me=[];for(let Oe=0;Oe<_.length;Oe++){let Pe=_[Oe],Ue=l.getTile(Pe),Ze=Ue.getBucket(d);if(!Ze||Ze.projection.name!==W.projection.name)continue;let je=Ze.programConfigurations.get(d.id),$e=Au(d);we&&$e.push("PROJECTION_GLOBE_VIEW");let it=m.useProgram("circle",je,$e),dt=Ze.layoutVertexBuffer,mt=Ze.globeExtVertexBuffer,Qt=Ze.indexBuffer,lt=W.projection.createInversionMatrix(W,Pe.canonical),Dt={programConfiguration:je,program:it,layoutVertexBuffer:dt,globeExtVertexBuffer:mt,indexBuffer:Qt,uniformValues:Su(m,Pe,Ue,lt,Se,d),tile:Ue};if(P){let bt=Ze.segments.get();for(let Ut of bt)Me.push({segments:new r.SegmentVector([Ut]),sortKey:Ut.sortKey,state:Dt})}else Me.push({segments:Ze.segments,sortKey:0,state:Dt})}P&&Me.sort((Oe,Pe)=>Oe.sortKey-Pe.sortKey);let ce={useDepthForOcclusion:!we};for(let Oe of Me){let{programConfiguration:Pe,program:Ue,layoutVertexBuffer:Ze,globeExtVertexBuffer:je,indexBuffer:$e,uniformValues:it,tile:dt}=Oe.state,mt=Oe.segments;m.terrain&&m.terrain.setupElevationDraw(dt,Ue,ce),m.prepareDrawProgram(F,Ue,dt.tileID.toUnwrapped()),Ue.draw(F,j.TRIANGLES,ee,fe,Te,r.CullFaceMode.disabled,it,d.id,Ze,$e,mt,d.paint,W.zoom,Pe,[je])}},heatmap:function(m,l,d,_){if(d.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){let b=m.context,E=b.gl,D=r.StencilMode.disabled,P=new r.ColorMode([E.ONE,E.ONE],r.Color.transparent,[!0,!0,!0,!0]);(function(Te,we,Se,Me){let ce=Te.gl,Oe=we.width*Me,Pe=we.height*Me;Te.activeTexture.set(ce.TEXTURE1),Te.viewport.set([0,0,Oe,Pe]);let Ue=Se.heatmapFbo;if(!Ue||Ue&&(Ue.width!==Oe||Ue.height!==Pe)){Ue&&Ue.destroy();let Ze=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,Ze),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),Ue=Se.heatmapFbo=Te.createFramebuffer(Oe,Pe,!1),function(je,$e,it,dt,mt,Qt){let lt=je.gl;lt.texImage2D(lt.TEXTURE_2D,0,je.isWebGL2&&je.extRenderToTextureHalfFloat?lt.RGBA16F:lt.RGBA,mt,Qt,0,lt.RGBA,je.extRenderToTextureHalfFloat?je.isWebGL2?lt.HALF_FLOAT:je.extTextureHalfFloat.HALF_FLOAT_OES:lt.UNSIGNED_BYTE,null),dt.colorAttachment.set(it)}(Te,0,Ze,Ue,Oe,Pe)}else ce.bindTexture(ce.TEXTURE_2D,Ue.colorAttachment.get()),Te.bindFramebuffer.set(Ue.framebuffer)})(b,m,d,m.transform.projection.name==="globe"?.5:.25),b.clear({color:r.Color.transparent});let F=m.transform,j=F.projection.name==="globe",W=j?["PROJECTION_GLOBE_VIEW"]:null,ee=j?r.CullFaceMode.frontCCW:r.CullFaceMode.disabled,fe=[r.mercatorXfromLng(F.center.lng),r.mercatorYfromLat(F.center.lat)];for(let Te=0;Te<_.length;Te++){let we=_[Te];if(l.hasRenderableParent(we))continue;let Se=l.getTile(we),Me=Se.getBucket(d);if(!Me||Me.projection.name!==F.projection.name)continue;let ce=Me.programConfigurations.get(d.id),Oe=m.useProgram("heatmap",ce,W),{zoom:Pe}=m.transform;m.terrain&&m.terrain.setupElevationDraw(Se,Oe),m.prepareDrawProgram(b,Oe,we.toUnwrapped());let Ue=F.projection.createInversionMatrix(F,we.canonical);Oe.draw(b,E.TRIANGLES,r.DepthMode.disabled,D,P,ee,No(m,we,Se,Ue,fe,Pe,d.paint.get("heatmap-intensity")),d.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,d.paint,m.transform.zoom,ce,j?[Me.globeExtVertexBuffer]:null)}b.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(b,E){let D=b.context,P=D.gl,F=E.heatmapFbo;if(!F)return;D.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,F.colorAttachment.get()),D.activeTexture.set(P.TEXTURE1);let j=E.colorRampTexture;j||(j=E.colorRampTexture=new r.Texture(D,E.colorRamp,P.RGBA)),j.bind(P.LINEAR,P.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(D,P.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,b.colorModeForRenderPass(),r.CullFaceMode.disabled,((W,ee,fe,Te)=>({u_image:0,u_color_ramp:1,u_opacity:ee.paint.get("heatmap-opacity")}))(0,E),E.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,E.paint,b.transform.zoom)}(m,d))},line:function(m,l,d,_){if(m.renderPass!=="translucent")return;let b=d.paint.get("line-opacity"),E=d.paint.get("line-width");if(b.constantOr(1)===0||E.constantOr(1)===0)return;let D=m.depthModeForSublayer(0,r.DepthMode.ReadOnly),P=m.colorModeForRenderPass(),F=m.terrain&&m.terrain.renderingToTexture?1:r.exported.devicePixelRatio,j=d.paint.get("line-dasharray"),W=j.constantOr(1),ee=d.layout.get("line-cap"),fe=d.paint.get("line-pattern"),Te=fe.constantOr(1),we=d.paint.get("line-gradient"),Se=Te?"linePattern":"line",Me=m.context,ce=Me.gl,Oe=(Ue=>{let Ze=[];hd(Ue)&&Ze.push("RENDER_LINE_DASH"),Ue.paint.get("line-gradient")&&Ze.push("RENDER_LINE_GRADIENT");let je=Ue.paint.get("line-trim-offset");je[0]===0&&je[1]===0||Ze.push("RENDER_LINE_TRIM_OFFSET");let $e=Ue.paint.get("line-pattern").constantOr(1),it=Ue.paint.get("line-opacity").constantOr(1)!==1;return!$e&&it&&Ze.push("RENDER_LINE_ALPHA_DISCARD"),Ze})(d),Pe=Oe.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Pe=!1);for(let Ue of _){let Ze=l.getTile(Ue);if(Te&&!Ze.patternsLoaded())continue;let je=Ze.getBucket(d);if(!je)continue;m.prepareDrawTile();let $e=je.programConfigurations.get(d.id),it=m.useProgram(Se,$e,Oe),dt=fe.constantOr(null);if(dt&&Ze.imageAtlas){let tt=Ze.imageAtlas.patternPositions[dt.toString()];tt&&$e.setConstantPatternPositions(tt)}let mt=j.constantOr(null),Qt=ee.constantOr(null);if(!Te&&mt&&Qt&&Ze.lineAtlas){let tt=Ze.lineAtlas.getDash(mt,Qt);tt&&$e.setConstantPatternPositions(tt)}let[lt,Dt]=d.paint.get("line-trim-offset");if(Qt==="round"||Qt==="square"){let tt=1;lt!==Dt&&(lt===0&&(lt-=tt),Dt===1&&(Dt+=tt))}let bt=m.terrain?Ue.projMatrix:null,Ut=Te?a_(m,Ze,d,bt,F):vp(m,Ze,d,bt,je.lineClipsArray.length,F,[lt,Dt]);if(we){let tt=je.gradients[d.id],yt=tt.texture;if(d.gradientVersion!==tt.version){let Nt=256;if(d.stepInterpolant){let jt=l.getSource().maxzoom,zn=Ue.canonical.z===jt?Math.ceil(1<<m.transform.maxZoom-Ue.canonical.z):1;Nt=r.clamp(r.nextPowerOfTwo(je.maxLineLength/r.EXTENT*1024*zn),256,Me.maxTextureSize)}tt.gradient=r.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Nt,image:tt.gradient||void 0,clips:je.lineClipsArray}),tt.texture?tt.texture.update(tt.gradient):tt.texture=new r.Texture(Me,tt.gradient,ce.RGBA),tt.version=d.gradientVersion,yt=tt.texture}Me.activeTexture.set(ce.TEXTURE1),yt.bind(d.stepInterpolant?ce.NEAREST:ce.LINEAR,ce.CLAMP_TO_EDGE)}W&&(Me.activeTexture.set(ce.TEXTURE0),Ze.lineAtlasTexture.bind(ce.LINEAR,ce.REPEAT),$e.updatePaintBuffers()),Te&&(Me.activeTexture.set(ce.TEXTURE0),Ze.imageAtlasTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),$e.updatePaintBuffers()),m.prepareDrawProgram(Me,it,Ue.toUnwrapped());let ft=tt=>{it.draw(Me,ce.TRIANGLES,D,tt,P,r.CullFaceMode.disabled,Ut,d.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,d.paint,m.transform.zoom,$e,[je.layoutVertexBuffer2])};if(Pe){let tt=m.stencilModeForClipping(Ue).ref;tt===0&&m.terrain&&Me.clear({stencil:0});let yt={func:ce.EQUAL,mask:255};Ut.u_alpha_discard_threshold=.8,ft(new r.StencilMode(yt,tt,255,ce.KEEP,ce.KEEP,ce.INVERT)),Ut.u_alpha_discard_threshold=0,ft(new r.StencilMode(yt,tt,255,ce.KEEP,ce.KEEP,ce.KEEP))}else ft(m.stencilModeForClipping(Ue))}Pe&&(m.resetStencilClippingMasks(),m.terrain&&Me.clear({stencil:0}))},fill:function(m,l,d,_){let b=d.paint.get("fill-color"),E=d.paint.get("fill-opacity");if(E.constantOr(1)===0)return;let D=m.colorModeForRenderPass(),P=d.paint.get("fill-pattern"),F=m.opaquePassEnabledForLayer()&&!P.constantOr(1)&&b.constantOr(r.Color.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===F){let j=m.depthModeForSublayer(1,m.renderPass==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly);p_(m,l,d,_,j,D,!1)}if(m.renderPass==="translucent"&&d.paint.get("fill-antialias")){let j=m.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,r.DepthMode.ReadOnly);p_(m,l,d,_,j,D,!0)}},"fill-extrusion":function(m,l,d,_){let b=d.paint.get("fill-extrusion-opacity");if(b!==0&&m.renderPass==="translucent"){let E=new r.DepthMode(m.context.gl.LEQUAL,r.DepthMode.ReadWrite,m.depthRangeFor3D);if(b!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))Sp(m,l,d,_,E,r.StencilMode.disabled,r.ColorMode.disabled),Sp(m,l,d,_,E,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{let D=m.colorModeForRenderPass();Sp(m,l,d,_,E,r.StencilMode.disabled,D)}}},hillshade:function(m,l,d,_){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;let b=m.context,E=m.depthModeForSublayer(0,r.DepthMode.ReadOnly),D=m.colorModeForRenderPass(),P=m.terrain&&m.terrain.renderingToTexture,[F,j]=m.renderPass!=="translucent"||P?[{},_]:m.stencilConfigForOverlap(_);for(let W of j){let ee=l.getTile(W);if(ee.needsHillshadePrepare&&m.renderPass==="offscreen")id(m,ee,d,E,r.StencilMode.disabled,D);else if(m.renderPass==="translucent"){let fe=P&&m.terrain?m.terrain.stencilModeForRTTOverlap(W):F[W.overscaledZ];wu(m,W,ee,d,E,fe,D)}}b.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,l,d,_,b,E){if(m.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!_.length)return;let D=m.context,P=D.gl,F=l.getSource(),j=m.useProgram("raster"),W=m.colorModeForRenderPass(),ee=m.terrain&&m.terrain.renderingToTexture,[fe,Te]=F instanceof oe||ee?[{},_]:m.stencilConfigForOverlap(_),we=Te[Te.length-1].overscaledZ,Se=!m.options.moving;for(let Me of Te){let ce=ee?r.DepthMode.disabled:m.depthModeForSublayer(Me.overscaledZ-we,d.paint.get("raster-opacity")===1?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly,P.LESS),Oe=Me.toUnwrapped(),Pe=l.getTile(Me);if(ee&&(!Pe||!Pe.hasData()))continue;let Ue=ee?Me.projMatrix:m.transform.calculateProjMatrix(Oe,Se),Ze=m.terrain&&ee?m.terrain.stencilModeForRTTOverlap(Me):fe[Me.overscaledZ],je=E?0:d.paint.get("raster-fade-duration");Pe.registerFadeDuration(je);let $e=l.findLoadedParent(Me,0),it=Eu(Pe,$e,l,m.transform,je),dt,mt;m.terrain&&m.terrain.prepareDrawTile();let Qt=d.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;D.activeTexture.set(P.TEXTURE0),Pe.texture.bind(Qt,P.CLAMP_TO_EDGE),D.activeTexture.set(P.TEXTURE1),$e?($e.texture.bind(Qt,P.CLAMP_TO_EDGE),dt=Math.pow(2,$e.tileID.overscaledZ-Pe.tileID.overscaledZ),mt=[Pe.tileID.canonical.x*dt%1,Pe.tileID.canonical.y*dt%1]):Pe.texture.bind(Qt,P.CLAMP_TO_EDGE);let lt=Bv(Ue,mt||[0,0],dt||1,it,d,F instanceof oe?F.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(D,j,Oe),F instanceof oe)F.boundsBuffer&&F.boundsSegments&&j.draw(D,P.TRIANGLES,ce,r.StencilMode.disabled,W,r.CullFaceMode.disabled,lt,d.id,F.boundsBuffer,m.quadTriangleIndexBuffer,F.boundsSegments);else{let{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:bt,tileBoundsSegments:Ut}=m.getTileBoundsBuffers(Pe);j.draw(D,P.TRIANGLES,ce,Ze,W,r.CullFaceMode.disabled,lt,d.id,Dt,bt,Ut)}}m.resetStencilClippingMasks()},background:function(m,l,d,_){let b=d.paint.get("background-color"),E=d.paint.get("background-opacity");if(E===0)return;let D=m.context,P=D.gl,F=m.transform,j=F.tileSize,W=d.paint.get("background-pattern");if(m.isPatternMissing(W))return;let ee=!W&&b.a===1&&E===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==ee)return;let fe=r.StencilMode.disabled,Te=m.depthModeForSublayer(0,ee==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly),we=m.colorModeForRenderPass(),Se=m.useProgram(W?"backgroundPattern":"background"),Me,ce=_;ce||(Me=m.getBackgroundTiles(),ce=Object.values(Me).map(Oe=>Oe.tileID)),W&&(D.activeTexture.set(P.TEXTURE0),m.imageManager.bind(m.context));for(let Oe of ce){let Pe=Oe.toUnwrapped(),Ue=_?Oe.projMatrix:m.transform.calculateProjMatrix(Pe);m.prepareDrawTile();let Ze=l?l.getTile(Oe):Me?Me[Oe.key]:new r.Tile(Oe,j,F.zoom,m),je=W?Tp(Ue,E,m,W,{tileID:Oe,tileSize:j}):Uv(Ue,E,b);m.prepareDrawProgram(D,Se,Pe);let{tileBoundsBuffer:$e,tileBoundsIndexBuffer:it,tileBoundsSegments:dt}=m.getTileBoundsBuffers(Ze);Se.draw(D,P.TRIANGLES,Te,fe,we,r.CullFaceMode.disabled,je,d.id,$e,it,dt)}},sky:function(m,l,d){let _=m.transform,b=_.projection.name==="mercator"||_.projection.name==="globe"?1:r.smoothstep(7,8,_.zoom),E=d.paint.get("sky-opacity")*b;if(E===0)return;let D=m.context,P=d.paint.get("sky-type"),F=new r.DepthMode(D.gl.LEQUAL,r.DepthMode.ReadOnly,[0,1]),j=m.frameCounter/1e3%1;P==="atmosphere"?m.renderPass==="offscreen"?d.needsSkyboxCapture(m)&&(function(W,ee,fe,Te){let we=W.context,Se=we.gl,Me=ee.skyboxFbo;if(!Me){Me=ee.skyboxFbo=we.createFramebuffer(32,32,!1),ee.skyboxGeometry=new dd(we),ee.skyboxTexture=we.gl.createTexture(),Se.bindTexture(Se.TEXTURE_CUBE_MAP,ee.skyboxTexture),Se.texParameteri(Se.TEXTURE_CUBE_MAP,Se.TEXTURE_WRAP_S,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_CUBE_MAP,Se.TEXTURE_WRAP_T,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_CUBE_MAP,Se.TEXTURE_MIN_FILTER,Se.LINEAR),Se.texParameteri(Se.TEXTURE_CUBE_MAP,Se.TEXTURE_MAG_FILTER,Se.LINEAR);for(let Ue=0;Ue<6;++Ue)Se.texImage2D(Se.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,0,Se.RGBA,32,32,0,Se.RGBA,Se.UNSIGNED_BYTE,null)}we.bindFramebuffer.set(Me.framebuffer),we.viewport.set([0,0,32,32]);let ce=ee.getCenter(W,!0),Oe=W.useProgram("skyboxCapture"),Pe=new Float64Array(16);r.identity(Pe),r.rotateY(Pe,Pe,.5*-Math.PI),Ci(we,ee,Oe,Pe,ce,0),r.identity(Pe),r.rotateY(Pe,Pe,.5*Math.PI),Ci(we,ee,Oe,Pe,ce,1),r.identity(Pe),r.rotateX(Pe,Pe,.5*-Math.PI),Ci(we,ee,Oe,Pe,ce,2),r.identity(Pe),r.rotateX(Pe,Pe,.5*Math.PI),Ci(we,ee,Oe,Pe,ce,3),r.identity(Pe),Ci(we,ee,Oe,Pe,ce,4),r.identity(Pe),r.rotateY(Pe,Pe,Math.PI),Ci(we,ee,Oe,Pe,ce,5),we.viewport.set([0,0,W.width,W.height])}(m,d),d.markSkyboxValid(m)):m.renderPass==="sky"&&function(W,ee,fe,Te,we){let Se=W.context,Me=Se.gl,ce=W.transform,Oe=W.useProgram("skybox");Se.activeTexture.set(Me.TEXTURE0),Me.bindTexture(Me.TEXTURE_CUBE_MAP,ee.skyboxTexture);let Pe=((Ue,Ze,je,$e,it)=>({u_matrix:Ue,u_sun_direction:Ze,u_cubemap:0,u_opacity:$e,u_temporal_offset:it}))(ce.skyboxMatrix,ee.getCenter(W,!1),0,Te,we);W.prepareDrawProgram(Se,Oe),Oe.draw(Se,Me.TRIANGLES,fe,r.StencilMode.disabled,W.colorModeForRenderPass(),r.CullFaceMode.backCW,Pe,"skybox",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)}(m,d,F,E,j):P==="gradient"&&m.renderPass==="sky"&&function(W,ee,fe,Te,we){let Se=W.context,Me=Se.gl,ce=W.transform,Oe=W.useProgram("skyboxGradient");ee.skyboxGeometry||(ee.skyboxGeometry=new dd(Se)),Se.activeTexture.set(Me.TEXTURE0);let Pe=ee.colorRampTexture;Pe||(Pe=ee.colorRampTexture=new r.Texture(Se,ee.colorRamp,Me.RGBA)),Pe.bind(Me.LINEAR,Me.CLAMP_TO_EDGE);let Ue=((Ze,je,$e,it,dt)=>({u_matrix:Ze,u_color_ramp:0,u_center_direction:je,u_radius:r.degToRad($e),u_opacity:it,u_temporal_offset:dt}))(ce.skyboxMatrix,ee.getCenter(W,!1),ee.paint.get("sky-gradient-radius"),Te,we);W.prepareDrawProgram(Se,Oe),Oe.draw(Se,Me.TRIANGLES,fe,r.StencilMode.disabled,W.colorModeForRenderPass(),r.CullFaceMode.backCW,Ue,"skyboxGradient",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)}(m,d,F,E,j)},debug:function(m,l,d){for(let _=0;_<d.length;_++)Ip(m,l,d[_])},custom:function(m,l,d,_){let b=m.context,E=d.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&d.isLayerDraped()){if(m.renderPass==="offscreen"){let D=E.prerender;if(D){if(m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){let P=m.transform.pointMerc;D.call(E,b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),r.globeToMercatorTransition(m.transform.zoom),[P.x,P.y],m.transform.pixelsPerMeterRatio)}else D.call(E,b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){let P=E.renderToTile;if(P){let F=_[0].canonical,j=new r.MercatorCoordinate(F.x+_[0].wrap*(1<<F.z),F.y,F.z);b.setDepthMode(r.DepthMode.disabled),b.setStencilMode(r.StencilMode.disabled),b.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),P.call(E,b.gl,j),b.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),b.setStencilMode(r.StencilMode.disabled);let D=E.renderingMode==="3d"?new r.DepthMode(m.context.gl.LEQUAL,r.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,r.DepthMode.ReadOnly);if(b.setDepthMode(D),m.transform.projection.name==="globe"){let P=m.transform.pointMerc;E.render(b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),r.globeToMercatorTransition(m.transform.zoom),[P.x,P.y],m.transform.pixelsPerMeterRatio)}else E.render(b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState(),b.bindFramebuffer.set(null)}}else r.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Lu{constructor(l,d,_=!1){this.context=new he(l,_),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=r.SourceCache.maxUnderzooming+r.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yg,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,d){let _=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new mp(this,l));let b=this._terrain;this.transform.elevation=_?b:null,b.update(l,this.transform,d)}_updateFog(l){let d=l.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[_,b]=d.getFovAdjustedRange(this.transform._fov);if(_>b)return void(this.transform.fogCullDistSq=null);let E=_+.78*(b-_);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,d){if(this.width=l*r.exported.devicePixelRatio,this.height=d*r.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let _ of this.style.order)this.style._layers[_].resize()}setup(){let l=this.context,d=new r.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(r.EXTENT,0),d.emplaceBack(0,r.EXTENT),d.emplaceBack(r.EXTENT,r.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(d,r.posAttributes.members),this.tileExtentSegments=r.SegmentVector.simpleSegment(0,0,4,2);let _=new r.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(r.EXTENT,0),_.emplaceBack(0,r.EXTENT),_.emplaceBack(r.EXTENT,r.EXTENT),this.debugBuffer=l.createVertexBuffer(_,r.posAttributes.members),this.debugSegments=r.SegmentVector.simpleSegment(0,0,4,5);let b=new r.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,r.posAttributes.members),this.viewportSegments=r.SegmentVector.simpleSegment(0,0,4,2);let E=new r.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(r.EXTENT,0,r.EXTENT,0),E.emplaceBack(0,r.EXTENT,0,r.EXTENT),E.emplaceBack(r.EXTENT,r.EXTENT,r.EXTENT,r.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(E,r.boundsAttributes.members),this.mercatorBoundsSegments=r.SegmentVector.simpleSegment(0,0,4,2);let D=new r.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(D);let P=new r.StructArrayLayout1ui2;for(let j of[0,1,3,2,0])P.emplaceBack(j);this.debugIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new r.Texture(l,new r.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=r.create();let F=this.context.gl;this.stencilClearMode=new r.StencilMode({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(r.window.performance.now()),this.atmosphereBuffer=new jv(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,d.TRIANGLES,r.DepthMode.disabled,this.stencilClearMode,r.ColorMode.disabled,r.CullFaceMode.disabled,Li(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,d,_){if(!d||this.currentStencilSource===d.id||!l.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(let F of _)if(this._tileClippingMaskIDs[F.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=d.id;let b=this.context,E=b.gl;this.nextStencilID+_.length>256&&this.clearStencil(),b.setColorMode(r.ColorMode.disabled),b.setDepthMode(r.DepthMode.disabled);let D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let P of _){let F=d.getTile(P),j=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:W,tileBoundsIndexBuffer:ee,tileBoundsSegments:fe}=this.getTileBoundsBuffers(F);D.draw(b,E.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:E.ALWAYS,mask:0},j,255,E.KEEP,E.KEEP,E.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,Li(P.projMatrix),"$clipping",W,ee,fe)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let l=this.nextStencilID++,d=this.context.gl;return new r.StencilMode({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);let d=this.context.gl;return new r.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){let d=this.context.gl,_=l.sort((D,P)=>P.overscaledZ-D.overscaledZ),b=_[_.length-1].overscaledZ,E=_[0].overscaledZ-b+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();let D={};for(let P=0;P<E;P++)D[P+b]=new r.StencilMode({func:d.GEQUAL,mask:255},P+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=E,[D,_]}return[{[b]:r.StencilMode.disabled},_]}colorModeForRenderPass(){let l=this.context.gl;if(this._showOverdrawInspector){let d=1/8;return new r.ColorMode([l.CONSTANT_COLOR,l.ONE],new r.Color(d,d,d,0),[!0,!0,!0,!0])}return this.renderPass==="opaque"?r.ColorMode.unblended:r.ColorMode.alphaBlended}depthModeForSublayer(l,d,_){if(!this.opaquePassEnabledForLayer())return r.DepthMode.disabled;let b=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new r.DepthMode(_||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,d){this.style=l,this.options=d,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(r.exported.now()),this.imageManager.beginFrame();let _=this.style.order,b=this.style._sourceCaches;for(let F in b){let j=b[F];j.used&&j.prepare(this.context)}let E={},D={},P={};for(let F in b){let j=b[F];E[F]=j.getVisibleCoordinates(),D[F]=E[F].slice().reverse(),P[F]=j.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<_.length;F++)if(this.style._layers[_[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(P),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.GlobeSharedBuffers(this.context)),r.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(let F of _){let j=this.style._layers[F],W=l._getLayerSourceCache(j);if(!j.hasOffscreenPass()||j.isHidden(this.transform.zoom))continue;let ee=W?D[W.id]:void 0;(j.type==="custom"||j.isSky()||ee&&ee.length)&&this.renderLayer(this,W,j,ee)}if(this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:d.showOverdrawInspector?r.Color.black:r.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){let F=this.style._layers[_[this.currentLayer]],j=l._getLayerSourceCache(F);if(F.isSky())continue;let W=j?D[j.id]:void 0;this._renderTileClippingMasks(F,j,W),this.renderLayer(this,j,F,W)}if(this.style.fog&&this.transform.projection.supportsFog&&function(F,j){let W=F.context,ee=W.gl,fe=F.transform,Te=new r.DepthMode(ee.LEQUAL,r.DepthMode.ReadOnly,[0,1]),we=F.useProgram("globeAtmosphere",null,fe.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Se=r.globeToMercatorTransition(fe.zoom),Me=j.properties.get("color").toArray01(),ce=j.properties.get("high-color").toArray01(),Oe=j.properties.get("space-color").toArray01PremultipliedAlpha(),Pe=r.identity$1([]);r.rotateY$1(Pe,Pe,-r.degToRad(fe._center.lng)),r.rotateX$1(Pe,Pe,r.degToRad(fe._center.lat)),r.rotateZ$1(Pe,Pe,fe.angle),r.rotateX$1(Pe,Pe,-fe._pitch);let Ue=r.fromQuat(new Float32Array(16),Pe),Ze=r.mapValue(j.properties.get("star-intensity"),0,1,0,.25),je=5e-4,$e=r.mapValue(j.properties.get("horizon-blend"),0,1,je,.25),it=r.globeUseCustomAntiAliasing(F,W,fe)&&$e===je?fe.worldSize/(2*Math.PI*1.025)-1:fe.globeRadius,dt=F.frameCounter/1e3%1,mt=r.length(fe.globeCenterInViewSpace),Qt=Math.sqrt(Math.pow(mt,2)-Math.pow(it,2)),lt=Math.acos(Qt/mt),Dt=((Ut,ft,tt,yt,Nt,jt,zn,oi,Mn,vn,Fn,vi,Bn,Fi)=>({u_frustum_tl:Ut,u_frustum_tr:ft,u_frustum_br:tt,u_frustum_bl:yt,u_horizon:Nt,u_transition:jt,u_fadeout_range:zn,u_color:oi,u_high_color:Mn,u_space_color:vn,u_star_intensity:Fn,u_star_size:5*r.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:vi,u_horizon_angle:Bn,u_rotation_matrix:Fi}))(fe.frustumCorners.TL,fe.frustumCorners.TR,fe.frustumCorners.BR,fe.frustumCorners.BL,fe.frustumCorners.horizon,Se,$e,Me,ce,Oe,Ze,dt,lt,Ue);F.prepareDrawProgram(W,we);let bt=F.atmosphereBuffer;bt&&we.draw(W,ee.TRIANGLES,Te,r.StencilMode.disabled,r.ColorMode.alphaBlended,r.CullFaceMode.backCW,Dt,"skybox",bt.vertexBuffer,bt.indexBuffer,bt.segments)}(this,this.style.fog),this.renderPass="sky",(r.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){let F=this.style._layers[_[this.currentLayer]],j=l._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,j,F,j?D[j.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){let F=this.style._layers[_[this.currentLayer]],j=l._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}let W=j?(F.type==="symbol"?P:D)[j.id]:void 0;this._renderTileClippingMasks(F,j,j?E[j.id]:void 0),this.renderLayer(this,j,F,W),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let F=null;r.values(this.style._layers).forEach(j=>{let W=l._getLayerSourceCache(j);W&&!j.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<W.getSource().maxzoom)&&(F=W)}),F&&this.options.showTileBoundaries&&Cp.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){let j=F.transform.padding;Oa(F,F.transform.height-(j.top||0),3,Ap),Oa(F,j.bottom||0,3,Mp),cc(F,j.left||0,3,m_),cc(F,F.transform.width-(j.right||0),3,g_);let W=F.transform.centerPoint;(function(ee,fe,Te,we){Cu(ee,fe-1,Te-10,2,20,we),Cu(ee,fe-10,Te-1,20,2,we)})(F,W.x,F.transform.height-W.y,__)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(r.window.performance.now()),this.saveCanvasCopy())}}renderLayer(l,d,_,b){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||b&&b.length)&&(this.id=_.id,this.gpuTimingStart(_),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(_.type)||l.terrain&&_.type==="custom")&&Cp[_.type](l,d,_,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;let d=this.context.extTimerQuery,_=this.gpuTimers[l.id];_||(_=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let l=this.context.extTimerQuery,d=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(d),l.beginQueryEXT(l.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;let l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){let l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){let l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){let d={};for(let _ in l){let b=l[_],E=this.context.extTimerQuery,D=E.getQueryObjectEXT(b.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(b.query),d[_]=D}return d}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;let d=this.context.extTimerQuery,_=0;for(let b of l)_+=d.getQueryObjectEXT(b,d.QUERY_RESULT_EXT)/1e6,d.deleteQueryEXT(b);return _}translatePosMatrix(l,d,_,b,E){if(!_[0]&&!_[1])return l;let D=E?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(D){let j=Math.sin(D),W=Math.cos(D);_=[_[0]*W-_[1]*j,_[0]*j+_[1]*W]}let P=[E?_[0]:Ct(d,_[0],this.transform.zoom),E?_[1]:Ct(d,_[1],this.transform.zoom),0],F=new Float32Array(16);return r.translate(F,l,P),F}saveTileTexture(l){let d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){let d=this._tileTextures[l];return d&&d.length>0?d.pop():null}isPatternMissing(l){return l===null||l!==void 0&&!this.imageManager.getPattern(l.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){let l=this.terrain&&this.terrain.renderingToTexture,d=this.terrain&&this.terrain.exaggeration()===0,_=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),this.transform.projection.name==="globe"&&b.push("GLOBE"),d&&b.push("ZERO_EXAGGERATION"),_&&!l&&_.getOpacity(this.transform.pitch)!==0&&b.push("FOG"),l&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(l,d,_){this.cache=this.cache||{};let b=_||[],E=this.currentGlobalDefines().concat(b),D=gp.cacheKey(cp[l],l,E,d);return this.cache[D]||(this.cache[D]=new gp(this.context,l,cp[l],d,Vv[l],E)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=r.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,d,_){if(this.terrain&&this.terrain.renderingToTexture)return;let b=this.style.fog;if(b){let E=b.getOpacity(this.transform.pitch),D=((P,F,j,W,ee,fe,Te,we,Se,Me,ce)=>{let Oe=P.transform,Pe=F.properties.get("color").toArray01();Pe[3]=W;let Ue=P.frameCounter/1e3%1;return{u_fog_matrix:j?Oe.calculateFogTileMatrix(j):P.identityMat,u_fog_range:F.getFovAdjustedRange(Oe._fov),u_fog_color:Pe,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_temporal_offset:Ue,u_frustum_tl:ee,u_frustum_tr:fe,u_frustum_br:Te,u_frustum_bl:we,u_globe_pos:Se,u_globe_radius:Me,u_viewport:ce,u_globe_transition:r.globeToMercatorTransition(Oe.zoom),u_is_globe:+(Oe.projection.name==="globe")}})(this,b,_,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.exported.devicePixelRatio,this.transform.height*r.exported.devicePixelRatio]);d.setFogUniformValues(l,D)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){let l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){let l=this.context.gl,d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let l=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(let b of _)d[b.key]=l[b.key]||new r.Tile(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class Lp{constructor(l=0,d=0,_=0,b=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=_,this.right=b}interpolate(l,d,_){return d.top!=null&&l.top!=null&&(this.top=r.number(l.top,d.top,_)),d.bottom!=null&&l.bottom!=null&&(this.bottom=r.number(l.bottom,d.bottom,_)),d.left!=null&&l.left!=null&&(this.left=r.number(l.left,d.left,_)),d.right!=null&&l.right!=null&&(this.right=r.number(l.right,d.right,_)),this}getCenter(l,d){let _=r.clamp((this.left+l-this.right)/2,0,l),b=r.clamp((this.top+d-this.bottom)/2,0,d);return new r.pointGeometry(_,b)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Lp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function y_(m,l){let d=r.getColumn(m,3);r.fromQuat(m,l),r.setColumn(m,3,d)}function pd(m,l){let d=r.identity$1([]);return r.rotateZ$1(d,d,-l),r.rotateX$1(d,d,-m),d}function v_(m,l){let d=[m[0],m[1],0],_=[l[0],l[1],0];if(r.length(d)>=1e-15){let D=r.normalize([],d);r.scale$2(_,D,r.dot(_,D)),l[0]=_[0],l[1]=_[1]}let b=r.cross([],l,m);if(r.len(b)<1e-15)return null;let E=Math.atan2(-b[1],b[0]);return pd(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),E)}class md{constructor(l,d){this.position=l,this.orientation=d}get position(){return this._position}set position(l){if(l){let d=l instanceof r.MercatorCoordinate?l:new r.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(d.x=r.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(l,d){if(this.orientation=null,!this.position)return;let _=this._elevation?this._elevation.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(l)):0,b=this.position,E=r.MercatorCoordinate.fromLngLat(l,_),D=[E.x-b.x,E.y-b.y,E.z-b.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=v_(D,d)}setPitchBearing(l,d){this.orientation=pd(r.degToRad(l),r.degToRad(-d))}}class dc{constructor(l,d){this._transform=r.identity([]),this.orientation=d,this.position=l}get mercatorPosition(){let l=this.position;return new r.MercatorCoordinate(l[0],l[1],l[2])}get position(){let l=r.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var d;l&&r.setColumn(this._transform,3,[(d=l)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||r.identity$1([]),l&&y_(this._transform,this._orientation)}getPitchBearing(){let l=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,d){this._orientation=pd(l,d),y_(this._transform,this._orientation)}forward(){let l=r.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){let l=r.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){let l=r.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,d){let _=new Float64Array(16);return r.invert(_,this.getWorldToCamera(l,d)),_}getWorldToCameraPosition(l,d,_){let b=this.position;r.scale$2(b,b,-l);let E=new Float64Array(16);return r.fromScaling(E,[_,_,_]),r.translate(E,E,b),E[10]*=d,E}getWorldToCamera(l,d){let _=new Float64Array(16),b=new Float64Array(4),E=this.position;return r.conjugate(b,this._orientation),r.scale$2(E,E,-l),r.fromQuat(_,b),r.translate(_,_,E),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(l,d,_,b){let E=new Float64Array(16);return r.perspective(E,l,d,_,b),E}getDistanceToElevation(l,d=!1){let _=l===0?0:r.mercatorZfromAltitude(l,d?r.latFromMercatorY(this.position[1]):this.position[1]),b=this.forward();return(_-this.position[2])/b[2]}clone(){return new dc([...this.position],[...this.orientation])}}function fc(m,l){let d=vl(m.projection,m.zoom,m.width,m.height),_=function(E,D,P,F,j){let W=new r.LngLat(P.lng-180*xl,P.lat),ee=new r.LngLat(P.lng+180*xl,P.lat),fe=E.project(W.lng,W.lat),Te=E.project(ee.lng,ee.lat),we=-Math.atan2(Te.y-fe.y,Te.x-fe.x),Se=r.MercatorCoordinate.fromLngLat(P);Se.y=r.clamp(Se.y,-.999975,.999975);let Me=Se.toLngLat(),ce=E.project(Me.lng,Me.lat),Oe=r.MercatorCoordinate.fromLngLat(Me);Oe.x+=xl;let Pe=Oe.toLngLat(),Ue=E.project(Pe.lng,Pe.lat),Ze=Ru(Ue.x-ce.x,Ue.y-ce.y,we),je=r.MercatorCoordinate.fromLngLat(Me);je.y+=xl;let $e=je.toLngLat(),it=E.project($e.lng,$e.lat),dt=Ru(it.x-ce.x,it.y-ce.y,we),mt=Math.abs(Ze.x)/Math.abs(dt.y),Qt=r.identity([]);r.rotateZ(Qt,Qt,-we*(1-(j?0:F)));let lt=r.identity([]);return r.scale(lt,lt,[1,1-(1-mt)*F,1]),lt[4]=-dt.x/dt.y*F,r.rotateZ(lt,lt,we),r.multiply(lt,Qt,lt),lt}(m.projection,0,m.center,d,l),b=gd(m);return r.scale(_,_,[b,b,1]),_}function gd(m){let l=m.projection,d=vl(m.projection,m.zoom,m.width,m.height),_=Du(l,m.center),b=Du(l,r.LngLat.convert(l.center));return Math.pow(2,_*d+(1-d)*b)}function vl(m,l,d,_,b=1/0){let E=m.range;if(!E)return 0;let D=Math.min(b,Math.max(d,_)),P=Math.log(D/1024)/Math.LN2;return r.smoothstep(E[0]+P,E[1]+P,l)}let xl=1/4e4;function Du(m,l){let d=r.clamp(l.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),_=new r.LngLat(l.lng-180*xl,d),b=new r.LngLat(l.lng+180*xl,d),E=m.project(_.lng,d),D=m.project(b.lng,d),P=r.MercatorCoordinate.fromLngLat(_),F=r.MercatorCoordinate.fromLngLat(b),j=D.x-E.x,W=D.y-E.y,ee=F.x-P.x,fe=F.y-P.y,Te=Math.sqrt((ee*ee+fe*fe)/(j*j+W*W));return Math.log(Te)/Math.LN2}function Ru(m,l,d){let _=Math.cos(d),b=Math.sin(d);return{x:m*_-l*b,y:m*b+l*_}}class yn{constructor(l,d,_,b,E,D,P){this.tileSize=512,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=b??60,this.setProjection(D),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new r.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Lp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new dc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){let l=new yn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l,d=!1){let _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(l||_)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return r.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};let d=this.projection?this.getProjection():void 0;this.projection=r.getProjection(this.projectionOptions);let _=!x(d,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){let l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.getProjection({name:"mercator"});let d=l!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){let l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.pointGeometry(this.width,this.height)}get bearing(){return r.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){let d=-l*Math.PI/180;var _;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new r.ARRAY_TYPE(4),r.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),function(b,E,D){var P=E[0],F=E[1],j=E[2],W=E[3],ee=Math.sin(D),fe=Math.cos(D);b[0]=P*fe+j*ee,b[1]=F*fe+W*ee,b[2]=P*-ee+j*fe,b[3]=F*-ee+W*fe}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){let d=r.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){let l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=r.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){let d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let l=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop(),b=0,E=0;for(let D=0;D<d.length;D++){let P=new r.pointGeometry(d[D][0]*this.width,_+d[D][1]*(this.height-_)),F=l.pointCoordinate(P);if(!F)continue;let j=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);b+=F[3]*j,E+=j}return E===0?NaN:b/E}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let l=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(l),E=this._mercatorZfromZoom(this._maxZoom),D=Math.max(b-_,E);this._setZoom(this._zoomFromMercatorZ(D))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){let d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude())),_;_=l.z<this._camera.position[2]?[d.x,d.y,d.z]:[l.x,l.y,l.z];let b=r.length(r.sub([],this._camera.position,_));return r.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let d=!1;if(l.orientation&&!r.exactEquals(l.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(l.orientation)),l.position){let _=[l.position.x,l.position.y,l.position.z];r.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let l=this._camera.position,d=new md;return d.position=new r.MercatorCoordinate(l[0],l[1],l[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(l){if(!r.length$1(l))return!1;r.normalize$1(l,l);let d=r.transformQuat([],[0,0,-1],l),_=r.transformQuat([],[0,-1,0],l);if(_[2]<0)return!1;let b=v_(d,_);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(l){let d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;l[2]=r.clamp(l[2],b/_,b/d),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,_){this._unmodified=!1,this._edgeInsets.interpolate(l,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){let d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){let d=[new r.UnwrappedTileID(0,l)];if(this.renderWorldCopies){let _=this.pointCoordinate(new r.pointGeometry(0,0)),b=this.pointCoordinate(new r.pointGeometry(this.width,0)),E=this.pointCoordinate(new r.pointGeometry(this.width,this.height)),D=this.pointCoordinate(new r.pointGeometry(0,this.height)),P=Math.floor(Math.min(_.x,b.x,E.x,D.x)),F=Math.floor(Math.max(_.x,b.x,E.x,D.x)),j=1;for(let W=P-j;W<=F+j;W++)W!==0&&d.push(new r.UnwrappedTileID(W,l))}return d}coveringTiles(l){let d=this.coveringZoomLevel(l),_=d,b=this.elevation&&!l.isTerrainDEM,E=this.projection.name==="mercator";if(l.minzoom!==void 0&&d<l.minzoom)return[];l.maxzoom!==void 0&&d>l.maxzoom&&(d=l.maxzoom);let D=this.locationCoordinate(this.center),P=this.center.lat,F=1<<d,j=[F*D.x,F*D.y,0],W=this.projection.name==="globe",ee=!W,fe=r.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,ee),Te=W?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),we=F*r.mercatorZfromAltitude(1,this.center.lat),Se=this._camera.position[2]/r.mercatorZfromAltitude(1,this.center.lat),Me=[F*Te.x,F*Te.y,Se*(ee?1:we)],ce=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),Oe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,Pe=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ue=l.isTerrainDEM?-Pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ze=this.projection.isReprojectedInTileSpace?gd(this):1,je=ft=>{let tt=1/4e4,yt=new r.MercatorCoordinate(ft.x+tt,ft.y,ft.z),Nt=new r.MercatorCoordinate(ft.x,ft.y+tt,ft.z),jt=ft.toLngLat(),zn=yt.toLngLat(),oi=Nt.toLngLat(),Mn=this.locationCoordinate(jt),vn=this.locationCoordinate(zn),Fn=this.locationCoordinate(oi),vi=Math.hypot(vn.x-Mn.x,vn.y-Mn.y),Bn=Math.hypot(Fn.x-Mn.x,Fn.y-Mn.y);return Math.sqrt(vi*Bn)*Ze/tt},$e=ft=>{let tt=Pe,yt=Ue;return{aabb:r.tileAABB(this,F,0,0,0,ft,yt,tt,this.projection),zoom:0,x:0,y:0,minZ:yt,maxZ:tt,wrap:ft,fullyVisible:!1}},it=[],dt=[],mt=d,Qt=l.reparseOverscaled?_:d,lt=ft=>ft*ft,Dt=lt((Se-this._centerAltitude)*we),bt=ft=>{if(!this._elevation||!ft.tileID||!E)return;let tt=this._elevation.getMinMaxForTile(ft.tileID),yt=ft.aabb;tt?(yt.min[2]=tt.min,yt.max[2]=tt.max,yt.center[2]=(yt.min[2]+yt.max[2])/2):(ft.shouldSplit=Ut(ft),ft.shouldSplit||(yt.min[2]=yt.max[2]=yt.center[2]=this._centerAltitude))},Ut=ft=>{if(ft.zoom<Oe)return!0;if(ft.zoom===mt)return!1;if(ft.shouldSplit!=null)return ft.shouldSplit;let tt=ft.aabb.distanceX(Me),yt=ft.aabb.distanceY(Me),Nt=Dt,jt=1;if(W){Nt=lt(ft.aabb.distanceZ(Me));let Mn=Math.pow(2,ft.zoom),vn=r.latFromMercatorY((ft.y+1)/Mn),Fn=r.latFromMercatorY(ft.y/Mn),vi=Math.min(Math.max(P,vn),Fn),Bn=r.circumferenceAtLatitude(vi)/r.circumferenceAtLatitude(P);if(jt=vi===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Bn/this._mercatorScaleRatio),this.zoom<=r.GLOBE_ZOOM_THRESHOLD_MIN&&ft.zoom===mt-1&&Bn>=.9)return!0}else if(b&&(Nt=lt(ft.aabb.distanceZ(Me)*we)),this.projection.isReprojectedInTileSpace&&_<=5){let Mn=Math.pow(2,ft.zoom),vn=je(new r.MercatorCoordinate((ft.x+.5)/Mn,(ft.y+.5)/Mn));jt=vn>.85?1:vn}let zn=tt*tt+yt*yt+Nt,oi=lt((1<<mt-ft.zoom)*ce*jt*((Mn,vn)=>{if(vn*lt(.707)<Mn)return 1;let Fn=Math.sqrt(vn/Mn);return Fn/(1.4144271570014144+(Math.pow(1.1,Fn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Nt,Dt),zn));return zn<oi};if(this.renderWorldCopies)for(let ft=1;ft<=3;ft++)it.push($e(-ft)),it.push($e(ft));for(it.push($e(0));it.length>0;){let ft=it.pop(),tt=ft.x,yt=ft.y,Nt=ft.fullyVisible;if(!Nt){let jt=ft.aabb.intersects(fe);if(jt===0)continue;Nt=jt===2}if(ft.zoom!==mt&&Ut(ft))for(let jt=0;jt<4;jt++){let zn=(tt<<1)+jt%2,oi=(yt<<1)+(jt>>1),Mn={aabb:E?ft.aabb.quadrant(jt):r.tileAABB(this,F,ft.zoom+1,zn,oi,ft.wrap,ft.minZ,ft.maxZ,this.projection),zoom:ft.zoom+1,x:zn,y:oi,wrap:ft.wrap,fullyVisible:Nt,tileID:void 0,shouldSplit:void 0,minZ:ft.minZ,maxZ:ft.maxZ};b&&!W&&(Mn.tileID=new r.OverscaledTileID(ft.zoom+1===mt?Qt:ft.zoom+1,ft.wrap,ft.zoom+1,zn,oi),bt(Mn)),it.push(Mn)}else{let jt=ft.zoom===mt?Qt:ft.zoom;if(l.minzoom&&l.minzoom>jt)continue;let zn=j[0]-(.5+tt+(ft.wrap<<ft.zoom))*(1<<d-ft.zoom),oi=j[1]-.5-yt,Mn=ft.tileID?ft.tileID:new r.OverscaledTileID(jt,ft.wrap,ft.zoom,tt,yt);dt.push({tileID:Mn,distanceSq:zn*zn+oi*oi})}}if(this.fogCullDistSq){let ft=this.fogCullDistSq,tt=this.horizonLineFromTop();dt=dt.filter(yt=>{let Nt=[0,0,0,1],jt=[r.EXTENT,r.EXTENT,0,1],zn=this.calculateFogTileMatrix(yt.tileID.toUnwrapped());r.transformMat4$1(Nt,Nt,zn),r.transformMat4$1(jt,jt,zn);let oi=r.getAABBPointSquareDist(Nt,jt);if(oi===0)return!0;let Mn=!1,vn=this._elevation;if(vn&&oi>ft&&tt!==0){let Fn=this.calculateProjMatrix(yt.tileID.toUnwrapped()),vi;l.isTerrainDEM||(vi=vn.getMinMaxForTile(yt.tileID)),vi||(vi={min:Ue,max:Pe});let Bn=r.furthestTileCorner(this.rotation),Fi=[Bn[0]*r.EXTENT,Bn[1]*r.EXTENT,vi.max];r.transformMat4(Fi,Fi,Fn),Mn=(1-Fi[1])*this.height*.5<tt}return oi<ft||Mn})}return dt.sort((ft,tt)=>ft.distanceSq-tt.distanceSq).map(ft=>ft.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){let d=r.clamp(l.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),_=this.projection.project(l.lng,d);return new r.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,d){let _,b,E=this.centerPoint;if(this.projection.name==="globe"){let P=this.worldSize;_=(d.x-E.x)/P,b=(d.y-E.y)/P}else{let P=this.pointCoordinate(d),F=this.pointCoordinate(E);_=P.x-F.x,b=P.y-F.y}let D=this.locationCoordinate(l);this.setLocation(new r.MercatorCoordinate(D.x-_,D.y-b))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,d){let _=d?r.mercatorZfromAltitude(d,l.lat):void 0,b=this.projection.project(l.lng,l.lat);return new r.MercatorCoordinate(b.x,b.y,_)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,d){let _=d??this._centerAltitude,b=[l.x,l.y,0,1],E=[l.x,l.y,1,1];r.transformMat4$1(b,b,this.pixelMatrixInverse),r.transformMat4$1(E,E,this.pixelMatrixInverse);let D=E[3];r.scale$1(b,b,1/b[3]),r.scale$1(E,E,1/D);let P=b[2],F=E[2];return{p0:b,p1:E,t:P===F?0:(_-P)/(F-P)}}screenPointToMercatorRay(l){let d=[l.x,l.y,0,1],_=[l.x,l.y,1,1];return r.transformMat4$1(d,d,this.pixelMatrixInverse),r.transformMat4$1(_,_,this.pixelMatrixInverse),r.scale$1(d,d,1/d[3]),r.scale$1(_,_,1/_[3]),d[2]=r.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,_[2]=r.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,r.scale$1(d,d,1/this.worldSize),r.scale$1(_,_,1/this.worldSize),new r.Ray([d[0],d[1],d[2]],r.normalize([],r.sub([],_,d)))}rayIntersectionCoordinate(l){let{p0:d,p1:_,t:b}=l,E=r.mercatorZfromAltitude(d[2],this._center.lat),D=r.mercatorZfromAltitude(_[2],this._center.lat);return new r.MercatorCoordinate(r.number(d[0],_[0],b)/this.worldSize,r.number(d[1],_[1],b)/this.worldSize,r.number(E,D,b))}pointCoordinate(l,d=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,d)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let d=this.projection.pointCoordinate3D(this,l.x,l.y);if(d)return new r.MercatorCoordinate(d[0],d[1],d[2]);let _=0,b=this.horizonLineFromTop();if(l.y>b)return this.pointCoordinate(l);let E=.02*b,D=l.clone();for(let P=0;P<10&&b-_>E;P++){D.y=r.number(_,b,.66);let F=this.projection.pointCoordinate3D(this,D.x,D.y);F?(b=D.y,d=F):_=D.y}return d?new r.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}_coordinatePoint(l,d){let _=d&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,b=[l.x*this.worldSize,l.y*this.worldSize,_+l.toAltitude(),1];return r.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new r.pointGeometry(b[0]/b[3],b[1]/b[3]):new r.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:l,left:d}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=this.pointLocation3D(new r.pointGeometry(d,l)),D=this.pointLocation3D(new r.pointGeometry(b,l)),P=this.pointLocation3D(new r.pointGeometry(b,_)),F=this.pointLocation3D(new r.pointGeometry(d,_)),j=Math.min(E.lng,D.lng,P.lng,F.lng),W=Math.max(E.lng,D.lng,P.lng,F.lng),ee=Math.min(E.lat,D.lat,P.lat,F.lat),fe=Math.max(E.lat,D.lat,P.lat,F.lat),Te=Math.pow(2,-this.zoom)/16*270,we=this.projection.name==="globe"?1:4,Se=(Me,ce,Oe,Pe,Ue)=>{let Ze=(Me+Oe)/2,je=(ce+Pe)/2,$e=new r.pointGeometry(Ze,je),{lng:it,lat:dt}=this.pointLocation3D($e),mt=Math.max(0,j-it,ee-dt,it-W,dt-fe);j=Math.min(j,it),W=Math.max(W,it),ee=Math.min(ee,dt),fe=Math.max(fe,dt),(Ue<we||mt>Te)&&(Se(Me,ce,Ze,je,Ue+1),Se(Ze,je,Oe,Pe,Ue+1))};if(Se(d,l,b,l,1),Se(b,l,b,_,1),Se(b,_,d,_,1),Se(d,_,d,l,1),this.projection.name==="globe"){let[Me,ce]=r.polesInViewport(this);Me?(fe=90,W=180,j=-180):ce&&(ee=-90,W=180,j=-180)}return new r.LngLatBounds(new r.LngLat(j,ee),new r.LngLat(W,fe))}_getBoundsRectangular(l,d){let{top:_,left:b}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,D=this.width-this._edgeInsets.right,P=new r.pointGeometry(b,_),F=new r.pointGeometry(D,_),j=new r.pointGeometry(D,E),W=new r.pointGeometry(b,E),ee=this.pointCoordinate(P,l),fe=this.pointCoordinate(F,l),Te=this.pointCoordinate(j,d),we=this.pointCoordinate(W,d),Se=(Me,ce)=>(ce.y-Me.y)/(ce.x-Me.x);return ee.y>1&&fe.y>=0?ee=new r.MercatorCoordinate((1-we.y)/Se(we,ee)+we.x,1):ee.y<0&&fe.y<=1&&(ee=new r.MercatorCoordinate(-we.y/Se(we,ee)+we.x,0)),fe.y>1&&ee.y>=0?fe=new r.MercatorCoordinate((1-Te.y)/Se(Te,fe)+Te.x,1):fe.y<0&&ee.y<=1&&(fe=new r.MercatorCoordinate(-Te.y/Se(Te,fe)+Te.x,0)),new r.LngLatBounds().extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(we)).extend(this.coordinateLocation(Te))}_getBoundsRectangularTerrain(){let l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);let d=l.visibleDemTiles.reduce((_,b)=>{if(b.dem){let E=b.dem.tree;_.min=Math.min(_.min,E.minimums[0]),_.max=Math.max(_.max,E.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*l.exaggeration(),d.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){let d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return l?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-r.MAX_MERCATOR_LATITUDE,this.maxLat=r.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=r.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=r.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=r.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,d){return this.projection.createTileMatrix(this,d,l)}calculateDistanceTileData(l){let d=l.key,_=this._distanceTileDataCache;if(_[d])return _[d];let b=l.canonical,E=1/this.height,D=this.cameraWorldSize,P=D/this.zoomScale(b.z),F=(b.x+Math.pow(2,b.z)*l.wrap)*P,j=b.y*P,W=this.point;W.x*=D/this.worldSize,W.y*=D/this.worldSize;let ee=this.angle,fe=Math.sin(-ee),Te=-Math.cos(-ee);return _[d]={bearing:[fe,Te],center:[(W.x-F)*E,(W.y-j)*E],scale:P/r.EXTENT*E},_[d]}calculateFogTileMatrix(l){let d=l.key,_=this._fogTileMatrixCache;if(_[d])return _[d];let b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return r.multiply(b,this.worldToFogMatrix,b),_[d]=new Float32Array(b),_[d]}calculateProjMatrix(l,d=!1){let _=l.key,b=d?this._alignedProjMatrixCache:this._projMatrixCache;if(b[_])return b[_];let E=this.calculatePosMatrix(l,this.worldSize);return r.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,E),b[_]=new Float32Array(E),b[_]}calculatePixelsToTileUnitsMatrix(l){let d=l.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];let b=function(E,D){let{scale:P}=E.tileTransform,F=P*r.EXTENT/(E.tileSize*Math.pow(2,D.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return j=new Float32Array(4),fe=(W=D.inverseAdjustmentMatrix)[1],Te=W[2],we=W[3],Me=(ee=[F,F])[1],j[0]=W[0]*(Se=ee[0]),j[1]=fe*Se,j[2]=Te*Me,j[3]=we*Me,j;var j,W,ee,fe,Te,we,Se,Me}(l,this);return _[d]=b,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let l=1/this.worldSize,d=r.fromScaling([],[l,l,l]);return r.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let l=this._elevation;this._updateCameraState();let d=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=this._camera.forward(),E=r.mercatorZfromAltitude(1,this._center.lat);_[2]/=E,b[2]/=E,r.normalize(b,b);let D=l.raycast(_,b,l.exaggeration());if(D){let P=r.scaleAndAdd([],_,b,D),F=new r.MercatorCoordinate(P[0],P[1],r.mercatorZfromAltitude(P[2],r.latFromMercatorY(P[1]))),j=(F.z+r.length([F.x-_[0],F.y-_[1],F.z-_[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(j),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;let d=this._elevation,_=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(_),E=d.getAtPointOrZero(new r.MercatorCoordinate(...b)),D=this.pixelsPerMeter/this.worldSize*E,P=this._minimumHeightOverTerrain(),F=b[2]-D;if(F<=P)if(F<0||l){let j=this.locationCoordinate(this._center,this._centerAltitude),W=[b[0],b[1],j.z-b[2]],ee=r.length(W);W[2]-=(P-F)/this._pixelsPerMercatorPixel;let fe=r.length(W);if(fe===0)return;r.scale$2(W,W,ee/fe*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],j.z*this._pixelsPerMercatorPixel-W[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){let fe=this.center;return fe.lat=r.clamp(fe.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(fe.lng=r.clamp(fe.lng,this.minLng,this.maxLng)),this.center=fe,void(this._constraining=!1)}let d=this._unmodified,{x:_,y:b}=this.point,E=0,D=_,P=b,F=this.width/2,j=this.height/2,W=this.worldMinY*this.scale,ee=this.worldMaxY*this.scale;if(b-j<W&&(P=W+j),b+j>ee&&(P=ee-j),ee-W<this.height&&(E=Math.max(E,this.height/(ee-W)),P=(ee+W)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let fe=this.worldMinX*this.scale,Te=this.worldMaxX*this.scale,we=this.worldSize/2-(fe+Te)/2;D=(_+we+this.worldSize)%this.worldSize-we,D-F<fe&&(D=fe+F),D+F>Te&&(D=Te-F),Te-fe<this.width&&(E=Math.max(E,this.width/(Te-fe)),D=(Te+fe)/2)}D===_&&P===b||(this.center=this.unproject(new r.pointGeometry(D,P))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let l=this.centerOffset,d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.mercatorZfromAltitude(1,this.center.lat)/r.mercatorZfromAltitude(1,r.GLOBE_SCALE_MATCH_LATITUDE));let _=vl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let b=this.projection.zAxisUnit==="meters"?d:1,E=this._camera.getWorldToCamera(this.worldSize,b),D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);D[8]=2*-l.x/this.width,D[9]=2*l.y/this.height;let P=r.mul([],D,E);if(this.projection.isReprojectedInTileSpace){let je=this.locationCoordinate(this.center),$e=r.identity([]);r.translate($e,$e,[je.x*this.worldSize,je.y*this.worldSize,0]),r.multiply($e,$e,fc(this)),r.translate($e,$e,[-je.x*this.worldSize,-je.y*this.worldSize,0]),r.multiply(P,P,$e),this.inverseAdjustmentMatrix=function(it){let dt=fc(it,!0);return me([],[dt[0],dt[1],dt[4],dt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=r.scale([],P,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=P,this.invProjMatrix=r.invert(new Float64Array(16),this.projMatrix);let F=r.invert([],D);this.frustumCorners=r.FrustumCorners.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height);let j=new Float32Array(16);r.identity(j),r.scale(j,j,[1,-1,1]),r.rotateX(j,j,this._pitch),r.rotateZ(j,j,this.angle);let W=r.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;W[8]=2*-l.x/this.width,W[9]=2*(l.y+ee)/this.height,this.skyboxMatrix=r.multiply(j,W,j);let fe=this.point,Te=fe.x,we=fe.y,Se=this.width%2/2,Me=this.height%2/2,ce=Math.cos(this.angle),Oe=Math.sin(this.angle),Pe=Te-Math.round(Te)+ce*Se+Oe*Me,Ue=we-Math.round(we)+ce*Me+Oe*Se,Ze=new Float64Array(P);if(r.translate(Ze,Ze,[Pe>.5?Pe-1:Pe,Ue>.5?Ue-1:Ue,0]),this.alignedProjMatrix=Ze,P=r.create(),r.scale(P,P,[this.width/2,-this.height/2,1]),r.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=r.create(),r.scale(P,P,[1,-1,1]),r.translate(P,P,[-1,-1,0]),r.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=r.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},P=r.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.calculateGlobeMatrix(this);let je=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.transformMat4(je,je,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let l=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,_=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,E=[l,l,d];r.scale$2(E,E,b),r.scale$2(_,_,-1),r.multiply$2(_,_,E);let D=r.create();r.translate(D,D,_),r.scale(D,D,E),this.mercatorFogMatrix=D,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,d,b)}_computeCameraPosition(l){let d=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),b=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-l/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-_[0]*E,b.y/this.worldSize-_[1]*E,l/this.worldSize*this._centerAltitude-_[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){let d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],b=l[2],E=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(E=Math.min((d-_)/b,1)),this._camera.position=r.scaleAndAdd([],this._camera.position,l,E),this._updateStateFromCamera()}_updateStateFromCamera(){let l=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:b}=this._camera.getPitchBearing(),E=r.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,D=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.degToRad(this._maxPitch)),P=Math.max((l[2]-E)/Math.cos(_),D),F=this._zoomFromMercatorZ(P);r.scaleAndAdd(l,l,d,P),this._pitch=r.clamp(_,r.degToRad(this.minPitch),r.degToRad(this.maxPitch)),this.angle=r.wrap(b,-Math.PI,Math.PI),this._setZoom(r.clamp(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){let l=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let d=0,_=r.GLOBE_ZOOM_THRESHOLD_MAX,b=0,E=1/0;for(;_-d>1e-6&&_>d;){let D=d+.5*(_-d),P=this.tileSize*Math.pow(2,D),F=this.getCameraToCenterDistance(this.projection,D,P),j=this.scaleZoom(F/(l*this.tileSize)),W=Math.abs(D-j);W<E&&(E=W,b=D),D<j?d=D:_=D}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,d){let _=Math.min(l.x,d.x),b=Math.max(l.x,d.x),E=Math.min(l.y,d.y),D=Math.max(l.y,d.y);if(E<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let P=[new r.pointGeometry(_,E),new r.pointGeometry(b,D),new r.pointGeometry(_,D),new r.pointGeometry(b,E)],F=this.renderWorldCopies?-3:0,j=this.renderWorldCopies?4:1;for(let W of P){let ee=this.pointRayIntersection(W);if(ee.t<0)return!0;let fe=this.rayIntersectionCoordinate(ee);if(fe.x<F||fe.y<0||fe.x>j||fe.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.pointGeometry(0,0),new r.pointGeometry(this.width,this.height))}zoomDeltaToMovement(l,d){let _=r.length(r.sub([],this._camera.position,l)),b=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){let l=function([d,_,b],E){let D=[d,_,b,1];r.transformMat4$1(D,D,E);let P=D[3]=Math.max(D[3],1e-6);return D[0]/=P,D[1]/=P,D[2]/=P,D}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.pointGeometry(l[0],l[1])}{let l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.pointGeometry(0,l))}}getCameraToCenterDistance(l,d=this.zoom,_=this.worldSize){let b=vl(l,d,this.width,this.height,1024),E=l.pixelSpaceConversion(this.center.lat,_,b);return .5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){let l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.multiply(l,l,this.globeMatrix),l}}function oo(m,l){let d=!1,_=null,b=()=>{_=null,d&&(m(),_=setTimeout(b,l),d=!1)};return()=>(d=!0,_||b(),_)}class x_{constructor(l){this._hashName=l&&encodeURIComponent(l),r.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=oo(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,r.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),r.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let l=this._map;if(!l)return"";let d=Dp(l);if(this._hashName){let _=this._hashName,b=!1,E=r.window.location.hash.slice(1).split("&").map(D=>{let P=D.split("=")[0];return P===_?(b=!0,`${P}=${d}`):D}).filter(D=>D);return b||E.push(`${_}=${d}`),`#${E.join("&")}`}return`#${d}`}_getCurrentHash(){let l=r.window.location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return l.split("/")}_onHashChange(){let l=this._map;if(!l)return!1;let d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){let _=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(d[3]||0):l.getBearing();return l.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){let l=r.window.location.href.replace(/(#.+)?$/,this.getHashString());r.window.history.replaceState(r.window.history.state,null,l)}}function Dp(m,l){let d=m.getCenter(),_=Math.round(100*m.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),D=Math.round(d.lng*E)/E,P=Math.round(d.lat*E)/E,F=m.getBearing(),j=m.getPitch(),W=l?`/${D}/${P}/${_}`:`${_}/${P}/${D}`;return(F||j)&&(W+="/"+Math.round(10*F)/10),j&&(W+=`/${Math.round(j)}`),W}let Pu={linearity:.3,easing:r.bezier(0,0,.3,1)},pc=r.extend({deceleration:2500,maxSpeed:1400},Pu),b_=r.extend({deceleration:20,maxSpeed:1400},Pu),_d=r.extend({deceleration:1e3,maxSpeed:360},Pu),Rp=r.extend({deceleration:1e3,maxSpeed:90},Pu);class yd{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.exported.now(),settings:l})}_drainInertiaBuffer(){let l=this._inertiaBuffer,d=r.exported.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let d={zoom:0,bearing:0,pitch:0,pan:new r.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(let{settings:E}of this._inertiaBuffer)d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround);let _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){let E=zu(d.pan.mag(),_,r.extend({},pc,l||{}));b.offset=d.pan.mult(E.amount/d.pan.mag()),b.center=this._map.transform.center,ku(b,E)}if(d.zoom){let E=zu(d.zoom,_,b_);b.zoom=this._map.transform.zoom+E.amount,ku(b,E)}if(d.bearing){let E=zu(d.bearing,_,_d);b.bearing=this._map.transform.bearing+r.clamp(E.amount,-179,179),ku(b,E)}if(d.pitch){let E=zu(d.pitch,_,Rp);b.pitch=this._map.transform.pitch+E.amount,ku(b,E)}if(b.zoom||b.bearing){let E=d.pinchAround===void 0?d.around:d.pinchAround;b.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function ku(m,l){(!m.duration||m.duration<l.duration)&&(m.duration=l.duration,m.easing=l.easing)}function zu(m,l,d){let{maxSpeed:_,linearity:b,deceleration:E}=d,D=r.clamp(m*b/(l/1e3),-_,_),P=Math.abs(D)/(E*b);return{easing:d.easing,duration:1e3*P,amount:D*(P/2)}}class Yr extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_,b={}){let E=G(d.getCanvasContainer(),_),D=d.unproject(E);super(l,r.extend({point:E,lngLat:D,originalEvent:_},b)),this._defaultPrevented=!1,this.target=d}}class vd extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_){let b=l==="touchend"?_.changedTouches:_.touches,E=le(d.getCanvasContainer(),b),D=E.map(F=>d.unproject(F)),P=E.reduce((F,j,W,ee)=>F.add(j.div(ee.length)),new r.pointGeometry(0,0));super(l,{points:E,point:P,lngLats:D,lngLat:d.unproject(P),originalEvent:_}),this._defaultPrevented=!1}}class Wv extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_){super(l,{originalEvent:_}),this._defaultPrevented=!1}}class w_{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new Wv(l.type,this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new Yr(l.type,this._map,l))}mouseup(l){this._map.fire(new Yr(l.type,this._map,l))}preclick(l){let d=r.extend({},l);d.type="preclick",this._map.fire(new Yr(d.type,this._map,d))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(l),this._map.fire(new Yr(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new Yr(l.type,this._map,l))}mouseover(l){this._map.fire(new Yr(l.type,this._map,l))}mouseout(l){this._map.fire(new Yr(l.type,this._map,l))}touchstart(l){return this._firePreventable(new vd(l.type,this._map,l))}touchmove(l){this._map.fire(new vd(l.type,this._map,l))}touchend(l){this._map.fire(new vd(l.type,this._map,l))}touchcancel(l){this._map.fire(new vd(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xd{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new Yr(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Yr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Yr(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pp{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(z(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;let _=d,b=this._startPos,E=this._lastPos;if(!b||!E||E.equals(_)||!this._box&&_.dist(b)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=A("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));let D=Math.min(b.x,_.x),P=Math.max(b.x,_.x),F=Math.min(b.y,_.y),j=Math.max(b.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${D}px,${F}px)`,this._box.style.width=P-D+"px",this._box.style.height=j-F+"px")})}mouseupWindow(l,d){if(!this._active)return;let _=this._startPos,b=d;if(_&&l.button===0){if(this.reset(),H(),_.x!==b.x||_.y!==b.y)return this._map.fire(new r.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:E=>E.fitScreenCoordinates(_,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),B(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new r.Event(l,{originalEvent:d}))}}function bd(m,l){let d={};for(let _=0;_<m.length;_++)d[m[_].identifier]=l[_];return d}class T_{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){let E=new r.pointGeometry(0,0);for(let D of b)E._add(D);return E.div(b.length)}(d),this.touches=bd(_,d)))}touchmove(l,d,_){if(this.aborted||!this.centroid)return;let b=bd(_,d);for(let E in this.touches){let D=this.touches[E],P=b[E];(!P||P.dist(D)>30)&&(this.aborted=!0)}}touchend(l,d,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){let b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class mc{constructor(l){this.singleTap=new T_(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,d,_){this.singleTap.touchstart(l,d,_)}touchmove(l,d,_){this.singleTap.touchmove(l,d,_)}touchend(l,d,_){let b=this.singleTap.touchend(l,d,_);if(b){let E=l.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(b)<30;if(E&&D||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class kp{constructor(){this._zoomIn=new mc({numTouches:1,numTaps:2}),this._zoomOut=new mc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,_){this._zoomIn.touchstart(l,d,_),this._zoomOut.touchstart(l,d,_)}touchmove(l,d,_){this._zoomIn.touchmove(l,d,_),this._zoomOut.touchmove(l,d,_)}touchend(l,d,_){let b=this._zoomIn.touchend(l,d,_),E=this._zoomOut.touchend(l,d,_);return b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(b)},{originalEvent:l})}):E?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(E)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let E_={0:1,2:2};class wd{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,d){return!1}_move(l,d){return{}}mousedown(l,d){if(this._lastPoint)return;let _=te(l);this._correctButton(l,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(l,d){let _=this._lastPoint;if(_){if(l.preventDefault(),this._eventButton!=null&&function(b,E){let D=E_[E];return b.buttons===void 0||(b.buttons&D)!==D}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}}mouseupWindow(l){this._lastPoint&&te(l)===this._eventButton&&(this._moved&&H(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class S_ extends wd{mousedown(l,d){super.mousedown(l,d),this._lastPoint&&(this._active=!0)}_correctButton(l,d){return d===0&&!l.ctrlKey}_move(l,d){return{around:d,panDelta:d.sub(l)}}}class zp extends wd{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){let _=.8*(d.x-l.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(l){l.preventDefault()}}class Op extends wd{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){let _=-.5*(d.y-l.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(l){l.preventDefault()}}class gc{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),r.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.pointGeometry(0,0)}touchstart(l,d,_){return this._calculateTransform(l,d,_)}touchmove(l,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!r.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,d,_)}}touchend(l,d,_){this._calculateTransform(l,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,_){_.length>0&&(this._active=!0);let b=bd(_,d),E=new r.pointGeometry(0,0),D=new r.pointGeometry(0,0),P=0;for(let j in b){let W=b[j],ee=this._touches[j];ee&&(E._add(W),D._add(W.sub(ee)),P++,b[j]=W)}if(this._touches=b,P<this._minTouches||!D.mag())return;let F=D.div(P);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(P),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=A("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Td{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,d,_){return{}}touchstart(l,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,_){let b=this._firstTwoTouches;if(!b)return;l.preventDefault();let[E,D]=b,P=Ou(_,d,E),F=Ou(_,d,D);if(!P||!F)return;let j=this._aroundCenter?null:P.add(F).div(2);return this._move([P,F],j,l)}touchend(l,d,_){if(!this._firstTwoTouches)return;let[b,E]=this._firstTwoTouches,D=Ou(_,d,b),P=Ou(_,d,E);D&&P||(this._active&&H(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ou(m,l,d){for(let _=0;_<m.length;_++)if(m[_].identifier===d)return l[_]}function A_(m,l){return Math.log(m/l)/Math.LN2}class M_ extends Td{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){let _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(A_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:A_(this._distance,_),pinchAround:d}}}function Np(m,l){return 180*m.angleWith(l)/Math.PI}class I_ extends Td{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){let _=this._vector;if(this._vector=l[0].sub(l[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Np(this._vector,_),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());let d=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;let b=Np(l,_);return Math.abs(b)<d}}function Ed(m){return Math.abs(m.y)>Math.abs(m.x)}class ds extends Td{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Ed(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,_){let b=this._lastPoints;if(!b)return;let E=l[0].sub(b[0]),D=l[1].sub(b[1]);return this._map._cooperativeGestures&&!r.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(E,D,_.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(E.y+D.y)/2*-.5})}gestureBeginsVertically(l,d,_){if(this._valid!==void 0)return this._valid;let b=l.mag()>=2,E=d.mag()>=2;if(!b&&!E)return;if(!b||!E)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;let D=l.y>0==d.y>0;return Ed(l)&&Ed(d)&&D}}let qv={panStep:100,bearingStep:15,pitchStep:10};class C_{constructor(){let l=qv;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,_=0,b=0,E=0,D=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),E=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),E=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),D=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:P=>{let F=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Xv,zoom:d?Math.round(F)+d*(l.shiftKey?2:1):F,bearing:P.getBearing()+_*this._bearingStep,pitch:P.getPitch()+b*this._pitchStep,offset:[-E*this._panStep,-D*this._panStep],center:P.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xv(m){return m*(2-m)}let L_=4.000244140625;class la{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,r.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||r.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=l.deltaMode===r.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,_=r.exported.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%L_==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let d=G(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let d=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){let F=this._type==="wheel"&&Math.abs(this._delta)>L_?this._wheelZoomRate:this._defaultZoomRate,j=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&j!==0&&(j=1/j);let W=d(),ee=Math.pow(2,W),fe=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):ee;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(fe*j))),this._type==="wheel"&&(this._startZoom=W,this._easing=this._smoothOutEasing(200)),this._delta=0}let _=typeof this._targetZoom=="number"?this._targetZoom:d(),b=this._startZoom,E=this._easing,D,P=!1;if(this._type==="wheel"&&b&&E){let F=Math.min((r.exported.now()-this._lastWheelEventTime)/200,1),j=E(F);D=r.number(b,_,j),F<1?this._frameId||(this._frameId=!0):P=!0}else D=_,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:D-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=r.ease;if(this._prevEase){let _=this._prevEase,b=(r.exported.now()-_.start)/_.duration,E=_.easing(b+.01)-_.easing(b),D=.27/Math.sqrt(E*E+1e-4)*.01,P=Math.sqrt(.0729-D*D);d=r.bezier(D,P,.25,1)}return this._prevEase={start:r.exported.now(),duration:l,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=A("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(r.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class D_{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _c{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,d){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(l.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fo{constructor(){this._tap=new mc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,d,_){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(l,d,_))}touchmove(l,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;let b=d[0],E=b.y-this._swipePoint.y;return this._swipePoint=b,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,d,_)}touchend(l,d,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(l,d,_)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sd{constructor(l,d,_){this._el=l,this._mousePan=d,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sn{constructor(l,d,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class R_{constructor(l,d,_,b){this._el=l,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Nu=m=>m.zoom||m.drag||m.pitch||m.rotate;class Fu extends r.Event{}class Bu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,d){let _=r.sub([],d,l);this.radius=r.length(_[2]<0?r.div([],_,this.constants):[_[0],_[1],0])}projectRay(l){r.div(l,l,this.constants),r.normalize(l,l),r.mul$1(l,l,this.constants);let d=r.scale$2([],l,this.radius);if(d[2]>0){let _=r.scale$2([],[0,0,1],r.dot(d,[0,0,1])),b=r.scale$2([],r.normalize([],[d[0],d[1],0]),this.radius),E=r.add([],d,r.scale$2([],r.sub([],r.add([],b,_),d),2));d[0]=E[0],d[1]=E[1]}return d}}function Uu(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class P_{constructor(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yd(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Bu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),r.bindAll(["handleEvent","handleWindowEvent"],this);let _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[r.window.document,"mousemove",{capture:!0}],[r.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[r.window,"blur",void 0]];for(let[b,E,D]of this._listeners)b.addEventListener(E,b===r.window.document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(let[l,d,_]of this._listeners)l.removeEventListener(d,l===r.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(l){let d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new w_(d,l));let b=d.boxZoom=new Pp(d,l);this._add("boxZoom",b);let E=new kp,D=new _c;d.doubleClickZoom=new D_(D,E),this._add("tapZoom",E),this._add("clickZoom",D);let P=new Fo;this._add("tapDragZoom",P);let F=d.touchPitch=new ds(d);this._add("touchPitch",F);let j=new zp(l),W=new Op(l);d.dragRotate=new Sn(l,j,W),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]);let ee=new S_(l),fe=new gc(d,l);d.dragPan=new Sd(_,ee,fe),this._add("mousePan",ee),this._add("touchPan",fe,["touchZoom","touchRotate"]);let Te=new I_,we=new M_;d.touchZoomRotate=new R_(_,we,Te,P),this._add("touchRotate",Te,["touchPan","touchZoom"]),this._add("touchZoom",we,["touchPan","touchRotate"]),this._add("blockableMapEvent",new xd(d));let Se=d.scrollZoom=new la(d,this);this._add("scrollZoom",Se,["mousePan"]);let Me=d.keyboard=new C_;this._add("keyboard",Me);for(let ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[ce]&&d[ce].enable(l[ce])}_add(l,d,_){this._handlers.push({handlerName:l,handler:d,allowed:_}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(let{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(let{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Nu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,d,_){for(let b in l)if(b!==_&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){let d=[];for(let _ of l)this._el.contains(_.target)&&d.push(_);return d}handleEvent(l,d){this._updatingCamera=!0;let _=l.type==="renderFrame",b=_?void 0:l,E={needsRenderFrame:!1},D={},P={},F=l.touches?this._getMapTouches(l.touches):void 0,j=F?le(this._el,F):_?void 0:G(this._el,l);for(let{handlerName:fe,handler:Te,allowed:we}of this._handlers){if(!Te.isEnabled())continue;let Se;this._blockedByActive(P,we,fe)?Te.reset():Te[d||l.type]&&(Se=Te[d||l.type](l,j,F),this.mergeHandlerResult(E,D,Se,fe,b),Se&&Se.needsRenderFrame&&this._triggerRenderFrame()),(Se||Te.isActive())&&(P[fe]=Te)}let W={};for(let fe in this._previousActiveHandlers)P[fe]||(W[fe]=b);this._previousActiveHandlers=P,(Object.keys(W).length||Uu(E))&&(this._changes.push([E,D,W]),this._triggerRenderFrame()),(Object.keys(P).length||Uu(E))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:ee}=E;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))}mergeHandlerResult(l,d,_,b,E){if(!_)return;r.extend(l,_);let D={handlerName:b,originalEvent:_.originalEvent||E};_.zoomDelta!==void 0&&(d.zoom=D),_.panDelta!==void 0&&(d.drag=D),_.pitchDelta!==void 0&&(d.pitch=D),_.bearingDelta!==void 0&&(d.rotate=D)}_applyChanges(){let l={},d={},_={};for(let[b,E,D]of this._changes)b.panDelta&&(l.panDelta=(l.panDelta||new r.pointGeometry(0,0))._add(b.panDelta)),b.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(l.around=b.around),b.aroundCoord!==void 0&&(l.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(l.pinchAround=b.pinchAround),b.noInertia&&(l.noInertia=b.noInertia),r.extend(d,E),r.extend(_,D);this._updateMapTransform(l,d,_),this._changes=[]}_updateMapTransform(l,d,_){let b=this._map,E=b.transform,D=Oe=>[Oe.x,Oe.y,Oe.z];if((Oe=>{let Pe=this._eventsInProgress.drag;return Pe&&!this._handlersById[Pe.handlerName].isActive()})()&&!Uu(l)){let Oe=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",Oe!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&b._stop(!0),!Uu(l))return void this._fireEvents(d,_,!0);let{panDelta:P,zoomDelta:F,bearingDelta:j,pitchDelta:W,around:ee,aroundCoord:fe,pinchAround:Te}=l;E._isCameraConstrained&&(F>0&&(F=0),E._isCameraConstrained=!1),Te!==void 0&&(ee=Te),(F||(Oe=>d.drag&&!this._eventsInProgress.drag)())&&ee&&(this._dragOrigin=D(E.pointCoordinate3D(ee)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",b._stop(!0),ee=ee||b.transform.centerPoint,j&&(E.bearing+=j),W&&(E.pitch+=W),E._updateCameraState();let we=[0,0,0];if(P)if(E.projection.name==="mercator"){let Oe=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(ee).dir),Pe=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(ee.sub(P)).dir);we[0]=Pe[0]-Oe[0],we[1]=Pe[1]-Oe[1]}else{let Oe=E.pointCoordinate(ee);if(E.projection.name==="globe"){P=P.rotate(-E.angle);let Pe=E._pixelsPerMercatorPixel/E.worldSize;we[0]=-P.x*r.mercatorScale(r.latFromMercatorY(Oe.y))*Pe,we[1]=-P.y*r.mercatorScale(E.center.lat)*Pe}else{let Pe=E.pointCoordinate(ee.sub(P));Oe&&Pe&&(we[0]=Pe.x-Oe.x,we[1]=Pe.y-Oe.y)}}let Se=E.zoom,Me=[0,0,0];if(F){let Oe=D(fe||E.pointCoordinate3D(ee)),Pe={dir:r.normalize([],r.sub([],Oe,E._camera.position))};if(Pe.dir[2]<0){let Ue=E.zoomDeltaToMovement(Oe,F);r.scale$2(Me,Pe.dir,Ue)}}let ce=r.add(we,we,Me);E._translateCameraConstrained(ce),F&&Math.abs(E.zoom-Se)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,_,!0)}_fireEvents(l,d,_){let b=Nu(this._eventsInProgress),E=Nu(l),D={};for(let W in l){let{originalEvent:ee}=l[W];this._eventsInProgress[W]||(D[`${W}start`]=ee),this._eventsInProgress[W]=l[W]}!b&&E&&this._fireEvent("movestart",E.originalEvent);for(let W in D)this._fireEvent(W,D[W]);E&&this._fireEvent("move",E.originalEvent);for(let W in l){let{originalEvent:ee}=l[W];this._fireEvent(W,ee)}let P={},F;for(let W in this._eventsInProgress){let{handlerName:ee,originalEvent:fe}=this._eventsInProgress[W];this._handlersById[ee].isActive()||(delete this._eventsInProgress[W],F=d[ee]||fe,P[`${W}end`]=F)}for(let W in P)this._fireEvent(W,P[W]);let j=Nu(this._eventsInProgress);if(_&&(b||E)&&!j){this._updatingCamera=!0;let W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ee=fe=>fe!==0&&-this._bearingSnap<fe&&fe<this._bearingSnap;W?(ee(W.bearing||this._map.getBearing())&&(W.bearing=0),this._map.easeTo(W,{originalEvent:F})):(this._map.fire(new r.Event("moveend",{originalEvent:F})),ee(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new r.Event(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new Fu("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Fp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class k_ extends r.Evented{constructor(l,d){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,r.bindAll(["_renderFrameCallback"],this)}getCenter(){return new r.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,_){return l=r.pointGeometry.convert(l).mult(-1),this.panTo(this.transform.center,r.extend({offset:l},d),_)}panTo(l,d,_){return this.easeTo(r.extend({center:l},d),_)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,_){return this.easeTo(r.extend({zoom:l},d),_)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,_){return this.easeTo(r.extend({bearing:l},d),_)}resetNorth(l,d){return this.rotateTo(0,r.extend({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(r.extend({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=r.LngLatBounds.convert(l);let _=d&&d.bearing||0,b=d&&d.pitch||0,E=l.getNorthWest(),D=l.getSouthEast();return this._cameraForBounds(this.transform,E,D,_,b,d)}_extendCameraOptions(l){let d={top:0,bottom:0,right:0,left:0};if(typeof(l=r.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){let _=l.padding;l.padding={top:_,bottom:_,right:_,left:_}}return l.padding=r.extend(d,l.padding),l}_minimumAABBFrustumDistance(l,d){let _=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return _/b>l.aspect?_/(2*Math.tan(.5*l.fovX)*l.aspect):b/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,d,_,b,E,D){let P=l.clone(),F=this._extendCameraOptions(D);P.bearing=b,P.pitch=E;let j=r.LngLat.convert(d),W=r.LngLat.convert(_),ee=.5*(j.lat+W.lat),fe=.5*(j.lng+W.lng),Te=r.latLngToECEF(ee,fe),we=r.normalize([],Te),Se=r.normalize([],r.cross([],we,[0,1,0])),Me=r.cross([],Se,we),ce=[Se[0],Se[1],Se[2],0,Me[0],Me[1],Me[2],0,we[0],we[1],we[2],0,0,0,0,1],Oe=[Te,r.latLngToECEF(j.lat,j.lng),r.latLngToECEF(W.lat,j.lng),r.latLngToECEF(W.lat,W.lng),r.latLngToECEF(j.lat,W.lng),r.latLngToECEF(ee,j.lng),r.latLngToECEF(ee,W.lng),r.latLngToECEF(j.lat,fe),r.latLngToECEF(W.lat,fe)],Pe=r.Aabb.fromPoints(Oe.map(Nt=>[r.dot(Se,Nt),r.dot(Me,Nt),r.dot(we,Nt)])),Ue=r.transformMat4([],Pe.center,ce);r.squaredLength(Ue)===0&&r.set(Ue,0,0,1),r.normalize(Ue,Ue),r.scale$2(Ue,Ue,r.GLOBE_RADIUS),P.center=r.ecefToLatLng(Ue);let Ze=P.getWorldToCameraMatrix(),je=r.invert(new Float64Array(16),Ze);Pe=r.Aabb.applyTransform(Pe,r.multiply([],Ze,ce)),r.transformMat4(Ue,Ue,Ze);let $e=.5*(Pe.max[2]-Pe.min[2]),it=this._minimumAABBFrustumDistance(P,Pe),dt=r.scale$2([],[0,0,1],$e),mt=r.add(dt,Ue,dt),Qt=it+(P.pitch===0?0:r.distance(Ue,mt)),lt=P.globeCenterInViewSpace,Dt=r.sub([],Ue,[lt[0],lt[1],lt[2]]);r.normalize(Dt,Dt),r.scale$2(Dt,Dt,Qt);let bt=r.add([],Ue,Dt);r.transformMat4(bt,bt,je);let Ut=r.earthRadius/r.GLOBE_RADIUS,ft=r.length(bt),tt=r.mercatorZfromAltitude(Math.max(ft*Ut-r.earthRadius,Number.EPSILON),0),yt=Math.min(P.zoomFromMercatorZAdjusted(tt),F.maxZoom);return yt>.5*(r.GLOBE_ZOOM_THRESHOLD_MIN+r.GLOBE_ZOOM_THRESHOLD_MAX)?(P.setProjection({name:"mercator"}),P.zoom=yt,this._cameraForBounds(P,d,_,b,E,D)):{center:P.center,zoom:yt,bearing:b,pitch:E}}queryTerrainElevation(l,d){let _=this.transform.elevation;return _?(d=r.extend({},{exaggerated:!0},d),_.getAtPoint(r.MercatorCoordinate.fromLngLat(l),null,d.exaggerated)):null}_cameraForBounds(l,d,_,b,E,D){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,d,_,b,E,D);let P=l.clone(),F=this._extendCameraOptions(D),j=P.padding;P.bearing=b,P.pitch=E;let W=r.LngLat.convert(d),ee=r.LngLat.convert(_),fe=new r.LngLat(W.lng,ee.lat),Te=new r.LngLat(ee.lng,W.lat),we=P.project(W),Se=P.project(ee),Me=this.queryTerrainElevation(W),ce=this.queryTerrainElevation(ee),Oe=this.queryTerrainElevation(fe),Pe=this.queryTerrainElevation(Te),Ue=[[we.x,we.y,Math.min(Me||0,ce||0,Oe||0,Pe||0)],[Se.x,Se.y,Math.max(Me||0,ce||0,Oe||0,Pe||0)]],Ze=r.Aabb.fromPoints(Ue),je=P.getWorldToCameraMatrix(),$e=r.invert(new Float64Array(16),je);Ze=r.Aabb.applyTransform(Ze,je);let it=r.sub([],Ze.max,Ze.min),dt=j.left||0,mt=j.right||0,Qt=j.bottom||0,lt=j.top||0,{left:Dt,right:bt,top:Ut,bottom:ft}=F.padding,tt=.5*(dt+mt),yt=.5*(lt+Qt),Nt=Math.min(P.scaleZoom(P.scale*Math.min((P.width-(dt+mt+Dt+bt))/it[0],(P.height-(Qt+lt+ft+Ut))/it[1])),F.maxZoom),jt=P.scale/P.zoomScale(Nt);Ze=new r.Aabb([Ze.min[0]-(Dt+tt)*jt,Ze.min[1]-(ft+yt)*jt,Ze.min[2]],[Ze.max[0]+(bt+tt)*jt,Ze.max[1]+(Ut+yt)*jt,Ze.max[2]]);let zn=.5*it[2],oi=this._minimumAABBFrustumDistance(P,Ze),Mn=[0,0,1,0];r.transformMat4$1(Mn,Mn,je),r.normalize$2(Mn,Mn);let vn=r.scale$2([],Mn,oi+zn),Fn=r.add([],Ze.center,vn),vi=(typeof F.offset.x=="number"&&typeof F.offset.y=="number"?new r.pointGeometry(F.offset.x,F.offset.y):r.pointGeometry.convert(F.offset)).rotate(-r.degToRad(b));Ze.center[0]-=vi.x*jt,Ze.center[1]+=vi.y*jt,r.transformMat4(Ze.center,Ze.center,$e),r.transformMat4(Fn,Fn,$e);let Bn=[Ze.center[0],Ze.center[1],Fn[2]*P.pixelsPerMeter];r.scale$2(Bn,Bn,1/P.worldSize);let Fi=r.lngFromMercatorX(Bn[0]),Wi=r.latFromMercatorY(Bn[1]),tr=Math.min(P._zoomFromMercatorZ(Bn[2]),F.maxZoom),Yi=new r.LngLat(Fi,Wi);return P.mercatorFromTransition&&tr<.5*(r.GLOBE_ZOOM_THRESHOLD_MIN+r.GLOBE_ZOOM_THRESHOLD_MAX)?(P.setProjection({name:"globe"}),P.zoom=tr,this._cameraForBounds(P,d,_,b,E,D)):{center:Yi,zoom:tr,bearing:b,pitch:E}}fitBounds(l,d,_){let b=this.cameraForBounds(l,d);return this._fitInternal(b,d,_)}fitScreenCoordinates(l,d,_,b,E){let D=r.pointGeometry.convert(l),P=r.pointGeometry.convert(d),F=new r.pointGeometry(Math.min(D.x,P.x),Math.min(D.y,P.y)),j=new r.pointGeometry(Math.max(D.x,P.x),Math.max(D.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(D,P))return this;let W=this.transform.pointLocation3D(F),ee=this.transform.pointLocation3D(j),fe=this.transform.pointLocation3D(new r.pointGeometry(F.x,j.y)),Te=this.transform.pointLocation3D(new r.pointGeometry(j.x,F.y)),we=[Math.min(W.lng,ee.lng,fe.lng,Te.lng),Math.min(W.lat,ee.lat,fe.lat,Te.lat)],Se=[Math.max(W.lng,ee.lng,fe.lng,Te.lng),Math.max(W.lat,ee.lat,fe.lat,Te.lat)],Me=b&&b.pitch?b.pitch:this.getPitch(),ce=this._cameraForBounds(this.transform,we,Se,_,Me,b);return this._fitInternal(ce,b,E)}_fitInternal(l,d,_){return l?(delete(d=r.extend(l,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(l,d){this.stop();let _=l.preloadOnly?this.transform.clone():this.transform,b=!1,E=!1,D=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(b=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=r.LngLat.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(E=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(D=!0,_.pitch=+l.pitch),l.padding==null||_.isPaddingEqual(l.padding)||(_.padding=l.padding),l.preloadOnly?(this._preloadTiles(_),this):(this.fire(new r.Event("movestart",d)).fire(new r.Event("move",d)),b&&this.fire(new r.Event("zoomstart",d)).fire(new r.Event("zoom",d)).fire(new r.Event("zoomend",d)),E&&this.fire(new r.Event("rotatestart",d)).fire(new r.Event("rotate",d)).fire(new r.Event("rotateend",d)),D&&this.fire(new r.Event("pitchstart",d)).fire(new r.Event("pitch",d)).fire(new r.Event("pitchend",d)),this.fire(new r.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.warnOnce(Fp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,d){let _=this.transform;if(!_.projection.supportsFreeCamera)return r.warnOnce(Fp),this;this.stop();let b=_.zoom,E=_.pitch,D=_.bearing;_.setFreeCameraOptions(l);let P=b!==_.zoom,F=E!==_.pitch,j=D!==_.bearing;return this.fire(new r.Event("movestart",d)).fire(new r.Event("move",d)),P&&this.fire(new r.Event("zoomstart",d)).fire(new r.Event("zoom",d)).fire(new r.Event("zoomend",d)),j&&this.fire(new r.Event("rotatestart",d)).fire(new r.Event("rotate",d)).fire(new r.Event("rotateend",d)),F&&this.fire(new r.Event("pitchstart",d)).fire(new r.Event("pitch",d)).fire(new r.Event("pitchend",d)),this.fire(new r.Event("moveend",d)),this}easeTo(l,d){this._stop(!1,l.easeId),((l=r.extend({offset:[0,0],duration:500,easing:r.ease},l)).animate===!1||!l.essential&&r.exported.prefersReducedMotion)&&(l.duration=0);let _=this.transform,b=this.getZoom(),E=this.getBearing(),D=this.getPitch(),P=this.getPadding(),F="zoom"in l?+l.zoom:b,j="bearing"in l?this._normalizeBearing(l.bearing,E):E,W="pitch"in l?+l.pitch:D,ee="padding"in l?l.padding:_.padding,fe=r.pointGeometry.convert(l.offset),Te,we,Se;if(_.projection.name==="globe"){let dt=r.MercatorCoordinate.fromLngLat(_.center),mt=fe.rotate(-_.angle);dt.x+=mt.x/_.worldSize,dt.y+=mt.y/_.worldSize;let Qt=dt.toLngLat(),lt=r.LngLat.convert(l.center||Qt);this._normalizeCenter(lt),Te=_.centerPoint.add(mt),we=new r.pointGeometry(dt.x,dt.y).mult(_.worldSize),Se=new r.pointGeometry(r.mercatorXfromLng(lt.lng),r.mercatorYfromLat(lt.lat)).mult(_.worldSize).sub(we)}else{Te=_.centerPoint.add(fe);let dt=_.pointLocation(Te),mt=r.LngLat.convert(l.center||dt);this._normalizeCenter(mt),we=_.project(dt),Se=_.project(mt).sub(we)}let Me=_.zoomScale(F-b),ce,Oe;l.around&&(ce=r.LngLat.convert(l.around),Oe=_.locationPoint(ce));let Pe=this._zooming||F!==b,Ue=this._rotating||E!==j,Ze=this._pitching||W!==D,je=!_.isPaddingEqual(ee),$e=dt=>mt=>{if(Pe&&(dt.zoom=r.number(b,F,mt)),Ue&&(dt.bearing=r.number(E,j,mt)),Ze&&(dt.pitch=r.number(D,W,mt)),je&&(dt.interpolatePadding(P,ee,mt),Te=dt.centerPoint.add(fe)),ce)dt.setLocationAtPoint(ce,Oe);else{let Qt=dt.zoomScale(dt.zoom-b),lt=F>b?Math.min(2,Me):Math.max(.5,Me),Dt=Math.pow(lt,1-mt),bt=dt.unproject(we.add(Se.mult(mt*Dt)).mult(Qt));dt.setLocationAtPoint(dt.renderWorldCopies?bt.wrap():bt,Te)}return l.preloadOnly||this._fireMoveEvents(d),dt};if(l.preloadOnly){let dt=this._emulate($e,l.duration,_);return this._preloadTiles(dt),this}let it={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Pe,this._rotating=Ue,this._pitching=Ze,this._padding=je,this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,it),this._ease($e(_),dt=>{_.recenterOnTerrain(),this._afterEase(d,dt)},l),this}_prepareEase(l,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||_.moving||this.fire(new r.Event("movestart",l)),this._zooming&&!_.zooming&&this.fire(new r.Event("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new r.Event("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new r.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new r.Event("move",l)),this._zooming&&this.fire(new r.Event("zoom",l)),this._rotating&&this.fire(new r.Event("rotate",l)),this._pitching&&this.fire(new r.Event("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let _=this._zooming,b=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new r.Event("zoomend",l)),b&&this.fire(new r.Event("rotateend",l)),E&&this.fire(new r.Event("pitchend",l)),this.fire(new r.Event("moveend",l))}flyTo(l,d){if(!l.essential&&r.exported.prefersReducedMotion){let Nt=r.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Nt,d)}this.stop(),l=r.extend({offset:[0,0],speed:1.2,curve:1.42,easing:r.ease},l);let _=this.transform,b=this.getZoom(),E=this.getBearing(),D=this.getPitch(),P=this.getPadding(),F="zoom"in l?r.clamp(+l.zoom,_.minZoom,_.maxZoom):b,j="bearing"in l?this._normalizeBearing(l.bearing,E):E,W="pitch"in l?+l.pitch:D,ee="padding"in l?l.padding:_.padding,fe=_.zoomScale(F-b),Te=r.pointGeometry.convert(l.offset),we=_.centerPoint.add(Te),Se=_.pointLocation(we),Me=r.LngLat.convert(l.center||Se);this._normalizeCenter(Me);let ce=_.project(Se),Oe=_.project(Me).sub(ce),Pe=l.curve,Ue=Math.max(_.width,_.height),Ze=Ue/fe,je=Oe.mag();if("minZoom"in l){let Nt=r.clamp(Math.min(l.minZoom,b,F),_.minZoom,_.maxZoom),jt=Ue/_.zoomScale(Nt-b);Pe=Math.sqrt(jt/je*2)}let $e=Pe*Pe;function it(Nt){let jt=(Ze*Ze-Ue*Ue+(Nt?-1:1)*$e*$e*je*je)/(2*(Nt?Ze:Ue)*$e*je);return Math.log(Math.sqrt(jt*jt+1)-jt)}function dt(Nt){return(Math.exp(Nt)-Math.exp(-Nt))/2}function mt(Nt){return(Math.exp(Nt)+Math.exp(-Nt))/2}let Qt=it(0),lt=function(Nt){return mt(Qt)/mt(Qt+Pe*Nt)},Dt=function(Nt){return Ue*((mt(Qt)*(dt(jt=Qt+Pe*Nt)/mt(jt))-dt(Qt))/$e)/je;var jt},bt=(it(1)-Qt)/Pe;if(Math.abs(je)<1e-6||!isFinite(bt)){if(Math.abs(Ue-Ze)<1e-6)return this.easeTo(l,d);let Nt=Ze<Ue?-1:1;bt=Math.abs(Math.log(Ze/Ue))/Pe,Dt=function(){return 0},lt=function(jt){return Math.exp(Nt*Pe*jt)}}l.duration="duration"in l?+l.duration:1e3*bt/("screenSpeed"in l?+l.screenSpeed/Pe:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);let Ut=E!==j,ft=W!==D,tt=!_.isPaddingEqual(ee),yt=Nt=>jt=>{let zn=jt*bt,oi=1/lt(zn);Nt.zoom=jt===1?F:b+Nt.scaleZoom(oi),Ut&&(Nt.bearing=r.number(E,j,jt)),ft&&(Nt.pitch=r.number(D,W,jt)),tt&&(Nt.interpolatePadding(P,ee,jt),we=Nt.centerPoint.add(Te));let Mn=jt===1?Me:Nt.unproject(ce.add(Oe.mult(Dt(zn))).mult(oi));return Nt.setLocationAtPoint(Nt.renderWorldCopies?Mn.wrap():Mn,we),Nt._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(d),Nt};if(l.preloadOnly){let Nt=this._emulate(yt,l.duration,_);return this._preloadTiles(Nt),this}return this._zooming=!0,this._rotating=Ut,this._pitching=ft,this._padding=tt,this._prepareEase(d,!1),this._ease(yt(_),()=>this._afterEase(d),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!l){let _=this.handlers;_&&_.stop(!1)}return this}_ease(l,d,_){_.animate===!1||_.duration===0?(l(1),d()):(this._easeStart=r.exported.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let l=Math.min((r.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,d){l=r.wrap(l,-180,180);let _=Math.abs(l-d);return Math.abs(l-360-d)<_&&(l-=360),Math.abs(l+360-d)<_&&(l+=360),l}_normalizeCenter(l){let d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;let _=l.lng-d.center.lng;l.lng+=_>180?-360:_<-180?360:0}_emulate(l,d,_){let b=Math.ceil(15*d/1e3),E=[],D=l(_.clone());for(let P=0;P<=b;P++){let F=D(P/b);E.push(F.clone())}return E}}class Bp{constructor(l={}){this.options=l,r.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){let d=this.options&&this.options.compact;return this._map=l,this._container=A("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=A("button","mapboxgl-ctrl-attrib-button",this._container),A("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=A("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,d){let _=this._map._getUIString(`AttributionControl.${d}`);l.setAttribute("aria-label",_),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));let d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.config.ACCESS_TOKEN}];if(l){let _=d.reduce((b,E,D)=>(E.value&&(b+=`${E.key}=${E.value}${D<d.length-1?"&":""}`),b),"?");l.href=`${r.config.FEEDBACK_URL}/${_}#${Dp(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){let b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}let d=this._map.style._sourceCaches;for(let b in d){let E=d[b];if(E.used){let D=E.getSource();D.attribution&&l.indexOf(D.attribution)<0&&l.push(D.attribution)}}l.sort((b,E)=>b.length-E.length),l=l.filter((b,E)=>{for(let D=E+1;D<l.length;D++)if(l[D].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));let _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Up{constructor(){r.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=A("div","mapboxgl-ctrl");let d=A("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(let d in l){let _=l[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){let l=this._container.children;if(l.length){let d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class Vu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){let d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){let d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(let b of _)if(b.id===l)return void(b.cancelled=!0)}run(l=0){let d=this._currentlyRunning=this._queue;this._queue=[];for(let _ of d)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ad(m,l,d){if(m=new r.LngLat(m.lng,m.lat),l){let _=new r.LngLat(m.lng-360,m.lat),b=new r.LngLat(m.lng+360,m.lat),E=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),D=d.locationPoint(m).distSqr(l),P=l.x<0||l.y<0||l.x>d.width||l.y>d.height;d.locationPoint(_).distSqr(l)<D&&(P||Math.abs(_.lng-d.center.lng)<E)?m=_:d.locationPoint(b).distSqr(l)<D&&(P||Math.abs(b.lng-d.center.lng)<E)&&(m=b)}for(;Math.abs(m.lng-d.center.lng)>180;){let _=d.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}let yc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Md extends r.Evented{constructor(l,d){if(super(),(l instanceof r.window.HTMLElement||d)&&(l=r.extend({element:l},d)),r.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=r.pointGeometry.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=A("div");let b=41,E=27,D=I("svg",{display:"block",height:b*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${b}`},this._element),P=I("radialGradient",{id:"shadowGradient"},I("defs",{},D));I("stop",{offset:"10%","stop-opacity":.4},P),I("stop",{offset:"100%","stop-opacity":.05},P),I("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),I("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),I("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),I("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=r.pointGeometry.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});let _=this._element.classList;for(let b in yc)_.remove(`mapboxgl-marker-anchor-${b}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){let l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=r.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){let d=38.1,_=13.5,b=Math.sqrt(Math.pow(_,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-d],"bottom-left":[b,-1*(d-_+b)],"bottom-right":[-b,-1*(d-_+b)],left:[_,-1*(d-_)],right:[-_,-1*(d-_)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){let d=l.code,_=l.charCode||l.keyCode;d!=="Space"&&d!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(l){let d=l.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let l=this._map,d=this._pos;if(!l||!d)return!1;let _=l.unproject(d),b=l.getFreeCameraOptions();if(!b.position)return!1;let E=b.position.toLngLat();return E.distanceTo(_)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){let l=this._map;if(!l)return;let d=this._pos;if(!d||d.x<0||d.x>l.transform.width||d.y<0||d.y>l.transform.height)return void this._clearFadeTimer();let _=l.unproject(d),b;l._showingGlobe()&&r.isLngLatBehindGlobe(l.transform,this._lngLat)?b=0:(b=1-l._queryFogOpacity(_),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let l=this._pos;if(!l||!this._map)return;let d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${yc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){let l=this._pos,d=this._map,_=this.getPitchAlignment();if(!d||!l||_!=="map")return"";if(!d._showingGlobe()){let F=d.getPitch();return F?`rotateX(${F}deg)`:""}let b=r.radToDeg(r.globeTiltAtLngLat(d.transform,this._lngLat)),E=l.sub(r.globeCenterToScreenPoint(d.transform)),D=Math.abs(E.x)+Math.abs(E.y);if(D===0)return"";let P=b/D;return`rotateX(${-E.y*P}deg) rotateY(${E.x*P}deg)`}_calculateZTransform(){let l=this._pos,d=this._map;if(!d||!l)return"";let _=0,b=this.getRotationAlignment();if(b==="map")if(d._showingGlobe()){let E=d.project(new r.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),D=d.project(new r.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);_=r.radToDeg(Math.atan2(D.y,D.x))-90}else _=-d.getBearing();else if(b==="horizon"){let E=r.smoothstep(4,6,d.getZoom()),D=r.globeCenterToScreenPoint(d.transform);D.y+=E*d.transform.height;let P=l.sub(D),F=r.radToDeg(Math.atan2(P.y,P.x));_=(F>90?F-270:F+90)*(1-E)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(l){r.window.cancelAnimationFrame(this._updateFrameId);let d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Ad(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),l===!0?this._updateFrameId=r.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=r.pointGeometry.convert(l),this._update(),this}_onMove(l){let d=this._map;if(!d)return;let _=this._pointerdownPos,b=this._positionDelta;if(_&&b){if(!this._isDragging){let E=this._clickTolerance||d._clickTolerance;if(l.point.dist(_)<E)return;this._isDragging=!0}this._pos=l.point.sub(b),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.Event("dragstart"))),this.fire(new r.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.Event("dragend")),this._state="inactive"}_addDragHandler(l){let d=this._map,_=this._pos;d&&_&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(_),this._pointerdownPos=l.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;let d=this._map;return d&&(l?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let z_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},O_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Vp(m=new r.pointGeometry(0,0),l="bottom"){if(typeof m=="number"){let d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(l){case"top":return new r.pointGeometry(0,m);case"top-left":return new r.pointGeometry(d,d);case"top-right":return new r.pointGeometry(-d,d);case"bottom":return new r.pointGeometry(0,-m);case"bottom-left":return new r.pointGeometry(d,-d);case"bottom-right":return new r.pointGeometry(-d,-d);case"left":return new r.pointGeometry(m,0);case"right":return new r.pointGeometry(-m,0)}return new r.pointGeometry(0,0)}return m instanceof r.pointGeometry||Array.isArray(m)?r.pointGeometry.convert(m):r.pointGeometry.convert(m[l]||[0,0])}class N_{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;let d=r.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,d,_){this._start=this.getValue(d),this._end=l,this._startTime=d,this._endTime=d+_}}let F_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},B_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Gp={showCompass:!0,showZoom:!0,visualizePitch:!1};class U_{constructor(l,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new zp({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,_&&(this.mousePitch=new Op({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),r.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),z()}move(l,d){let _=this.map,b=this.mouseRotate.mousemoveWindow(l,d),E=b&&b.bearingDelta;if(E&&_.setBearing(_.getBearing()+E),this.mousePitch){let D=this.mousePitch.mousemoveWindow(l,d),P=D&&D.pitchDelta;P&&_.setPitch(_.getPitch()+P)}}off(){let l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){B(),r.window.removeEventListener("mousemove",this.mousemove),r.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(r.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),G(this.element,l)),r.window.addEventListener("mousemove",this.mousemove),r.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,G(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=le(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=le(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let V_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},G_={maxWidth:100,unit:"metric"};function H_(m,l,d){let _=Id(l),b=_/l,E={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[d];this._map._requestDomTask(()=>{this._container.style.width=m*b+"px",this._container.innerHTML=`${_}&nbsp;${E}`})}function Id(m){let l=Math.pow(10,`${Math.floor(m)}`.length-1),d=m/l;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(_){let b=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*b)/b}(d),l*d}let Gu={version:r.version,supported:v,setRTLTextPlugin:r.setRTLTextPlugin,getRTLTextPluginStatus:r.getRTLTextPluginStatus,Map:class extends k_{constructor(m){if(r.LivePerformanceUtils.mark(r.PerformanceMarkers.create),(m=r.extend({},B_,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&r.isSafariWithAntialiasingBug(r.window)&&(m.antialias=!1,r.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new yn(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Vu,this._domRenderTaskQueue=new Vu,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.uniqueId(),this._locale=r.extend({},F_,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new N_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,typeof m.container=="string"){if(this._container=r.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof r.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&r.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),r.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),r.window!==void 0&&(r.window.addEventListener("online",this._onWindowOnline,!1),r.window.addEventListener("resize",this._onWindowResize,!1),r.window.addEventListener("orientationchange",this._onWindowResize,!1),r.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new P_(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new x_(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,r.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Bp({customAttribution:m.customAttribution})),this._logoControl=new Up,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new r.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new r.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(m,l){if(l===void 0&&(l=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let d=m.onAdd(this);this._controls.push(m);let _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let l=this._controls.indexOf(m);return l>-1&&this._controls.splice(l,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let l=!this._moving;return l&&this.fire(new r.Event("movestart",m)).fire(new r.Event("move",m)),this.fire(new r.Event("resize",m)),l&&this.fire(new r.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(r.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?r.window.navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(l=>l==="auto"?r.window.navigator.language:l):m}setLanguage(m){let l=this._parseLanguage(m);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(let d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let m=this.transform,l=m.projection.name,d;l==="globe"&&m.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),d=!0):l==="mercator"&&m.zoom<r.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,l){return this._updateProjection(m||l||{name:"mercator"})}_updateProjection(m){let l;if(l=m.name==="globe"&&this.transform.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(let d in this.style._sourceCaches)this.style._sourceCaches[d].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(r.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(r.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,l,d){if(m==="mouseenter"||m==="mouseover"){let _=!1,b=D=>{let P=l.filter(j=>this.getLayer(j)),F=P.length?this.queryRenderedFeatures(D.point,{layers:P}):[];F.length?_||(_=!0,d.call(this,new Yr(m,this,D.originalEvent,{features:F}))):_=!1},E=()=>{_=!1};return{layers:new Set(l),listener:d,delegates:{mousemove:b,mouseout:E}}}if(m==="mouseleave"||m==="mouseout"){let _=!1,b=D=>{let P=l.filter(F=>this.getLayer(F));(P.length?this.queryRenderedFeatures(D.point,{layers:P}):[]).length?_=!0:_&&(_=!1,d.call(this,new Yr(m,this,D.originalEvent)))},E=D=>{_&&(_=!1,d.call(this,new Yr(m,this,D.originalEvent)))};return{layers:new Set(l),listener:d,delegates:{mousemove:b,mouseout:E}}}{let _=b=>{let E=l.filter(P=>this.getLayer(P)),D=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];D.length&&(b.features=D,d.call(this,b),delete b.features)};return{layers:new Set(l),listener:d,delegates:{[m]:_}}}}on(m,l,d){if(d===void 0)return super.on(m,l);Array.isArray(l)||(l=[l]);let _=this._createDelegatedListener(m,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(let b in _.delegates)this.on(b,_.delegates[b]);return this}once(m,l,d){if(d===void 0)return super.once(m,l);Array.isArray(l)||(l=[l]);let _=this._createDelegatedListener(m,l,d);for(let b in _.delegates)this.once(b,_.delegates[b]);return this}off(m,l,d){if(d===void 0)return super.off(m,l);l=new Set(Array.isArray(l)?l:[l]);let _=(E,D)=>{if(E.size!==D.size)return!1;for(let P of E)if(!D.has(P))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[m]:void 0;return b&&(E=>{for(let D=0;D<E.length;D++){let P=E[D];if(P.listener===d&&_(P.layers,l)){for(let F in P.delegates)this.off(F,P.delegates[F]);return E.splice(D,1),this}}})(b),this}queryRenderedFeatures(m,l){return this.style?(l!==void 0||m===void 0||m instanceof r.pointGeometry||Array.isArray(m)||(l=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(m,l){return this.style.querySourceFeatures(m,l)}setStyle(m,l){return(l=r.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(m,l))}_getUIString(m){let l=this._locale[m];if(l==null)throw new Error(`Missing UI string '${m}'`);return l}_updateStyle(m,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new so(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new so(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,l){if(typeof m=="string"){let d=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(d,r.ResourceType.Style);r.getJSON(_,(b,E)=>{b?this.fire(new r.ErrorEvent(b)):E&&this._updateDiff(E,l)})}else typeof m=="object"&&this._updateDiff(m,l)}_updateDiff(m,l){try{this.style.setState(m)&&this._update(!0)}catch(d){r.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(m,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.warnOnce("There is no style added to the map."),!1)}addSource(m,l){return this._lazyInitEmptyStyle(),this.style.addSource(m,l),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){let m=this.style&&this.style._sourceCaches;for(let l in m){let d=m[l]._tiles;for(let _ in d){let b=d[_];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}addSourceType(m,l,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,l,d)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,l,{pixelRatio:d=1,sdf:_=!1,stretchX:b,stretchY:E,content:D}={}){if(this._lazyInitEmptyStyle(),l instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&l instanceof r.window.ImageBitmap){let{width:P,height:F,data:j}=r.exported.getImageData(l);this.style.addImage(m,{data:new r.RGBAImage({width:P,height:F},j),pixelRatio:d,stretchX:b,stretchY:E,content:D,sdf:_,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:P,height:F}=l,j=l;this.style.addImage(m,{data:new r.RGBAImage({width:P,height:F},new Uint8Array(j.data)),pixelRatio:d,stretchX:b,stretchY:E,content:D,sdf:_,version:0,userImage:j}),j.onAdd&&j.onAdd(this,m)}}updateImage(m,l){let d=this.style.getImage(m);if(!d)return void this.fire(new r.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=l instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&l instanceof r.window.ImageBitmap?r.exported.getImageData(l):l,{width:b,height:E}=_;b!==void 0&&E!==void 0?b===d.data.width&&E===d.data.height?(d.data.replace(_.data,!(l instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&l instanceof r.window.ImageBitmap)),this.style.updateImage(m,d)):this.fire(new r.ErrorEvent(new Error(`The width and height of the updated image (${b}, ${E})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`))):this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new r.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,l){r.getImage(this._requestManager.transformRequest(m,r.ResourceType.Image),(d,_)=>{l(d,_ instanceof r.window.HTMLImageElement?r.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,l){return this._lazyInitEmptyStyle(),this.style.addLayer(m,l),this._update(!0)}moveLayer(m,l){return this.style.moveLayer(m,l),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,l,d){return this.style.setLayerZoomRange(m,l,d),this._update(!0)}setFilter(m,l,d={}){return this.style.setFilter(m,l,d),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,l,d,_={}){return this.style.setPaintProperty(m,l,d,_),this._update(!0)}getPaintProperty(m,l){return this.style.getPaintProperty(m,l)}setLayoutProperty(m,l,d,_={}){return this.style.setLayoutProperty(m,l,d,_),this._update(!0)}getLayoutProperty(m,l){return this.style.getLayoutProperty(m,l)}setLight(m,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.LngLat.convert(m),this.transform):0}setFeatureState(m,l){return this.style.setFeatureState(m,l),this._update()}removeFeatureState(m,l){return this.style.removeFeatureState(m,l),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;let m=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300,d,_,b,E=this._container;for(;E&&(!_||!b);){let D=r.window.getComputedStyle(E).transform;D&&D!=="none"&&(d=D.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(_=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(b=d[3])),E=E.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=b?Math.abs(l/b):l}_detectMissingCSS(){r.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=A("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();let l=this._canvasContainer=A("div","mapboxgl-canvas-container",m);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=A("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let d=this._controlContainer=A("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=A("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,l){let d=r.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(l),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${l}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){let l=this._markers.indexOf(m);l!==-1&&this._markers.splice(l,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){let l=this._popups.indexOf(m);l!==-1&&this._popups.splice(l,1)}_setupPainter(){let m=r.extend({},v.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._useWebGL2&&this._canvas.getContext("webgl2",m),d=l||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);d?(this._useWebGL2&&!l&&r.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),r.storeAuthState(d,!0),this.painter=new Lu(d,this.transform,!!l),this.on("data",_=>{_.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.exported$1.testSupport(d)):this.fire(new r.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new r.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let l,d=this.painter.context.extTimerQuery,_=r.exported.now();if(this.listens("gpu-timing-frame")&&(l=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],r.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],r.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();let b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let P=this.transform.zoom,F=this.transform.pitch,j=r.exported.now(),W=new r.EvaluationParameters(P,{now:j,fadeDuration:b,pitch:F,transition:this.style.getTransition()});this.style.update(W)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){let P=r.exported.now()-_;d.endQueryEXT(d.TIME_ELAPSED_EXT,l),setTimeout(()=>{let F=d.getQueryObjectEXT(l,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(l),this.fire(new r.Event("gpu-timing-frame",{cpuTime:P,gpuTime:F})),r.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:F}})},50)}if(this.listens("gpu-timing-layer")){let P=this.painter.collectGpuTimers();setTimeout(()=>{let F=this.painter.queryGpuTimers(P);this.fire(new r.Event("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){let P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let F=this.painter.queryGpuTimeDeferredRender(P);this.fire(new r.Event("gpu-timing-deferred-render",{gpuTime:F}))},50)}let D=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(D||this._repaint)this.triggerRepaint();else{let P=!this.isMoving()&&this.loaded();if(P&&(E=this._updateAverageElevation(_,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new r.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let F=this._calculateSpeedIndex();this.fire(new r.Event("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,r.LivePerformanceUtils.mark(r.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&r.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(let l of this._markers)m&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(let l of this._popups)!m||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(m,l=!1){let d=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);if((l||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){let _=this.transform.averageElevation,b=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=m;let D=Math.abs(_-b);if(D>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,m,300)}else if(D>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){r.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===r.AUTH_ERR_MSG||m.status===401)){let l=this.painter.context.gl;r.storeAuthState(l,!1),this._logoControl instanceof Up&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){let m=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());let d=this.painter.context.gl,_=d.createFramebuffer();function b(E){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,E,0);let D=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,D),D}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(b(m),l.canvasCopies.map(b),l.timeStamps)}_canvasPixelComparison(m,l,d){let _=d[1]-d[0],b=m.length/4;for(let E=0;E<l.length;E++){let D=l[E],P=0;for(let F=0;F<D.length;F+=4)D[F]===m[F]&&D[F+1]===m[F+1]&&D[F+2]===m[F+2]&&D[F+3]===m[F+3]&&(P+=1);_+=(d[E+2]-d[E+1])*(1-P/b)}return _}remove(){this._hash&&this._hash.remove();for(let l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),r.window!==void 0&&(r.window.removeEventListener("resize",this._onWindowResize,!1),r.window.removeEventListener("orientationchange",this._onWindowResize,!1),r.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.removeEventListener("online",this._onWindowOnline,!1),r.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));let m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new r.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=r.exported.frame(l=>{let d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(l)}))}_preloadTiles(m){let l=this.style?Object.values(this.style._sourceCaches):[];return r.asyncAll(l,(d,_)=>d._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){r.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,l){r.setCacheLimits(m,l)}get version(){return r.version}},NavigationControl:class{constructor(m){this.options=r.extend({},Gp,m),this._container=A("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(r.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),A("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),A("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{let d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:l}):d.resetNorth({},{originalEvent:l}))}),this._compassIcon=A("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let m=this._map;if(!m)return;let l=m.getZoom(),d=l===m.getMaxZoom(),_=l===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){let m=this._map;if(!m)return;let l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new U_(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){let m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,l){let d=A("button",m,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(m,l){if(!this._map)return;let d=this._map._getUIString(`NavigationControl.${l}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends r.Evented{constructor(m){super(),this.options=r.extend({geolocation:r.window.navigator.geolocation},V_,m),r.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=oo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=A("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){let l=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,m(d)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):r.window.navigator.permissions!==void 0?r.window.navigator.permissions.query({name:"geolocation"}).then(d=>l(d.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(m){let l=this._map.getMaxBounds(),d=m.coords;return!!l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new r.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("geolocate",m)),this._finish()}}_updateCamera(m){let l=new r.LngLat(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,_=this._map.getBearing(),b=r.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(d),b,{geolocateSource:!0})}_updateMarker(m){if(m){let l=new r.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let m=this._map.transform,l=r.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,d=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=A("button","mapboxgl-ctrl-geolocate",this._container),A("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){r.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{let l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=A("div","mapboxgl-user-location"),this._dotElement.appendChild(A("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(A("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Md({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=A("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Md({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let m=()=>{r.window.addEventListener("ondeviceorientationabsolute"in r.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};r.window.DeviceMotionEvent!==void 0&&typeof r.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),r.window.removeEventListener("deviceorientation",this._onDeviceOrientation),r.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Bp,ScaleControl:class{constructor(m){this.options=r.extend({},G_,m),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch(l){return!1}}()||(this._setScale=H_.bind(this)),r.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let m=this.options.maxWidth||100,l=this._map,d=l._containerHeight/2,_=l._containerWidth/2-m/2,b=l.unproject([_,d]),E=l.unproject([_+m,d]),D=b.distanceTo(E);if(this.options.unit==="imperial"){let P=3.2808*D;P>5280?this._setScale(m,P/5280,"mile"):this._setScale(m,P,"foot")}else this.options.unit==="nautical"?this._setScale(m,D/1852,"nautical-mile"):D>=1e3?this._setScale(m,D/1e3,"kilometer"):this._setScale(m,D,"meter")}_setScale(m,l,d){let _=Id(l),b=_/l;this._map._requestDomTask(()=>{this._container.style.width=m*b+"px",this._container.innerHTML=d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:d}).format(_):`${_}&nbsp;nm`})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=A("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof r.window.HTMLElement?this._container=m.container:r.warnOnce("Full screen control 'container' must be a DOM element.")),r.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in r.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in r.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=A("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,r.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!r.window.document.fullscreenEnabled&&!r.window.document.webkitFullscreenEnabled)}_setupUI(){let m=this._fullscreenButton=A("button","mapboxgl-ctrl-fullscreen",this._controlContainer);A("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),r.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(r.window.document.fullscreenElement||r.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?r.window.document.exitFullscreen?r.window.document.exitFullscreen():r.window.document.webkitCancelFullScreen&&r.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.Evented{constructor(m){super(),this.options=r.extend(Object.create(z_),m),r.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new r.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new r.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=r.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();let l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(r.window.document.createTextNode(m))}setHTML(m){let l=r.window.document.createDocumentFragment(),d=r.window.document.createElement("body"),_;for(d.innerHTML=m;_=d.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=A("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(m),this.options.closeButton){let d=this._closeButton=A("button","mapboxgl-popup-close-button",l);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let l;return this._classList.delete(m)?l=!1:(this._classList.add(m),l=!0),this._updateClassList(),l}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;let l=this._map,d=this._container,_=this._pos;if(!l||!d||!_)return"bottom";let b=d.offsetWidth,E=d.offsetHeight,D=_.x<b/2,P=_.x>l.transform.width-b/2;if(_.y+m<E)return D?"top-left":P?"top-right":"top";if(_.y>l.transform.height-E){if(D)return"bottom-left";if(P)return"bottom-right"}return D?"left":P?"right":"bottom"}_updateClassList(){let m=this._container;if(!m)return;let l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),m.className=l.join(" ")}_update(m){let l=this._map,d=this._content;if(!l||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=A("div","mapboxgl-popup",l.getContainer()),this._tip=A("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ad(this._lngLat,this._pos,l.transform)),!this._trackPointer||m){let b=this._pos=this._trackPointer&&m?m:l.project(this._lngLat),E=Vp(this.options.offset),D=this._anchor=this._getAnchor(E.y),P=Vp(this.options.offset,D),F=b.add(P).round();l._requestDomTask(()=>{this._container&&D&&(this._container.style.transform=`${yc[D]} translate(${F.x}px,${F.y}px)`)})}if(!this._marker&&l._showingGlobe()){let b=r.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let m=this._container.querySelector(O_);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Md,Style:so,LngLat:r.LngLat,LngLatBounds:r.LngLatBounds,Point:r.pointGeometry,MercatorCoordinate:r.MercatorCoordinate,FreeCameraOptions:md,Evented:r.Evented,config:r.config,prewarm:function(){In().acquire(Jt)},clearPrewarmedResources:function(){let m=cn;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Jt),cn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return r.config.ACCESS_TOKEN},set accessToken(m){r.config.ACCESS_TOKEN=m},get baseApiUrl(){return r.config.API_URL},set baseApiUrl(m){r.config.API_URL=m},get workerCount(){return Ht.workerCount},set workerCount(m){Ht.workerCount=m},get maxParallelImageRequests(){return r.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){r.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){r.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:r.exported.setNow,restoreNow:r.exported.restoreNow};return Gu});var p=c;return p})}),fl=rG;import.meta.env=Dl;var yL="pk.eyJ1IjoicXVhZHdlYXRoZXIiLCJhIjoiY2w1cnByYzR2MDF1bjNkbGVwZ3Z1NDhndiJ9.gy64c7E23bqmiNncsiYR3g";m1!="null"&&(yL=m1);fl.accessToken=yL;var tc={};tc.fsSource=`
    precision mediump float;
    varying float color;
    uniform sampler2D u_texture;
    uniform float u_min;
    uniform float u_max;
    uniform float u_opacity;

    void main() {
        float calcolor = (color-u_min)/(u_max - u_min);
        vec4 color = texture2D(u_texture,vec2(min(max(calcolor,0.0),1.0),0.0)).xyzw;
        //if below threshold, don't render (make transparent)
        gl_FragColor = vec4(color.x*u_opacity, color.y*u_opacity, color.z*u_opacity, color.w*u_opacity*step(0.0, calcolor));
    }
`;tc.fsSourceFramebuffer=`
    precision highp float;
    varying float color;
    uniform float u_min;
    uniform float u_max;

    vec4 EncodeFloatRGBA( float v ) {
        vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;
        enc = fract(enc);
        enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);
        return enc;
    }

    void main() {
        vec4 encoded;

        //get on 0-1 scale
        float calcolor = min(1.0, max((color - u_min)/(u_max - u_min), 0.0));

        //if upper end, need this check because [0,1)
        if (abs(calcolor - 1.0) < 0.00001) {
            encoded = vec4(1.0,0.0,0.0,1.0);
        } else {
            encoded = EncodeFloatRGBA(calcolor);
            encoded.a = 1.0;
        }
       
        gl_FragColor = encoded;

    }

`;tc.vsSource=`
    //x: azimuth
    //y: range
    //z: value
    attribute vec3 aPosition;
    attribute float aColor;
    
    uniform mat4 u_matrix;
    varying float color;

    void main() {
        color = aPosition.z;
        gl_Position = u_matrix * vec4(aPosition.x,aPosition.y,0.0,1.0);
    }
`;tc.instancedVsSource=`
precision highp float;

attribute vec2 a_position;
attribute vec3 a_row1;
attribute vec3 a_row2;
attribute float a_color;
uniform vec2 u_radarLocation;
uniform mat4 u_matrix;

varying float color;

void main() {

    mat3 translation_matrix = mat3(
        a_row1.x, a_row2.x, 0, 
        a_row1.y, a_row2.y, 0, 
        a_row1.z, a_row2.z, 1
    );

    vec3 outPos = translation_matrix * vec3(a_position.x - u_radarLocation.x, a_position.y - u_radarLocation.y, 1.0);

    color = a_color;

    gl_Position = u_matrix * vec4(outPos.x, outPos.y, 0.0, 1.0);

}

`;tc.instancedFsSource=`
    precision highp float;
    uniform sampler2D u_texture;
    uniform float u_min;
    uniform float u_max;
    uniform float u_opacity;

    varying float color;

    void main() {

       

        float calcolor = (color-u_min)/(u_max - u_min);
        vec4 color = texture2D(u_texture,vec2(min(max(calcolor,0.0),1.0),0.0)).xyzw;
        //if below threshold, don't render (make transparent)
        gl_FragColor = vec4(color.x*u_opacity, color.y*u_opacity, color.z*u_opacity, color.w*u_opacity*step(0.0, calcolor));
    }
`;function sG(i,e){var t=i.getCenter(),s=i.getZoom(),c=i.getBearing(),h=i.getPitch();e.forEach(function(p){p.jumpTo({center:t,zoom:s,bearing:c,pitch:h})})}function oG(){var i,e=arguments.length;if(e===1)i=arguments[0];else{i=[];for(var t=0;t<e;t++)i.push(arguments[t])}var s=[];i.forEach(function(r,x){s[x]=p.bind(null,r,i.filter(function(v,w){return w!==x}))});function c(){i.forEach(function(r,x){r.on("move",s[x])})}function h(){i.forEach(function(r,x){r.off("move",s[x])})}function p(r,x){h(),sG(r,x),c()}return c(),function(){h(),s=[]}}var vL=oG;function aG(i){let e;return{c(){e=Ie("canvas"),Z(e,"class","svelte-80k2l0")},m(t,s){Gt(t,e,s),i[3](e)},p:Vn,i:Vn,o:Vn,d(t){t&&Bt(e),i[3](null)}}}function lG(i,e,t){let s;It(i,Xo,R=>t(2,s=R));let{REFLECTIVITY:c,VELOCITY:h,VELOCITY_DEALIASED:p}=yo,{field:r}=e,x,v,w;function S(){r===void 0||v===void 0||(r===c&&s!="unsupported"?w.render(s.br.all[s.br.current]):v.render(r))}function A(){r===c&&s!="unsupported"&&w.render(s.br.all[s.br.current])}Zs(()=>{v=cM(x),w=lM(x),!(r===void 0||r===c)&&v.render(r)});function I(R){wi[R?"unshift":"push"](()=>{x=R,t(0,x)})}return i.$$set=R=>{"field"in R&&t(1,r=R.field)},i.$$.update=()=>{if(i.$$.dirty&2){e:S()}if(i.$$.dirty&4){e:A()}},[x,r,s,I]}var xL=class extends gi{constructor(e){super();Ti(this,e,lG,aG,ai,{field:1})}},bL=xL;function wL(i,e,t){let s=i.slice();return s[35]=e[t],s}function TL(i){let e,t=i[35].text+"",s,c,h;return{c(){e=Ie("option"),s=On(t),c=ot(),e.__value=h=i[35].value,e.value=e.__value},m(p,r){Gt(p,e,r),Q(e,s),Q(e,c)},p(p,r){r[0]&64&&t!==(t=p[35].text+"")&&si(s,t),r[0]&64&&h!==(h=p[35].value)&&(e.__value=h,e.value=e.__value)},d(p){p&&Bt(e)}}}function SL(i){let e,t=i[2]&&i[3]&&i[9]===i[10]&&EL(i);return{c(){e=Ie("div"),t&&t.c(),Z(e,"class","right svelte-1g8phpe")},m(s,c){Gt(s,e,c),t&&t.m(e,null)},p(s,c){s[2]&&s[3]&&s[9]===s[10]?t?t.p(s,c):(t=EL(s),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},d(s){s&&Bt(e),t&&t.d()}}}function EL(i){let e,t,s,c,h,p,r=(i[2]?" "+i[2].toFixed(1)+" km":"")+"",x,v,w,S=(i[1]===void 0||isNaN(i[1])?"":`${i[1]} ${i[4]>-1?i[11][i[4]]:""}`)+"",A;return{c(){e=Ie("table"),t=Ie("tbody"),s=Ie("tr"),s.innerHTML=`<th class="file svelte-1g8phpe">Beam Height</th> 
                                <th class="vcp svelte-1g8phpe">Gate Value</th>`,c=ot(),h=Ie("tr"),p=Ie("td"),x=On(r),v=ot(),w=Ie("td"),A=On(S),Z(s,"class","svelte-1g8phpe"),Z(p,"class","content file svelte-1g8phpe"),Z(w,"class","content vcp svelte-1g8phpe"),Z(h,"class","svelte-1g8phpe"),Z(e,"class","svelte-1g8phpe")},m(I,R){Gt(I,e,R),Q(e,t),Q(t,s),Q(t,c),Q(t,h),Q(h,p),Q(p,x),Q(h,v),Q(h,w),Q(w,A)},p(I,R){R[0]&4&&r!==(r=(I[2]?" "+I[2].toFixed(1)+" km":"")+"")&&si(x,r),R[0]&18&&S!==(S=(I[1]===void 0||isNaN(I[1])?"":`${I[1]} ${I[4]>-1?I[11][I[4]]:""}`)+"")&&si(A,S)},d(I){I&&Bt(e)}}}function ML(i){let e,t,s=i[2]&&i[3]&&i[9]===i[10]&&AL(i);return{c(){e=Ie("div"),s&&s.c(),Z(e,"class",t="right "+(i[7]==="horizontal"?"":"right-vertical")+" svelte-1g8phpe")},m(c,h){Gt(c,e,h),s&&s.m(e,null)},p(c,h){c[2]&&c[3]&&c[9]===c[10]?s?s.p(c,h):(s=AL(c),s.c(),s.m(e,null)):s&&(s.d(1),s=null),h[0]&128&&t!==(t="right "+(c[7]==="horizontal"?"":"right-vertical")+" svelte-1g8phpe")&&Z(e,"class",t)},d(c){c&&Bt(e),s&&s.d()}}}function AL(i){let e,t,s,c,h,p,r,x=(i[2]?" "+i[2].toFixed(1)+" km":"")+"",v,w,S,A=(i[1]===void 0||isNaN(i[1])?"":`${i[1]} ${i[4]>-1?i[11][i[4]]:""}`)+"",I;return{c(){e=Ie("div"),t=Ie("table"),s=Ie("tbody"),c=Ie("tr"),c.innerHTML=`<th class="file svelte-1g8phpe">Beam Height</th> 
                                <th class="vcp svelte-1g8phpe">Gate Value</th>`,h=ot(),p=Ie("tr"),r=Ie("td"),v=On(x),w=ot(),S=Ie("td"),I=On(A),Z(c,"class","svelte-1g8phpe"),Z(r,"class","content file svelte-1g8phpe"),Z(S,"class","content vcp svelte-1g8phpe"),Z(p,"class","svelte-1g8phpe"),Z(t,"class","svelte-1g8phpe"),Z(e,"class","table-padding svelte-1g8phpe")},m(R,k){Gt(R,e,k),Q(e,t),Q(t,s),Q(s,c),Q(s,h),Q(s,p),Q(p,r),Q(r,v),Q(p,w),Q(p,S),Q(S,I)},p(R,k){k[0]&4&&x!==(x=(R[2]?" "+R[2].toFixed(1)+" km":"")+"")&&si(v,x),k[0]&18&&A!==(A=(R[1]===void 0||isNaN(R[1])?"":`${R[1]} ${R[4]>-1?R[11][R[4]]:""}`)+"")&&si(I,A)},d(R){R&&Bt(e)}}}function cG(i){let e,t,s,c,h,p,r,x=(i[5]?`${i[5].station} ${i[5].elevation}° elevation | VCP ${i[5].vcp}`:"")+"",v,w,S,A=(i[5]?i[5].date.toUTCString().replace("GMT","UTC"):"")+"",I,R,k,L,z,B,$,H,G,le=i[6],te=[];for(let se=0;se<le.length;se+=1)te[se]=TL(wL(i,le,se));let ue=(i[7]==="horizontal"||i[8]!=Er)&&SL(i);z=new bL({props:{field:i[0]}});let me=i[7]==="vertical"&&i[8]===Er&&ML(i);return{c(){e=Ie("div"),t=Ie("div"),s=Ie("div"),c=Ie("select");for(let se=0;se<te.length;se+=1)te[se].c();h=ot(),p=Ie("div"),r=Ie("p"),v=On(x),w=ot(),S=Ie("p"),I=On(A),R=ot(),ue&&ue.c(),k=ot(),L=Ie("div"),mr(z.$$.fragment),B=ot(),me&&me.c(),Z(c,"class","s svelte-1g8phpe"),i[4]===void 0&&_a(()=>i[15].call(c)),Z(r,"class","metap svelte-1g8phpe"),Z(S,"class","metap svelte-1g8phpe"),Z(p,"class","meta svelte-1g8phpe"),Z(s,"class","left svelte-1g8phpe"),Z(t,"class","barContainer svelte-1g8phpe"),Z(L,"class","colorbar svelte-1g8phpe"),Z(e,"class","main-container svelte-1g8phpe")},m(se,Y){Gt(se,e,Y),Q(e,t),Q(t,s),Q(s,c);for(let ye=0;ye<te.length;ye+=1)te[ye].m(c,null);ih(c,i[4]),Q(s,h),Q(s,p),Q(p,r),Q(r,v),Q(p,w),Q(p,S),Q(S,I),Q(t,R),ue&&ue.m(t,null),Q(e,k),Q(e,L),dr(z,L,null),Q(L,B),me&&me.m(L,null),$=!0,H||(G=[mn(c,"change",i[15]),mn(c,"change",i[12])],H=!0)},p(se,Y){if(Y[0]&64){le=se[6];let Xe;for(Xe=0;Xe<le.length;Xe+=1){let ge=wL(se,le,Xe);te[Xe]?te[Xe].p(ge,Y):(te[Xe]=TL(ge),te[Xe].c(),te[Xe].m(c,null))}for(;Xe<te.length;Xe+=1)te[Xe].d(1);te.length=le.length}Y[0]&80&&ih(c,se[4]),(!$||Y[0]&32)&&x!==(x=(se[5]?`${se[5].station} ${se[5].elevation}° elevation | VCP ${se[5].vcp}`:"")+"")&&si(v,x),(!$||Y[0]&32)&&A!==(A=(se[5]?se[5].date.toUTCString().replace("GMT","UTC"):"")+"")&&si(I,A),se[7]==="horizontal"||se[8]!=Er?ue?ue.p(se,Y):(ue=SL(se),ue.c(),ue.m(t,null)):ue&&(ue.d(1),ue=null);let ye={};Y[0]&1&&(ye.field=se[0]),z.$set(ye),se[7]==="vertical"&&se[8]===Er?me?me.p(se,Y):(me=ML(se),me.c(),me.m(L,null)):me&&(me.d(1),me=null)},i(se){$||(ri(z.$$.fragment,se),$=!0)},o(se){mi(z.$$.fragment,se),$=!1},d(se){se&&Bt(e),Is(te,se),ue&&ue.d(),fr(z),me&&me.d(),H=!1,cr(G)}}}function uG(i,e,t){let s,c,h,p,r,x,v;It(i,_i,pe=>t(14,s=pe)),It(i,ni,pe=>t(16,c=pe)),It(i,qr,pe=>t(17,h=pe)),It(i,kl,pe=>t(18,p=pe)),It(i,Ea,pe=>t(7,r=pe)),It(i,$r,pe=>t(8,x=pe)),It(i,Xr,pe=>t(9,v=pe));let{DEALIASED:w,RAW:S}=Ka,{READING:A}=vs,{REFLECTIVITY:I,VELOCITY:R,VELOCITY_DEALIASED:k,CC:L,PHI:z,ZDR:B,SW:$}=yo,H=bo(),G=Lo(),le,{mouseoverValue:te}=e,{field:ue}=e,{idx:me}=e,{height:se}=e,{over:Y}=e,ye,Xe;s[me]&&s[me].type?ye=s[me].type:(ye=-1,Xe=[{value:-1,text:"No Scan Selected"}]);let ge={0:"dBZ",1:"kt",9:"",10:"deg km-1",5:"dB",2:"kt"},re=[0,1,9,10,2,5],ve={0:"Reflectivity",1:"Velocity",2:"Spectrum Width",5:"Differential Reflectivity",9:"Correlation Coefficient",10:"Specific Differential Phase"},ae={0:I,1:R,9:L,10:z,5:B,2:$};function de(pe){ye===1&&p===w?t(0,ue=k):t(0,ue=ae[ye]),G("message",{value:"setField",idx:me,field:ue}),on(qr,h[me].field=ue,h),H.logStore(s[me].scan)}function xe(){if(!s[me]||!s[me].scan)return;let pe=s[me].scan.scan,xt=[];for(let Qe=0;Qe<pe.length;Qe++){let zt=pe[Qe].fields;for(let Zt=0;Zt<zt.length;Zt++)xt.push(zt[Zt])}let Ct=new Set(xt),ct=Array.from(Ct).sort(function(Qe,zt){return Qe-zt});t(6,Xe=ct.map(Qe=>({value:Qe,text:ve[Qe]})).filter(Qe=>re.indexOf(Qe.value)>=0)),h[me]!==void 0&&(h[me].field===k||h[me].field===R?t(4,ye=1):t(4,ye=s[me].type))}function De(pe,xt){if(s[me]===void 0||s[me].scan===null)return;let Ct,ct,Qe,zt=s[me].scan.scan,Zt=s[me].scan.station?s[me].scan.station:"";Qe=s[me].file===void 0||c[s[me].file]===void 0?"":c[s[me].file].vcp;for(let Lt=0;Lt<zt.length;Lt++)if(zt[Lt].fields.indexOf(pe)>-1){Ct=zt[Lt].date,ct=zt[Lt].elevation.toFixed(1);break}if(Ct)return{date:Ct,elevation:ct,station:Zt,vcp:Qe}}function Ce(){ye=Em(this),t(4,ye),t(6,Xe)}return i.$$set=pe=>{"mouseoverValue"in pe&&t(1,te=pe.mouseoverValue),"field"in pe&&t(0,ue=pe.field),"idx"in pe&&t(13,me=pe.idx),"height"in pe&&t(2,se=pe.height),"over"in pe&&t(3,Y=pe.over)},i.$$.update=()=>{if(i.$$.dirty[0]&16384){e:xe()}if(i.$$.dirty[0]&16400){e:t(5,le=De(ye,s))}},[ue,te,se,Y,ye,le,Xe,r,x,v,A,ge,de,me,s,Ce]}var IL=class extends gi{constructor(e){super();Ti(this,e,uG,cG,ai,{mouseoverValue:1,field:0,idx:13,height:2,over:3},null,[-1,-1])}},CL=IL;function LL(i,{delay:e=0,duration:t=400,easing:s=Qx}={}){let c=+getComputedStyle(i).opacity;return{delay:e,duration:t,easing:s,css:h=>`opacity: ${h*c}`}}function DL(i){let e,t,s;return{c(){e=Ie("p"),t=On(i[5]),Z(e,"class","desc svelte-nzajvy")},m(c,h){Gt(c,e,h),Q(e,t)},p(c,h){h&32&&si(t,c[5])},i(c){s||_a(()=>{s=c1(e,LL,{duration:300}),s.start()})},o:Vn,d(c){c&&Bt(e)}}}function RL(i){let e,t,s,c,h=`${i[4]+1}/${i[0].length}`,p,r,x,v,w;return{c(){e=Ie("div"),t=Ie("button"),t.innerHTML='<span class="arrow svelte-nzajvy">‹</span>',s=ot(),c=Ie("div"),p=On(h),r=ot(),x=Ie("button"),x.innerHTML='<span class="arrow svelte-nzajvy">›</span>',Z(t,"class","arrowbutton left svelte-nzajvy"),Z(c,"class","num svelte-nzajvy"),Z(x,"class","arrowbutton right svelte-nzajvy"),Z(e,"class","footer svelte-nzajvy")},m(S,A){Gt(S,e,A),Q(e,t),Q(e,s),Q(e,c),Q(c,p),Q(e,r),Q(e,x),v||(w=[mn(t,"click",i[7]),mn(x,"click",i[8])],v=!0)},p(S,A){A&17&&h!==(h=`${S[4]+1}/${S[0].length}`)&&si(p,h)},d(S){S&&Bt(e),v=!1,cr(w)}}}function hG(i){let e,t,s,c,h=i[0][i[4]].properties.event+"",p,r,x,v,w,S,A,I,R,k,L=i[5],z,B,$,H,G,le,te=DL(i),ue=i[0].length>1&&RL(i);return{c(){e=Ie("div"),t=Ie("div"),s=Ie("div"),c=Ie("div"),p=On(h),x=ot(),v=Ie("button"),w=On("×"),I=ot(),R=Ie("div"),k=Ie("div"),te.c(),z=ot(),B=Ie("div"),H=ot(),ue&&ue.c(),Z(c,"class",r=""+(fo("warning-title")+" svelte-nzajvy")),Z(v,"class",S=""+(fo(`close-button ${i[6][i[0][i[4]].properties.event]}`)+" svelte-nzajvy")),Z(s,"class",A=""+(fo(`top-section ${i[6][i[0][i[4]].properties.event]} `)+" svelte-nzajvy")),Z(t,"class","wrapper"),Z(k,"class","text-container svelte-nzajvy"),Z(B,"class",$=""+(fo(`shadow ${i[3]?"off":""}`)+" svelte-nzajvy")),Z(R,"class","text-wrapper svelte-nzajvy"),Z(e,"class","container svelte-nzajvy")},m(me,se){Gt(me,e,se),Q(e,t),Q(t,s),Q(s,c),Q(c,p),Q(s,x),Q(s,v),Q(v,w),Q(e,I),Q(e,R),Q(R,k),te.m(k,null),i[9](k),Q(R,z),Q(R,B),Q(e,H),ue&&ue.m(e,null),G||(le=mn(v,"click",function(){Jr(i[1])&&i[1].apply(this,arguments)}),G=!0)},p(me,[se]){i=me,se&17&&h!==(h=i[0][i[4]].properties.event+"")&&si(p,h),se&17&&S!==(S=""+(fo(`close-button ${i[6][i[0][i[4]].properties.event]}`)+" svelte-nzajvy"))&&Z(v,"class",S),se&17&&A!==(A=""+(fo(`top-section ${i[6][i[0][i[4]].properties.event]} `)+" svelte-nzajvy"))&&Z(s,"class",A),se&32&&ai(L,L=i[5])?(mo(),mi(te,1,1,Vn),go(),te=DL(i),te.c(),ri(te),te.m(k,null)):te.p(i,se),se&8&&$!==($=""+(fo(`shadow ${i[3]?"off":""}`)+" svelte-nzajvy"))&&Z(B,"class",$),i[0].length>1?ue?ue.p(i,se):(ue=RL(i),ue.c(),ue.m(e,null)):ue&&(ue.d(1),ue=null)},i(me){ri(te)},o(me){mi(te)},d(me){me&&Bt(e),te.d(me),i[9](null),ue&&ue.d(),G=!1,le()}}}function dG(i,e,t){let{geojson:s}=e,{closeFunc:c}=e,h,p=!1,r=0,x=s[r].properties.description.replace(/([^[\n])\n([^\n])/g,"$1 $2"),v={"Tornado Warning":"red","PDS Tornado Warning":"magenta","Flash Flood Warning":"green","Severe Thunderstorm Warning":"yellow","Special Weather Statement":"black"};async function w(){r>0&&(t(4,r=r-1),t(5,x=s[r].properties.description.replace(/([^[\n])\n([^\n])/g,"$1 $2")),await Im(),t(3,p=h.scrollHeight-h.scrollTop===h.clientHeight))}async function S(){r<s.length-1&&(t(4,r=r+1),t(5,x=s[r].properties.description.replace(/([^[\n])\n([^\n])/g,"$1 $2")),await Im(),t(3,p=h.scrollHeight-h.scrollTop===h.clientHeight))}Zs(async()=>{await Im(),h.addEventListener("scroll",()=>{t(3,p=h.scrollHeight-h.scrollTop===h.clientHeight)}),t(3,p=h.scrollHeight-h.scrollTop===h.clientHeight)});function A(I){wi[I?"unshift":"push"](()=>{h=I,t(2,h)})}return i.$$set=I=>{"geojson"in I&&t(0,s=I.geojson),"closeFunc"in I&&t(1,c=I.closeFunc)},[s,c,h,p,r,x,v,w,S,A]}var PL=class extends gi{constructor(e){super();Ti(this,e,dG,hG,ai,{geojson:0,closeFunc:1})}},kL=PL;function fG(i){let e,t=i[0]&&zL(i);return{c(){e=Ie("div"),t&&t.c(),Z(e,"class","legend-container svelte-1v4wfig")},m(s,c){Gt(s,e,c),t&&t.m(e,null)},p(s,c){s[0]?t||(t=zL(s),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},d(s){s&&Bt(e),t&&t.d()}}}function zL(i){let e;return{c(){e=Ie("div"),e.innerHTML=`<div class="entry svelte-1v4wfig" id="entry1"><span>Viewers</span> 
            <div class="circle1 circle-transform svelte-1v4wfig"></div></div> 
        <div class="entry svelte-1v4wfig" id="entry2"><span>Trending</span> 
            <div class="circle2 circle-transform svelte-1v4wfig"></div></div>`,Z(e,"class","trending-container svelte-1v4wfig")},m(t,s){Gt(t,e,s)},d(t){t&&Bt(e)}}}function pG(i){let e,t=yh&&fG(i);return{c(){t&&t.c(),e=Gs()},m(s,c){t&&t.m(s,c),Gt(s,e,c)},p(s,[c]){yh&&t.p(s,c)},i:Vn,o:Vn,d(s){t&&t.d(s),s&&Bt(e)}}}function mG(i,e,t){let s;return It(i,Bc,c=>t(0,s=c)),[s]}var OL=class extends gi{constructor(e){super();Ti(this,e,mG,pG,ai,{})}},NL=OL;function FL(i,e,t){let s=i.slice();return s[120]=e[t],s}function BL(i){let e;return{c(){e=Ie("div"),e.innerHTML=`<div class="radar-container svelte-1gtocuo"><div class="background svelte-1gtocuo"></div> 
                <div class="line svelte-1gtocuo"></div> 
                <div class="inner svelte-1gtocuo"></div> 
                <div class="outer svelte-1gtocuo"></div> 
                <div class="border svelte-1gtocuo"></div></div>`,Z(e,"class","loading svelte-1gtocuo")},m(t,s){Gt(t,e,s)},d(t){t&&Bt(e)}}}function UL(i){let e,t;return{c(){e=Ie("canvas"),Tm(e,"display","none"),Z(e,"id",t=i[120])},m(s,c){Gt(s,e,c)},p:Vn,d(s){s&&Bt(e)}}}function gG(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L,z;r=new CL({props:{mouseoverValue:i[7],field:i[8],idx:i[1],height:i[10],over:i[3]}}),r.$on("message",i[2]),v=new NL({});let B=i[9]&&BL(i),$=i[11],H=[];for(let G=0;G<$.length;G+=1)H[G]=UL(FL(i,$,G));return{c(){e=Ie("div"),t=Ie("div"),c=ot(),h=Ie("canvas"),p=ot(),mr(r.$$.fragment),x=ot(),mr(v.$$.fragment),w=ot(),B&&B.c(),A=ot();for(let G=0;G<H.length;G+=1)H[G].c();I=ot(),R=Ie("canvas"),Z(t,"id",s="map"+i[1]),Z(t,"class","mapContainer svelte-1gtocuo"),Rn(t,"active",!i[0]),Z(h,"class","overlay-canvas svelte-1gtocuo"),Z(h,"tabindex","-1"),Z(e,"id",S="mapwrapper"+i[1]),Z(e,"class","mapWrapper svelte-1gtocuo"),Rn(e,"active",!i[0]),Z(R,"class","canvas3d svelte-1gtocuo"),Z(R,"width",k=32),Z(R,"height",L=32)},m(G,le){Gt(G,e,le),Q(e,t),i[30](t),Q(e,c),Q(e,h),i[31](h),Q(e,p),dr(r,e,null),Q(e,x),dr(v,e,null),Q(e,w),B&&B.m(e,null),Gt(G,A,le);for(let te=0;te<H.length;te+=1)H[te].m(G,le);Gt(G,I,le),Gt(G,R,le),i[32](R),z=!0},p(G,le){(!z||le[0]&2&&s!==(s="map"+G[1]))&&Z(t,"id",s),le[0]&1&&Rn(t,"active",!G[0]);let te={};if(le[0]&128&&(te.mouseoverValue=G[7]),le[0]&256&&(te.field=G[8]),le[0]&2&&(te.idx=G[1]),le[0]&1024&&(te.height=G[10]),le[0]&8&&(te.over=G[3]),r.$set(te),G[9]?B||(B=BL(G),B.c(),B.m(e,null)):B&&(B.d(1),B=null),(!z||le[0]&2&&S!==(S="mapwrapper"+G[1]))&&Z(e,"id",S),le[0]&1&&Rn(e,"active",!G[0]),le[0]&2048){$=G[11];let ue;for(ue=0;ue<$.length;ue+=1){let me=FL(G,$,ue);H[ue]?H[ue].p(me,le):(H[ue]=UL(me),H[ue].c(),H[ue].m(I.parentNode,I))}for(;ue<H.length;ue+=1)H[ue].d(1);H.length=$.length}},i(G){z||(ri(r.$$.fragment,G),ri(v.$$.fragment,G),z=!0)},o(G){mi(r.$$.fragment,G),mi(v.$$.fragment,G),z=!1},d(G){G&&Bt(e),i[30](null),i[31](null),fr(r),fr(v),B&&B.d(),G&&Bt(A),Is(H,G),G&&Bt(I),G&&Bt(R),i[32](null)}}}function _G(i,e,t){let s,c,h,p,r,x,v,w,S,A,I,R,k,L,z,B,$,H,G,le,te,ue,me,se,Y,ye;It(i,qr,qe=>t(50,s=qe)),It(i,vh,qe=>t(12,c=qe)),It(i,Xo,qe=>t(13,h=qe)),It(i,Js,qe=>t(14,p=qe)),It(i,Xr,qe=>t(15,r=qe)),It(i,_i,qe=>t(16,x=qe)),It(i,Ys,qe=>t(17,v=qe)),It(i,kl,qe=>t(51,w=qe)),It(i,Rl,qe=>t(52,S=qe)),It(i,Ym,qe=>t(18,A=qe)),It(i,Ea,qe=>t(19,I=qe)),It(i,Vc,qe=>t(20,R=qe)),It(i,Bc,qe=>t(21,k=qe)),It(i,Uc,qe=>t(22,L=qe)),It(i,Fl,qe=>t(23,z=qe)),It(i,_h,qe=>t(24,B=qe)),It(i,xo,qe=>t(25,$=qe)),It(i,bh,qe=>t(53,H=qe)),It(i,xh,qe=>t(54,G=qe)),It(i,$r,qe=>t(26,le=qe)),It(i,Ds,qe=>t(55,te=qe)),It(i,Sr,qe=>t(56,ue=qe)),It(i,pM,qe=>t(57,me=qe)),It(i,Lm,qe=>t(27,se=qe)),It(i,Dm,qe=>t(28,Y=qe)),It(i,fM,qe=>t(29,ye=qe));let{REFLECTIVITY:Xe,VELOCITY:ge,VELOCITY_DEALIASED:re,CC:ve,PHI:ae,ZDR:de,SW:xe}=yo,{DEALIASED:De}=Ka,{READING:Ce,MODE3D:pe,CROSS:xt}=vs,{HISTORICAL:Ct,LIVE:ct}=vo,Qe={[Xe]:0,[ge]:1,[re]:255,[ve]:9,[ae]:10,[de]:5,[xe]:2},zt=Lo(),Zt=bo(),{show:Lt}=e,{idx:Re}=e,qt=c.styleid,nt=c.layer,at=0,St=!1,ut=!1,Ot=!1,Pn,bn,wn=new fl.Popup;wn.on("close",()=>{bn&&bn.$destroy(),bn=null});let xn=document.createElement("div");xn.className="circle-outline";let ei=new fl.Marker(xn);function ze(){if(!s[Re])return;let qe=s[Re].getSource("alerts");qe&&qe.setData(se)}function Ae(){if(!s[Re])return;let qe=s[Re].getSource("trending");qe&&qe.setData(Y)}function gt(){if(!s[Re])return;let qe=s[Re].getSource("lightning");if(qe){qe.setData(ye);let pn=new Date().getTime()/1e3;s[Re].setPaintProperty("lightning","circle-color",["interpolate",["linear"],["/",["-",pn,["get","date"]],1800],.1,"#fff",1,"#696969"])}}let Rt={},Xt,gn=[0,1],Tn,Ee,et,rn={},tn={},Je=new Uint8Array(4),sn,nn,An=!1,Et,Dn;function un(qe="none"){s[Re]&&s[Re].triggerRepaint()}function Nn(){t(9,An=!0)}function Kn(){t(9,An=!1)}function Gn(){"lon"in $&&s[Re]&&(te===Ct&&s[Re].flyTo({center:[$.lon,$.lat],zoom:7.5}),Ne(),Ke(),on(bh,H=null,H),on(xh,G=null,G))}let Ei=0;function ln(){Ei=1}function li(){s[Re].getSource("lightning")===void 0&&s[Re].addSource("lightning",{type:"geojson",data:ye});let pn;if(R?pn="visible":pn="none",s[Re].getStyle().layers.map(Ye=>Ye.id).indexOf("lightning")<0){s[Re].addLayer({id:"lightning-blur",type:"circle",source:"lightning",paint:{"circle-color":"#000","circle-opacity":.3,"circle-blur":.4,"circle-radius":["interpolate",["linear"],["zoom"],6,4,13,12],"circle-translate":[2,2]},layout:{visibility:pn}});let Ye=new Date().getTime()/1e3;s[Re].addLayer({id:"lightning",type:"circle",source:"lightning",paint:{"circle-color":["interpolate",["linear"],["/",["-",Ye,["get","date"]],1800],.1,"#fff",1,"#696969"],"circle-radius":["interpolate",["linear"],["zoom"],6,3,13,8],"circle-stroke-color":"#ebebeb","circle-stroke-width":["interpolate",["linear"],["zoom"],6,.25,13,1.5],"circle-stroke-opacity":1},layout:{visibility:pn}})}}function $t(){s[Re].getSource("alerts")===void 0&&s[Re].addSource("alerts",{type:"geojson",data:se});let pn;z?pn="visible":pn="none";let st=s[Re].getStyle().layers.map(ui=>ui.id),Ye;st.indexOf("sites")>-1?Ye="sites":Ye="",st.indexOf("alerts-background")<0&&(s[Re].addLayer({id:"alerts-background",type:"line",source:"alerts",layout:{visibility:pn},filter:["!=",["get","event"],"Special Weather Statement"],paint:{"line-color":"#232323","line-width":4.5}},Ye),s[Re].addLayer({id:"alerts",type:"line",source:"alerts",layout:{visibility:pn},filter:["!=",["get","event"],"Special Weather Statement"],paint:{"line-color":["case",["==",["get","event"],"Tornado Warning"],"#f00",["==",["get","event"],"PDS Tornado Warning"],"#ff00ff",["==",["get","event"],"Severe Thunderstorm Warning"],"#ff0",["==",["get","event"],"Flash Flood Warning"],"#0f0",["==",["get","event"],"Winter Storm Warning"],"#f0f","#fff"],"line-width":3}},Ye),s[Re].addLayer({id:"alerts-fill",type:"fill",source:"alerts",layout:{visibility:pn},filter:["!=",["get","event"],"Special Weather Statement"],paint:{"fill-opacity":0}},Ye))}function kn(){s[Re].getSource("trending")===void 0&&s[Re].addSource("trending",{type:"geojson",data:Y});let pn;k?pn="visible":pn="none";let st=s[Re].getStyle().layers.map(ui=>ui.id),Ye;st.indexOf("sws")>-1?Ye="sws":Ye="",st.indexOf("trending")<0&&s[Re].addLayer({id:"trending",type:"circle",source:"trending",layout:{visibility:pn},paint:{"circle-color":["case",["to-boolean",["get","trending"]],"#FFE83D","#8356ff"],"circle-radius":["get","scaling"],"circle-opacity":.6,"circle-stroke-color":["case",["to-boolean",["get","trending"]],"#FFE83D","#8356ff"],"circle-stroke-width":["case",["to-boolean",["get","trending"]],5,3],"circle-stroke-opacity":1}},Ye)}function Un(){s[Re].getSource("alerts")===void 0&&s[Re].addSource("alerts",{type:"geojson",data:se});let pn;L?pn="visible":pn="none";let st=s[Re].getStyle().layers.map(ui=>ui.id),Ye;st.indexOf("alerts")>-1?Ye="alerts":Ye="",st.indexOf("sws-background")<0&&(s[Re].addLayer({id:"sws-background",type:"line",source:"alerts",layout:{visibility:pn},filter:["==",["get","event"],"Special Weather Statement"],paint:{"line-color":"#232323","line-width":4.5}},Ye),s[Re].addLayer({id:"sws",type:"line",source:"alerts",layout:{visibility:pn},filter:["==",["get","event"],"Special Weather Statement"],paint:{"line-color":["case",["==",["get","event"],"Special Weather Statement"],"#fff","#fff"],"line-width":3}},Ye),s[Re].addLayer({id:"sws-fill",type:"fill",source:"alerts",layout:{visibility:pn},filter:["==",["get","event"],"Special Weather Statement"],paint:{"fill-opacity":0}},Ye))}function Yn(){if(s[Re].getSource("sites")===void 0){s[Re].addSource("sites",{type:"geojson",data:me});let pn=zi.site===void 0?null:zi.site;s[Re].addLayer({id:"sites",type:"symbol",source:"sites",layout:{"icon-image":["case",["==",["slice",["get","STATION_ID"],7],pn],"selected","unselected"],"text-field":["slice",["get","STATION_ID"],7],"icon-text-fit":"both","text-size":12,"text-font":["Arial Unicode MS Bold"],"icon-text-fit-padding":[4,8,4,8]},paint:{"text-color":"#fff","icon-halo-width":20,"icon-halo-color":"#fff"}}),ut||(s[Re].on("click",["sites","sws-fill","alerts-fill"],function(st){if(te!=ct||ue)return;let Ye=new Set,ui=st.features.filter(Mi=>Ye.has(Mi.properties.id)?!1:(Ye.add(Mi.properties.id),!0)),Cn=st.features.filter(Mi=>Mi.layer.id==="sites");if(Cn.length){let Mi=Cn[0].properties.STATION_ID.split(":").slice(-1)[0];(Mi[0]==="K"||Mi[0]==="P"||Mi[0]==="T")&&(zi.setSite(Mi),s[Re].setLayoutProperty("sites","icon-image",["case",["==",["slice",["get","STATION_ID"],7],zi.site],"selected","unselected"]))}else if(ui.length){let Mi={"Tornado Warning":"#ef1212","Special Weather Statement":"#000","Severe Thunderstorm Warning":"#f9dc00","Flash Flood Warning":"#00990F"};bn&&(bn.$destroy(),bn=null);let fi=()=>{wn&&wn.remove()};bn=new kL({target:Pn,props:{geojson:ui,closeFunc:fi}}),wn.setLngLat(st.lngLat).setDOMContent(Pn).addTo(s[Re])}}),s[Re].on("mouseenter",["sites","sws-fill","alerts-fill"],function(st){te===ct&&(s[Re].getCanvas().style.cursor="pointer")}),s[Re].on("mouseleave",["sites","sws-fill","alerts-fill"],function(st){r===xt||r===pe?s[Re].getCanvas().style.cursor="crosshair":s[Re].getCanvas().style.cursor=""}),ut=!0)}}function Ft(qe){if(qe!==null){if(qe.detail.value==="loadVertices"&&Et&&(Et.updateData(),t(9,An=!1)),qe.detail.value==="setBox"&&Fe(qe.detail.box),qe.detail.value==="setLine"&&Fe(qe.detail.line),qe.detail.value==="readValue"&&Ht([qe.detail.coords,qe.detail.ll]),qe.detail.value==="showHide"&&(t(3,at=qe.detail.over),at===0&&ei.remove()),qe.detail.value==="removeBox"&&Ne(),qe.detail.value==="removeLine"&&Ke(),qe.detail.value==="showSites"&&Yn(),qe.detail.value==="showAlerts"&&$t(),qe.detail.value==="deactivateSites"&&s[Re].setLayoutProperty("sites","icon-image",["case",["==",["slice",["get","STATION_ID"],7],qe.detail.site===void 0?null:qe.detail.site],"selected","unselected"]),qe.detail.value==="showLightning"&&li(),qe.detail.value==="showStatements"&&Un(),qe.detail.value==="activateMap"&&(Wn(),(s[Re].field===ge||s[Re].field===re)&&on(qr,s[Re].field=w===De?re:ge,s),x[0].scan&&Zt.logStore(x[0].scan)),qe.detail.value==="setField"){let pn=qe.detail.field;ko(pn)}qe.detail.value==="clearMap"&&(Et.clear(),Ot=!0,s[Re].triggerRepaint()),qe.detail.value==="setDealiasState"&&(s[Re].field===ge||s[Re].field===re)&&(ko(w===De?re:ge),Zt.logStore(x[Re].scan)),qe.detail.value==="startLoading"&&t(9,An=!0)}}s1(()=>{s[Re]&&Ei&&(s[Re].resize(),Ei=0)});let he=Symbol("drawing"),X=Symbol("done"),N=Ce,K,ne;function oe(qe){on(xh,G=qe,G)}function be(qe){on(bh,H=qe,H)}function Fe(qe){let pn=qe[0].lat,st=qe[0].lng,Ye=qe[1].lat,ui=qe[1].lng;if(r===pe){let Cn=[Math.min(st,ui),Math.max(pn,Ye)],Mi=[Math.max(st,ui),Math.min(pn,Ye)],fi={type:"Feature",geometry:{type:"Polygon",coordinates:[[Cn,[Mi[0],Cn[1]],Mi,[Cn[0],Mi[1]],Cn]]}};s[Re].getSource("box").setData(fi)}if(r===xt){let Cn={type:"Feature",geometry:{type:"LineString",coordinates:[[st,pn],[ui,Ye]]}};s[Re].getSource("line").setData(Cn),Rt.A&&Rt.A.setLngLat([st,pn]).addTo(s[Re]),Rt.B&&Rt.B.setLngLat([ui,Ye]).addTo(s[Re])}}function Ne(){s[Re]&&s[Re].getSource("box")&&(on(xh,G=null,G),s[Re].getSource("box").setData({type:"Feature",geometry:{type:"Polygon",coordinates:[]}}))}function Ke(){s[Re]&&s[Re].getSource("line")&&(on(bh,H=null,H),s[Re].getSource("line").setData({type:"Feature",geometry:{type:"Polygon",coordinates:[]}}),Rt.A&&Rt.A.remove(),Rt.B&&Rt.B.remove())}function rt(qe){N=he,K=qe.lngLat.wrap()}function Pt(qe){let pn=Xt.getBoundingClientRect(),st,Ye;return qe.type==="mousemove"||qe.type==="mousedown"||qe.type==="mouseup"?st=new fl.Point(qe.clientX-pn.left-Xt.clientLeft,qe.clientY-pn.top-Xt.clientTop):(qe.type==="touchmove"||qe.type==="touchstart"||qe.type==="touchend")&&(qe.type==="touchend"&&qe.changedTouches.length>0?Ye=qe.changedTouches[0]:Ye=qe.touches[0],st=new fl.Point(Ye.clientX-pn.left-Xt.clientLeft,Ye.clientY-pn.top-Xt.clientTop)),s[Re].unproject(st)}function _t(qe){if(r===pe&&qe.composedPath()[0].localName!="select"&&Ne(),r===xt&&qe.composedPath()[0].localName!="select"&&Ke(),r===pe||r===xt){if(qe.composedPath().indexOf(s[Re]._canvas)==-1)return;qe.preventDefault(),N=he,K=Pt(qe)}}function Jt(qe){e:if(N===he){if(qe.lngLat)break e;ne=Pt(qe),Fe([K,ne]),r===pe?zt("message",{value:"setBox",idx:Re,box:[K,ne]}):r===xt&&zt("message",{value:"setLine",idx:Re,line:[K,ne]})}if(r===Ce&&!p&&($&&$.lon&&x[0].scan?t(10,Dn=T2($.lon,$.lat,qe.lngLat.lng,qe.lngLat.lat,x[0].scan.scan[0].elevation)):t(10,Dn=null),Et)){let pn=window.devicePixelRatio||1;zt("message",{value:"readValue",idx:Re,coords:[pn*qe.point.x,pn*qe.point.y,Dn],ll:[qe.lngLat.lng,qe.lngLat.lat]}),Et.gl.bindFramebuffer(Et.gl.FRAMEBUFFER,Et.fb),Et.gl.readPixels(pn*qe.point.x,Et.gl.drawingBufferHeight-pn*qe.point.y,1,1,Et.gl.RGBA,Et.gl.UNSIGNED_BYTE,Je),Po(Je)}}function Ht(qe){if(r===Ce&&!p&&(ei.setLngLat(qe[1]).addTo(s[Re]),Et)){t(10,Dn=qe[0][2]),Et.gl.bindFramebuffer(Et.gl.FRAMEBUFFER,Et.fb);let pn=window.devicePixelRatio||1;Et.gl.readPixels(qe[0][0],Et.gl.drawingBufferHeight-qe[0][1],1,1,Et.gl.RGBA,Et.gl.UNSIGNED_BYTE,Je),Po(Je)}}function cn(qe){N===Ce&&Et&&(Et.gl.bindFramebuffer(Et.gl.FRAMEBUFFER,Et.fb),Et.gl.readPixels(2*qe.point.x,Et.gl.drawingBufferHeight-2*qe.point.y,1,1,Et.gl.RGBA,Et.gl.UNSIGNED_BYTE,Je),Po(Je))}function In(qe){N===he&&(N=X,r===pe&&oe([K,Pt(qe)]),r===xt&&be([K,Pt(qe)]))}function Wn(){!s[Re]||(Ei=1,r===pe&&(s[Re].getCanvas().style.cursor="crosshair",s[Re].dragPan.disable(),Ke(),G&&Fe(G),Xt.addEventListener("mousedown",_t,!0),Xt.addEventListener("mousemove",Jt),document.addEventListener("mouseup",In),Xt.addEventListener("touchstart",_t,!0),Xt.addEventListener("touchmove",Jt),document.addEventListener("touchend",In)),r===xt&&(s[Re].getCanvas().style.cursor="crosshair",s[Re].dragPan.disable(),Ne(),H&&Fe(H),Xt.addEventListener("mousedown",_t,!0),Xt.addEventListener("mousemove",Jt),document.addEventListener("mouseup",In),Xt.addEventListener("touchstart",_t,!0),Xt.addEventListener("touchmove",Jt),document.addEventListener("touchend",In)),r===Ce&&(s[Re].getCanvas().style.cursor="",Ne(),Ke(),s[Re].dragPan.enable(),Xt.removeEventListener("mousedown",_t),Xt.removeEventListener("mousemove",Jt),document.removeEventListener("mouseup",In),Xt.removeEventListener("touchstart",_t),Xt.removeEventListener("touchmove",Jt),document.removeEventListener("touchend",In)),kn(),Un(),$t(),li(),B&&Yn())}function $n(qe){if(!s[Re])return;let pn=s[Re].getStyle().layers.map(st=>st.id);qe==="sites"&&pn.indexOf("sites")>-1&&(B?s[Re].setLayoutProperty("sites","visibility","visible"):s[Re].setLayoutProperty("sites","visibility","none")),qe==="lightning"&&pn.indexOf("lightning")>-1&&(R?(s[Re].setLayoutProperty("lightning","visibility","visible"),s[Re].setLayoutProperty("lightning-blur","visibility","visible")):(s[Re].setLayoutProperty("lightning","visibility","none"),s[Re].setLayoutProperty("lightning-blur","visibility","none"))),qe==="alerts"&&pn.indexOf("alerts")>-1&&(z?(s[Re].setLayoutProperty("alerts-background","visibility","visible"),s[Re].setLayoutProperty("alerts","visibility","visible"),s[Re].setLayoutProperty("alerts-fill","visibility","visible")):(s[Re].setLayoutProperty("alerts-background","visibility","none"),s[Re].setLayoutProperty("alerts","visibility","none"),s[Re].setLayoutProperty("alerts-fill","visibility","none"))),qe==="trending"&&pn.indexOf("trending")>-1&&(k?s[Re].setLayoutProperty("trending","visibility","visible"):s[Re].setLayoutProperty("trending","visibility","none")),qe==="sws"&&pn.indexOf("sws")>-1&&(L?(s[Re].setLayoutProperty("sws-background","visibility","visible"),s[Re].setLayoutProperty("sws","visibility","visible"),s[Re].setLayoutProperty("sws-fill","visibility","visible")):(s[Re].setLayoutProperty("sws-background","visibility","none"),s[Re].setLayoutProperty("sws","visibility","none"),s[Re].setLayoutProperty("sws-fill","visibility","none")))}function hn(){Et&&h!="unsupported"&&(Et.updateColorTable(),un())}function yi(){Et&&(Et.updateOpacity(),un())}function Qn(){s[Re]?.resize(),Et&&ia(Et)}function Rr(){p||s[Re]&&(Ot=!0,s[Re].triggerRepaint())}function Fr(qe,pn){let st=this,Ye=qe;this.layerType=pn;let ui,Cn=function(Oi){st.layerType=Oi,ui=new Float32Array([]),Ir()},Mi=function(){ui=new Float32Array([])},fi,ra=function(Oi){ui===void 0||ui.length==0||(Ot&&(Ye.useProgram(this.programFramebuffer),Ye.uniformMatrix4fv(this.matrixLocationFramebuffer,!1,Oi),Ye.bindFramebuffer(Ye.FRAMEBUFFER,fi),Ye.clearColor(0,0,0,0),Ye.clear(qe.COLOR_BUFFER_BIT|qe.DEPTH_BUFFER_BIT),p||st.ext2.drawArraysInstancedANGLE(qe.TRIANGLES,0,6,ui.length/7),Ye.flush(),Ye.bindFramebuffer(Ye.FRAMEBUFFER,null),Ot=!1),Ye.useProgram(this.instancedProgram),Ye.enable(Ye.BLEND),Ye.blendFunc(Ye.SRC_ALPHA,Ye.ONE_MINUS_SRC_ALPHA),Ye.uniformMatrix4fv(this.instancedMatrixLocation,!1,Oi),st.ext2.drawArraysInstancedANGLE(qe.TRIANGLES,0,6,ui.length/7))};function Ir(){if(Ye.useProgram(st.instancedProgram),Ye.activeTexture(qe.TEXTURE7),Ye.bindTexture(Ye.TEXTURE_2D,rn[st.layerType]),Ye.texImage2D(Ye.TEXTURE_2D,0,Ye.RGBA,Ye.RGBA,Ye.UNSIGNED_BYTE,tn[st.layerType]),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_WRAP_S,Ye.CLAMP_TO_EDGE),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_WRAP_T,Ye.CLAMP_TO_EDGE),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_MIN_FILTER,Ye.LINEAR),Ye.uniform1i(st.textureLocation,7),st.layerType===Xe){let Oi,pr;if(h!="unsupported"){let Vi=h.br.all[h.br.current].minMax;Oi=Vi[0],pr=Vi[1]}else Oi=0,pr=80;Ye.uniform1f(st.minLocation,Oi),Ye.uniform1f(st.maxLocation,pr)}if(st.layerType===ve&&(Ye.uniform1f(st.minLocation,.2),Ye.uniform1f(st.maxLocation,1.05)),st.layerType===ae&&(Ye.uniform1f(st.minLocation,-2),Ye.uniform1f(st.maxLocation,10)),st.layerType===de&&(Ye.uniform1f(st.minLocation,-8),Ye.uniform1f(st.maxLocation,8)),st.layerType===xe&&(Ye.uniform1f(st.minLocation,0),Ye.uniform1f(st.maxLocation,60)),st.layerType===ge&&(Ye.uniform1f(st.minLocation,ba),Ye.uniform1f(st.maxLocation,wa)),st.layerType===re&&(Ye.uniform1f(st.minLocation,ba),Ye.uniform1f(st.maxLocation,wa)),Ye.useProgram(st.programFramebuffer),st.layerType===Xe){let Oi,pr;Oi=-30,pr=80,Ye.uniform1f(st.minLocationFramebuffer,Oi),Ye.uniform1f(st.maxLocationFramebuffer,pr)}st.layerType===ve&&(Ye.uniform1f(st.minLocationFramebuffer,.2),Ye.uniform1f(st.maxLocationFramebuffer,1.05)),st.layerType===ae&&(Ye.uniform1f(st.minLocationFramebuffer,-2),Ye.uniform1f(st.maxLocationFramebuffer,10)),st.layerType===de&&(Ye.uniform1f(st.minLocationFramebuffer,-8),Ye.uniform1f(st.maxLocationFramebuffer,8)),st.layerType===xe&&(Ye.uniform1f(st.minLocationFramebuffer,0),Ye.uniform1f(st.maxLocationFramebuffer,60)),st.layerType===ge&&(Ye.uniform1f(st.minLocationFramebuffer,ba),Ye.uniform1f(st.maxLocationFramebuffer,wa)),st.layerType===re&&(Ye.uniform1f(st.minLocationFramebuffer,ba*2),Ye.uniform1f(st.maxLocationFramebuffer,wa*2))}function nc(){let Oi=Ye.drawingBufferWidth,pr=Ye.drawingBufferHeight,Vi=Ye.createTexture();Ye.activeTexture(qe.TEXTURE0),Ye.bindTexture(Ye.TEXTURE_2D,Vi);let So=0,Oo=Ye.RGBA,Kr=0,jr=Ye.RGBA,ic=Ye.UNSIGNED_BYTE,Ra=null;Ye.texImage2D(Ye.TEXTURE_2D,So,Oo,Oi,pr,Kr,jr,ic,Ra),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_MIN_FILTER,Ye.NEAREST),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_WRAP_S,Ye.CLAMP_TO_EDGE),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_WRAP_T,Ye.CLAMP_TO_EDGE),fi=Ye.createFramebuffer(),Ye.bindFramebuffer(Ye.FRAMEBUFFER,fi);let vr=Ye.COLOR_ATTACHMENT0;Ye.framebufferTexture2D(Ye.FRAMEBUFFER,vr,Ye.TEXTURE_2D,Vi,So)}let zo=function(){Ye.useProgram(st.instancedProgram),Ye.uniform1f(st.opacityLocation,A.opacity)},mu=function(){let Oi=Jy(qe,h.br.all[h.br.current]);tn[Xe]=Oi.imageData,rn[Xe]=Oi.texture,st.layerType===Xe&&Ir()},pl=function(){let Oi;nn&&(Oi=S[x[Re].file][Qe[nn]]),Ye.bindBuffer(Ye.ARRAY_BUFFER,st.instancedPositionBuffer),Ye.bufferData(Ye.ARRAY_BUFFER,Oi,Ye.STATIC_DRAW),Ye.enableVertexAttribArray(st.instancedPositionLocation),Ye.vertexAttribPointer(st.instancedPositionLocation,2,Ye.FLOAT,!1,0,0),st.ext2.vertexAttribDivisorANGLE(st.instancedPositionLocation,0),Ye.enableVertexAttribArray(st.framebufferPositionLocation),Ye.vertexAttribPointer(st.framebufferPositionLocation,2,Ye.FLOAT,!1,0,0),st.ext2.vertexAttribDivisorANGLE(st.framebufferPositionLocation,0),Ye.useProgram(st.programFramebuffer),Ye.uniform2f(st.radarLocationFramebuffer,(Oi[2]+Oi[4])/2,(Oi[3]+Oi[1])/2),Ye.useProgram(st.instancedProgram),Ye.uniform2f(st.radarLocationInstanced,(Oi[2]+Oi[4])/2,(Oi[3]+Oi[1])/2)},ml=function(){ui=v[x[Re].file][x[Re].type][x[Re].elevation],ui!==void 0&&(pl(),Ye.bindBuffer(Ye.ARRAY_BUFFER,st.instancedBufferData),Ye.bufferSubData(Ye.ARRAY_BUFFER,0,ui),st.ext2.vertexAttribDivisorANGLE(st.instancedRow1,1),st.ext2.vertexAttribDivisorANGLE(st.instancedRow2,1),st.ext2.vertexAttribDivisorANGLE(st.instancedColor,1),st.ext2.vertexAttribDivisorANGLE(st.framebufferRow1,1),st.ext2.vertexAttribDivisorANGLE(st.framebufferRow2,1),Ot=!0,s[Re].triggerRepaint())},sa=function(){let Oi=3,pr=Ye.FLOAT,Vi=!1,So=0,Oo=0;Ye.bindBuffer(Ye.ARRAY_BUFFER,st.instancedBufferData),Ye.enableVertexAttribArray(st.instancedRow1),Ye.vertexAttribPointer(st.instancedRow1,3,Ye.FLOAT,!1,28,0),Ye.enableVertexAttribArray(st.instancedRow2),Ye.vertexAttribPointer(st.instancedRow2,3,Ye.FLOAT,!1,28,12),Ye.enableVertexAttribArray(st.instancedColor),Ye.vertexAttribPointer(st.instancedColor,1,Ye.FLOAT,!1,28,24),Ye.enableVertexAttribArray(st.framebufferRow1),Ye.vertexAttribPointer(st.framebufferRow1,3,Ye.FLOAT,!1,28,0),Ye.enableVertexAttribArray(st.framebufferRow2),Ye.vertexAttribPointer(st.framebufferRow2,3,Ye.FLOAT,!1,28,12),Ye.bufferData(Ye.ARRAY_BUFFER,25e6,Ye.DYNAMIC_DRAW)},Da=function(){let Oi=Ye.drawingBufferWidth,pr=Ye.drawingBufferHeight,Vi=Ye.createTexture();Ye.activeTexture(qe.TEXTURE0),Ye.bindTexture(Ye.TEXTURE_2D,Vi);let So=0,Oo=Ye.RGBA,Kr=0,jr=Ye.RGBA,ic=Ye.UNSIGNED_BYTE,Ra=null;Ye.texImage2D(Ye.TEXTURE_2D,So,Oo,Oi,pr,Kr,jr,ic,Ra),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_MIN_FILTER,Ye.NEAREST),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_WRAP_S,Ye.CLAMP_TO_EDGE),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_WRAP_T,Ye.CLAMP_TO_EDGE),Ye.bindFramebuffer(Ye.FRAMEBUFFER,fi);let vr=Ye.COLOR_ATTACHMENT0;Ye.framebufferTexture2D(Ye.FRAMEBUFFER,vr,Ye.TEXTURE_2D,Vi,So)};return nc(),sa(),zo(),{render:ra,updateData:ml,createFrameBuffer:nc,fb:fi,gl:Ye,setType:Cn,clear:Mi,attachColor:Ir,updateOpacity:zo,updateFrameBuffer:Da,updateColorTable:mu,setPixelGeometry:pl}}function Tt(qe,pn,st,Ye){return{id:"custom-layer",type:"custom",renderingMode:"2d",minzoom:0,maxzoom:18,onAdd(ui,Cn){let Mi;qe===Xe&&h!="unsupported"?Mi=Jy(Cn,h.br.all[h.br.current]):Mi=tb(Cn,qe),tn[qe]=Mi.imageData,rn[qe]=Mi.texture,this.ext2=Cn.getExtension("ANGLE_instanced_arrays");var fi=Cn.createShader(Cn.FRAGMENT_SHADER);Cn.shaderSource(fi,Ye),Cn.compileShader(fi);let ra=Cn.createShader(Cn.VERTEX_SHADER);Cn.shaderSource(ra,pn),Cn.compileShader(ra);let Ir=Cn.createShader(Cn.FRAGMENT_SHADER);Cn.shaderSource(Ir,st),Cn.compileShader(Ir),this.programFramebuffer=Cn.createProgram(),Cn.attachShader(this.programFramebuffer,ra),Cn.attachShader(this.programFramebuffer,fi),Cn.linkProgram(this.programFramebuffer),this.matrixLocationFramebuffer=Cn.getUniformLocation(this.programFramebuffer,"u_matrix"),this.minLocationFramebuffer=Cn.getUniformLocation(this.programFramebuffer,"u_min"),this.maxLocationFramebuffer=Cn.getUniformLocation(this.programFramebuffer,"u_max"),this.radarLocationFramebuffer=Cn.getUniformLocation(this.programFramebuffer,"u_radarLocation"),this.framebufferPositionLocation=Cn.getAttribLocation(this.programFramebuffer,"a_position"),this.framebufferRow1=Cn.getAttribLocation(this.programFramebuffer,"a_row1"),this.framebufferRow2=Cn.getAttribLocation(this.programFramebuffer,"a_row2"),this.instancedProgram=Cn.createProgram(),Cn.attachShader(this.instancedProgram,ra),Cn.attachShader(this.instancedProgram,Ir),Cn.linkProgram(this.instancedProgram),this.instancedMatrixLocation=Cn.getUniformLocation(this.instancedProgram,"u_matrix"),this.radarLocationInstanced=Cn.getUniformLocation(this.instancedProgram,"u_radarLocation"),this.instancedPositionLocation=Cn.getAttribLocation(this.instancedProgram,"a_position"),this.instancedRow1=Cn.getAttribLocation(this.instancedProgram,"a_row1"),this.instancedRow2=Cn.getAttribLocation(this.instancedProgram,"a_row2"),this.instancedColor=Cn.getAttribLocation(this.instancedProgram,"a_color"),this.minLocation=Cn.getUniformLocation(this.instancedProgram,"u_min"),this.maxLocation=Cn.getUniformLocation(this.instancedProgram,"u_max"),this.textureLocation=Cn.getUniformLocation(this.instancedProgram,"u_texture"),this.opacityLocation=Cn.getUniformLocation(this.instancedProgram,"u_opacity"),this.positionBuffer=Cn.createBuffer(),this.indexBuffer=Cn.createBuffer(),this.colorBuffer=Cn.createBuffer(),this.instancedPositionBuffer=Cn.createBuffer(),this.instancedBufferData=Cn.createBuffer(),Et=Fr.apply(this,[Cn,qe]),Et.attachColor()},render(ui,Cn){Et.render.apply(this,[Cn])}}}function hs(){let qe=s[Re].getStyle().layers,pn;for(let Ye of qe)if(Ye.type==="symbol"){pn=Ye.id;break}(!nt||s[Re].getLayer(nt)===void 0)&&(nt=pn),on(vh,c.layer=nt,c);let st=s[Re].getStyle().layers.map(Ye=>Ye.id);s[Re].getSource("box")||s[Re].addSource("box",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[]}}}),s[Re].getSource("line")||s[Re].addSource("line",{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[]}}}),s[Re].getSource("circle")||s[Re].addSource("circle",{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[]}}}),s[Re].getLayer("custom-layer")===void 0&&s[Re].addLayer(Tt(s[Re].field,tc.instancedVsSource,tc.instancedFsSource,tc.fsSourceFramebuffer),nt),st.indexOf("box")<0&&s[Re].addLayer({id:"box",type:"fill",source:"box",layout:{},paint:{"fill-color":"#fff","fill-opacity":.075}}),st.indexOf("box-outline")<0&&s[Re].addLayer({id:"box-outline",type:"line",source:"box",layout:{},paint:{"line-color":"#fff","line-width":2}}),st.indexOf("cross-line")<0&&s[Re].addLayer({id:"cross-line",type:"line",source:"line",layout:{},paint:{"line-color":"#0080ff","line-width":2}}),st.indexOf("circle")<0&&s[Re].addLayer({id:"circle",type:"circle",source:"circle",layout:{},paint:{"circle-color":"#0080ff","circle-radius":10}})}let Si;function As(){let qe,pn;function st(){let Cn=Xt.offsetWidth,Mi=Xt.offsetHeight;t(6,Ee.width=Cn,Ee),t(6,Ee.height=Mi,Ee),qe=Ee.getContext("2d"),pn=window.devicePixelRatio||1,t(6,Ee.width=Ee.width*pn,Ee),t(6,Ee.height=Ee.height*pn,Ee),t(6,Ee.style.width=`${Cn}px`,Ee),t(6,Ee.style.height=`${Mi}px`,Ee),qe.scale(pn,pn),qe.clearRect(0,0,Ee.width,Ee.height)}function Ye(Cn){ui(),qe.lineWidth=3,qe.strokeStyle="black",qe.beginPath(),qe.arc(Cn[0]/pn,Cn[1]/pn,6,0,2*Math.PI),qe.stroke(),qe.lineWidth=2,qe.strokeStyle="white",qe.beginPath(),qe.arc(Cn[0]/pn,Cn[1]/pn,6,0,2*Math.PI),qe.stroke()}function ui(){qe.clearRect(0,0,Ee.width,Ee.height)}return st(),{drawCircle:Ye,clear:ui,resize:st}}function ia(qe){clearTimeout(Si),Si=setTimeout(function(){qe&&qe.updateFrameBuffer(),Ot=!0,un()},300)}Zs(async()=>{Pn=document.createElement("div");let qe,pn;s[0]&&s[0]._loaded?(pn=s[0].getZoom(),qe=s[0].getCenter()):(pn=3.5,qe=[-95,37.5]),on(qr,s[Re]=new fl.Map({container:Xt,style:qt,center:qe,zoom:pn,maxZoom:18,projection:"mercator"}),s),on(qr,s[Re].setLoading=Nn,s),on(qr,s[Re].stopLoading=Kn,s),on(qr,s[Re].updateField=ko,s),s[Re].on("resize",function(){Et&&ia(Et)}),s[Re].on("moveend",function(){Et&&(Ot=!0,s[Re].triggerRepaint())}),s[Re].on("load",async function(){await rb,ko(Re===0?Xe:w===De?re:ge),s[Re].keyboard.disable(),s[Re].getCanvas().removeAttribute("tabindex"),hs(),x[0].scan&&Zt.logStore(x[0].scan),s[0]._loaded&&s[1]&&s[1]._loaded&&vL(s[0],s[1]);let st=document.createElement("div");st.className="crosslabel",st.textContent="A";let Ye=document.createElement("div");Ye.className="crosslabel",Ye.textContent="B",Rt.A=new fl.Marker(st),Rt.B=new fl.Marker(Ye);let ui=s[Re].field;ui&&Et&&Et.setType(ui),x[Re]&&v[x[Re].file]&&Et&&Et.updateData(),Wn()}),s[Re].on("style.load",async function(){await rb;let st=AT("selected"),Ye=AT("unselected");if(s[Re].addImage("selected",st),s[Re].addImage("unselected",Ye),St){let ui=s[Re].field;ui&&Et&&Et.setType(ui),hs(),x[Re]&&v[x[Re].file]&&Et&&Et.updateData(),Wn(),St=!1}}),s[Re].on("mousemove",Jt),Xt.addEventListener("mouseleave",st=>{t(3,at=0),zt("message",{value:"showHide",idx:Re,over:0})}),Xt.addEventListener("mouseenter",st=>{r===Ce&&!p&&(t(3,at=1),ei.remove(),zt("message",{value:"showHide",idx:Re,over:1}))})});function yr(qe,pn){let st,Ye;s[Re].field===re?(st=pn[0]*2,Ye=pn[1]*2):(st=pn[0],Ye=pn[1]);let ui=qe[0]/255+qe[1]/65025+qe[2]/16581375;if(qe[3]===255)return ui*(Ye-st)+st}function Po(qe){let pn=yr(qe,sM[s[Re].field]);if(pn===void 0){t(7,sn=void 0);return}s[Re].field===ve?t(7,sn=pn.toFixed(2)):s[Re].field===ae||s[Re].field===de?t(7,sn=pn.toFixed(1)):t(7,sn=(Math.round(pn*2)/2).toFixed(1))}function ko(qe){if((!(qe in rn)||!rn[qe])&&Et){let pn;qe===Xe&&h!="unsupported"?pn=Jy(Et.gl,h.br.all[h.br.current]):pn=tb(Et.gl,qe),tn[qe]=pn.imageData,rn[qe]=pn.texture}on(qr,s[Re].field=qe,s),t(8,nn=qe),Et&&Et.setType(qe)}function La(){if(bn&&(bn.$destroy(),bn=null),wn&&wn.remove(),c.styleid!=qt){St=!0;let qe=c.styleid;qe!=qt&&(nt=c.layer,qt=qe,s[Re].setStyle(qe))}}function an(qe){wi[qe?"unshift":"push"](()=>{Xt=qe,t(4,Xt)})}function di(qe){wi[qe?"unshift":"push"](()=>{Ee=qe,t(6,Ee)})}function ci(qe){wi[qe?"unshift":"push"](()=>{Tn=qe,t(5,Tn)})}return i.$$set=qe=>{"show"in qe&&t(0,Lt=qe.show),"idx"in qe&&t(1,Re=qe.idx)},i.$$.update=()=>{if(i.$$.dirty[0]&134217728){e:ze()}if(i.$$.dirty[0]&536870912){e:gt()}if(i.$$.dirty[0]&268435456){e:Ae()}if(i.$$.dirty[0]&67108864){e:ln()}if(i.$$.dirty[0]&131072){e:un("vertex data updated")}if(i.$$.dirty[0]&65536){e:un("selections updated")}if(i.$$.dirty[0]&33554432){e:Gn()}if(i.$$.dirty[0]&32768){e:Wn()}if(i.$$.dirty[0]&16777216){e:$n("sites")}if(i.$$.dirty[0]&8388608){e:$n("alerts")}if(i.$$.dirty[0]&4194304){e:$n("sws")}if(i.$$.dirty[0]&2097152){e:$n("trending")}if(i.$$.dirty[0]&1048576){e:$n("lightning")}if(i.$$.dirty[0]&4096){e:La()}if(i.$$.dirty[0]&262144){e:yi()}if(i.$$.dirty[0]&8192){e:hn()}if(i.$$.dirty[0]&524288){e:Qn()}if(i.$$.dirty[0]&16384){e:Rr()}},[Lt,Re,Ft,at,Xt,Tn,Ee,sn,nn,An,Dn,gn,c,h,p,r,x,v,A,I,R,k,L,z,B,$,le,se,Y,ye,an,di,ci]}var VL=class extends gi{constructor(e){super();Ti(this,e,_G,gG,ai,{show:0,idx:1,handleMessage:2},null,[-1,-1,-1,-1])}get handleMessage(){return this.$$.ctx[2]}},DT=VL;function xG(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L,z,B,$,H,G;return{c(){e=Ie("div"),t=Ie("div"),t.innerHTML='<a href="https://quadweather.com" target="_blank"><img class="image svelte-ywbsvu" width="200" height="56" src="qwlogo.png" alt="logo"/></a>',s=ot(),c=Ie("div"),c.innerHTML=`<div class="inner svelte-ywbsvu"><h3 class="svelte-ywbsvu">A Powerful Tool</h3> 
            <p class="svelte-ywbsvu">Viewing NEXRAD Level II files typically requires downloading software
                that only works on a specific operating system with difficult dependencies. With 
                this application, you can read and view Level II files in the browser, no installation
                necessary. Use this site to analyze historical data or monitor weather events in real time.</p></div>`,h=ot(),p=Ie("figure"),p.innerHTML=`<img class="heroimage svelte-ywbsvu" width="550" height="232" src="hondo_cross_z.png" alt="logo"/> 
        <figcaption class="svelte-ywbsvu">Cross section through a supercell in Hondo, Texas on 29 April 2021 that produced a 6.4&quot; hailstone.</figcaption>`,r=ot(),x=Ie("div"),x.innerHTML=`<h3 class="svelte-ywbsvu">Steps for Using the Application</h3> 
        <ol class="svelte-ywbsvu"><li class="svelte-ywbsvu">A live feed is available when you <a href="https://radar.quadweather.com/auth/signup" target="_blank">sign up for an account</a>. You can also view historical NEXRAD Level II archive files.
                A built-in archive is provided with QuadWeather Extra. Visit your <a href="https://radar.quadweather.com/auth/account" target="_blank">account page</a> to join the beta. 
                You can also source your own Level II data. The best source for downloading data is the <a href="https://s3.amazonaws.com/noaa-nexrad-level2/index.html" target="_blank">AWS Explorer</a>. 
                A <a href="/KTLX20130520_201229_V06.gz">sample file</a> is available for the 20 May 2013 Moore tornado.</li> 
            <li class="svelte-ywbsvu">Load the file into the application by either clicking its name in Archive mode or choosing a file from your file system.</li> 
            <li class="svelte-ywbsvu">The default view is the Elevation View. The application will read the file to determine which elevation scans are present. Click
                on an elevation to view scan data. The default field is Reflectivity, but all fields present in the file can be selected in the map dropdown.</li> 
            <li class="svelte-ywbsvu">View the Reflectivity in 3D by clicking the 3D View button in the top bar then dragging a bounding box over the map. View a cross section 
                by clicking the Cross Section button and dragging a line across the map. 3D views are available for all users in Historical mode but only
                QuadWeather Extra users in Live mode.</li> 
            <li class="svelte-ywbsvu">The application can load up to five files. Remove a file from the application by entering the File View and clicking the trashcan icon next to the file name.
                In Live mode, the oldest file will be deleted automatically as new data is available.</li></ol>`,v=ot(),w=Ie("figure"),w.innerHTML=`<img class="heroimage svelte-ywbsvu" width="550" height="238" src="harvey.png" alt="logo"/> 
        <figcaption class="svelte-ywbsvu">3D view of Hurricane Harvey as it made landfall in Texas on 26 August 2017.</figcaption>`,S=ot(),A=Ie("div"),A.innerHTML=`<h3 class="svelte-ywbsvu">FAQs</h3> 
        <p class="q svelte-ywbsvu">The application isn&#39;t working on my device, why?</p> 
        <p class="a svelte-ywbsvu">This application uses modern web elements like WebAssembly and WebGL2. It requires an up-to-date, modern browser.
            More importantly, it requires a device that can use a good amount of memory (1GB+). It may work on some tablets. It will not work on mobile phones.</p> 
        <p class="q svelte-ywbsvu">Why does it take longer to load velocity data than the other data types?</p> 
        <p class="a svelte-ywbsvu">You likely have the application in Dealias mode. Level II data has only been lightly post-processed.
            Often, the raw velocity field suffers from a problem called &quot;aliasing&quot;, which means values fold from positive to negative
            and vice versa. Aliasing makes the velocity field impossible to interpret, so a dealiasing step is necessary. The math to
            perform dealiasing is complex, and your computer is doing heavy-duty calculations to correct the velocity field. The calculation
            can take 10 seconds or more at times, particularly in the restricted environment of mobile devices. It may not work at all on your mobile device.</p> 
        <h3 class="svelte-ywbsvu">Acknowledgements</h3> 
        <p class="a svelte-ywbsvu">This application uses icons generously provided by Lucide. <a href="https://lucide.dev/license" target="_blank">License.</a></p>`,I=ot(),R=Ie("div"),k=Ie("div"),L=Ie("span"),L.textContent=`${yG}${vG}`,z=ot(),B=Ie("div"),B.innerHTML=`<a class="twitter svelte-ywbsvu" href="https://twitter.com/QuadWeather" target="_blank"><img class="twitter svelte-ywbsvu" src="logo-white.png" alt="X (twitter)"/></a> 
                <a class="email svelte-ywbsvu" href="https://twitter.com/QuadWeather" target="_blank">@QuadWeather</a>`,$=ot(),H=Ie("span"),H.textContent="QuadWeather, LLC",Z(t,"class","logo svelte-ywbsvu"),Z(c,"class","group svelte-ywbsvu"),Z(p,"class","hero svelte-ywbsvu"),Z(x,"class","steps svelte-ywbsvu"),Z(w,"class","hero svelte-ywbsvu"),Z(A,"class","faq svelte-ywbsvu"),Z(L,"class","email svelte-ywbsvu"),Z(B,"class","twitter-container"),Z(H,"class","email svelte-ywbsvu"),Z(k,"class","footer-child svelte-ywbsvu"),Z(R,"class","footer svelte-ywbsvu"),Z(e,"class",G="about-container "+(i[0]==="OPEN"?"":"hide")+" svelte-ywbsvu")},m(le,te){Gt(le,e,te),Q(e,t),Q(e,s),Q(e,c),Q(e,h),Q(e,p),Q(e,r),Q(e,x),Q(e,v),Q(e,w),Q(e,S),Q(e,A),Q(e,I),Q(e,R),Q(R,k),Q(k,L),Q(k,z),Q(k,B),Q(k,$),Q(k,H)},p(le,[te]){te&1&&G!==(G="about-container "+(le[0]==="OPEN"?"":"hide")+" svelte-ywbsvu")&&Z(e,"class",G)},i:Vn,o:Vn,d(le){le&&Bt(e)}}}var yG="QuadWx",vG="@gmail.com";function bG(i,e,t){let{show:s="CLOSED"}=e;return i.$$set=c=>{"show"in c&&t(0,s=c.show)},[s]}var GL=class extends gi{constructor(e){super();Ti(this,e,bG,xG,ai,{show:0})}},HL=GL;function jL(i,e,t){let s=i.slice();return s[38]=e[t],s[40]=t,s}function WL(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k;return{c(){e=Ie("div"),t=Ie("form"),s=Ie("label"),s.innerHTML='Mapbox public <a href="https://docs.mapbox.com/api/maps/styles/" target="_blank">style URL</a>',c=ot(),h=Ie("input"),r=ot(),x=Ie("label"),x.innerHTML='Layer to render before <span class="optional svelte-11kzt0w"><i>(optional)</i></span>',v=ot(),w=Ie("input"),A=ot(),I=Ie("input"),Z(s,"class","man svelte-11kzt0w"),Z(s,"for","styleid"),Z(h,"class","text-input svelte-11kzt0w"),Z(h,"type","text"),Z(h,"id","styleid"),Z(h,"name","styleid"),h.value=p=i[7].value==="custom"?i[7].styleid:"",Z(x,"class","man svelte-11kzt0w"),Z(x,"for","layer"),Z(w,"class","text-input svelte-11kzt0w"),Z(w,"type","text"),Z(w,"id","layer"),Z(w,"name","layer"),w.value=S=i[7].value==="custom"?i[7].layer:"",Z(I,"class","b svelte-11kzt0w"),Z(I,"type","button"),I.value="Load Style",Z(t,"autocomplete","off"),Z(e,"class","custom-container svelte-11kzt0w")},m(L,z){Gt(L,e,z),Q(e,t),Q(t,s),Q(t,c),Q(t,h),Q(t,r),Q(t,x),Q(t,v),Q(t,w),Q(t,A),Q(t,I),R||(k=mn(I,"click",i[10]),R=!0)},p(L,z){z[0]&128&&p!==(p=L[7].value==="custom"?L[7].styleid:"")&&h.value!==p&&(h.value=p),z[0]&128&&S!==(S=L[7].value==="custom"?L[7].layer:"")&&w.value!==S&&(w.value=S)},d(L){L&&Bt(e),R=!1,k()}}}function XL(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k=i[3],L=[];for(let z=0;z<k.length;z+=1)L[z]=qL(jL(i,k,z));return{c(){e=Ie("p"),e.textContent="Color Tables",t=ot(),s=Ie("p"),s.innerHTML=`Add a custom Reflectivity color table file in the <a href="https://www.grlevelx.com/manuals/color_tables/files_color_table.htm" target="_blank">expected format</a>. 
        Sample files are available at <a href="https://www.wxtools.org/reflectivity" target="_blank">Wx Tools</a>.<br/><br/> 
        Only Reflectivity is currently supported (the Product in the color table file must be specified as &quot;BR&quot;).`,c=ot(),h=Ie("div"),p=Ie("input"),r=ot(),x=Ie("label"),v=Ie("input"),w=On(`
            Add Color Table File`),S=ot(),A=Ie("div");for(let z=0;z<L.length;z+=1)L[z].c();Z(e,"class","setting svelte-11kzt0w"),Z(s,"class","about-color svelte-11kzt0w"),Z(p,"type","file"),Z(p,"id","input"),p.multiple=!0,Z(p,"class","svelte-11kzt0w"),Z(v,"type","file"),Z(v,"class","svelte-11kzt0w"),Z(x,"class","custom-file-upload svelte-11kzt0w"),Z(h,"class","upload-button svelte-11kzt0w"),Z(A,"class","table-div svelte-11kzt0w")},m(z,B){Gt(z,e,B),Gt(z,t,B),Gt(z,s,B),Gt(z,c,B),Gt(z,h,B),Q(h,p),Q(h,r),Q(h,x),Q(x,v),i[27](v),Q(x,w),i[28](x),Gt(z,S,B),Gt(z,A,B);for(let $=0;$<L.length;$+=1)L[$].m(A,null);I||(R=mn(v,"change",i[11]),I=!0)},p(z,B){if(B[0]&12360){k=z[3];let $;for($=0;$<k.length;$+=1){let H=jL(z,k,$);L[$]?L[$].p(H,B):(L[$]=qL(H),L[$].c(),L[$].m(A,null))}for(;$<L.length;$+=1)L[$].d(1);L.length=k.length}},d(z){z&&Bt(e),z&&Bt(t),z&&Bt(s),z&&Bt(c),z&&Bt(h),i[27](null),i[28](null),z&&Bt(S),z&&Bt(A),Is(L,z),I=!1,R()}}}function ZL(i){let e,t,s;function c(){return i[30](i[38])}return{c(){e=Ie("button"),e.innerHTML=`<svg class="trash svelte-11kzt0w" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 468.36 468.36" style="enable-background:new 0 0 468.36 468.36;" xml:space="preserve"><g><g><path d="M381.048,64.229l-71.396,0.031L309.624,0L158.666,0.064l0.027,64.26l-71.405,0.031l0.024,60.056h293.76L381.048,64.229z
                                    M189.274,30.652l89.759-0.04l0.016,33.66l-89.759,0.04L189.274,30.652z"></path><path d="M87.312,468.36h293.76V139.71H87.312V468.36z M303.042,184.588h15.301v238.891h-15.301V184.588z M226.542,184.588h15.3
                                    v238.891h-15.3V184.588z M150.042,184.588h15.3v238.891h-15.3V184.588z"></path></g></g></svg>`,Z(e,"class","trashbutton svelte-11kzt0w")},m(h,p){Gt(h,e,p),t||(s=mn(e,"click",c),t=!0)},p(h,p){i=h},d(h){h&&Bt(e),t=!1,s()}}}function qL(i){let e,t,s=i[38].name+"",c,h,p,r=`<img class="colorbar-image" src="${i[38].image}">`,x,v,w,S;function A(){return i[29](i[38])}let I=i[38].id!=1&&ZL(i);return{c(){e=Ie("div"),t=Ie("p"),c=On(s),h=ot(),p=Ie("div"),x=ot(),I&&I.c(),v=ot(),Z(t,"class","colorbar-name svelte-11kzt0w"),Z(p,"class","wrapper svelte-11kzt0w"),Rn(p,"active",i[6].br.current===i[40]),Z(e,"class","colorbar-entry svelte-11kzt0w")},m(R,k){Gt(R,e,k),Q(e,t),Q(t,c),Q(e,h),Q(e,p),p.innerHTML=r,Q(e,x),I&&I.m(e,null),Q(e,v),w||(S=mn(p,"click",A),w=!0)},p(R,k){i=R,k[0]&8&&s!==(s=i[38].name+"")&&si(c,s),k[0]&8&&r!==(r=`<img class="colorbar-image" src="${i[38].image}">`)&&(p.innerHTML=r),k[0]&64&&Rn(p,"active",i[6].br.current===i[40]),i[38].id!=1?I?I.p(i,k):(I=ZL(i),I.c(),I.m(e,v)):I&&(I.d(1),I=null)},d(R){R&&Bt(e),I&&I.d(),w=!1,S()}}}function wG(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L,z,B,$,H,G,le,te,ue,me,se,Y,ye,Xe,ge,re,ve,ae,de,xe,De,Ce,pe,xt,Ct,ct,Qe,zt,Zt,Lt=i[1]==="custom"&&WL(i),Re=i[6]!="unsupported"&&XL(i);return{c(){e=Ie("div"),t=Ie("p"),t.textContent="Basemap",s=ot(),c=Ie("div"),h=Ie("label"),p=Ie("input"),r=On(`
            Default`),x=ot(),v=Ie("label"),w=Ie("input"),S=On(`
            Satellite`),A=ot(),I=Ie("label"),R=Ie("input"),k=On(`
            Traffic`),L=ot(),z=Ie("label"),B=Ie("input"),$=On(`
            Custom`),H=ot(),Lt&&Lt.c(),G=ot(),le=Ie("p"),le.textContent="Dual Map Split",te=ot(),ue=Ie("div"),me=Ie("label"),se=Ie("input"),Y=On(`
            Horizontal`),ye=ot(),Xe=Ie("label"),ge=Ie("input"),re=On(`
            Vertical`),ve=ot(),ae=Ie("p"),ae.textContent="Radar Data Opacity",de=ot(),xe=Ie("div"),De=Ie("span"),De.textContent="transparent",Ce=ot(),pe=Ie("input"),xt=ot(),Ct=Ie("span"),Ct.textContent="opaque",ct=ot(),Re&&Re.c(),Z(t,"class","setting basemap svelte-11kzt0w"),Z(p,"class","app-radio svelte-11kzt0w"),Z(p,"type","radio"),p.__value="monochrome",p.value=p.__value,i[20][0].push(p),Z(h,"class","split svelte-11kzt0w"),Z(w,"class","app-radio svelte-11kzt0w"),Z(w,"type","radio"),w.__value="satellite",w.value=w.__value,i[20][0].push(w),Z(v,"class","split svelte-11kzt0w"),Z(R,"class","app-radio svelte-11kzt0w"),Z(R,"type","radio"),R.__value="traffic",R.value=R.__value,i[20][0].push(R),Z(I,"class","split svelte-11kzt0w"),Z(B,"class","app-radio svelte-11kzt0w"),Z(B,"type","radio"),B.__value="custom",B.value=B.__value,i[20][0].push(B),Z(z,"class","split svelte-11kzt0w"),Z(c,"class","nested svelte-11kzt0w"),Z(le,"class","setting svelte-11kzt0w"),Z(se,"class","app-radio svelte-11kzt0w"),Z(se,"type","radio"),Z(se,"name","layout"),se.__value="horizontal",se.value=se.__value,i[20][1].push(se),Z(me,"class","split svelte-11kzt0w"),Z(ge,"class","app-radio split svelte-11kzt0w"),Z(ge,"type","radio"),Z(ge,"name","layout"),ge.__value="vertical",ge.value=ge.__value,i[20][1].push(ge),Z(Xe,"class","split svelte-11kzt0w"),Z(ue,"class","nested svelte-11kzt0w"),Z(ae,"class","setting svelte-11kzt0w"),Z(De,"class","svelte-11kzt0w"),Z(pe,"type","range"),Z(pe,"step","0.01"),Z(pe,"class","slider svelte-11kzt0w"),Z(pe,"id","opacity"),Z(pe,"name","opacity"),Z(pe,"min","0"),Z(pe,"max","1"),Z(Ct,"class","svelte-11kzt0w"),Z(xe,"class","slider-container svelte-11kzt0w"),Z(e,"class","container svelte-11kzt0w")},m(qt,nt){Gt(qt,e,nt),Q(e,t),Q(e,s),Q(e,c),Q(c,h),Q(h,p),p.checked=p.__value===i[1],Q(h,r),Q(c,x),Q(c,v),Q(v,w),w.checked=w.__value===i[1],Q(v,S),Q(c,A),Q(c,I),Q(I,R),R.checked=R.__value===i[1],Q(I,k),Q(c,L),Q(c,z),Q(z,B),B.checked=B.__value===i[1],Q(z,$),Q(e,H),Lt&&Lt.m(e,null),Q(e,G),Q(e,le),Q(e,te),Q(e,ue),Q(ue,me),Q(me,se),se.checked=se.__value===i[8],Q(me,Y),Q(ue,ye),Q(ue,Xe),Q(Xe,ge),ge.checked=ge.__value===i[8],Q(Xe,re),Q(e,ve),Q(e,ae),Q(e,de),Q(e,xe),Q(xe,De),Q(xe,Ce),Q(xe,pe),Ll(pe,i[2]),Q(xe,xt),Q(xe,Ct),Q(e,ct),Re&&Re.m(e,null),zt||(Zt=[mn(p,"keydown",Yd(i[18])),mn(p,"change",i[19]),mn(w,"keydown",Yd(i[17])),mn(w,"change",i[21]),mn(R,"keydown",Yd(i[16])),mn(R,"change",i[22]),mn(B,"keydown",Yd(i[15])),mn(B,"change",i[23]),mn(se,"change",i[24]),mn(se,"change",i[14]),mn(ge,"change",i[25]),mn(ge,"change",i[14]),mn(pe,"change",i[26]),mn(pe,"input",i[26]),Cl(Qe=du.call(null,e,{callback:i[9],state:i[0]}))],zt=!0)},p(qt,nt){nt[0]&2&&(p.checked=p.__value===qt[1]),nt[0]&2&&(w.checked=w.__value===qt[1]),nt[0]&2&&(R.checked=R.__value===qt[1]),nt[0]&2&&(B.checked=B.__value===qt[1]),qt[1]==="custom"?Lt?Lt.p(qt,nt):(Lt=WL(qt),Lt.c(),Lt.m(e,G)):Lt&&(Lt.d(1),Lt=null),nt[0]&256&&(se.checked=se.__value===qt[8]),nt[0]&256&&(ge.checked=ge.__value===qt[8]),nt[0]&4&&Ll(pe,qt[2]),qt[6]!="unsupported"?Re?Re.p(qt,nt):(Re=XL(qt),Re.c(),Re.m(e,null)):Re&&(Re.d(1),Re=null),Qe&&Jr(Qe.update)&&nt[0]&1&&Qe.update.call(null,{callback:qt[9],state:qt[0]})},i:Vn,o:Vn,d(qt){qt&&Bt(e),i[20][0].splice(i[20][0].indexOf(p),1),i[20][0].splice(i[20][0].indexOf(w),1),i[20][0].splice(i[20][0].indexOf(R),1),i[20][0].splice(i[20][0].indexOf(B),1),Lt&&Lt.d(),i[20][1].splice(i[20][1].indexOf(se),1),i[20][1].splice(i[20][1].indexOf(ge),1),Re&&Re.d(),zt=!1,cr(Zt)}}}function TG(i,e,t){let s,c,h,p,r;It(i,Xo,ct=>t(6,s=ct)),It(i,Zi,ct=>t(32,c=ct)),It(i,Ym,ct=>t(33,h=ct)),It(i,vh,ct=>t(7,p=ct)),It(i,Ea,ct=>t(8,r=ct));let{showAppearance:x="CLOSED"}=e;function v(){t(0,x="CLOSED")}let w=p.value,S=h.opacity,A=[],I,R;s!="unsupported"&&(A=s.br.all);let k=new FileReader,L={monochrome:"mapbox://styles/quadweather/cksxhy0l281db18nvnnfvdigv",satellite:"mapbox://styles/mapbox/satellite-streets-v12",traffic:"mapbox://styles/mapbox/navigation-night-v1"};function z(){if(w==="custom")return;let ct;w==="satellite"&&(ct="tunnel-minor-case"),w==="monochrome"&&(ct="land-structure-line"),w==="traffic"&&(ct="turning-feature-outline-navigation"),on(vh,p={value:w,styleid:L[w],layer:ct},p)}function B(ct){Zi.update(Qe=>(Qe.error=!0,Qe.message=`There was an error loading the style ${ct}. Please check that the style URL is correct and that the style is public.`,Qe.header="Style not loaded",Qe.color="normal",Qe))}async function $(ct){let Qe=document.getElementById("styleid").value,zt=document.getElementById("layer").value;if(Qe){let Zt=/mapbox:\/\/styles\/([a-zA-Z0-9\-]*)\/([\s\S]*)/i,Lt=Qe.match(Zt);if(!Lt||Lt.length!=3){B(Qe);return}let Re;if(await fetch(`https://api.mapbox.com/styles/v1/${Lt[1]}/${Lt[2]}?access_token=pk.eyJ1IjoicXVhZHdlYXRoZXIiLCJhIjoiY2w2YXZ4YjAzMWdmODNkbWx5YmwycjcxaSJ9.DOMnL520hn-dTFcGgkH2BQ`).then(qt=>{if(!qt.ok)throw new Error("Network response was not OK");Re=1}).catch(qt=>{Re=0}),!Re){B(Qe);return}on(vh,p={value:w,styleid:Qe,layer:zt},p)}}function H(){let ct={...h};ct.opacity=S,on(Ym,h=ct,h)}async function G(ct){if(this.files.length){let Qe=this.files[0];k.onload=async function(zt){let Zt=zt.target.result,Lt=Qe.name,Re=Zt.split(`
`),qt=null,nt=null,at=null,St=/;.*$/,ut=Re.map(xn=>xn.trim()).filter(xn=>xn&&!xn.startsWith(";")).map(xn=>xn.replace(St,"")).map(xn=>xn.split(":"));for(let xn=0;xn<ut.length;xn++){if(ut[xn].length===2&&ut[xn][0].trim().toLowerCase()==="product"&&ut[xn][1].trim().toLowerCase()!="br"){on(Zi,c={error:!0,message:"Only Reflectivity (BR) is currently supported",header:"Unsupported product"},c);return}ut[xn].length===2&&ut[xn][0].trim().toLowerCase()==="product"&&(qt=ut[xn][1].trim().toLowerCase()),ut[xn].length===2&&ut[xn][0].trim().toLowerCase()==="scale"&&(nt=parseFloat(ut[xn][1])),ut[xn].length===2&&ut[xn][0].trim().toLowerCase()==="units"&&(at=ut[xn][1].trim().toLowerCase())}if(qt===null){on(Zi,c={error:!0,message:"The supplied color table file is incomplete",header:"Missing required properties"},c);return}let Ot=[];for(let xn=0;xn<ut.length;xn++)if(ut[xn].length===2){ut[xn][0]=ut[xn][0].trim().toLowerCase(),ut[xn][1]=ut[xn][1].trim();let ze=ut[xn][1].split(/\s+/).filter(gt=>!isNaN(parseFloat(gt))).map(gt=>parseFloat(gt)),Ae=ze.shift();if(ut[xn][0]==="color"&&ze.length===3)Ot.push([Ae,ze]);else if(ut[xn][0]==="color"&&ze.length===6){let gt=ze.slice(0,3),Rt=ze.slice(3);Ot.push([Ae,gt,Rt])}else if(ut[xn][0]==="color4"&&ze.length===4)ze[ze.length-1]=ze[ze.length-1]/255,Ot.push([Ae,ze]);else if(ut[xn][0]==="color4"&&ze.length===8){let gt=ze.slice(0,4);gt[gt.length-1]=gt[gt.length-1]/255;let Rt=ze.slice(4);Rt[Rt.length-1]=Rt[Rt.length-1]/255,Ot.push([Ae,gt,Rt])}else ut[xn][0]==="solidcolor"&&ze.length===3?Ot.push([Ae,ze,ze]):ut[xn][0]==="solidcolor4"&&ze.length===4&&(ze[ze.length-1]=ze[ze.length-1]/255,Ot.push([Ae,ze,ze]))}let Pn=await Th.setColorValue("colorTables",Ot,Lt.split(".")[0],qt,nt,at),bn=Yy(Ot,Lt.split(".")[0],Pn,qt,nt,at),wn={...s};wn[qt].all.push(bn),on(Xo,s=wn,s),t(3,A=s[qt].all)},k.readAsText(Qe)}t(5,R.value=null,R)}function le(ct){let Qe=s[ct.product].all;for(let zt=0;zt<Qe.length;zt++)if(Qe[zt].id===ct.id){on(Xo,s[ct.product].current=zt,s);break}Th.selectColor("colorTables",ct)}async function te(ct){let Qe,zt=s[ct.product].all,Zt;for(let Lt=0;Lt<zt.length;Lt++)if(zt[Lt].id===ct.id){Zt=Lt;break}s[ct.product].all[s[ct.product].current].id===ct.id&&(Qe=!0),s[ct.product].all.splice(Zt,1),s[ct.product].current>=Zt&&on(Xo,s[ct.product].current-=1,s),t(3,A=s[ct.product].all),await Th.deleteColor("colorTables",ct),Qe&&(Th.selectColor("colorTables",s[ct.product].all[0]),on(Xo,s[ct.product].current=0,s))}function ue(ct){Ea.set(ct.target.value)}let me=[[],[]];function se(ct){Jd.call(this,i,ct)}function Y(ct){Jd.call(this,i,ct)}function ye(ct){Jd.call(this,i,ct)}function Xe(ct){Jd.call(this,i,ct)}function ge(){w=this.__value,t(1,w)}function re(){w=this.__value,t(1,w)}function ve(){w=this.__value,t(1,w)}function ae(){w=this.__value,t(1,w)}function de(){r=this.__value,Ea.set(r)}function xe(){r=this.__value,Ea.set(r)}function De(){S=n1(this.value),t(2,S)}function Ce(ct){wi[ct?"unshift":"push"](()=>{R=ct,t(5,R)})}function pe(ct){wi[ct?"unshift":"push"](()=>{I=ct,t(4,I)})}let xt=ct=>le(ct),Ct=ct=>te(ct);return i.$$set=ct=>{"showAppearance"in ct&&t(0,x=ct.showAppearance)},i.$$.update=()=>{if(i.$$.dirty[0]&2){e:z()}if(i.$$.dirty[0]&4){e:H()}},[x,w,S,A,I,R,s,p,r,v,$,G,le,te,ue,se,Y,ye,Xe,ge,me,re,ve,ae,de,xe,De,Ce,pe,xt,Ct]}var KL=class extends gi{constructor(e){super();Ti(this,e,TG,wG,ai,{showAppearance:0},null,[-1,-1])}},YL=KL;function JL(i,e,t){let s=i.slice();return s[34]=e[t],s[36]=t,s}function $L(i){let e,t,s;return{c(){e=Ie("span"),t=Ie("i"),s=On(i[7]),Z(e,"class","notice svelte-1ohk5ia")},m(c,h){Gt(c,e,h),Q(e,t),Q(t,s)},p(c,h){h[0]&128&&si(s,c[7])},d(c){c&&Bt(e)}}}function EG(i){let e;return{c(){e=Ie("tr"),e.innerHTML=`<td class="jet svelte-1ohk5ia">None</td> 
                        <td class="jet svelte-1ohk5ia">None</td>`,Z(e,"class","svelte-1ohk5ia")},m(t,s){Gt(t,e,s)},p:Vn,d(t){t&&Bt(e)}}}function SG(i){let e,t=i[5],s=[];for(let c=0;c<t.length;c+=1)s[c]=QL(JL(i,t,c));return{c(){for(let c=0;c<s.length;c+=1)s[c].c();e=Gs()},m(c,h){for(let p=0;p<s.length;p+=1)s[p].m(c,h);Gt(c,e,h)},p(c,h){if(h[0]&2080){t=c[5];let p;for(p=0;p<t.length;p+=1){let r=JL(c,t,p);s[p]?s[p].p(r,h):(s[p]=QL(r),s[p].c(),s[p].m(e.parentNode,e))}for(;p<s.length;p+=1)s[p].d(1);s.length=t.length}},d(c){Is(s,c),c&&Bt(e)}}}function QL(i){let e,t,s=i[34].key.split("/").pop()+"",c,h,p,r=(i[34].size/1e6).toFixed(1)+"",x,v,w,S,A;function I(){return i[15](i[34],i[36])}return{c(){e=Ie("tr"),t=Ie("td"),c=On(s),h=ot(),p=Ie("td"),x=On(r),v=On("MB"),w=ot(),Z(t,"class","jet svelte-1ohk5ia"),Z(p,"class","jet svelte-1ohk5ia"),Z(e,"tabindex","0"),Z(e,"class","svelte-1ohk5ia"),Rn(e,"selected",!!i[34].selected)},m(R,k){Gt(R,e,k),Q(e,t),Q(t,c),Q(e,h),Q(e,p),Q(p,x),Q(p,v),Q(e,w),S||(A=mn(e,"click",I),S=!0)},p(R,k){i=R,k[0]&32&&s!==(s=i[34].key.split("/").pop()+"")&&si(c,s),k[0]&32&&r!==(r=(i[34].size/1e6).toFixed(1)+"")&&si(x,r),k[0]&32&&Rn(e,"selected",!!i[34].selected)},d(R){R&&Bt(e),S=!1,A()}}}function eD(i){let e,t,s;function c(r,x){return r[1].toDownload?MG:AG}let h=c(i,[-1,-1]),p=h(i);return{c(){e=Ie("div"),p.c(),t=ot(),s=Ie("div"),Z(s,"class","lds-dual-ring svelte-1ohk5ia"),Z(e,"class","loadingWrapper svelte-1ohk5ia")},m(r,x){Gt(r,e,x),p.m(e,null),Q(e,t),Q(e,s)},p(r,x){h===(h=c(r,x))&&p?p.p(r,x):(p.d(1),p=h(r),p&&(p.c(),p.m(e,t)))},d(r){r&&Bt(e),p.d()}}}function AG(i){let e;return{c(){e=Ie("div"),e.textContent="Loading File List",Z(e,"class","of svelte-1ohk5ia")},m(t,s){Gt(t,e,s)},p:Vn,d(t){t&&Bt(e)}}}function MG(i){let e,t,s=i[1].downloaded+1+"",c,h,p=i[1].toDownload+i[1].downloaded+"",r;return{c(){e=Ie("div"),t=On("Downloading "),c=On(s),h=On(" of "),r=On(p),Z(e,"class","of svelte-1ohk5ia")},m(x,v){Gt(x,e,v),Q(e,t),Q(e,c),Q(e,h),Q(e,r)},p(x,v){v[0]&2&&s!==(s=x[1].downloaded+1+"")&&si(c,s),v[0]&2&&p!==(p=x[1].toDownload+x[1].downloaded+"")&&si(r,p)},d(x){x&&Bt(e)}}}function IG(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L,z,B,$,H,G,le,te,ue,me,se,Y,ye,Xe,ge,re,ve,ae,de=i[7]&&$L(i);function xe(xt,Ct){return xt[5].length?SG:EG}let De=xe(i,[-1,-1]),Ce=De(i),pe=(i[1].toDownload||i[6])&&eD(i);return{c(){e=Ie("div"),t=Ie("div"),t.innerHTML=`<div class="line svelte-1ohk5ia"></div> 
        <div class="line svelte-1ohk5ia"></div> 
        <div class="line svelte-1ohk5ia"></div>`,s=ot(),c=Ie("div"),h=Ie("button"),h.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>',r=ot(),x=Ie("form"),v=Ie("div"),w=Ie("div"),S=Ie("span"),S.textContent="Date",A=ot(),I=Ie("input"),R=ot(),k=Ie("div"),L=Ie("span"),L.textContent="Site",z=ot(),B=Ie("input"),$=ot(),H=Ie("div"),de&&de.c(),G=ot(),le=Ie("button"),le.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scroll button-svg svelte-1ohk5ia"><path d="M19 17V5a2 2 0 0 0-2-2H4"></path><path d="M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3"></path></svg> 
            <span class="button-span svelte-1ohk5ia">View Files</span>`,te=ot(),ue=Ie("div"),me=Ie("table"),se=Ie("colgroup"),se.innerHTML=`<col style="width:80%;"/> 
                <col style="width:20%;"/>`,Y=ot(),ye=Ie("thead"),ye.innerHTML=`<tr class="svelte-1ohk5ia"><th class="svelte-1ohk5ia">File</th> 
                    <th class="svelte-1ohk5ia">Size</th></tr>`,Xe=ot(),ge=Ie("tbody"),Ce.c(),re=ot(),pe&&pe.c(),Z(t,"class","grab svelte-1ohk5ia"),Z(h,"id","close"),Z(h,"class",p=""+(fo("close-button")+" svelte-1ohk5ia")),Z(c,"class","close svelte-1ohk5ia"),Z(S,"class","input-label svelte-1ohk5ia"),Z(I,"id","date"),Z(I,"type","date"),Z(L,"class","input-label svelte-1ohk5ia"),Z(B,"id","tinput"),Z(B,"type","text"),Z(B,"placeholder","Site (e.g., KCLE)"),Z(v,"class","input-container svelte-1ohk5ia"),Z(H,"class","notice-container svelte-1ohk5ia"),Z(le,"id","view"),Z(le,"class","main sub svelte-1ohk5ia"),Z(le,"type","submit"),Z(x,"class","inputs svelte-1ohk5ia"),Z(ye,"class","svelte-1ohk5ia"),Z(ge,"class","svelte-1ohk5ia"),Z(me,"class","svelte-1ohk5ia"),Z(ue,"id","results"),Z(ue,"class","resultContainer svelte-1ohk5ia"),Z(e,"class","container svelte-1ohk5ia"),Rn(e,"active",!!i[0])},m(xt,Ct){Gt(xt,e,Ct),Q(e,t),Q(e,s),Q(e,c),Q(c,h),Q(e,r),Q(e,x),Q(x,v),Q(v,w),Q(w,S),Q(w,A),Q(w,I),Ll(I,i[2]),Q(v,R),Q(v,k),Q(k,L),Q(k,z),Q(k,B),Ll(B,i[4]),Q(x,$),Q(x,H),de&&de.m(H,null),Q(x,G),Q(x,le),Q(e,te),Q(e,ue),Q(ue,me),Q(me,se),Q(me,Y),Q(me,ye),Q(me,Xe),Q(me,ge),Ce.m(ge,null),Q(e,re),pe&&pe.m(e,null),i[16](e),ve||(ae=[mn(h,"click",i[12]),mn(I,"input",i[13]),mn(I,"change",i[8]),mn(B,"input",i[14]),mn(B,"input",i[10]),mn(x,"submit",i[9])],ve=!0)},p(xt,Ct){Ct[0]&4&&Ll(I,xt[2]),Ct[0]&16&&B.value!==xt[4]&&Ll(B,xt[4]),xt[7]?de?de.p(xt,Ct):(de=$L(xt),de.c(),de.m(H,null)):de&&(de.d(1),de=null),De===(De=xe(xt,Ct))&&Ce?Ce.p(xt,Ct):(Ce.d(1),Ce=De(xt),Ce&&(Ce.c(),Ce.m(ge,null))),xt[1].toDownload||xt[6]?pe?pe.p(xt,Ct):(pe=eD(xt),pe.c(),pe.m(e,null)):pe&&(pe.d(1),pe=null),Ct[0]&1&&Rn(e,"active",!!xt[0])},i:Vn,o:Vn,d(xt){xt&&Bt(e),de&&de.d(),Ce.d(),pe&&pe.d(),i[16](null),ve=!1,cr(ae)}}}function CG(i,e,t){let s,c,h,p,r,x;It(i,Gc,Ce=>t(0,s=Ce)),It(i,Rs,Ce=>t(1,c=Ce)),It(i,Vr,Ce=>t(26,h=Ce)),It(i,_i,Ce=>t(27,p=Ce)),It(i,ni,Ce=>t(28,r=Ce)),It(i,Zi,Ce=>t(29,x=Ce));let v=bo(),w="",S,A="",I=!1,R=[],k=!1,L="Select a date and site.";function z(){I=w&&A.trim(),I?t(7,L=""):t(7,L="Select a date and site.")}async function B(Ce){Ce.preventDefault(),I&&(t(6,k=!0),gr.get(`${$s}/archive/list?date=${w}&site=${A}`).then(pe=>pe.json()).then(pe=>{t(5,R=pe),G(),t(6,k=!1)}).catch(pe=>{t(6,k=!1)}))}function $(Ce){Ce.target.value=Ce.target.value.toUpperCase(),t(4,A=Ce.target.value),z()}async function H(Ce,pe){let xt=0,Ct=[];for(let zt=0;zt<r.length;zt++)r[zt]&&r[zt].loaded&&(xt++,Ct.push(r[zt].fileName));if(Ct=Ct.concat(c.readFiles).concat(c.downloadFiles),c.toDownload+xt>=5||xt>=5){on(Zi,x={error:!0,message:"The application cannot load more than 5 files. Remove a file by clicking the trashcan icon in the File View before loading another.",header:"Too many files"},x);return}let ct=Ce.split("/").pop();if(Ct.indexOf(ct)>=0){on(Zi,x={error:!0,message:"A file already exists with the name "+ct,header:"Duplicate file"},x);return}on(Rs,c.toDownload+=1,c),c.downloadFiles.push(ct),G();let Qe=encodeURIComponent(Ce);gr.get(`${$s}/archive/retrieve?object=${Qe}`).then(zt=>zt.arrayBuffer()).then(zt=>{let Zt=zt,Lt=new Uint8Array(Zt);try{Lt=ph(Lt)}catch(at){}let Re=Ho(ct),qt="";for(let at=0;at<6;at++)qt=qt+String.fromCharCode(Lt[at]);if(qt!="AR2V00"&&qt!="ARCHIV"&&!Re.elevationFile){on(Rs,c.toDownload-=1,c),qt==="ARCHIV"?on(Zi,x={error:!0,message:"The application cannot yet read files in an old format like "+Ce.name+".",header:"Old format"},x):on(Zi,x={error:!0,message:"The file "+Ce.name+" could not be read due to an unexpected format.",header:"Unexpected format"},x);return}let nt={message:"initialize",status:null,jobId:null,buffer:Lt.buffer,source:"download"};Re.type==="chunk"&&(nt.message="readChunk"),Object.assign(nt,Re),Ii.submit({data:nt}),t(5,R[pe].selected=!0,R),t(5,R[pe].idx=pe,R)}).catch(zt=>{let Zt=c.downloadFiles.filter(Lt=>Lt!==ct);on(Rs,c.toDownload-=1,c),on(Rs,c.downloadFiles=Zt,c)})}function G(){if(!s)return;let Ce=[];for(let pe=0;pe<r.length;pe++)r[pe]&&r[pe].loaded&&Ce.push(r[pe].fileName);Ce=Ce.concat(c.readFiles).concat(c.downloadFiles);for(let pe=0;pe<R.length;pe++)Ce.includes(R[pe].key.split("/").pop())?t(5,R[pe].selected=!0,R):t(5,R[pe].selected=!1,R)}function le(){if(c.downloaded>0&&c.toDownload===0&&(on(Rs,c.downloaded=0,c),!p[0].scan)){let Ce={elevation:h.elevations[h.stations[0]][0],station:h.stations[0]},pe=h.scans[Ce.station][Ce.elevation],xt={fileNumber:pe[0][0].fileNumber,scan:pe[0],fileName:pe[0][0].fileName,station:Ce.station};v.logStore(xt),rr.setStates(),rr.setSites()}}let te=0,ue=0,me,se,Y,ye,Xe,ge;function re(Ce){te+=Ce.dx,ue+=Ce.dy,me.style("transform",`translate(${te}px,${ue}px)`)}Zs(()=>{me=ro(S),se=ro("#tinput"),Y=ro("#results"),ye=ro("#date"),Xe=ro("#view"),ge=ro("#close"),me.call(Pv().on("drag",re)),se.on("mousedown",Ce=>{Ce.stopPropagation()}),se.on("touchstart",Ce=>{Ce.stopPropagation()}),Y.on("mousedown",Ce=>{Ce.stopPropagation()}),Y.on("touchstart",Ce=>{Ce.stopPropagation()}),Xe.on("mousedown",Ce=>{Ce.stopPropagation()}),Xe.on("touchstart",Ce=>{Ce.stopPropagation()}),ye.on("mousedown",Ce=>{Ce.stopPropagation()}),ye.on("touchstart",Ce=>{Ce.stopPropagation()}),ge.on("mousedown",Ce=>{Ce.stopPropagation()}),ge.on("touchstart",Ce=>{Ce.stopPropagation()})});function ve(){on(Gc,s=!1,s)}zi.setUpdateArchive(G);function ae(){w=this.value,t(2,w)}function de(){A=this.value,t(4,A)}let xe=(Ce,pe)=>H(Ce.key,pe);function De(Ce){wi[Ce?"unshift":"push"](()=>{S=Ce,t(3,S)})}return i.$$.update=()=>{if(i.$$.dirty[0]&2){e:le()}if(i.$$.dirty[0]&1){e:G()}},[s,c,w,S,A,R,k,L,z,B,$,H,ve,ae,de,xe,De]}var tD=class extends gi{constructor(e){super();Ti(this,e,CG,IG,ai,{},null,[-1,-1])}},nD=tD;function LG(i){let e,t,s;return{c(){e=ii("svg"),t=ii("path"),s=ii("path"),Z(t,"d","M4 4v16h16"),Z(s,"d","m4 20 7-7"),Z(e,"xmlns","http://www.w3.org/2000/svg"),Z(e,"width","18"),Z(e,"height","18"),Z(e,"viewBox","0 0 24 24"),Z(e,"fill","none"),Z(e,"stroke","currentColor"),Z(e,"stroke-width","2"),Z(e,"stroke-linecap","round"),Z(e,"stroke-linejoin","round"),Z(e,"class","lucide lucide-axis-3d button-svg svelte-qpuaqj")},m(c,h){Gt(c,e,h),Q(e,t),Q(e,s)},d(c){c&&Bt(e)}}}function DG(i){let e,t,s,c,h,p,r,x;return{c(){e=ii("svg"),t=ii("path"),s=ii("circle"),c=ii("path"),h=ii("circle"),p=ii("path"),r=ii("path"),x=ii("path"),Z(t,"d","M5.42 9.42 8 12"),Z(s,"cx","4"),Z(s,"cy","8"),Z(s,"r","2"),Z(c,"d","m14 6-8.58 8.58"),Z(h,"cx","4"),Z(h,"cy","16"),Z(h,"r","2"),Z(p,"d","M10.8 14.8 14 18"),Z(r,"d","M16 12h-2"),Z(x,"d","M22 12h-2"),Z(e,"xmlns","http://www.w3.org/2000/svg"),Z(e,"width","18"),Z(e,"height","18"),Z(e,"viewBox","0 0 24 24"),Z(e,"fill","none"),Z(e,"stroke","currentColor"),Z(e,"stroke-width","2"),Z(e,"stroke-linecap","round"),Z(e,"stroke-linejoin","round"),Z(e,"class","lucide lucide-scissors-line-dashed button-svg svelte-qpuaqj")},m(v,w){Gt(v,e,w),Q(e,t),Q(e,s),Q(e,c),Q(e,h),Q(e,p),Q(e,r),Q(e,x)},d(v){v&&Bt(e)}}}function RG(i){let e,t,s,c;return{c(){e=ii("svg"),t=ii("path"),s=ii("path"),c=ii("path"),Z(t,"d","M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"),Z(s,"d","m3.3 7 8.7 5 8.7-5"),Z(c,"d","M12 22V12"),Z(e,"xmlns","http://www.w3.org/2000/svg"),Z(e,"width","18"),Z(e,"height","18"),Z(e,"viewBox","0 0 24 24"),Z(e,"fill","none"),Z(e,"stroke","currentColor"),Z(e,"stroke-width","2"),Z(e,"stroke-linecap","round"),Z(e,"stroke-linejoin","round"),Z(e,"class","lucide lucide-box button-svg svelte-qpuaqj")},m(h,p){Gt(h,e,p),Q(e,t),Q(e,s),Q(e,c)},d(h){h&&Bt(e)}}}function iD(i){let e,t,s;return{c(){e=Ie("button"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-1 button-svg svelte-qpuaqj"><path d="M11 14h1v4"></path><path d="M16 2v4"></path><path d="M3 10h18"></path><path d="M8 2v4"></path><rect x="3" y="4" width="18" height="18" rx="2"></rect></svg> 
                <span class="button-span svelte-qpuaqj">Archive</span>`,Z(e,"class","main svelte-qpuaqj"),Rn(e,"active",!!i[9])},m(c,h){Gt(c,e,h),t||(s=mn(e,"click",i[38]),t=!0)},p(c,h){h[0]&512&&Rn(e,"active",!!c[9])},d(c){c&&Bt(e),t=!1,s()}}}function rD(i){let e,t,s,c,h;return{c(){e=Ie("button"),e.textContent="Alerts",t=ot(),s=Ie("button"),s.textContent="Statements",Z(e,"class","layer-button svelte-qpuaqj"),Rn(e,"layer-active",!!i[12]),Z(s,"class","layer-button svelte-qpuaqj"),Rn(s,"layer-active",!!i[11])},m(p,r){Gt(p,e,r),Gt(p,t,r),Gt(p,s,r),c||(h=[mn(e,"click",i[33]),mn(s,"click",i[34])],c=!0)},p(p,r){r[0]&4096&&Rn(e,"layer-active",!!p[12]),r[0]&2048&&Rn(s,"layer-active",!!p[11])},d(p){p&&Bt(e),p&&Bt(t),p&&Bt(s),c=!1,cr(h)}}}function sD(i){let e,t,s;return{c(){e=Ie("button"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in button-svg svelte-qpuaqj"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" x2="3" y1="12" y2="12"></line></svg> 
                <span class="span-svg">Log in</span>`,Z(e,"class","main account svelte-qpuaqj"),Rn(e,"active",i[8]==="open")},m(c,h){Gt(c,e,h),t||(s=mn(e,"click",PG),t=!0)},p(c,h){h[0]&256&&Rn(e,"active",c[8]==="open")},d(c){c&&Bt(e),t=!1,s()}}}function oD(i){let e,t,s;return{c(){e=Ie("button"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings button-svg svelte-qpuaqj"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> 
                <span class="span-svg">Account</span>`,Z(e,"class","main account svelte-qpuaqj"),Rn(e,"active",i[8]==="open")},m(c,h){Gt(c,e,h),t||(s=mn(e,"click",i[36]),t=!0)},p(c,h){h[0]&256&&Rn(e,"active",c[8]==="open")},d(c){c&&Bt(e),t=!1,s()}}}function aD(i){let e,t,s,c=(i[4]?i[4].username:"")+"",h,p,r,x=(i[4]?i[4].username:"")+"",v,w,S,A,I,R,k,L,z;return{c(){e=Ie("div"),t=Ie("div"),s=Ie("span"),h=On(c),p=ot(),r=Ie("span"),v=On(x),w=ot(),S=Ie("div"),A=Ie("button"),A.innerHTML=`<span class="span-svg">View Details</span> 
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-arrow-out-up-right button-svg-right svelte-qpuaqj"><path d="M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6"></path><path d="m21 3-9 9"></path><path d="M15 3h6v6"></path></svg>`,I=ot(),R=Ie("button"),R.textContent="Log Out",Z(s,"class","bold svelte-qpuaqj"),Z(r,"class","secondary svelte-qpuaqj"),Z(t,"class","row svelte-qpuaqj"),Z(A,"class","main log svelte-qpuaqj"),Z(R,"class","main account svelte-qpuaqj"),Z(S,"class","acontainer svelte-qpuaqj"),Z(e,"class","settings-container svelte-qpuaqj")},m(B,$){Gt(B,e,$),Q(e,t),Q(t,s),Q(s,h),Q(t,p),Q(t,r),Q(r,v),Q(e,w),Q(e,S),Q(S,A),Q(S,I),Q(S,R),L||(z=[mn(A,"click",kG),mn(R,"click",i[35]),Cl(k=du.call(null,e,{callback:i[40],state:i[7]}))],L=!0)},p(B,$){$[0]&16&&c!==(c=(B[4]?B[4].username:"")+"")&&si(h,c),$[0]&16&&x!==(x=(B[4]?B[4].username:"")+"")&&si(v,x),k&&Jr(k.update)&&$[0]&128&&k.update.call(null,{callback:B[40],state:B[7]})},d(B){B&&Bt(e),L=!1,cr(z)}}}function lD(i){let e,t,s;function c(p){i[47](p)}let h={};return i[3]!==void 0&&(h.showAppearance=i[3]),e=new YL({props:h}),wi.push(()=>_o(e,"showAppearance",c)),{c(){mr(e.$$.fragment)},m(p,r){dr(e,p,r),s=!0},p(p,r){let x={};!t&&r[0]&8&&(t=!0,x.showAppearance=p[3],po(()=>t=!1)),e.$set(x)},i(p){s||(ri(e.$$.fragment,p),s=!0)},o(p){mi(e.$$.fragment,p),s=!1},d(p){fr(e,p)}}}function zG(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L,z,B,$,H,G,le,te,ue,me,se,Y,ye,Xe,ge,re,ve,ae,de,xe,De,Ce,pe,xt,Ct,ct,Qe,zt,Zt,Lt,Re,qt,nt,at,St,ut,Ot,Pn,bn,wn,xn,ei,ze,Ae,gt,Rt,Xt,gn,Tn,Ee,et,rn,tn;function Je(ln,li){return ln[0]===ln[20]?RG:ln[0]===ln[21]?DG:LG}let sn=Je(i,[-1,-1,-1]),nn=sn(i),An=i[10]!=i[22]&&iD(i),Et=i[10]===i[22]&&rD(i);function Dn(ln){i[46](ln)}let un={};i[2]!==void 0&&(un.show=i[2]),wn=new HL({props:un}),wi.push(()=>_o(wn,"show",Dn));let Nn=!i[1]&&sD(i),Kn=i[1]&&oD(i),Gn=i[7]==="OPEN"&&aD(i),Ei=i[3]==="OPEN"&&lD(i);return gn=new nD({}),{c(){e=Ie("div"),t=Ie("div"),s=Ie("div"),c=Ie("button"),c.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radio button-svg svelte-qpuaqj"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"></path><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"></path><circle cx="12" cy="12" r="2"></circle><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"></path><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"></path></svg> 
                <span class="button-span svelte-qpuaqj" text="Live">Live</span>`,h=ot(),p=Ie("button"),p.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rows-2 button-svg svelte-qpuaqj"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M3 12h18"></path></svg> 
                <span class="button-span svelte-qpuaqj" text="Dual Map">Dual Map</span>`,r=ot(),x=Ie("div"),v=Ie("button"),nn.c(),w=ot(),S=Ie("span"),S.textContent="3D",A=ot(),I=ii("svg"),R=ii("path"),k=ot(),L=Ie("div"),z=Ie("div"),B=Ie("input"),H=ot(),G=Ie("label"),G.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-axis-3d button-svg svelte-qpuaqj"><path d="M4 4v16h16"></path><path d="m4 20 7-7"></path></svg> 
                            <span class="button-span svelte-qpuaqj">Off</span>`,le=ot(),te=Ie("div"),ue=Ie("input"),se=ot(),Y=Ie("label"),Y.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-box button-svg svelte-qpuaqj"><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path><path d="m3.3 7 8.7 5 8.7-5"></path><path d="M12 22V12"></path></svg> 
                            <span class="button-span svelte-qpuaqj">Volume Render</span>`,ye=ot(),Xe=Ie("div"),ge=Ie("input"),ve=ot(),ae=Ie("label"),ae.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scissors-line-dashed button-svg svelte-qpuaqj"><path d="M5.42 9.42 8 12"></path><circle cx="4" cy="8" r="2"></circle><path d="m14 6-8.58 8.58"></path><circle cx="4" cy="16" r="2"></circle><path d="M10.8 14.8 14 18"></path><path d="M16 12h-2"></path><path d="M22 12h-2"></path></svg> 
                        <span class="button-span svelte-qpuaqj">Cross Section</span>`,xe=ot(),De=Ie("button"),De.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-binary button-svg svelte-qpuaqj"><rect x="14" y="14" width="4" height="6" rx="2"></rect><rect x="6" y="4" width="4" height="6" rx="2"></rect><path d="M6 20h4"></path><path d="M14 10h4"></path><path d="M6 14h2v6"></path><path d="M14 4h2v6"></path></svg> 
                <span class="button-span svelte-qpuaqj">Dealias</span>`,Ce=ot(),An&&An.c(),pe=ot(),xt=Ie("div"),Ct=ot(),ct=Ie("div"),Qe=Ie("div"),Et&&Et.c(),zt=ot(),Zt=Ie("button"),Zt.textContent="Sites",Lt=ot(),Re=Ie("button"),Re.textContent="Trending",qt=ot(),nt=Ie("div"),at=Ie("div"),St=Ie("button"),St.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-palette button-svg svelte-qpuaqj"><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"></circle><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"></circle><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"></circle><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"></circle><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"></path></svg> 
           <span class="button-span svelte-qpuaqj">Appearance</span>`,ut=ot(),Ot=Ie("div"),Pn=Ie("button"),Pn.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book button-svg svelte-qpuaqj"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20"></path></svg> 
                <span class="span-svg">About</span>`,bn=ot(),mr(wn.$$.fragment),ze=ot(),Nn&&Nn.c(),Ae=ot(),Kn&&Kn.c(),gt=ot(),Gn&&Gn.c(),Rt=ot(),Ei&&Ei.c(),Xt=ot(),mr(gn.$$.fragment),Tn=ot(),Ee=Ie("div"),Z(c,"class","main svelte-qpuaqj"),Rn(c,"active",i[10]===i[22]),Z(p,"class","main svelte-qpuaqj"),Rn(p,"active",i[18]===Er),Z(S,"class","button-span svelte-qpuaqj"),Z(S,"text","Dual Map"),Z(R,"d","m6 9 6 6 6-6"),Z(I,"xmlns","http://www.w3.org/2000/svg"),Z(I,"width","18"),Z(I,"height","18"),Z(I,"viewBox","0 0 24 24"),Z(I,"fill","none"),Z(I,"stroke","currentColor"),Z(I,"stroke-width","2"),Z(I,"stroke-linecap","round"),Z(I,"stroke-linejoin","round"),Z(I,"class","lucide lucide-chevron-down button-svg down svelte-qpuaqj"),Z(v,"class","main sub svelte-qpuaqj"),Rn(v,"active",i[0]===i[20]||i[0]===i[21]),Z(B,"type","radio"),Z(B,"id","off"),Z(B,"name","modes"),B.__value="off",B.value=B.__value,B.disabled=$=i[17]===null||i[15][i[17]]===void 0,Z(B,"class","svelte-qpuaqj"),i[43][0].push(B),Z(G,"for","off"),Z(G,"class","radio-button svelte-qpuaqj"),Z(ue,"type","radio"),Z(ue,"id","cube"),Z(ue,"name","modes"),ue.__value="cube",ue.value=ue.__value,ue.disabled=me=i[17]===null||i[15][i[17]]===void 0,Z(ue,"class","svelte-qpuaqj"),i[43][0].push(ue),Z(Y,"for","cube"),Z(Y,"class","radio-button svelte-qpuaqj"),Rn(Y,"disabled",i[17]===null||i[15][i[17]]===void 0),Z(ge,"type","radio"),Z(ge,"id","cross"),Z(ge,"name","modes"),ge.__value="cross",ge.value=ge.__value,ge.disabled=re=i[17]===null||i[15][i[17]]===void 0,Z(ge,"class","svelte-qpuaqj"),i[43][0].push(ge),Z(ae,"for","cross"),Z(ae,"class","radio-button svelte-qpuaqj"),Rn(ae,"disabled",i[17]===null||i[15][i[17]]===void 0),Z(L,"class","submenu svelte-qpuaqj"),Rn(L,"flex",i[6]==="OPEN"),Z(x,"class","sub-parent svelte-qpuaqj"),Z(De,"class","main svelte-qpuaqj"),Rn(De,"active",i[16]===i[19]),Z(xt,"class","shadow svelte-qpuaqj"),Z(s,"class","left-button-container svelte-qpuaqj"),Z(Zt,"class","layer-button svelte-qpuaqj"),Rn(Zt,"layer-active",!!i[14]),Z(Re,"class","layer-button svelte-qpuaqj"),Rn(Re,"layer-active",!!i[13]),Z(Qe,"class","layer-container svelte-qpuaqj"),Z(ct,"class","layer-group svelte-qpuaqj"),Z(t,"class","leftgroup svelte-qpuaqj"),Z(St,"class","main svelte-qpuaqj"),Rn(St,"active",i[3]==="OPEN"),Z(Pn,"class","main svelte-qpuaqj"),Rn(Pn,"active",i[2]==="OPEN"),Z(Ee,"class","shadow-right svelte-qpuaqj"),Z(at,"class","right-button-container svelte-qpuaqj"),Z(nt,"class","rightgroup svelte-qpuaqj"),Z(e,"class","barContainer svelte-qpuaqj")},m(ln,li){Gt(ln,e,li),Q(e,t),Q(t,s),Q(s,c),Q(s,h),Q(s,p),Q(s,r),Q(s,x),Q(x,v),nn.m(v,null),Q(v,w),Q(v,S),Q(v,A),Q(v,I),Q(I,R),Q(x,k),Q(x,L),Q(L,z),Q(z,B),B.checked=B.__value===i[5],Q(z,H),Q(z,G),Q(L,le),Q(L,te),Q(te,ue),ue.checked=ue.__value===i[5],Q(te,se),Q(te,Y),Q(L,ye),Q(L,Xe),Q(Xe,ge),ge.checked=ge.__value===i[5],Q(Xe,ve),Q(Xe,ae),Q(s,xe),Q(s,De),Q(s,Ce),An&&An.m(s,null),Q(s,pe),Q(s,xt),Q(t,Ct),Q(t,ct),Q(ct,Qe),Et&&Et.m(Qe,null),Q(Qe,zt),Q(Qe,Zt),Q(Qe,Lt),Q(Qe,Re),Q(e,qt),Q(e,nt),Q(nt,at),Q(at,St),Q(at,ut),Q(at,Ot),Q(Ot,Pn),Q(Ot,bn),dr(wn,Ot,null),Q(at,ze),Nn&&Nn.m(at,null),Q(at,Ae),Kn&&Kn.m(at,null),Q(at,gt),Gn&&Gn.m(at,null),Q(at,Rt),Ei&&Ei.m(at,null),Q(at,Xt),dr(gn,at,null),Q(at,Tn),Q(at,Ee),et=!0,rn||(tn=[mn(c,"click",i[30]),mn(p,"click",i[23]),mn(v,"click",i[37]),mn(B,"change",i[42]),mn(G,"click",i[24]),mn(ue,"change",i[44]),mn(Y,"click",i[25]),mn(ge,"change",i[45]),mn(ae,"click",i[26]),Cl(de=du.call(null,x,{callback:i[39],state:i[6]})),mn(De,"click",i[27]),mn(Zt,"click",i[31]),mn(Re,"click",i[32]),mn(St,"click",i[29]),mn(Pn,"click",i[28]),Cl(ei=du.call(null,Ot,{callback:i[41],state:i[2]}))],rn=!0)},p(ln,li){li[0]&4195328&&Rn(c,"active",ln[10]===ln[22]),li[0]&262144&&Rn(p,"active",ln[18]===Er),sn!==(sn=Je(ln,li))&&(nn.d(1),nn=sn(ln),nn&&(nn.c(),nn.m(v,w))),li[0]&3145729&&Rn(v,"active",ln[0]===ln[20]||ln[0]===ln[21]),(!et||li[0]&163840&&$!==($=ln[17]===null||ln[15][ln[17]]===void 0))&&(B.disabled=$),li[0]&32&&(B.checked=B.__value===ln[5]),(!et||li[0]&163840&&me!==(me=ln[17]===null||ln[15][ln[17]]===void 0))&&(ue.disabled=me),li[0]&32&&(ue.checked=ue.__value===ln[5]),li[0]&163840&&Rn(Y,"disabled",ln[17]===null||ln[15][ln[17]]===void 0),(!et||li[0]&163840&&re!==(re=ln[17]===null||ln[15][ln[17]]===void 0))&&(ge.disabled=re),li[0]&32&&(ge.checked=ge.__value===ln[5]),li[0]&163840&&Rn(ae,"disabled",ln[17]===null||ln[15][ln[17]]===void 0),li[0]&64&&Rn(L,"flex",ln[6]==="OPEN"),de&&Jr(de.update)&&li[0]&64&&de.update.call(null,{callback:ln[39],state:ln[6]}),li[0]&589824&&Rn(De,"active",ln[16]===ln[19]),ln[10]!=ln[22]?An?An.p(ln,li):(An=iD(ln),An.c(),An.m(s,pe)):An&&(An.d(1),An=null),ln[10]===ln[22]?Et?Et.p(ln,li):(Et=rD(ln),Et.c(),Et.m(Qe,zt)):Et&&(Et.d(1),Et=null),li[0]&16384&&Rn(Zt,"layer-active",!!ln[14]),li[0]&8192&&Rn(Re,"layer-active",!!ln[13]),li[0]&8&&Rn(St,"active",ln[3]==="OPEN"),li[0]&4&&Rn(Pn,"active",ln[2]==="OPEN");let $t={};!xn&&li[0]&4&&(xn=!0,$t.show=ln[2],po(()=>xn=!1)),wn.$set($t),ei&&Jr(ei.update)&&li[0]&4&&ei.update.call(null,{callback:ln[41],state:ln[2]}),ln[1]?Nn&&(Nn.d(1),Nn=null):Nn?Nn.p(ln,li):(Nn=sD(ln),Nn.c(),Nn.m(at,Ae)),ln[1]?Kn?Kn.p(ln,li):(Kn=oD(ln),Kn.c(),Kn.m(at,gt)):Kn&&(Kn.d(1),Kn=null),ln[7]==="OPEN"?Gn?Gn.p(ln,li):(Gn=aD(ln),Gn.c(),Gn.m(at,Rt)):Gn&&(Gn.d(1),Gn=null),ln[3]==="OPEN"?Ei?(Ei.p(ln,li),li[0]&8&&ri(Ei,1)):(Ei=lD(ln),Ei.c(),ri(Ei,1),Ei.m(at,Xt)):Ei&&(mo(),mi(Ei,1,1,()=>{Ei=null}),go())},i(ln){et||(ri(wn.$$.fragment,ln),ri(Ei),ri(gn.$$.fragment,ln),et=!0)},o(ln){mi(wn.$$.fragment,ln),mi(Ei),mi(gn.$$.fragment,ln),et=!1},d(ln){ln&&Bt(e),nn.d(),i[43][0].splice(i[43][0].indexOf(B),1),i[43][0].splice(i[43][0].indexOf(ue),1),i[43][0].splice(i[43][0].indexOf(ge),1),An&&An.d(),Et&&Et.d(),fr(wn),Nn&&Nn.d(),Kn&&Kn.d(),Gn&&Gn.d(),Ei&&Ei.d(),fr(gn),rn=!1,cr(tn)}}}function kG(){window.open("/auth/account","_blank")}async function PG(){window.location.href="/auth/signin"}function OG(i,e,t){let s,c,h,p,r,x,v,w,S,A,I,R,k,L,z,B,$,H,G,le;It(i,Xr,et=>t(0,s=et)),It(i,ah,et=>t(1,c=et)),It(i,gf,et=>t(8,h=et)),It(i,Gc,et=>t(9,p=et)),It(i,Ds,et=>t(10,r=et)),It(i,Vc,et=>t(48,x=et)),It(i,Uc,et=>t(11,v=et)),It(i,Fl,et=>t(12,w=et)),It(i,yh,et=>t(49,S=et)),It(i,Bc,et=>t(13,A=et)),It(i,_h,et=>t(14,I=et)),It(i,Sr,et=>t(50,R=et)),It(i,ni,et=>t(15,k=et)),It(i,Js,et=>t(51,L=et)),It(i,kl,et=>t(16,z=et)),It(i,Ya,et=>t(52,B=et)),It(i,_i,et=>t(53,$=et)),It(i,Cs,et=>t(54,H=et)),It(i,ya,et=>t(17,G=et)),It(i,$r,et=>t(18,le=et));let te=Lo(),{DEALIASED:ue,RAW:me}=Ka,{READING:se,MODE3D:Y,CROSS:ye}=vs,{HISTORICAL:Xe,LIVE:ge}=vo,re="CLOSED",ve="CLOSED",ae,de,xe="off",De="CLOSED",Ce="CLOSED";function pe(){le===Py?on($r,le=Er,le):le===Er?on($r,le=Pl,le):le===Pl&&(on($r,le=Er,le),te("message",{value:"activateMap",idx:1}))}function xt(){s===Y&&(te("message",{value:"removeBox"}),te("message",{value:"removeLine"})),s===ye&&(te("message",{value:"removeLine"}),te("message",{value:"removeBox"})),on(Xr,s=se,s),t(5,xe="off")}function Ct(){if(G===null||k[G]===void 0){on(Xr,s=se,s);return}if(on(Xr,s=s===Y?se:Y,s),s===Y)if(H[$[0].file]===void 0||k[$[0].file].scans.length!=H[$[0].file].elevations.length){let et={data:{fileNum:$[0].file,idx:255,field:254,fileName:$[0].scan.fileName,priority:80,map:-1,message:"read3DBytes",selections:$,scans:k}};Ur.submit(et),on(Ya,B=!0,B)}else te("message",{value:"loadTexture"});else te("message",{value:"removeBox"}),te("message",{value:"removeLine"})}function ct(){if(G===null||k[G]===void 0){on(Xr,s=se,s);return}if(on(Xr,s=s===ye?se:ye,s),s===ye)if(H[$[0].file]===void 0||k[$[0].file].scans.length!=H[$[0].file].elevations.length){let et={data:{fileNum:$[0].file,idx:255,field:254,fileName:$[0].scan.fileName,priority:80,map:-1,message:"read3DBytes",selections:$,scans:k}};Ur.submit(et),on(Ya,B=!0,B)}else te("message",{value:"loadTexture"});else te("message",{value:"removeLine"}),te("message",{value:"removeBox"})}function Qe(){on(kl,z=z===ue?me:ue,z),te("message",{value:"setDealiasState"})}function zt(et){t(2,re=re==="OPEN"?"CLOSED":"OPEN")}function Zt(et){ve==="OPEN"?t(3,ve="CLOSED"):t(3,ve="OPEN")}async function Lt(){L&&rr.handleAnimateClick();for(let et=0;et<k.length;et++)k[et]&&k[et].fileNumber>=0&&sh(k[et].fileNumber);on(Ds,r=Xe,r),te("message",{value:"deactivateSites",site:"XXXX"}),on(Fl,w=!1,w),on(Sr,R=!1,R),on(Uc,v=!1,v),on(Vc,x=!1,x),zi.ws&&zi.ws.close()}async function Re(){if(r===Xe&&!c){Ta.update(et=>(et.error=!0,et.message="An account is needed to view live radar. Create a free account or log in to an existing account.",et.header="Not logged in",et.page="signup",et));return}L&&rr.handleAnimateClick();for(let et=0;et<k.length;et++)k[et]&&k[et].fileNumber>=0&&sh(k[et].fileNumber);if(on(Ds,r=r===Xe?ge:Xe,r),xt(),r===ge){on(Fl,w=!0,w),on(_h,I=!0,I),on(Gc,p=!1,p);let et=await wh.getUser();et&&et.tier!=="paid"&&!et.feature_flags.includes("launch_beta")&&(t(6,De="CLOSED"),on(Xr,s=se,s)),zi.ws&&zi.ws.isAlive||zi.connect(gr.token).then(function(rn){te("message",{value:"showSites"}),te("message",{value:"showAlerts"}),te("message",{value:"deactivateSites",site:zi.site})}).catch(function(rn){console.log("ws connect failed",rn)})}else te("message",{value:"deactivateSites",site:"XXXX"}),on(Fl,w=!1,w),on(Sr,R=!1,R),on(Uc,v=!1,v),on(Vc,x=!1,x),zi.ws&&zi.ws.close()}function qt(){I?on(_h,I=!1,I):(on(_h,I=!0,I),te("message",{value:"showSites"}))}function nt(){A?(on(Bc,A=!1,A),on(yh,S=!1,S),ib.clear()):(on(Bc,A=!0,A),on(yh,S=!0,S),ib.start())}function at(){w?on(Fl,w=!1,w):on(Fl,w=!0,w)}function St(){v?on(Uc,v=!1,v):on(Uc,v=!0,v)}function ut(){x?on(Vc,x=!1,x):on(Vc,x=!0,x)}async function Ot(){wh.logout()}function Pn(et){h==="open"?(on(gf,h="closed",h),t(7,Ce="CLOSED")):(on(gf,h="open",h),t(7,Ce="OPEN"))}async function bn(){c&&wh&&t(4,de=await wh.getUser()),!c&&zi&&zi.ws&&Lt()}async function wn(){if(De==="OPEN")t(6,De="CLOSED");else{let et=await wh.getUser();if(et&&et.tier!=="paid"&&!et.feature_flags.includes("launch_beta")&&r===ge){Ta.update(rn=>(rn.error=!0,rn.message="A subscription to QuadWeather Extra is needed to view live 3D data. Join the launch beta in your account.",rn.header="Missing permission",rn.page="account",rn));return}t(6,De="OPEN")}}async function xn(){if(p){on(Gc,p=!1,p);return}let et=await wh.getUser();if(!et||et.tier!=="paid"&&!et.feature_flags.includes("launch_beta")){Ta.update(rn=>(rn.error=!0,rn.message="A subscription to QuadWeather Extra is needed to view archive data. Join the launch beta in your account.",rn.header="Missing permission",rn.page="account",rn));return}on(Gc,p=!0,p)}function ei(){t(6,De="CLOSED")}function ze(){t(7,Ce="CLOSED"),h==="open"?on(gf,h="closed",h):on(gf,h="open",h)}function Ae(){t(2,re="CLOSED")}let gt=[[]];function Rt(){xe=this.__value,t(5,xe)}function Xt(){xe=this.__value,t(5,xe)}function gn(){xe=this.__value,t(5,xe)}function Tn(et){re=et,t(2,re)}function Ee(et){ve=et,t(3,ve)}return i.$$.update=()=>{if(i.$$.dirty[0]&2){e:bn()}if(i.$$.dirty[0]&1){e:ei()}},[s,c,re,ve,de,xe,De,Ce,h,p,r,v,w,A,I,k,z,G,le,ue,Y,ye,ge,pe,xt,Ct,ct,Qe,zt,Zt,Re,qt,nt,at,St,Ot,Pn,wn,xn,ei,ze,Ae,Rt,gt,Xt,gn,Tn,Ee]}var cD=class extends gi{constructor(e){super();Ti(this,e,OG,zG,ai,{},null,[-1,-1,-1])}},uD=cD;function NG(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L;return{c(){e=Ie("div"),t=Ie("div"),s=Ie("p"),c=On(i[0]),h=ot(),p=Ie("div"),r=Ie("div"),x=Ie("p"),v=On(i[1]),w=ot(),S=Ie("div"),A=Ie("button"),A.textContent="Account",I=ot(),R=Ie("button"),R.textContent="Close",Z(s,"class","header-text svelte-tefax4"),Z(t,"class","notice-header svelte-tefax4"),Z(r,"class","body-text svelte-tefax4"),Z(p,"class","notice-body svelte-tefax4"),Z(A,"class","svelte-tefax4"),Z(R,"class","svelte-tefax4"),Z(S,"class","close svelte-tefax4"),Z(e,"class","notice-wrapper svelte-tefax4")},m(z,B){Gt(z,e,B),Q(e,t),Q(t,s),Q(s,c),Q(e,h),Q(e,p),Q(p,r),Q(r,x),Q(x,v),Q(e,w),Q(e,S),Q(S,A),Q(S,I),Q(S,R),k||(L=[mn(A,"click",i[2]),mn(R,"click",i[3])],k=!0)},p(z,[B]){B&1&&si(c,z[0]),B&2&&si(v,z[1])},i:Vn,o:Vn,d(z){z&&Bt(e),k=!1,cr(L)}}}function FG(i,e,t){let s;It(i,Ta,w=>t(5,s=w));let{header:c}=e,{body:h}=e,{page:p}=e,r=Lo();async function x(){let w;try{let S=await gr.getRefresh();gr.setToken(S),w=!0}catch(S){w=!1}w?p==="account"?window.location.href="https://radar.quadweather.com/auth/account":p==="signup"&&(window.location.href="https://radar.quadweather.com/auth/signin"):window.location.href="https://radar.quadweather.com/auth/signin",v()}function v(){on(Ta,s.error=!1,s),r("message",{value:"hideModal"})}return i.$$set=w=>{"header"in w&&t(0,c=w.header),"body"in w&&t(1,h=w.body),"page"in w&&t(4,p=w.page)},[c,h,x,v,p]}var hD=class extends gi{constructor(e){super();Ti(this,e,FG,NG,ai,{header:0,body:1,page:4})}},dD=hD;function BG(){}function UG(i,e,t){let s,c,h,p,r,x,v,w,S,A;It(i,$y,ue=>t(0,s=ue)),It(i,Ta,ue=>t(1,c=ue)),It(i,Zi,ue=>t(2,h=ue)),It(i,ya,ue=>t(3,p=ue)),It(i,Ys,ue=>t(4,r=ue)),It(i,Rl,ue=>t(5,x=ue)),It(i,_i,ue=>t(6,v=ue)),It(i,Xr,ue=>t(9,w=ue)),It(i,Cs,ue=>t(10,S=ue)),It(i,$r,ue=>t(7,A=ue));let{READING:I,MODE3D:R,CROSS:k}=vs,L=Lo(),z;function B(){for(let ue=0;ue<z;ue++)if(!!v[ue]&&r[v[ue].file]!==void 0){if(r[v[ue].file][v[ue].type][v[ue].elevation]===void 0)continue;L("message",{value:"loadVertices",idx:ue})}}function $(){for(let ue=0;ue<z;ue++)if(!!v[ue]&&!(v[ue].file===null||r[v[ue].file]===void 0)){if(r[v[ue].file][v[ue].type][v[ue].elevation]===void 0)continue;L("message",{value:"loadVertices",idx:ue})}}function H(){if(w===R||w===k){if(S[v[0].file]===void 0)return;L("message",{value:"loadTexture"})}}function G(){h.error&&L("message",{value:"showError"})}function le(){c.error&&L("message",{value:"showModal"})}function te(){if(s){for(let ue=0;ue<z;ue++)L("message",{value:"clearMap",idx:ue});w===R&&L("message",{value:"removeBox"}),w===k&&L("message",{value:"removeLine"}),on($y,s=!1,s)}}return i.$$.update=()=>{if(i.$$.dirty&128){e:A===Er?z=2:z=1}if(i.$$.dirty&64){e:B()}if(i.$$.dirty&32){e:BG()}if(i.$$.dirty&16){e:$()}if(i.$$.dirty&8){e:H()}if(i.$$.dirty&4){e:G()}if(i.$$.dirty&2){e:le()}if(i.$$.dirty&1){e:te()}},[s,c,h,p,r,x,v,A]}var fD=class extends gi{constructor(e){super();Ti(this,e,UG,null,ai,{})}},pD=fD;function VG(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k;return{c(){e=Ie("div"),t=Ie("div"),s=Ie("p"),c=On(i[0]),p=ot(),r=Ie("div"),x=Ie("div"),v=Ie("p"),w=On(i[1]),S=ot(),A=Ie("div"),I=Ie("button"),I.textContent="Okay",Z(s,"class","header-text svelte-1knftiy"),Z(t,"class",h=""+(fo(`notice-header ${i[2]}`)+" svelte-1knftiy")),Z(x,"class","body-text svelte-1knftiy"),Z(r,"class","notice-body svelte-1knftiy"),Z(I,"class","svelte-1knftiy"),Z(A,"class","close svelte-1knftiy"),Z(e,"class","notice-wrapper svelte-1knftiy")},m(L,z){Gt(L,e,z),Q(e,t),Q(t,s),Q(s,c),Q(e,p),Q(e,r),Q(r,x),Q(x,v),Q(v,w),Q(e,S),Q(e,A),Q(A,I),R||(k=mn(I,"click",i[3]),R=!0)},p(L,[z]){z&1&&si(c,L[0]),z&4&&h!==(h=""+(fo(`notice-header ${L[2]}`)+" svelte-1knftiy"))&&Z(t,"class",h),z&2&&si(w,L[1])},i:Vn,o:Vn,d(L){L&&Bt(e),R=!1,k()}}}function GG(i,e,t){let s;It(i,Zi,v=>t(4,s=v));let{header:c}=e,{body:h}=e,{className:p}=e,r=Lo();function x(){on(Zi,s.error=!1,s),on(Zi,s.color=null,s),r("message",{value:"hideError"})}return i.$$set=v=>{"header"in v&&t(0,c=v.header),"body"in v&&t(1,h=v.body),"className"in v&&t(2,p=v.className)},[c,h,p,x]}var mD=class extends gi{constructor(e){super();Ti(this,e,GG,VG,ai,{header:0,body:1,className:2})}},gD=mD;var{window:HG}=u1;function _D(i){let e,t;return{c(){e=Ie("hr"),Z(e,"class",t="line "+(i[13]==="horizontal"?"":"vertical-line")+" svelte-ujmhx0")},m(s,c){Gt(s,e,c)},p(s,c){c[0]&8192&&t!==(t="line "+(s[13]==="horizontal"?"":"vertical-line")+" svelte-ujmhx0")&&Z(e,"class",t)},d(s){s&&Bt(e)}}}function yD(i){let e,t,s={show:i[1],idx:1};return e=new DT({props:s}),i[19](e),e.$on("message",i[14]),{c(){mr(e.$$.fragment)},m(c,h){dr(e,c,h),t=!0},p(c,h){let p={};h[0]&2&&(p.show=c[1]),e.$set(p)},i(c){t||(ri(e.$$.fragment,c),t=!0)},o(c){mi(e.$$.fragment,c),t=!1},d(c){i[19](null),fr(e,c)}}}function jG(i){let e;return{c(){e=Ie("div"),e.innerHTML='<div class="lds-ripple svelte-ujmhx0"><div class="svelte-ujmhx0"></div><div class="svelte-ujmhx0"></div></div>',Z(e,"class","loading svelte-ujmhx0")},m(t,s){Gt(t,e,s)},d(t){t&&Bt(e)}}}function vD(i){let e,t;return e=new gD({props:{header:i[4],body:i[5],className:i[6]}}),e.$on("message",i[14]),{c(){mr(e.$$.fragment)},m(s,c){dr(e,s,c),t=!0},p(s,c){let h={};c[0]&16&&(h.header=s[4]),c[0]&32&&(h.body=s[5]),c[0]&64&&(h.className=s[6]),e.$set(h)},i(s){t||(ri(e.$$.fragment,s),t=!0)},o(s){mi(e.$$.fragment,s),t=!1},d(s){fr(e,s)}}}function xD(i){let e,t;return e=new dD({props:{header:i[7],body:i[8],page:i[9]}}),e.$on("message",i[14]),{c(){mr(e.$$.fragment)},m(s,c){dr(e,s,c),t=!0},p(s,c){let h={};c[0]&128&&(h.header=s[7]),c[0]&256&&(h.body=s[8]),c[0]&512&&(h.page=s[9]),e.$set(h)},i(s){t||(ri(e.$$.fragment,s),t=!0)},o(s){mi(e.$$.fragment,s),t=!1},d(s){fr(e,s)}}}function qG(i){let e,t,s,c,h,p,r,x,v,w,S,A,I,R,k,L,z,B,$,H,G;t=new uD({}),t.$on("message",i[14]);function le(re){i[16](re)}function te(re){i[17](re)}let ue={};i[10]!==void 0&&(ue.elevationFunctions=i[10]),i[11]!==void 0&&(ue.canvas=i[11]),h=new uL({props:ue}),wi.push(()=>_o(h,"elevationFunctions",le)),wi.push(()=>_o(h,"canvas",te));let me={show:!0,idx:0};w=new DT({props:me}),i[18](w),w.$on("message",i[14]);let se=i[0]===Er&&_D(i),Y=(i[0]===Er||i[0]===Pl)&&yD(i);k=new pD({}),k.$on("message",i[14]);let ye=WG&&jG(i),Xe=i[2]&&vD(i),ge=i[3]&&xD(i);return{c(){e=Ie("div"),mr(t.$$.fragment),s=ot(),c=Ie("div"),mr(h.$$.fragment),x=ot(),v=Ie("div"),mr(w.$$.fragment),S=ot(),se&&se.c(),A=ot(),Y&&Y.c(),R=ot(),mr(k.$$.fragment),L=ot(),ye&&ye.c(),z=ot(),Xe&&Xe.c(),B=ot(),ge&&ge.c(),Z(v,"class",I="map-display "+(i[13]==="horizontal"?"":"vertical")+" svelte-ujmhx0"),Z(c,"class","main-display svelte-ujmhx0"),Z(e,"class","parent svelte-ujmhx0")},m(re,ve){Gt(re,e,ve),dr(t,e,null),Q(e,s),Q(e,c),dr(h,c,null),Q(c,x),Q(c,v),dr(w,v,null),Q(v,S),se&&se.m(v,null),Q(v,A),Y&&Y.m(v,null),Q(c,R),dr(k,c,null),Q(c,L),ye&&ye.m(c,null),Q(e,z),Xe&&Xe.m(e,null),Q(e,B),ge&&ge.m(e,null),$=!0,H||(G=mn(HG,"keydown",i[15]),H=!0)},p(re,ve){let ae={};!p&&ve[0]&1024&&(p=!0,ae.elevationFunctions=re[10],po(()=>p=!1)),!r&&ve[0]&2048&&(r=!0,ae.canvas=re[11],po(()=>r=!1)),h.$set(ae);let de={};w.$set(de),re[0]===Er?se?se.p(re,ve):(se=_D(re),se.c(),se.m(v,A)):se&&(se.d(1),se=null),re[0]===Er||re[0]===Pl?Y?(Y.p(re,ve),ve[0]&1&&ri(Y,1)):(Y=yD(re),Y.c(),ri(Y,1),Y.m(v,null)):Y&&(mo(),mi(Y,1,1,()=>{Y=null}),go()),(!$||ve[0]&8192&&I!==(I="map-display "+(re[13]==="horizontal"?"":"vertical")+" svelte-ujmhx0"))&&Z(v,"class",I),re[2]?Xe?(Xe.p(re,ve),ve[0]&4&&ri(Xe,1)):(Xe=vD(re),Xe.c(),ri(Xe,1),Xe.m(e,B)):Xe&&(mo(),mi(Xe,1,1,()=>{Xe=null}),go()),re[3]?ge?(ge.p(re,ve),ve[0]&8&&ri(ge,1)):(ge=xD(re),ge.c(),ri(ge,1),ge.m(e,null)):ge&&(mo(),mi(ge,1,1,()=>{ge=null}),go())},i(re){$||(ri(t.$$.fragment,re),ri(h.$$.fragment,re),ri(w.$$.fragment,re),ri(Y),ri(k.$$.fragment,re),ri(Xe),ri(ge),$=!0)},o(re){mi(t.$$.fragment,re),mi(h.$$.fragment,re),mi(w.$$.fragment,re),mi(Y),mi(k.$$.fragment,re),mi(Xe),mi(ge),$=!1},d(re){re&&Bt(e),fr(t),fr(h),i[18](null),fr(w),se&&se.d(),Y&&Y.d(),fr(k),ye&&ye.d(),Xe&&Xe.d(),ge&&ge.d(),H=!1,G()}}}var WG=!1;function XG(i,e,t){let s,c,h,p,r,x;It(i,qr,xe=>t(22,s=xe)),It(i,Jm,xe=>t(23,c=xe)),It(i,Ta,xe=>t(24,h=xe)),It(i,Zi,xe=>t(25,p=xe)),It(i,$r,xe=>t(0,r=xe)),It(i,Ea,xe=>t(13,x=xe));let{ELEVATION:v,FILE:w}=Qd,{MODE3D:S,CROSS:A}=vs,I=!1,R=!1,k=!1,L=new Set([0]),z,B,$,H,G,le,te,ue,me={};function se(xe){if(xe.detail.value==="setBox"){let De=new Set([xe.detail.idx]);new Set([...L].filter(pe=>!De.has(pe))).forEach(pe=>me[pe].handleMessage(xe))}else if(xe.detail.value==="removeBox")Array.from(L).forEach(Ce=>me[Ce].handleMessage(xe)),ue.removeMeshes(S);else if(xe.detail.value==="setLine"){let De=new Set([xe.detail.idx]);new Set([...L].filter(pe=>!De.has(pe))).forEach(pe=>me[pe].handleMessage(xe))}else if(xe.detail.value==="removeLine")Array.from(L).forEach(Ce=>me[Ce].handleMessage(xe)),ue.removeMeshes(A);else if(xe.detail.value==="readValue"){let De=new Set([xe.detail.idx]);new Set([...L].filter(pe=>!De.has(pe))).forEach(pe=>me[pe].handleMessage(xe))}else if(xe.detail.value==="showHide"){let De=new Set([xe.detail.idx]);new Set([...L].filter(pe=>!De.has(pe))).forEach(pe=>me[pe].handleMessage(xe))}else if(xe.detail.value==="showSites"||xe.detail.value==="showAlerts"||xe.detail.value==="showStatements"||xe.detail.value==="showLightning"||xe.detail.value==="deactivateSites")for(let De in me)me[De].handleMessage(xe);else xe.detail.value==="setDealiasState"?Array.from(L).forEach(Ce=>me[Ce].handleMessage(xe)):xe.detail.value==="loadTexture"?ue.loadTexture():xe.detail.value==="showError"?(t(4,z=p.header),t(5,B=p.message),p.color?t(6,$="header-message"):t(6,$="header-error"),t(2,R=!0)):xe.detail.value==="showModal"?(t(7,H=h.header),t(8,G=h.message),t(9,le=h.page),t(3,k=!0)):xe.detail.value==="hideError"?t(2,R=!1):xe.detail.value==="hideModal"?t(3,k=!1):me[xe.detail.idx].handleMessage(xe)}function Y(xe){xe.keyCode===37?(c===v||c===w)&&rr.previous():xe.keyCode===39&&(c===v||c===w)&&rr.advance()}function ye(){requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`);for(let xe=0;xe<2;xe++)s[xe]&&s[xe].resize()})})}let Xe;function ge(){clearTimeout(Xe),Xe=setTimeout(function(){ye()},500)}Zs(async()=>{window.addEventListener("resize",ge),window.addEventListener("orientationchange",ge),ye()});function re(xe){te=xe,t(10,te)}function ve(xe){ue=xe,t(11,ue)}function ae(xe){wi[xe?"unshift":"push"](()=>{me[0]=xe,t(12,me)})}function de(xe){wi[xe?"unshift":"push"](()=>{me[1]=xe,t(12,me)})}return i.$$.update=()=>{if(i.$$.dirty[0]&1){e:r===Pl?(t(1,I=!1),L=new Set([0])):r===Er&&(t(1,I=!0),L=new Set([0,1]))}},[r,I,R,k,z,B,$,H,G,le,te,ue,me,x,se,Y,re,ve,ae,de]}var bD=class extends gi{constructor(e){super();Ti(this,e,XG,qG,ai,{},null,[-1,-1])}},wD=bD;var ZG=new wD({target:document.body}),KG=ZG;export{KG as default};
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */
/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
//# sourceMappingURL=index.js.map
